<!DOCTYPE html>
<html>
    <head><link rel='icon' href='../../../../dependencies/images/triniti-corporation.png' >  
    <!-- dependencies -->
        <title>TlThread.T_Transact_Lots</title>
        <script src='../../../../dependencies/jquery/jquery.js'></script>
        <script src='../../../../dependencies/lodash/lodash.js'></script>
        <script src='../../../../dependencies/backbone/backbone.js'></script>
        <script src='../../../../dependencies/jointjs/joint.js'></script>
        <script src='../../../../dependencies/joint_helper.js'></script>
        <link rel='stylesheet' type='text/css' href='../../../../dependencies/jointjs/joint.css' />
        <link rel='stylesheet' type='text/css' href='../../../../dependencies/slider/slider.css' />
		<style type="text/css">
			:root {
			    font: Courier New;
			}
        .natural_language{
         text-transform: Uppercase;
         background: #ffffff;
         padding: 10px; 
         border: 2px solid black !important;
         border-radius: 6px;
         display: inline-block;
         transition: all 0.3s ease 0s;}
        .natural_language:hover,.natural_language:focus  {
          color: white !important;
         background-color: blue;}
        .java {
         text-transform: Uppercase;
         background: #ffffff;
         padding: 10px;
         border: 2px solid black !important;
         border-radius: 6px;
         display: inline-block;
         transition: all 0.3s ease 0s;}
        .java:hover,.java:focus {
         color: white !important;
         background-color: blue;}
          .flow-head {
           width: 100%;
 		   margin: auto;
 		   }
 		  .flow-1{
 		   width: 80%;
 		   float: left;
		   height: auto;
 			}
 		  .flow-2{
 		   width: 20%;
 		   float: left;
		   height: auto;
 			}
        .one {
        width: 12%;
        margin-top: 25px;
        float: left;
        height: auto;
        }
        .two {
        width: 88%;
        margin-top: 25px;
        float: left;
        height: auto;
        }
        .circle {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        margin-bottom: 2px;
        }
        .text {
        line-height: 15px;
        margin-bottom: 2px; 
        }
		</style>

        <script type='text/javascript'>
            var textColor = '#EEE';
            var backGroundColor = 'null';
            var strokeColor = '#000000';
            var rhombus = new joint.shapes.basic.Rhombus({
                size: {
                    width: 120, height: 60,
                    height: 60
                },
                attrs: {
                    path: {
                        d: 'M 50 0 L 0 49 0 51 50 100 100 51 100 49 z',
                        fill: '#800020',
                        stroke: strokeColor
                    },
                    text: {
                        text: 'Rhombus',
                        fill: textColor,
                    fontFamily: 'Courier New',
                    fontSize: '13px',
                    }
                }
            });
            rhombus.position(400, 30);
            rhombus.set('nodeType', 'Rhombus');

            var ellipse = new joint.shapes.basic.Circle({
                size: { 
                    width: 100, height: 40 
                },
                attrs: { 
                    text: { 
                        text: 'Ellipse', fill: textColor,
                    fontFamily: 'Courier New',
                    fontSize: '13px',
                    },
                    circle: { 
                        fill:'blue', 
                    }
                }
            });
            ellipse.position(400, 30);

            var rect = new joint.shapes.standard.Rectangle();
            rect.attr({
                body: {
                    fill: '#9400D3',
                    rx: 10,
                    ry: 10,
                    strokeWidth: 1
                },
                label: {
                    text: 'Rectangle',
                    fill: textColor,
                    fontFamily: 'Courier New',
                    fontSize: '13px',
                }
            });
            rect.position(400, 30);
            rect.resize(100, 40);
            rect.set('nodeType', 'Rectangle');

            var link = new joint.shapes.standard.Link({
                attrs: {
                    line: { 
                        strokeWidth: 1.5
                    }
                }
            });
            link.connector('rounded', { radius: 15 });
        </script>
    </head>
    <body onUnload='unLoadPage()'>
  <div class='flow-head'>
            <div class='flow-1'>
             <img height='50' width='150;' alt='Triniti' src='../../../../dependencies/images/logo_triniti.png'  /> 
        <h2 style='text-decoration:none' target='_blank'> Package : loteDapter.tlthread</h2>
        <h3><a style='text-decoration:none' target='_blank' href='index.html'>Class : TlThread</a></h3>
        <h4 style='text-decoration:none' target='_blank'> Method : T_Transact_Lots</h4>
         <p style='text-decoration:none' target='_blank'> -- Hari Krishnan Nov 06 Added(I_Resp_Id, I_Resp_Appl_Id) for Tinvadapt receive transactions</p>
  <button class='java' autofocus onClick='Java();'><b>&nbsp;&nbsp&nbsp;&nbsp; Java Language&nbsp;&nbsp&nbsp;&nbsp;</b></button>
  <button class='natural_language' onClick='NaturalLanguage();'><b>&nbsp;&nbsp&nbsp;Natural Language&nbsp;&nbsp&nbsp;</b></button>
            </div>
</div><div class='flow-2'>
         <div class='one'> 
         <div class='circle ' style='background-color: #9400D3;'></div>
         <div class='circle ' style='background-color: #800020;'></div>
         <div class='circle ' style='background-color: #F400A1;'></div>
         <div class='circle ' style='background-color: blue;'></div>
         </div>
         <div class='two'>
         <div class='text'>Initialization & Assignment</div>
         <div class='text'>Conditional</div>
         <div class='text'>Loops</div>
         <div class='text'>Method calling</div>
         </div>
              </div>
              </div>
              <div style="width: 100%; clear: both;"></div>
        <div id='nlStatementFlowChart' style='display:block;'></div>
        <script type='text/javascript'>
            var nlStatementsGraph = new joint.dia.Graph;

            var nlStatementsPaper = new joint.dia.Paper({
                el: document.getElementById('nlStatementFlowChart'),
                interactive: false,
                model: nlStatementsGraph,
                width: 1000,
                height: 13900,
                gridSize: 1
            });

            var flowChartNode;
            var resizeWidth;
            var nodesArr = [];

            nodesArr.push('Line No-5824: Assign null to i_Transaction_Id');
            nodesArr.push('Line No-5825: Assign null to i_Lot_Id');
            nodesArr.push('Line No-5826: Assign false to i_Error_Records');
            nodesArr.push('Line No-5828: Create an instance of HashMap and assign it to variable methodParams_OutputMap');
            nodesArr.push('Line No-5829: Create an instance of HashMap and assign it to variable procedureParams_OutputMap');
            nodesArr.push('Line No-5830: Initialize variable Child_Lots_Rec_ResultSet of type ResultSet as null');
            nodesArr.push('Line No-5831: Initialize variable Child_Wait_Rec_ResultSet of type ResultSet as null');
            nodesArr.push('Line No-5832: Initialize variable Child_Wait_Rec1_ResultSet of type ResultSet as null');
            nodesArr.push('Line No-5833: Initialize variable Parent_Wait_Rec_ResultSet of type ResultSet as null');
            nodesArr.push('Line No-5834: Initialize variable Transfer_Wait_Rec_ResultSet of type ResultSet as null');
            nodesArr.push('Line No-5835: Declare variable totalRows of type Integer');
            nodesArr.push('Line No-5837: Declare variable t of type String');
            nodesArr.push('Line No-5838: Declare variable i_Error_Code of type Integer');
            nodesArr.push('Line No-5839: Initialize variable i_Error_Message of type String as null');
            nodesArr.push('Line No-5841: Initialize variable t_Startup of type boolean as false');
            nodesArr.push('Line No-5842: Initialize variable t_Reverse_Insert_From_Oracle of type boolean as true');
            nodesArr.push('Line No-5844: Declare variable t_Reverse_Insert_Unique_Id of type Integer');
            nodesArr.push('Line No-5845: Declare variable t_Tlot_Check_Lot_Number of type String');
            nodesArr.push('Line No-5846: Declare variable t_Dummy of type String');
            nodesArr.push('Line No-5847: Declare variable t_Hold_Value of type String');
            nodesArr.push('Line No-5848: Declare variable t_Rows_Updated of type Integer');
            nodesArr.push('Line No-5849: Initialize variable updateCount of type Integer as null');
            nodesArr.push('Line No-5850: Declare variable t_Lot_Name of type String');
            nodesArr.push('Line No-5851: Initialize variable x_Wip_Entity_Id of type Integer as null');
            nodesArr.push('Line No-5852: Declare variable t_Unprocessed_Rows of type Integer');
            nodesArr.push('Line No-5853: Initialize variable t_Original_Qty of type Integer as null');
            nodesArr.push('Line No-5854: Declare variable t_Qty_Scrapped of type Integer');
            nodesArr.push('Line No-5855: Declare variable t_Lot_Policy of type String');
            nodesArr.push('Line No-5856: Assign "DD-MON-YYYY HH24:MI.SS" to variable t_Date_Format');
            nodesArr.push('Line No-5857: Declare variable x_Transfer_Wip_Qty of type Integer');
            nodesArr.push('Line No-5858: Declare variable t_Transfer_Operation_Seq_Num of type Integer');
            nodesArr.push('Line No-5859: Initialize variable x_Transfer_Wip_Entity_Id of type Integer as null');
            nodesArr.push('Line No-5860: Initialize variable x_Transfer_Inventory_Item_Id of type Integer as null');
            nodesArr.push('Line No-5861: Initialize variable t_Transfer_Lot_Position of type String as null');
            nodesArr.push('Line No-5862: Initialize variable t_Transfer_Job_Name of type String as null');
            nodesArr.push('Line No-5863: Initialize variable t_Dummy_Wip_Qty of type Integer as null');
            nodesArr.push('Line No-5864: Initialize variable t_Transfer of type boolean as true');
            nodesArr.push('Line No-5865: Initialize variable t_Unscrap_Qty of type Integer as null');
            nodesArr.push('Line No-5866: Initialize variable t_Scrapped_Qty of type Integer as null');
            nodesArr.push('Line No-5867: Initialize variable t_Found_Flag of type boolean as false');
            nodesArr.push('Line No-5868: Initialize variable t_Parent_Qty of type Integer as null');
            nodesArr.push('Line No-5869: Declare variable t_Child_Qty of type Integer');
            nodesArr.push('Line No-5870: Initialize variable t_Total_Child_Qty of type Integer as null');
            nodesArr.push('Line No-5871: Initialize variable t_Outside_Resource of type String as null');
            nodesArr.push('Line No-5872: Initialize variable t_Current_Routing of type String as null');
            nodesArr.push('Line No-5873: Initialize variable t_Current_Operation_Seq of type String as null');
            nodesArr.push('Line No-5874: Declare variable t_Transactions_Per_Run of type Integer');
            nodesArr.push('Line No-5875: Initialize variable x_Track_In_Oracle of type Integer as null');
            nodesArr.push('Line No-5876: Initialize variable t_Class_Code of type String as null');
            nodesArr.push('Line No-5877: Initialize variable t_Bonus_Account_Id of type Integer as null');
            nodesArr.push('Line No-5878: Initialize variable t_Suspense_Account_Id of type Integer as null');
            nodesArr.push('Line No-5879: Initialize variable t_First_Pass of type boolean as false');
            nodesArr.push('Line No-5880: Initialize variable t_Bom_Level of type String as null');
            nodesArr.push('Line No-5881: Initialize variable o_Inventory_Item_Id of type Integer as null');
            nodesArr.push('Line No-5882: Declare variable t_Count of type Integer');
            nodesArr.push('Line No-5883: Declare variable t_Number_Of_Digits of type Integer');
            nodesArr.push('Line No-5884: Declare variable t_To_Operation_Code of type String');
            nodesArr.push('Line No-5885: Initialize variable t_Operation_Seq of type String as null');
            nodesArr.push('Line No-5886: Initialize variable t_New_Routing of type String as null');
            nodesArr.push('Line No-5887: Declare variable t_New_Uom_Code1 of type String');
            nodesArr.push('Line No-5888: Declare variable t_Component_Item_Id of type Integer');
            nodesArr.push('Line No-5889: Declare variable t_Component_Qty of type Integer');
            nodesArr.push('Line No-5890: Declare variable t_Component_Item of type String');
            nodesArr.push('Line No-5891: Declare variable t_New_Operation1 of type String');
            nodesArr.push('Line No-5892: Declare variable t_Oper_Seq1 of type String');
            nodesArr.push('Line No-5893: Declare variable t_New_Department1 of type String');
            nodesArr.push('Line No-5894: Declare variable t_Uom of type String');
            nodesArr.push('Line No-5895: Declare variable t_Routing of type String');
            nodesArr.push('Line No-5896: Declare variable t_New_State of type String');
            nodesArr.push('Line No-5897: Declare variable t_New_State1 of type String');
            nodesArr.push('Line No-5898: Declare variable t_New_Txn_Qty1 of type Integer');
            nodesArr.push('Line No-5899: Declare variable t_New_Txn_Qty of type Integer');
            nodesArr.push('Line No-5900: Initialize variable o_Bom_Level of type String as null');
            nodesArr.push('Line No-5901: Initialize variable t_Unique_Id of type Integer as null');
            nodesArr.push('Line No-5902: Declare variable t_Lot_Suffix of type String');
            nodesArr.push('Line No-5903: Declare variable t_Lot_Process_Status of type Integer');
            nodesArr.push('Line No-5904: Declare variable t_Current_Level of type Integer');
            nodesArr.push('Line No-5905: Declare variable t_Level of type Integer');
            nodesArr.push('Line No-5906: Declare variable t_Operation_Seq_Id of type Integer');
            nodesArr.push('Line No-5907: Declare variable x_Operation_Seq_Id of type Integer');
            nodesArr.push('Line No-5908: Declare variable t_Consume_Flag of type Integer');
            nodesArr.push('Line No-5909: Initialize variable t_Undo of type boolean as false');
            nodesArr.push('Line No-5910: Declare variable t_Quantity_In_Queue of type Integer');
            nodesArr.push('Line No-5911: Declare variable t_Quantity_Running of type Integer');
            nodesArr.push('Line No-5912: Declare variable t_Quantity_Waiting_To_Move of type Integer');
            nodesArr.push('Line No-5913: Initialize variable t_Quantity_Scrapped of type Integer as null');
            nodesArr.push('Line No-5914: Initialize variable t_Oracle_Intraope_Step_Type of type Integer as null');
            nodesArr.push('Line No-5915: Initialize variable t_Tpla_Intraope_Step_Type of type Integer as null');
            nodesArr.push('Line No-5916: Initialize variable t_Same_Bom_Level of type boolean as false');
            nodesArr.push('Line No-5917: Declare variable t_Timezone of type String');
            nodesArr.push('Line No-5918: Declare variable t_Actual_Txn_Date of type Date');
            nodesArr.push('Line No-5919: Initialize variable t_Wo_Std_Op_Id of type Integer as null');
            nodesArr.push('Line No-5920: Initialize variable t_Bos_Std_Op_Id of type Integer as null');
            nodesArr.push('Line No-5921: Declare variable t_Bom_Seq_Id of type Integer');
            nodesArr.push('Line No-5922: Declare variable t_Op_Seq_Num of type Integer');
            nodesArr.push('Line No-5923: Declare variable t_Item_Seq_Num of type Integer');
            nodesArr.push('Line No-5924: Declare variable t_Comp_Item_Id of type Integer');
            nodesArr.push('Line No-5925: Declare variable t_Min_Wip_Qty of type Integer');
            nodesArr.push('Line No-5926: Declare variable t_Ignore_Sample of type Integer');
            nodesArr.push('Line No-5927: Initialize variable t_Sample_Success_Flag of type Integer as null');
            nodesArr.push('Line No-5928: Declare variable t_Txn_Date1 of type Date');
            nodesArr.push('Line No-5931: Declare variable t_Wip_Cur_Qty of type Integer');
            nodesArr.push('Line No-5932: Declare variable t_Min_Op_Seq_Num of type Integer');
            nodesArr.push('Line No-5933: Declare variable t_Returned_Quantity of type Integer');
            nodesArr.push('Line No-5934: Declare variable t_Return_Quantity of type Integer');
            nodesArr.push('Line No-5935: Declare variable t_Lot_Control_Code of type Integer');
            nodesArr.push('Line No-5936: Declare variable t_Component_Item_Number of type String');
            nodesArr.push('Line No-5938: Initialize variable t_Child_Exist of type Integer as 0');
            nodesArr.push('Line No-5939: Declare variable t_Child_Txn_Id of type Integer');
            nodesArr.push('Line No-5940: Declare variable t_Item_Id of type String');
            nodesArr.push('Line No-5942: Declare variable t_Parent_Wait_Transaction_Id of type Integer');
            nodesArr.push('Line No-5943: Declare variable t_Wake_Rec_Transaction_Id of type Integer');
            nodesArr.push('Line No-5944: Declare variable t_Wake_Txn_Id of type Integer');
            nodesArr.push('Line No-5945: Declare variable t_Child_Wait_Transaction_Id of type Integer');
            nodesArr.push('Line No-5946: Declare variable t_Wake_Rec_Txn_Id1 of type Integer');
            nodesArr.push('Line No-5947: Declare variable t_Child_Lot_Control_Code of type Integer');
            nodesArr.push('Line No-5948: Declare variable t_Child_Item_Id of type Integer');
            nodesArr.push('Line No-5949: Declare variable t_Wait_Child_Lot of type String');
            nodesArr.push('Line No-5951: Initialize variable t_Transaction_Id of type Integer as null');
            nodesArr.push('Line No-5952: Declare variable Tp_Transaction_Id of type Integer');
            nodesArr.push('Line No-5953: Declare variable Tc_Transaction_Id of type Integer');
            nodesArr.push('Line No-5954: Declare variable t_Net_Quantity of type Integer');
            nodesArr.push('Line No-5955: Declare variable t_Nls_Date_Format of type String');
            nodesArr.push('Line No-5957: Initialize variable t_Wip_Status of type String as null');
            nodesArr.push('Line No-5960: Declare variable t_Lot_Id of type String');
            nodesArr.push('Line No-5962: Declare variable x_Tcla_Lot_Id of type String');
            nodesArr.push('Line No-5964: Declare variable t_Child_Lot of type String');
            nodesArr.push('Line No-5966: Declare variable t_Component_Lot of type String');
            nodesArr.push('Line No-5968: Initialize variable t_Item_Num of type String as null');
            nodesArr.push('Line No-5970: Declare variable T_Inv_Item of type Integer');
            nodesArr.push('Line No-5971: Declare variable T_Chg_Item of type Integer');
            nodesArr.push('Line No-5972: Create an instance of TLotUtils and assign it to variable tLotUtilsObject');
            nodesArr.push('Line No-5973: Create an instance of TedUtils and assign it to variable tedutilsObject');
            nodesArr.push('Line No-5974: Create an instance of TltAdapt and assign it to variable tltAdatpObject');
            nodesArr.push('Line No-5975: Create an instance of TinvAdapt and assign it to variable tinvAdaptObject');
            nodesArr.push('Line No-5976: Create an instance of TltAdaptSubClass and assign it to variable tltAdatptSubObject');
            nodesArr.push('Line No-22000: Return methodParams_OutputMap');
            nodesArr.push('Stop');

            var gapBetweenNodes = 40;
            maxNodeWidth = getMaxNodeWidthByNames(nodesArr);


            var rect0 = ellipse.clone();
            rect0.addTo(nlStatementsGraph);
            rect0.attr('text/text', 'Start');
            rect0.attr('circle/fill', 'green');

            rootNode = rect0;

            flowChartNode = getBrokenText('Line No-5824: Assign null to i_Transaction_Id    ');
            var rect1 = rect.clone();
            rect1.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect1.attr('label/text', flowChartNode);
            rect1.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5825: Assign null to i_Lot_Id    ');
            var rect2 = rect.clone();
            rect2.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect2.attr('label/text', flowChartNode);
            rect2.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5826: Assign false to i_Error_Records    ');
            var rect3 = rect.clone();
            rect3.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect3.attr('label/text', flowChartNode);
            rect3.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5828: Create an instance of HashMap and assign it to variable methodParams_OutputMap    ');
            var rect4 = rect.clone();
            rect4.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect4.attr('label/text', flowChartNode);
            rect4.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5829: Create an instance of HashMap and assign it to variable procedureParams_OutputMap    ');
            var rect5 = rect.clone();
            rect5.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect5.attr('label/text', flowChartNode);
            rect5.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5830: Initialize variable Child_Lots_Rec_ResultSet of type ResultSet as null    ');
            var rect6 = rect.clone();
            rect6.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect6.attr('label/text', flowChartNode);
            rect6.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5831: Initialize variable Child_Wait_Rec_ResultSet of type ResultSet as null    ');
            var rect7 = rect.clone();
            rect7.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect7.attr('label/text', flowChartNode);
            rect7.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5832: Initialize variable Child_Wait_Rec1_ResultSet of type ResultSet as null    ');
            var rect8 = rect.clone();
            rect8.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect8.attr('label/text', flowChartNode);
            rect8.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5833: Initialize variable Parent_Wait_Rec_ResultSet of type ResultSet as null    ');
            var rect9 = rect.clone();
            rect9.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect9.attr('label/text', flowChartNode);
            rect9.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5834: Initialize variable Transfer_Wait_Rec_ResultSet of type ResultSet as null    ');
            var rect10 = rect.clone();
            rect10.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect10.attr('label/text', flowChartNode);
            rect10.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5835: Declare variable totalRows of type Integer    ');
            var rect11 = rect.clone();
            rect11.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect11.attr('label/text', flowChartNode);
            rect11.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5837: Declare variable t of type String    ');
            var rect12 = rect.clone();
            rect12.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect12.attr('label/text', flowChartNode);
            rect12.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5838: Declare variable i_Error_Code of type Integer    ');
            var rect13 = rect.clone();
            rect13.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect13.attr('label/text', flowChartNode);
            rect13.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5839: Initialize variable i_Error_Message of type String as null    ');
            var rect14 = rect.clone();
            rect14.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect14.attr('label/text', flowChartNode);
            rect14.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5841: Initialize variable t_Startup of type boolean as false    ');
            var rect15 = rect.clone();
            rect15.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect15.attr('label/text', flowChartNode);
            rect15.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5842: Initialize variable t_Reverse_Insert_From_Oracle of type boolean as true    ');
            var rect16 = rect.clone();
            rect16.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect16.attr('label/text', flowChartNode);
            rect16.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5844: Declare variable t_Reverse_Insert_Unique_Id of type Integer    ');
            var rect17 = rect.clone();
            rect17.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect17.attr('label/text', flowChartNode);
            rect17.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5845: Declare variable t_Tlot_Check_Lot_Number of type String    ');
            var rect18 = rect.clone();
            rect18.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect18.attr('label/text', flowChartNode);
            rect18.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5846: Declare variable t_Dummy of type String    ');
            var rect19 = rect.clone();
            rect19.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect19.attr('label/text', flowChartNode);
            rect19.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5847: Declare variable t_Hold_Value of type String    ');
            var rect20 = rect.clone();
            rect20.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect20.attr('label/text', flowChartNode);
            rect20.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5848: Declare variable t_Rows_Updated of type Integer    ');
            var rect21 = rect.clone();
            rect21.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect21.attr('label/text', flowChartNode);
            rect21.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5849: Initialize variable updateCount of type Integer as null    ');
            var rect22 = rect.clone();
            rect22.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect22.attr('label/text', flowChartNode);
            rect22.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5850: Declare variable t_Lot_Name of type String    ');
            var rect23 = rect.clone();
            rect23.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect23.attr('label/text', flowChartNode);
            rect23.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5851: Initialize variable x_Wip_Entity_Id of type Integer as null    ');
            var rect24 = rect.clone();
            rect24.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect24.attr('label/text', flowChartNode);
            rect24.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5852: Declare variable t_Unprocessed_Rows of type Integer    ');
            var rect25 = rect.clone();
            rect25.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect25.attr('label/text', flowChartNode);
            rect25.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5853: Initialize variable t_Original_Qty of type Integer as null    ');
            var rect26 = rect.clone();
            rect26.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect26.attr('label/text', flowChartNode);
            rect26.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5854: Declare variable t_Qty_Scrapped of type Integer    ');
            var rect27 = rect.clone();
            rect27.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect27.attr('label/text', flowChartNode);
            rect27.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5855: Declare variable t_Lot_Policy of type String    ');
            var rect28 = rect.clone();
            rect28.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect28.attr('label/text', flowChartNode);
            rect28.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5856: Assign "DD-MON-YYYY HH24:MI.SS" to variable t_Date_Format    ');
            var rect29 = rect.clone();
            rect29.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect29.attr('label/text', flowChartNode);
            rect29.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5857: Declare variable x_Transfer_Wip_Qty of type Integer    ');
            var rect30 = rect.clone();
            rect30.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect30.attr('label/text', flowChartNode);
            rect30.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5858: Declare variable t_Transfer_Operation_Seq_Num of type Integer    ');
            var rect31 = rect.clone();
            rect31.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect31.attr('label/text', flowChartNode);
            rect31.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5859: Initialize variable x_Transfer_Wip_Entity_Id of type Integer as null    ');
            var rect32 = rect.clone();
            rect32.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect32.attr('label/text', flowChartNode);
            rect32.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5860: Initialize variable x_Transfer_Inventory_Item_Id of type Integer as null    ');
            var rect33 = rect.clone();
            rect33.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect33.attr('label/text', flowChartNode);
            rect33.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5861: Initialize variable t_Transfer_Lot_Position of type String as null    ');
            var rect34 = rect.clone();
            rect34.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect34.attr('label/text', flowChartNode);
            rect34.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5862: Initialize variable t_Transfer_Job_Name of type String as null    ');
            var rect35 = rect.clone();
            rect35.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect35.attr('label/text', flowChartNode);
            rect35.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5863: Initialize variable t_Dummy_Wip_Qty of type Integer as null    ');
            var rect36 = rect.clone();
            rect36.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect36.attr('label/text', flowChartNode);
            rect36.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5864: Initialize variable t_Transfer of type boolean as true    ');
            var rect37 = rect.clone();
            rect37.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect37.attr('label/text', flowChartNode);
            rect37.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5865: Initialize variable t_Unscrap_Qty of type Integer as null    ');
            var rect38 = rect.clone();
            rect38.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect38.attr('label/text', flowChartNode);
            rect38.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5866: Initialize variable t_Scrapped_Qty of type Integer as null    ');
            var rect39 = rect.clone();
            rect39.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect39.attr('label/text', flowChartNode);
            rect39.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5867: Initialize variable t_Found_Flag of type boolean as false    ');
            var rect40 = rect.clone();
            rect40.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect40.attr('label/text', flowChartNode);
            rect40.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5868: Initialize variable t_Parent_Qty of type Integer as null    ');
            var rect41 = rect.clone();
            rect41.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect41.attr('label/text', flowChartNode);
            rect41.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5869: Declare variable t_Child_Qty of type Integer    ');
            var rect42 = rect.clone();
            rect42.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect42.attr('label/text', flowChartNode);
            rect42.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5870: Initialize variable t_Total_Child_Qty of type Integer as null    ');
            var rect43 = rect.clone();
            rect43.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect43.attr('label/text', flowChartNode);
            rect43.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5871: Initialize variable t_Outside_Resource of type String as null    ');
            var rect44 = rect.clone();
            rect44.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect44.attr('label/text', flowChartNode);
            rect44.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5872: Initialize variable t_Current_Routing of type String as null    ');
            var rect45 = rect.clone();
            rect45.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect45.attr('label/text', flowChartNode);
            rect45.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5873: Initialize variable t_Current_Operation_Seq of type String as null    ');
            var rect46 = rect.clone();
            rect46.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect46.attr('label/text', flowChartNode);
            rect46.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5874: Declare variable t_Transactions_Per_Run of type Integer    ');
            var rect47 = rect.clone();
            rect47.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect47.attr('label/text', flowChartNode);
            rect47.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5875: Initialize variable x_Track_In_Oracle of type Integer as null    ');
            var rect48 = rect.clone();
            rect48.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect48.attr('label/text', flowChartNode);
            rect48.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5876: Initialize variable t_Class_Code of type String as null    ');
            var rect49 = rect.clone();
            rect49.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect49.attr('label/text', flowChartNode);
            rect49.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5877: Initialize variable t_Bonus_Account_Id of type Integer as null    ');
            var rect50 = rect.clone();
            rect50.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect50.attr('label/text', flowChartNode);
            rect50.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5878: Initialize variable t_Suspense_Account_Id of type Integer as null    ');
            var rect51 = rect.clone();
            rect51.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect51.attr('label/text', flowChartNode);
            rect51.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5879: Initialize variable t_First_Pass of type boolean as false    ');
            var rect52 = rect.clone();
            rect52.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect52.attr('label/text', flowChartNode);
            rect52.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5880: Initialize variable t_Bom_Level of type String as null    ');
            var rect53 = rect.clone();
            rect53.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect53.attr('label/text', flowChartNode);
            rect53.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5881: Initialize variable o_Inventory_Item_Id of type Integer as null    ');
            var rect54 = rect.clone();
            rect54.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect54.attr('label/text', flowChartNode);
            rect54.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5882: Declare variable t_Count of type Integer    ');
            var rect55 = rect.clone();
            rect55.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect55.attr('label/text', flowChartNode);
            rect55.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5883: Declare variable t_Number_Of_Digits of type Integer    ');
            var rect56 = rect.clone();
            rect56.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect56.attr('label/text', flowChartNode);
            rect56.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5884: Declare variable t_To_Operation_Code of type String    ');
            var rect57 = rect.clone();
            rect57.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect57.attr('label/text', flowChartNode);
            rect57.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5885: Initialize variable t_Operation_Seq of type String as null    ');
            var rect58 = rect.clone();
            rect58.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect58.attr('label/text', flowChartNode);
            rect58.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5886: Initialize variable t_New_Routing of type String as null    ');
            var rect59 = rect.clone();
            rect59.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect59.attr('label/text', flowChartNode);
            rect59.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5887: Declare variable t_New_Uom_Code1 of type String    ');
            var rect60 = rect.clone();
            rect60.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect60.attr('label/text', flowChartNode);
            rect60.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5888: Declare variable t_Component_Item_Id of type Integer    ');
            var rect61 = rect.clone();
            rect61.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect61.attr('label/text', flowChartNode);
            rect61.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5889: Declare variable t_Component_Qty of type Integer    ');
            var rect62 = rect.clone();
            rect62.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect62.attr('label/text', flowChartNode);
            rect62.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5890: Declare variable t_Component_Item of type String    ');
            var rect63 = rect.clone();
            rect63.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect63.attr('label/text', flowChartNode);
            rect63.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5891: Declare variable t_New_Operation1 of type String    ');
            var rect64 = rect.clone();
            rect64.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect64.attr('label/text', flowChartNode);
            rect64.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5892: Declare variable t_Oper_Seq1 of type String    ');
            var rect65 = rect.clone();
            rect65.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect65.attr('label/text', flowChartNode);
            rect65.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5893: Declare variable t_New_Department1 of type String    ');
            var rect66 = rect.clone();
            rect66.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect66.attr('label/text', flowChartNode);
            rect66.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5894: Declare variable t_Uom of type String    ');
            var rect67 = rect.clone();
            rect67.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect67.attr('label/text', flowChartNode);
            rect67.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5895: Declare variable t_Routing of type String    ');
            var rect68 = rect.clone();
            rect68.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect68.attr('label/text', flowChartNode);
            rect68.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5896: Declare variable t_New_State of type String    ');
            var rect69 = rect.clone();
            rect69.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect69.attr('label/text', flowChartNode);
            rect69.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5897: Declare variable t_New_State1 of type String    ');
            var rect70 = rect.clone();
            rect70.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect70.attr('label/text', flowChartNode);
            rect70.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5898: Declare variable t_New_Txn_Qty1 of type Integer    ');
            var rect71 = rect.clone();
            rect71.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect71.attr('label/text', flowChartNode);
            rect71.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5899: Declare variable t_New_Txn_Qty of type Integer    ');
            var rect72 = rect.clone();
            rect72.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect72.attr('label/text', flowChartNode);
            rect72.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5900: Initialize variable o_Bom_Level of type String as null    ');
            var rect73 = rect.clone();
            rect73.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect73.attr('label/text', flowChartNode);
            rect73.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5901: Initialize variable t_Unique_Id of type Integer as null    ');
            var rect74 = rect.clone();
            rect74.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect74.attr('label/text', flowChartNode);
            rect74.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5902: Declare variable t_Lot_Suffix of type String    ');
            var rect75 = rect.clone();
            rect75.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect75.attr('label/text', flowChartNode);
            rect75.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5903: Declare variable t_Lot_Process_Status of type Integer    ');
            var rect76 = rect.clone();
            rect76.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect76.attr('label/text', flowChartNode);
            rect76.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5904: Declare variable t_Current_Level of type Integer    ');
            var rect77 = rect.clone();
            rect77.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect77.attr('label/text', flowChartNode);
            rect77.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5905: Declare variable t_Level of type Integer    ');
            var rect78 = rect.clone();
            rect78.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect78.attr('label/text', flowChartNode);
            rect78.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5906: Declare variable t_Operation_Seq_Id of type Integer    ');
            var rect79 = rect.clone();
            rect79.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect79.attr('label/text', flowChartNode);
            rect79.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5907: Declare variable x_Operation_Seq_Id of type Integer    ');
            var rect80 = rect.clone();
            rect80.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect80.attr('label/text', flowChartNode);
            rect80.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5908: Declare variable t_Consume_Flag of type Integer    ');
            var rect81 = rect.clone();
            rect81.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect81.attr('label/text', flowChartNode);
            rect81.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5909: Initialize variable t_Undo of type boolean as false    ');
            var rect82 = rect.clone();
            rect82.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect82.attr('label/text', flowChartNode);
            rect82.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5910: Declare variable t_Quantity_In_Queue of type Integer    ');
            var rect83 = rect.clone();
            rect83.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect83.attr('label/text', flowChartNode);
            rect83.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5911: Declare variable t_Quantity_Running of type Integer    ');
            var rect84 = rect.clone();
            rect84.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect84.attr('label/text', flowChartNode);
            rect84.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5912: Declare variable t_Quantity_Waiting_To_Move of type Integer    ');
            var rect85 = rect.clone();
            rect85.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect85.attr('label/text', flowChartNode);
            rect85.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5913: Initialize variable t_Quantity_Scrapped of type Integer as null    ');
            var rect86 = rect.clone();
            rect86.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect86.attr('label/text', flowChartNode);
            rect86.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5914: Initialize variable t_Oracle_Intraope_Step_Type of type Integer as null    ');
            var rect87 = rect.clone();
            rect87.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect87.attr('label/text', flowChartNode);
            rect87.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5915: Initialize variable t_Tpla_Intraope_Step_Type of type Integer as null    ');
            var rect88 = rect.clone();
            rect88.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect88.attr('label/text', flowChartNode);
            rect88.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5916: Initialize variable t_Same_Bom_Level of type boolean as false    ');
            var rect89 = rect.clone();
            rect89.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect89.attr('label/text', flowChartNode);
            rect89.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5917: Declare variable t_Timezone of type String    ');
            var rect90 = rect.clone();
            rect90.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect90.attr('label/text', flowChartNode);
            rect90.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5918: Declare variable t_Actual_Txn_Date of type Date    ');
            var rect91 = rect.clone();
            rect91.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect91.attr('label/text', flowChartNode);
            rect91.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5919: Initialize variable t_Wo_Std_Op_Id of type Integer as null    ');
            var rect92 = rect.clone();
            rect92.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect92.attr('label/text', flowChartNode);
            rect92.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5920: Initialize variable t_Bos_Std_Op_Id of type Integer as null    ');
            var rect93 = rect.clone();
            rect93.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect93.attr('label/text', flowChartNode);
            rect93.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5921: Declare variable t_Bom_Seq_Id of type Integer    ');
            var rect94 = rect.clone();
            rect94.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect94.attr('label/text', flowChartNode);
            rect94.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5922: Declare variable t_Op_Seq_Num of type Integer    ');
            var rect95 = rect.clone();
            rect95.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect95.attr('label/text', flowChartNode);
            rect95.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5923: Declare variable t_Item_Seq_Num of type Integer    ');
            var rect96 = rect.clone();
            rect96.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect96.attr('label/text', flowChartNode);
            rect96.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5924: Declare variable t_Comp_Item_Id of type Integer    ');
            var rect97 = rect.clone();
            rect97.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect97.attr('label/text', flowChartNode);
            rect97.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5925: Declare variable t_Min_Wip_Qty of type Integer    ');
            var rect98 = rect.clone();
            rect98.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect98.attr('label/text', flowChartNode);
            rect98.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5926: Declare variable t_Ignore_Sample of type Integer    ');
            var rect99 = rect.clone();
            rect99.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect99.attr('label/text', flowChartNode);
            rect99.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5927: Initialize variable t_Sample_Success_Flag of type Integer as null    ');
            var rect100 = rect.clone();
            rect100.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect100.attr('label/text', flowChartNode);
            rect100.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5928: Declare variable t_Txn_Date1 of type Date    ');
            var rect101 = rect.clone();
            rect101.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect101.attr('label/text', flowChartNode);
            rect101.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5931: Declare variable t_Wip_Cur_Qty of type Integer    ');
            var rect102 = rect.clone();
            rect102.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect102.attr('label/text', flowChartNode);
            rect102.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5932: Declare variable t_Min_Op_Seq_Num of type Integer    ');
            var rect103 = rect.clone();
            rect103.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect103.attr('label/text', flowChartNode);
            rect103.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5933: Declare variable t_Returned_Quantity of type Integer    ');
            var rect104 = rect.clone();
            rect104.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect104.attr('label/text', flowChartNode);
            rect104.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5934: Declare variable t_Return_Quantity of type Integer    ');
            var rect105 = rect.clone();
            rect105.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect105.attr('label/text', flowChartNode);
            rect105.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5935: Declare variable t_Lot_Control_Code of type Integer    ');
            var rect106 = rect.clone();
            rect106.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect106.attr('label/text', flowChartNode);
            rect106.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5936: Declare variable t_Component_Item_Number of type String    ');
            var rect107 = rect.clone();
            rect107.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect107.attr('label/text', flowChartNode);
            rect107.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5938: Initialize variable t_Child_Exist of type Integer as 0    ');
            var rect108 = rect.clone();
            rect108.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect108.attr('label/text', flowChartNode);
            rect108.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5939: Declare variable t_Child_Txn_Id of type Integer    ');
            var rect109 = rect.clone();
            rect109.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect109.attr('label/text', flowChartNode);
            rect109.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5940: Declare variable t_Item_Id of type String    ');
            var rect110 = rect.clone();
            rect110.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect110.attr('label/text', flowChartNode);
            rect110.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5942: Declare variable t_Parent_Wait_Transaction_Id of type Integer    ');
            var rect111 = rect.clone();
            rect111.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect111.attr('label/text', flowChartNode);
            rect111.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5943: Declare variable t_Wake_Rec_Transaction_Id of type Integer    ');
            var rect112 = rect.clone();
            rect112.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect112.attr('label/text', flowChartNode);
            rect112.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5944: Declare variable t_Wake_Txn_Id of type Integer    ');
            var rect113 = rect.clone();
            rect113.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect113.attr('label/text', flowChartNode);
            rect113.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5945: Declare variable t_Child_Wait_Transaction_Id of type Integer    ');
            var rect114 = rect.clone();
            rect114.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect114.attr('label/text', flowChartNode);
            rect114.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5946: Declare variable t_Wake_Rec_Txn_Id1 of type Integer    ');
            var rect115 = rect.clone();
            rect115.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect115.attr('label/text', flowChartNode);
            rect115.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5947: Declare variable t_Child_Lot_Control_Code of type Integer    ');
            var rect116 = rect.clone();
            rect116.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect116.attr('label/text', flowChartNode);
            rect116.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5948: Declare variable t_Child_Item_Id of type Integer    ');
            var rect117 = rect.clone();
            rect117.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect117.attr('label/text', flowChartNode);
            rect117.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5949: Declare variable t_Wait_Child_Lot of type String    ');
            var rect118 = rect.clone();
            rect118.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect118.attr('label/text', flowChartNode);
            rect118.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5951: Initialize variable t_Transaction_Id of type Integer as null    ');
            var rect119 = rect.clone();
            rect119.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect119.attr('label/text', flowChartNode);
            rect119.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5952: Declare variable Tp_Transaction_Id of type Integer    ');
            var rect120 = rect.clone();
            rect120.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect120.attr('label/text', flowChartNode);
            rect120.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5953: Declare variable Tc_Transaction_Id of type Integer    ');
            var rect121 = rect.clone();
            rect121.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect121.attr('label/text', flowChartNode);
            rect121.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5954: Declare variable t_Net_Quantity of type Integer    ');
            var rect122 = rect.clone();
            rect122.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect122.attr('label/text', flowChartNode);
            rect122.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5955: Declare variable t_Nls_Date_Format of type String    ');
            var rect123 = rect.clone();
            rect123.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect123.attr('label/text', flowChartNode);
            rect123.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5957: Initialize variable t_Wip_Status of type String as null    ');
            var rect124 = rect.clone();
            rect124.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect124.attr('label/text', flowChartNode);
            rect124.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5960: Declare variable t_Lot_Id of type String    ');
            var rect125 = rect.clone();
            rect125.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect125.attr('label/text', flowChartNode);
            rect125.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5962: Declare variable x_Tcla_Lot_Id of type String    ');
            var rect126 = rect.clone();
            rect126.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect126.attr('label/text', flowChartNode);
            rect126.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5964: Declare variable t_Child_Lot of type String    ');
            var rect127 = rect.clone();
            rect127.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect127.attr('label/text', flowChartNode);
            rect127.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5966: Declare variable t_Component_Lot of type String    ');
            var rect128 = rect.clone();
            rect128.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect128.attr('label/text', flowChartNode);
            rect128.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5968: Initialize variable t_Item_Num of type String as null    ');
            var rect129 = rect.clone();
            rect129.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect129.attr('label/text', flowChartNode);
            rect129.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5970: Declare variable T_Inv_Item of type Integer    ');
            var rect130 = rect.clone();
            rect130.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect130.attr('label/text', flowChartNode);
            rect130.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5971: Declare variable T_Chg_Item of type Integer    ');
            var rect131 = rect.clone();
            rect131.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect131.attr('label/text', flowChartNode);
            rect131.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5972: Create an instance of TLotUtils and assign it to variable tLotUtilsObject    ');
            var rect132 = rect.clone();
            rect132.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect132.attr('label/text', flowChartNode);
            rect132.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5973: Create an instance of TedUtils and assign it to variable tedutilsObject    ');
            var rect133 = rect.clone();
            rect133.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect133.attr('label/text', flowChartNode);
            rect133.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5974: Create an instance of TltAdapt and assign it to variable tltAdatpObject    ');
            var rect134 = rect.clone();
            rect134.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect134.attr('label/text', flowChartNode);
            rect134.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5975: Create an instance of TinvAdapt and assign it to variable tinvAdaptObject    ');
            var rect135 = rect.clone();
            rect135.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect135.attr('label/text', flowChartNode);
            rect135.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-5976: Create an instance of TltAdaptSubClass and assign it to variable tltAdatptSubObject    ');
            var rect136 = rect.clone();
            rect136.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect136.attr('label/text', flowChartNode);
            rect136.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Line No-22000: Return methodParams_OutputMap    ');
            var rect137 = rect.clone();
            rect137.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect137.attr('label/text', flowChartNode);
            rect137.addTo(nlStatementsGraph);

            flowChartNode = getBrokenText('Stop    ');
            var rect138 = ellipse.clone();
            rect138.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect138.attr('text/text', flowChartNode);
            rect138.addTo(nlStatementsGraph);


            var link1 = link.clone();
            link1.source(rect0);
            link1.target(rect1);
            link1.addTo(nlStatementsGraph);

            var link2 = link.clone();
            link2.source(rect1);
            link2.target(rect2);
            link2.addTo(nlStatementsGraph);

            var link3 = link.clone();
            link3.source(rect2);
            link3.target(rect3);
            link3.addTo(nlStatementsGraph);

            var link4 = link.clone();
            link4.source(rect3);
            link4.target(rect4);
            link4.addTo(nlStatementsGraph);

            var link5 = link.clone();
            link5.source(rect4);
            link5.target(rect5);
            link5.addTo(nlStatementsGraph);

            var link6 = link.clone();
            link6.source(rect5);
            link6.target(rect6);
            link6.addTo(nlStatementsGraph);

            var link7 = link.clone();
            link7.source(rect6);
            link7.target(rect7);
            link7.addTo(nlStatementsGraph);

            var link8 = link.clone();
            link8.source(rect7);
            link8.target(rect8);
            link8.addTo(nlStatementsGraph);

            var link9 = link.clone();
            link9.source(rect8);
            link9.target(rect9);
            link9.addTo(nlStatementsGraph);

            var link10 = link.clone();
            link10.source(rect9);
            link10.target(rect10);
            link10.addTo(nlStatementsGraph);

            var link11 = link.clone();
            link11.source(rect10);
            link11.target(rect11);
            link11.addTo(nlStatementsGraph);

            var link12 = link.clone();
            link12.source(rect11);
            link12.target(rect12);
            link12.addTo(nlStatementsGraph);

            var link13 = link.clone();
            link13.source(rect12);
            link13.target(rect13);
            link13.addTo(nlStatementsGraph);

            var link14 = link.clone();
            link14.source(rect13);
            link14.target(rect14);
            link14.addTo(nlStatementsGraph);

            var link15 = link.clone();
            link15.source(rect14);
            link15.target(rect15);
            link15.addTo(nlStatementsGraph);

            var link16 = link.clone();
            link16.source(rect15);
            link16.target(rect16);
            link16.addTo(nlStatementsGraph);

            var link17 = link.clone();
            link17.source(rect16);
            link17.target(rect17);
            link17.addTo(nlStatementsGraph);

            var link18 = link.clone();
            link18.source(rect17);
            link18.target(rect18);
            link18.addTo(nlStatementsGraph);

            var link19 = link.clone();
            link19.source(rect18);
            link19.target(rect19);
            link19.addTo(nlStatementsGraph);

            var link20 = link.clone();
            link20.source(rect19);
            link20.target(rect20);
            link20.addTo(nlStatementsGraph);

            var link21 = link.clone();
            link21.source(rect20);
            link21.target(rect21);
            link21.addTo(nlStatementsGraph);

            var link22 = link.clone();
            link22.source(rect21);
            link22.target(rect22);
            link22.addTo(nlStatementsGraph);

            var link23 = link.clone();
            link23.source(rect22);
            link23.target(rect23);
            link23.addTo(nlStatementsGraph);

            var link24 = link.clone();
            link24.source(rect23);
            link24.target(rect24);
            link24.addTo(nlStatementsGraph);

            var link25 = link.clone();
            link25.source(rect24);
            link25.target(rect25);
            link25.addTo(nlStatementsGraph);

            var link26 = link.clone();
            link26.source(rect25);
            link26.target(rect26);
            link26.addTo(nlStatementsGraph);

            var link27 = link.clone();
            link27.source(rect26);
            link27.target(rect27);
            link27.addTo(nlStatementsGraph);

            var link28 = link.clone();
            link28.source(rect27);
            link28.target(rect28);
            link28.addTo(nlStatementsGraph);

            var link29 = link.clone();
            link29.source(rect28);
            link29.target(rect29);
            link29.addTo(nlStatementsGraph);

            var link30 = link.clone();
            link30.source(rect29);
            link30.target(rect30);
            link30.addTo(nlStatementsGraph);

            var link31 = link.clone();
            link31.source(rect30);
            link31.target(rect31);
            link31.addTo(nlStatementsGraph);

            var link32 = link.clone();
            link32.source(rect31);
            link32.target(rect32);
            link32.addTo(nlStatementsGraph);

            var link33 = link.clone();
            link33.source(rect32);
            link33.target(rect33);
            link33.addTo(nlStatementsGraph);

            var link34 = link.clone();
            link34.source(rect33);
            link34.target(rect34);
            link34.addTo(nlStatementsGraph);

            var link35 = link.clone();
            link35.source(rect34);
            link35.target(rect35);
            link35.addTo(nlStatementsGraph);

            var link36 = link.clone();
            link36.source(rect35);
            link36.target(rect36);
            link36.addTo(nlStatementsGraph);

            var link37 = link.clone();
            link37.source(rect36);
            link37.target(rect37);
            link37.addTo(nlStatementsGraph);

            var link38 = link.clone();
            link38.source(rect37);
            link38.target(rect38);
            link38.addTo(nlStatementsGraph);

            var link39 = link.clone();
            link39.source(rect38);
            link39.target(rect39);
            link39.addTo(nlStatementsGraph);

            var link40 = link.clone();
            link40.source(rect39);
            link40.target(rect40);
            link40.addTo(nlStatementsGraph);

            var link41 = link.clone();
            link41.source(rect40);
            link41.target(rect41);
            link41.addTo(nlStatementsGraph);

            var link42 = link.clone();
            link42.source(rect41);
            link42.target(rect42);
            link42.addTo(nlStatementsGraph);

            var link43 = link.clone();
            link43.source(rect42);
            link43.target(rect43);
            link43.addTo(nlStatementsGraph);

            var link44 = link.clone();
            link44.source(rect43);
            link44.target(rect44);
            link44.addTo(nlStatementsGraph);

            var link45 = link.clone();
            link45.source(rect44);
            link45.target(rect45);
            link45.addTo(nlStatementsGraph);

            var link46 = link.clone();
            link46.source(rect45);
            link46.target(rect46);
            link46.addTo(nlStatementsGraph);

            var link47 = link.clone();
            link47.source(rect46);
            link47.target(rect47);
            link47.addTo(nlStatementsGraph);

            var link48 = link.clone();
            link48.source(rect47);
            link48.target(rect48);
            link48.addTo(nlStatementsGraph);

            var link49 = link.clone();
            link49.source(rect48);
            link49.target(rect49);
            link49.addTo(nlStatementsGraph);

            var link50 = link.clone();
            link50.source(rect49);
            link50.target(rect50);
            link50.addTo(nlStatementsGraph);

            var link51 = link.clone();
            link51.source(rect50);
            link51.target(rect51);
            link51.addTo(nlStatementsGraph);

            var link52 = link.clone();
            link52.source(rect51);
            link52.target(rect52);
            link52.addTo(nlStatementsGraph);

            var link53 = link.clone();
            link53.source(rect52);
            link53.target(rect53);
            link53.addTo(nlStatementsGraph);

            var link54 = link.clone();
            link54.source(rect53);
            link54.target(rect54);
            link54.addTo(nlStatementsGraph);

            var link55 = link.clone();
            link55.source(rect54);
            link55.target(rect55);
            link55.addTo(nlStatementsGraph);

            var link56 = link.clone();
            link56.source(rect55);
            link56.target(rect56);
            link56.addTo(nlStatementsGraph);

            var link57 = link.clone();
            link57.source(rect56);
            link57.target(rect57);
            link57.addTo(nlStatementsGraph);

            var link58 = link.clone();
            link58.source(rect57);
            link58.target(rect58);
            link58.addTo(nlStatementsGraph);

            var link59 = link.clone();
            link59.source(rect58);
            link59.target(rect59);
            link59.addTo(nlStatementsGraph);

            var link60 = link.clone();
            link60.source(rect59);
            link60.target(rect60);
            link60.addTo(nlStatementsGraph);

            var link61 = link.clone();
            link61.source(rect60);
            link61.target(rect61);
            link61.addTo(nlStatementsGraph);

            var link62 = link.clone();
            link62.source(rect61);
            link62.target(rect62);
            link62.addTo(nlStatementsGraph);

            var link63 = link.clone();
            link63.source(rect62);
            link63.target(rect63);
            link63.addTo(nlStatementsGraph);

            var link64 = link.clone();
            link64.source(rect63);
            link64.target(rect64);
            link64.addTo(nlStatementsGraph);

            var link65 = link.clone();
            link65.source(rect64);
            link65.target(rect65);
            link65.addTo(nlStatementsGraph);

            var link66 = link.clone();
            link66.source(rect65);
            link66.target(rect66);
            link66.addTo(nlStatementsGraph);

            var link67 = link.clone();
            link67.source(rect66);
            link67.target(rect67);
            link67.addTo(nlStatementsGraph);

            var link68 = link.clone();
            link68.source(rect67);
            link68.target(rect68);
            link68.addTo(nlStatementsGraph);

            var link69 = link.clone();
            link69.source(rect68);
            link69.target(rect69);
            link69.addTo(nlStatementsGraph);

            var link70 = link.clone();
            link70.source(rect69);
            link70.target(rect70);
            link70.addTo(nlStatementsGraph);

            var link71 = link.clone();
            link71.source(rect70);
            link71.target(rect71);
            link71.addTo(nlStatementsGraph);

            var link72 = link.clone();
            link72.source(rect71);
            link72.target(rect72);
            link72.addTo(nlStatementsGraph);

            var link73 = link.clone();
            link73.source(rect72);
            link73.target(rect73);
            link73.addTo(nlStatementsGraph);

            var link74 = link.clone();
            link74.source(rect73);
            link74.target(rect74);
            link74.addTo(nlStatementsGraph);

            var link75 = link.clone();
            link75.source(rect74);
            link75.target(rect75);
            link75.addTo(nlStatementsGraph);

            var link76 = link.clone();
            link76.source(rect75);
            link76.target(rect76);
            link76.addTo(nlStatementsGraph);

            var link77 = link.clone();
            link77.source(rect76);
            link77.target(rect77);
            link77.addTo(nlStatementsGraph);

            var link78 = link.clone();
            link78.source(rect77);
            link78.target(rect78);
            link78.addTo(nlStatementsGraph);

            var link79 = link.clone();
            link79.source(rect78);
            link79.target(rect79);
            link79.addTo(nlStatementsGraph);

            var link80 = link.clone();
            link80.source(rect79);
            link80.target(rect80);
            link80.addTo(nlStatementsGraph);

            var link81 = link.clone();
            link81.source(rect80);
            link81.target(rect81);
            link81.addTo(nlStatementsGraph);

            var link82 = link.clone();
            link82.source(rect81);
            link82.target(rect82);
            link82.addTo(nlStatementsGraph);

            var link83 = link.clone();
            link83.source(rect82);
            link83.target(rect83);
            link83.addTo(nlStatementsGraph);

            var link84 = link.clone();
            link84.source(rect83);
            link84.target(rect84);
            link84.addTo(nlStatementsGraph);

            var link85 = link.clone();
            link85.source(rect84);
            link85.target(rect85);
            link85.addTo(nlStatementsGraph);

            var link86 = link.clone();
            link86.source(rect85);
            link86.target(rect86);
            link86.addTo(nlStatementsGraph);

            var link87 = link.clone();
            link87.source(rect86);
            link87.target(rect87);
            link87.addTo(nlStatementsGraph);

            var link88 = link.clone();
            link88.source(rect87);
            link88.target(rect88);
            link88.addTo(nlStatementsGraph);

            var link89 = link.clone();
            link89.source(rect88);
            link89.target(rect89);
            link89.addTo(nlStatementsGraph);

            var link90 = link.clone();
            link90.source(rect89);
            link90.target(rect90);
            link90.addTo(nlStatementsGraph);

            var link91 = link.clone();
            link91.source(rect90);
            link91.target(rect91);
            link91.addTo(nlStatementsGraph);

            var link92 = link.clone();
            link92.source(rect91);
            link92.target(rect92);
            link92.addTo(nlStatementsGraph);

            var link93 = link.clone();
            link93.source(rect92);
            link93.target(rect93);
            link93.addTo(nlStatementsGraph);

            var link94 = link.clone();
            link94.source(rect93);
            link94.target(rect94);
            link94.addTo(nlStatementsGraph);

            var link95 = link.clone();
            link95.source(rect94);
            link95.target(rect95);
            link95.addTo(nlStatementsGraph);

            var link96 = link.clone();
            link96.source(rect95);
            link96.target(rect96);
            link96.addTo(nlStatementsGraph);

            var link97 = link.clone();
            link97.source(rect96);
            link97.target(rect97);
            link97.addTo(nlStatementsGraph);

            var link98 = link.clone();
            link98.source(rect97);
            link98.target(rect98);
            link98.addTo(nlStatementsGraph);

            var link99 = link.clone();
            link99.source(rect98);
            link99.target(rect99);
            link99.addTo(nlStatementsGraph);

            var link100 = link.clone();
            link100.source(rect99);
            link100.target(rect100);
            link100.addTo(nlStatementsGraph);

            var link101 = link.clone();
            link101.source(rect100);
            link101.target(rect101);
            link101.addTo(nlStatementsGraph);

            var link102 = link.clone();
            link102.source(rect101);
            link102.target(rect102);
            link102.addTo(nlStatementsGraph);

            var link103 = link.clone();
            link103.source(rect102);
            link103.target(rect103);
            link103.addTo(nlStatementsGraph);

            var link104 = link.clone();
            link104.source(rect103);
            link104.target(rect104);
            link104.addTo(nlStatementsGraph);

            var link105 = link.clone();
            link105.source(rect104);
            link105.target(rect105);
            link105.addTo(nlStatementsGraph);

            var link106 = link.clone();
            link106.source(rect105);
            link106.target(rect106);
            link106.addTo(nlStatementsGraph);

            var link107 = link.clone();
            link107.source(rect106);
            link107.target(rect107);
            link107.addTo(nlStatementsGraph);

            var link108 = link.clone();
            link108.source(rect107);
            link108.target(rect108);
            link108.addTo(nlStatementsGraph);

            var link109 = link.clone();
            link109.source(rect108);
            link109.target(rect109);
            link109.addTo(nlStatementsGraph);

            var link110 = link.clone();
            link110.source(rect109);
            link110.target(rect110);
            link110.addTo(nlStatementsGraph);

            var link111 = link.clone();
            link111.source(rect110);
            link111.target(rect111);
            link111.addTo(nlStatementsGraph);

            var link112 = link.clone();
            link112.source(rect111);
            link112.target(rect112);
            link112.addTo(nlStatementsGraph);

            var link113 = link.clone();
            link113.source(rect112);
            link113.target(rect113);
            link113.addTo(nlStatementsGraph);

            var link114 = link.clone();
            link114.source(rect113);
            link114.target(rect114);
            link114.addTo(nlStatementsGraph);

            var link115 = link.clone();
            link115.source(rect114);
            link115.target(rect115);
            link115.addTo(nlStatementsGraph);

            var link116 = link.clone();
            link116.source(rect115);
            link116.target(rect116);
            link116.addTo(nlStatementsGraph);

            var link117 = link.clone();
            link117.source(rect116);
            link117.target(rect117);
            link117.addTo(nlStatementsGraph);

            var link118 = link.clone();
            link118.source(rect117);
            link118.target(rect118);
            link118.addTo(nlStatementsGraph);

            var link119 = link.clone();
            link119.source(rect118);
            link119.target(rect119);
            link119.addTo(nlStatementsGraph);

            var link120 = link.clone();
            link120.source(rect119);
            link120.target(rect120);
            link120.addTo(nlStatementsGraph);

            var link121 = link.clone();
            link121.source(rect120);
            link121.target(rect121);
            link121.addTo(nlStatementsGraph);

            var link122 = link.clone();
            link122.source(rect121);
            link122.target(rect122);
            link122.addTo(nlStatementsGraph);

            var link123 = link.clone();
            link123.source(rect122);
            link123.target(rect123);
            link123.addTo(nlStatementsGraph);

            var link124 = link.clone();
            link124.source(rect123);
            link124.target(rect124);
            link124.addTo(nlStatementsGraph);

            var link125 = link.clone();
            link125.source(rect124);
            link125.target(rect125);
            link125.addTo(nlStatementsGraph);

            var link126 = link.clone();
            link126.source(rect125);
            link126.target(rect126);
            link126.addTo(nlStatementsGraph);

            var link127 = link.clone();
            link127.source(rect126);
            link127.target(rect127);
            link127.addTo(nlStatementsGraph);

            var link128 = link.clone();
            link128.source(rect127);
            link128.target(rect128);
            link128.addTo(nlStatementsGraph);

            var link129 = link.clone();
            link129.source(rect128);
            link129.target(rect129);
            link129.addTo(nlStatementsGraph);

            var link130 = link.clone();
            link130.source(rect129);
            link130.target(rect130);
            link130.addTo(nlStatementsGraph);

            var link131 = link.clone();
            link131.source(rect130);
            link131.target(rect131);
            link131.addTo(nlStatementsGraph);

            var link132 = link.clone();
            link132.source(rect131);
            link132.target(rect132);
            link132.addTo(nlStatementsGraph);

            var link133 = link.clone();
            link133.source(rect132);
            link133.target(rect133);
            link133.addTo(nlStatementsGraph);

            var link134 = link.clone();
            link134.source(rect133);
            link134.target(rect134);
            link134.addTo(nlStatementsGraph);

            var link135 = link.clone();
            link135.source(rect134);
            link135.target(rect135);
            link135.addTo(nlStatementsGraph);

            var link136 = link.clone();
            link136.source(rect135);
            link136.target(rect136);
            link136.addTo(nlStatementsGraph);

            var link137 = link.clone();
            link137.source(rect136);
            link137.target(rect137);
            link137.addTo(nlStatementsGraph);

            var link138 = link.clone();
            link138.source(rect137);
            link138.target(rect138);
            link138.addTo(nlStatementsGraph);

            rect0.set('startNode', 'true');
            rect138.set('stopNode', 'true');
            rect138.attr('circle/fill', 'red');
            rect138.translate((maxNodeWidth - 100)/ 2, 0);

            setFlowDiagramFolder('../../../../');
            setIfElseMultiplier(1.1);

            setPaperId(nlStatementsPaper);
            setGraphId(nlStatementsGraph);
            moveNodesOnYAxis(gapBetweenNodes);
            moveIfElseBlocks();
            moveImproperIfElseBlocks();
            moveImproperWhileBlocks();
            moveInvisibleNodes();
            beautifyLoopConnectors();
            alignStopNode(rect0, rect138);
            resizePaper();
            initializePaperBehavior();
            hideThisFlowChart('nlStatementFlowChart');
        </script>
        <div id='javaStatementFlowChart' style='display:block;'></div>
        <script type='text/javascript'>
            var javaStatementsGraph = new joint.dia.Graph;

            var javaStatementsPaper = new joint.dia.Paper({
                el: document.getElementById('javaStatementFlowChart'),
                interactive: false,
                model: javaStatementsGraph,
                width: 1000,
                height: 27900,
                gridSize: 1
            });

            var flowChartNode;
            var resizeWidth;
            var nodesArr = [];

            nodesArr.push('Line No-5824: i_Transaction_Id = null;');
            nodesArr.push('Line No-5825: i_Lot_Id = null;');
            nodesArr.push('Line No-5826: i_Error_Records = false;');
            nodesArr.push('Line No-5828: HashMap methodParams_OutputMap = new HashMap();');
            nodesArr.push('Line No-5829: HashMap procedureParams_OutputMap = new HashMap();');
            nodesArr.push('Line No-5830: ResultSet Child_Lots_Rec_ResultSet = null;');
            nodesArr.push('Line No-5831: ResultSet Child_Wait_Rec_ResultSet = null;');
            nodesArr.push('Line No-5832: ResultSet Child_Wait_Rec1_ResultSet = null;');
            nodesArr.push('Line No-5833: ResultSet Parent_Wait_Rec_ResultSet = null;');
            nodesArr.push('Line No-5834: ResultSet Transfer_Wait_Rec_ResultSet = null;');
            nodesArr.push('Line No-5835: Integer totalRows;');
            nodesArr.push('Line No-5837: String t');
            nodesArr.push('Line No-5838: Integer i_Error_Code;');
            nodesArr.push('Line No-5839: String i_Error_Message = null;');
            nodesArr.push('Line No-5841: boolean t_Startup = false');
            nodesArr.push('Line No-5842: boolean t_Reverse_Insert_From_Oracle = true;');
            nodesArr.push('Line No-5844: Integer t_Reverse_Insert_Unique_Id');
            nodesArr.push('Line No-5845: String t_Tlot_Check_Lot_Number;');
            nodesArr.push('Line No-5846: String t_Dummy;');
            nodesArr.push('Line No-5847: String t_Hold_Value;');
            nodesArr.push('Line No-5848: Integer t_Rows_Updated;');
            nodesArr.push('Line No-5849: Integer updateCount = null;');
            nodesArr.push('Line No-5850: String t_Lot_Name;');
            nodesArr.push('Line No-5851: Integer x_Wip_Entity_Id = null;');
            nodesArr.push('Line No-5852: Integer t_Unprocessed_Rows;');
            nodesArr.push('Line No-5853: Integer t_Original_Qty = null;');
            nodesArr.push('Line No-5854: Integer t_Qty_Scrapped;');
            nodesArr.push('Line No-5855: String t_Lot_Policy;');
            nodesArr.push('Line No-5856: String t_Date_Format = "DD-MON-YYYY HH24:MI.SS";');
            nodesArr.push('Line No-5857: Integer x_Transfer_Wip_Qty;');
            nodesArr.push('Line No-5858: Integer t_Transfer_Operation_Seq_Num;');
            nodesArr.push('Line No-5859: Integer x_Transfer_Wip_Entity_Id = null;');
            nodesArr.push('Line No-5860: Integer x_Transfer_Inventory_Item_Id = null;');
            nodesArr.push('Line No-5861: String t_Transfer_Lot_Position = null;');
            nodesArr.push('Line No-5862: String t_Transfer_Job_Name = null;');
            nodesArr.push('Line No-5863: Integer t_Dummy_Wip_Qty = null;');
            nodesArr.push('Line No-5864: boolean t_Transfer = true;');
            nodesArr.push('Line No-5865: Integer t_Unscrap_Qty = null;');
            nodesArr.push('Line No-5866: Integer t_Scrapped_Qty = null;');
            nodesArr.push('Line No-5867: boolean t_Found_Flag = false;');
            nodesArr.push('Line No-5868: Integer t_Parent_Qty = null;');
            nodesArr.push('Line No-5869: Integer t_Child_Qty;');
            nodesArr.push('Line No-5870: Integer t_Total_Child_Qty = null;');
            nodesArr.push('Line No-5871: String t_Outside_Resource = null;');
            nodesArr.push('Line No-5872: String t_Current_Routing = null;');
            nodesArr.push('Line No-5873: String t_Current_Operation_Seq = null;');
            nodesArr.push('Line No-5874: Integer t_Transactions_Per_Run;');
            nodesArr.push('Line No-5875: Integer x_Track_In_Oracle = null;');
            nodesArr.push('Line No-5876: String t_Class_Code = null;');
            nodesArr.push('Line No-5877: Integer t_Bonus_Account_Id = null;');
            nodesArr.push('Line No-5878: Integer t_Suspense_Account_Id = null;');
            nodesArr.push('Line No-5879: boolean t_First_Pass = false;');
            nodesArr.push('Line No-5880: String t_Bom_Level = null;');
            nodesArr.push('Line No-5881: Integer o_Inventory_Item_Id = null;');
            nodesArr.push('Line No-5882: Integer t_Count;');
            nodesArr.push('Line No-5883: Integer t_Number_Of_Digits;');
            nodesArr.push('Line No-5884: String t_To_Operation_Code;');
            nodesArr.push('Line No-5885: String t_Operation_Seq = null;');
            nodesArr.push('Line No-5886: String t_New_Routing = null;');
            nodesArr.push('Line No-5887: String t_New_Uom_Code1;');
            nodesArr.push('Line No-5888: Integer t_Component_Item_Id;');
            nodesArr.push('Line No-5889: Integer t_Component_Qty;');
            nodesArr.push('Line No-5890: String t_Component_Item;');
            nodesArr.push('Line No-5891: String t_New_Operation1;');
            nodesArr.push('Line No-5892: String t_Oper_Seq1;');
            nodesArr.push('Line No-5893: String t_New_Department1;');
            nodesArr.push('Line No-5894: String t_Uom;');
            nodesArr.push('Line No-5895: String t_Routing;');
            nodesArr.push('Line No-5896: String t_New_State;');
            nodesArr.push('Line No-5897: String t_New_State1;');
            nodesArr.push('Line No-5898: Integer t_New_Txn_Qty1;');
            nodesArr.push('Line No-5899: Integer t_New_Txn_Qty;');
            nodesArr.push('Line No-5900: String o_Bom_Level = null;');
            nodesArr.push('Line No-5901: Integer t_Unique_Id = null;');
            nodesArr.push('Line No-5902: String t_Lot_Suffix;');
            nodesArr.push('Line No-5903: Integer t_Lot_Process_Status;');
            nodesArr.push('Line No-5904: Integer t_Current_Level;');
            nodesArr.push('Line No-5905: Integer t_Level;');
            nodesArr.push('Line No-5906: Integer t_Operation_Seq_Id;');
            nodesArr.push('Line No-5907: Integer x_Operation_Seq_Id;');
            nodesArr.push('Line No-5908: Integer t_Consume_Flag;');
            nodesArr.push('Line No-5909: boolean t_Undo = false;');
            nodesArr.push('Line No-5910: Integer t_Quantity_In_Queue;');
            nodesArr.push('Line No-5911: Integer t_Quantity_Running;');
            nodesArr.push('Line No-5912: Integer t_Quantity_Waiting_To_Move;');
            nodesArr.push('Line No-5913: Integer t_Quantity_Scrapped = null;');
            nodesArr.push('Line No-5914: Integer t_Oracle_Intraope_Step_Type = null;');
            nodesArr.push('Line No-5915: Integer t_Tpla_Intraope_Step_Type = null;');
            nodesArr.push('Line No-5916: boolean t_Same_Bom_Level = false;');
            nodesArr.push('Line No-5917: String t_Timezone;');
            nodesArr.push('Line No-5918: Date t_Actual_Txn_Date;');
            nodesArr.push('Line No-5919: Integer t_Wo_Std_Op_Id = null;');
            nodesArr.push('Line No-5920: Integer t_Bos_Std_Op_Id = null;');
            nodesArr.push('Line No-5921: Integer t_Bom_Seq_Id;');
            nodesArr.push('Line No-5922: Integer t_Op_Seq_Num;');
            nodesArr.push('Line No-5923: Integer t_Item_Seq_Num;');
            nodesArr.push('Line No-5924: Integer t_Comp_Item_Id;');
            nodesArr.push('Line No-5925: Integer t_Min_Wip_Qty;');
            nodesArr.push('Line No-5926: Integer t_Ignore_Sample;');
            nodesArr.push('Line No-5927: Integer t_Sample_Success_Flag = null;');
            nodesArr.push('Line No-5928: Date t_Txn_Date1;');
            nodesArr.push('Line No-5931: Integer t_Wip_Cur_Qty');
            nodesArr.push('Line No-5932: Integer t_Min_Op_Seq_Num;');
            nodesArr.push('Line No-5933: Integer t_Returned_Quantity;');
            nodesArr.push('Line No-5934: Integer t_Return_Quantity;');
            nodesArr.push('Line No-5935: Integer t_Lot_Control_Code;');
            nodesArr.push('Line No-5936: String t_Component_Item_Number;');
            nodesArr.push('Line No-5938: Integer t_Child_Exist = 0;');
            nodesArr.push('Line No-5939: Integer t_Child_Txn_Id;');
            nodesArr.push('Line No-5940: String t_Item_Id;');
            nodesArr.push('Line No-5942: Integer t_Parent_Wait_Transaction_Id;');
            nodesArr.push('Line No-5943: Integer t_Wake_Rec_Transaction_Id;');
            nodesArr.push('Line No-5944: Integer t_Wake_Txn_Id;');
            nodesArr.push('Line No-5945: Integer t_Child_Wait_Transaction_Id;');
            nodesArr.push('Line No-5946: Integer t_Wake_Rec_Txn_Id1;');
            nodesArr.push('Line No-5947: Integer t_Child_Lot_Control_Code;');
            nodesArr.push('Line No-5948: Integer t_Child_Item_Id;');
            nodesArr.push('Line No-5949: String t_Wait_Child_Lot;');
            nodesArr.push('Line No-5951: Integer t_Transaction_Id = null;');
            nodesArr.push('Line No-5952: Integer Tp_Transaction_Id;');
            nodesArr.push('Line No-5953: Integer Tc_Transaction_Id;');
            nodesArr.push('Line No-5954: Integer t_Net_Quantity;');
            nodesArr.push('Line No-5955: String t_Nls_Date_Format;');
            nodesArr.push('Line No-5957: String t_Wip_Status = null;');
            nodesArr.push('Line No-5960: String t_Lot_Id');
            nodesArr.push('Line No-5962: String x_Tcla_Lot_Id;');
            nodesArr.push('Line No-5964: String t_Child_Lot;');
            nodesArr.push('Line No-5966: String t_Component_Lot;');
            nodesArr.push('Line No-5968: String t_Item_Num = null;');
            nodesArr.push('Line No-5970: Integer T_Inv_Item;');
            nodesArr.push('Line No-5971: Integer T_Chg_Item;');
            nodesArr.push('Line No-5972: TLotUtils tLotUtilsObject = new TLotUtils();');
            nodesArr.push('Line No-5973: TedUtils tedutilsObject = new TedUtils();');
            nodesArr.push('Line No-5974: TltAdapt tltAdatpObject = new TltAdapt();');
            nodesArr.push('Line No-5975: TinvAdapt tinvAdaptObject = new TinvAdapt();');
            nodesArr.push('Line No-5976: TltAdaptSubClass tltAdatptSubObject = new TltAdaptSubClass();');
            nodesArr.push('Line No-5978: t_Unterminate: {    end_Transact_Loop: {        Log_Msg = "TLTHREAD.T_Transact_Lots: Inside Procedure";        procedureParams_OutputMap = Log_Message(Log_Msg);        logger.debug(Log_Msg);        t_Stmt_Num = 10;        // --  if FND_PROFILE.VALUE(MRP_TRACE)=Y then        // --    dbms_session.set_sql_trace(true);        // --    select tlthread.t_transact_lots into t_trace_dummy from dual;        // --  end if;        try {            Sql = "SELECT  Routing_Field, " + " Operation_Field, " + " Mp.Organization_Id, " + " Job_Prefix, " + " Job_Separator, " + " Bom_Explode_Flag, " + " Routing_Type_Field, " + " Min_Operation_Seq, " + " Mp.Organization_Code, " + " Routing_On_The_Fly_Flag, " + " Factory_Id, " + " System_Item_Flag, " + " Hold_Column, " + " Hold_Value, " + " Completion_Subinventory, " + " Consume_Flag, " + " Std_Operations_Flag, " + " Create_Standard_Operations, " + " Operation_Seq_Field, " + " Transactions_Per_Run, " + " Lot_Suffix, " + " Number_Of_Digits, " + " Lot_Process_Status, " + " Department_Flag, " + " Timezone, " + " Ignore_Sample, " + " Serial_Enabled " + // --Added by MohanVamsi 8-Nov-2011 to check if Factory is Serial Enabled or not            " From Mtl_Parameters Mp, t_Factories Tf " + " Where Tf.Factory_Name = ? " + " And Tf.Organization_Code = Mp.Organization_Code  ";            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);            preparedStatement.setObject(1, i_Factory_Name);            resultSet = preparedStatement.executeQuery();            resultSet.last();            totalRows = resultSet.getRow();            resultSet.beforeFirst();            if (totalRows > 1) {                throw new SQLException("Too Many Rows");            }            if (resultSet.next() == false) {                throw new No_Data_Found("No Data Found");            } else {                t_Routing_Field = resultSet.getString(1);                t_Operation_Field = resultSet.getString(2);                t_Organization_Id = resultSet.getInt(3);                t_Job_Prefix = resultSet.getString(4);                t_Job_Separator = resultSet.getString(5);                t_Bom_Explode_Flag = resultSet.getString(6);                t_Routing_Type_Field = resultSet.getString(7);                t_Min_Operation_Seq = resultSet.getInt(8);                t_Organization_Code = resultSet.getString(9);                t_Routing_On_The_Fly_Flag = resultSet.getString(10);                t_Factory_Id = resultSet.getInt(11);                t_System_Item_Flag = resultSet.getInt(12);                t_Hold_Column = resultSet.getString(13);                t_Hold_Value = resultSet.getString(14);                t_Completion_Subinventory = resultSet.getString(15);                t_Consume_Flag = resultSet.getInt(16);                t_Standard_Operations_Flag = resultSet.getInt(17);                t_Create_Standard_Operations = resultSet.getInt(18);                t_Step_Seq_Field = resultSet.getString(19);                t_Transactions_Per_Run = resultSet.getInt(20);                t_Lot_Suffix = resultSet.getString(21);                t_Number_Of_Digits = resultSet.getInt(22);                t_Lot_Process_Status = resultSet.getInt(23);                t_Department_Flag = resultSet.getInt(24);                t_Timezone = resultSet.getString(25);                t_Ignore_Sample = resultSet.getInt(26);                T_Serial_Enabled_Factory = resultSet.getString(27);            }        } catch (SQLException e) {            logger.error(e, e);            t_Status_Code = Failure_Code;            t_Error_Code = 210;            t_Error_Message = "Error fetching factory details in wrapper, Err Msg:" + e.getSQLState();            procedureParams_OutputMap = Log_Message(t_Error_Message);            return methodParams_OutputMap;        }        t_Stmt_Num = 20;        if (i_Transaction_Id == null) {            // --if lot code is begin run for debugging one txn only            // --added to take care of multiple lot edapters for same factory            /*dbms_output.put_line(t_lot_process_status-||t_lot_process_status);                     if t_lot_process_status=2                     then                     dbms_output.put_line(Multiple threads are running);                     tLotUtilsObject.t_multi_thread;   --display message in output file                     return;                     else                     update  t_factories                     set lot_process_status=2                     where   factory_id=t_factory_id;                     commit;                     end if;*/            try {                Sql = "SELECT  Lot_Process_Status " + " From t_Factories " + " Where Factory_Id = ? " + " For Update Of Lot_Process_Status Nowait  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Factory_Id);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Lot_Process_Status = resultSet.getInt(1);                }                if (((t_Lot_Process_Status != null ? t_Lot_Process_Status : 2) == 2)) {                    Log_Msg = "Multiple threads are running,Check. If none are running then update lot_process_status in t_factories to 1 for this factory: " + i_Factory_Name;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    logger.debug(Log_Msg);                    logger.debug("Multiple Threads are running");                    logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                    logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                    logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                    // display message in output file                    tLotUtilsObject.T_Multi_Thread();                    Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = Nvl  (  Lot_Process_Status , ? )  " + " Where Factory_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, 1);                    preparedStatement.setObject(2, t_Factory_Id);                    preparedStatement.executeUpdate();                    connection.commit();                    // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                    // --Error Concurrent Request if Multiple Threads are Running.                    // --Some alert will hopefully catch this errored request                    // ------------------------------------------------------------------------------------------------------                    tLotUtilsObject.T_Global_Conc_Error = true;                    tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                    // ------------------------------------------------------------------------------------------------------                    // --To SET Concurrent Program Status, Added till here(Tri2:)                    return methodParams_OutputMap;                } else {                    Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, 2);                    preparedStatement.setObject(2, t_Factory_Id);                    preparedStatement.executeUpdate();                    connection.commit();                }                // }catch  ( t_No_Wait_Detected e) {            } catch (RuntimeException e) {                t_Error_Message = "Lot process status in T_FACTORIES is being updated by another thread";                procedureParams_OutputMap = Log_Message(t_Error_Message);                logger.debug(t_Error_Message);                logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                logger.debug(t_Error_Message);                tLotUtilsObject.T_Multi_Thread();                // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                // --Error Concurrent Request if Multiple Threads are Running.                // --Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                tLotUtilsObject.T_Global_Conc_Error = true;                tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                // --Error Concurrent Request if Multiple Threads are Running. Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                // --To SET Concurrent Program Status, Added till here(Tri2:)                return methodParams_OutputMap;            } catch (SQLException e) {                logger.error(e, e);                t_Error_Message = "Error in updating T_Factories, Err Msg: " + e.getSQLState();                procedureParams_OutputMap = Log_Message(t_Error_Message);                logger.debug(t_Error_Message);                logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                logger.debug(t_Error_Message);                logger.debug(t_Error_Message);                // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                // --Error Concurrent Request if Multiple Threads are Running.                // --Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                tLotUtilsObject.T_Global_Conc_Error = true;                tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                // --Error Concurrent Request if Multiple Threads are Running. Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                // --To SET Concurrent Program Status, Added till here(Tri2:)                return methodParams_OutputMap;            }        }        t_Factory_Name = i_Factory_Name;        t_User_Id = i_User_Id;        t_Stmt_Num = 30;        Sql = "SELECT  * " + " From t_Property_Lots " + " Where Factory_Id = ? ";        preparedStatement = connection.prepareStatement(Sql);        preparedStatement.setObject(1, t_Factory_Id);        resultSet1 = preparedStatement.executeQuery();        while (resultSet1.next()) {            String t_Chk_Col_Rec_Destination_Table = resultSet1.getString("DESTINATION_TABLE");            String t_Chk_Col_Rec_Destination_Column = resultSet1.getString("DESTINATION_COLUMN");            try {                Sql = "SELECT  x " + " From All_Tab_Columns " + " Where Table_Name = ? " + " And Column_Name = ? ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Chk_Col_Rec_Destination_Table);                preparedStatement.setObject(2, t_Chk_Col_Rec_Destination_Column);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Dummy = resultSet.getString(1);                }            } catch (SQLException e) {                logger.error(e, e);                t_Status_Code = Failure_Code;                t_Error_Code = 323;                t_Error_Message = "T_Transact_Lots: Error checking column existence: " + e.getSQLState();                logger.debug("T_Transact_Lots: Error Msg: " + t_Error_Message + ", at Stmt no: " + t_Stmt_Num);                procedureParams_OutputMap = Log_Message(t_Error_Message);                return methodParams_OutputMap;            }        }        t_Stmt_Num = 60;        if (i_Error_Records) {            logger.debug("T_Transact_Lots: Picking errored records also");            t_Reject_Code = Reject_Code;            t_Failure_Code = Failure_Code;            t_Api_Error_Code = Api_Error_Code;        } else {            t_Reject_Code = Reset_Code;            t_Failure_Code = Reset_Code;            t_Api_Error_Code = Reset_Code;        }        /*added by vishnu,28/01/2009, for PI,                             at pi there is no interface_id in wlmti, hence the below check is being performed*/        try {            Sql_String = "SELECT INTERFACE_ID FROM WSM_LOT_MOVE_TXN_INTERFACE WHERE ROWNUM =1 ";            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);            resultSet = preparedStatement.executeQuery();            resultSet.last();            totalRows = resultSet.getRow();            resultSet.beforeFirst();            if (resultSet.next() == false) {                throw new No_Data_Found("No Data Found");            } else {                Rows_Processed = 1;            }            if (Rows_Processed == 1) {                T_Wlmti_Interface_Id_Check = "Y";            }        } catch (SQLException e) {            logger.error(e, e);            T_Wlmti_Interface_Id_Check = "N";        }        // -- added upto here, vishnu,29/01/2009 ,for pi        Log_Msg = "Inside Transact_lots: Ready to Start process after initial checks";        procedureParams_OutputMap = Log_Message(Log_Msg);        logger.debug(Log_Msg);        // --Suds SiRF May26, 2009, for debugging date format issue. It is happening before the cursor. Check later        Sql = "SELECT  Value " + " From V$nls_Parameters " + " Where Parameter = ? ";        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);        preparedStatement.setObject(1, "NLS_DATE_FORMAT");        resultSet = preparedStatement.executeQuery();        resultSet.last();        totalRows = resultSet.getRow();        resultSet.beforeFirst();        if (totalRows > 1) {            throw new SQLException("Too Many Rows");        }        if (resultSet.next() == false) {            throw new No_Data_Found("No Data Found");        } else {            t_Nls_Date_Format = resultSet.getString(1);        }        procedureParams_OutputMap = Log_Message("1: The NLS Date format before C_LOT_REC is -" + t_Nls_Date_Format);        t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";        preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);        resultSet = preparedStatement.executeQuery();        resultSet.last();        totalRows = resultSet.getRow();        resultSet.beforeFirst();        if (totalRows > 1) {            throw new SQLException("Too Many Rows");        }        if (resultSet.next() == false) {            throw new No_Data_Found("No Data Found");        } else {        }        // --Suds SiRF May26, 2009        t_Rows_Processed = 0;        Sql = "SELECT   " + /*+ ordered use_nl (  b a ) */        " b. * " + " From  (  Select  " + /*+ INDEX (  A T_PARENT_LOTS_API_n2 ) */        " Rowid " + " From t_Parent_Lots_Api a " + " Where Status_Code In " + "  (   ?, " + " ?, " + " ?, " + " ?, " + " ?  )  " + " And New_Factory_Name = ? " + " And Transaction_Id = " + " Nvl  (   ?, Transaction_Id  )  " + " And Nvl  (   Lot_Id, x  )  = " + " Nvl  (   ?, Nvl  (   Lot_Id, x  )   )  " + " Order By Transaction_Id  )  a, " + " t_Parent_Lots_Api b " + " Where a.Rowid = b.Rowid " + " And Rownum < ?  ";        preparedStatement = connection.prepareStatement(Sql);        preparedStatement.setObject(1, Reset_Code);        preparedStatement.setObject(2, Found_Code);        preparedStatement.setObject(3, t_Reject_Code);        preparedStatement.setObject(4, t_Failure_Code);        preparedStatement.setObject(5, t_Api_Error_Code);        preparedStatement.setObject(6, i_Factory_Name);        preparedStatement.setObject(7, i_Transaction_Id);        preparedStatement.setObject(8, i_Lot_Id);        preparedStatement.setObject(9, t_Transactions_Per_Run);        resultSet2 = preparedStatement.executeQuery();        while (resultSet2.next()) {            String c_Lot_Rec_Old_Uom_Code = resultSet2.getString("Old_Uom_Code");            String c_Lot_Rec_Po_Line_Num = resultSet2.getString("Po_Line_Num");            String c_Lot_Rec_Transfer_Factory_Name = resultSet2.getString("Transfer_Factory_Name");            String c_Lot_Rec_Error_Message = resultSet2.getString("Error_Message");            String c_Lot_Rec_Transfer_Lot_Id = resultSet2.getString("Transfer_Lot_Id");            Integer c_Lot_Rec_Status_Code = resultSet2.getInt("Status_Code");            String c_Lot_Rec_New_Factory_Name = resultSet2.getString("New_Factory_Name");            Date c_Lot_Rec_Last_Update_Date = resultSet2.getDate("Last_Update_Date");            String c_Lot_Rec_Old_Department = resultSet2.getString("Old_Department");            String c_Lot_Rec_So_Line_Num = resultSet2.getString("So_Line_Num");            Integer c_Lot_Rec_Priority = resultSet2.getInt("Priority");            String c_Lot_Rec_Old_State_Id = resultSet2.getString("Old_State_Id");            String c_Lot_Rec_New_Routing = resultSet2.getString("New_Routing");            Integer c_Lot_Rec_Lot_Id = resultSet2.getInt("Lot_Id");            String c_Lot_Rec_Message_Id = resultSet2.getString("Message_Id");            String c_Lot_Rec_Old_Routing = resultSet2.getString("Old_Routing");            String c_Lot_Rec_Shipment_Number = resultSet2.getString("Shipment_Number");            String c_Lot_Rec_Po_Num = resultSet2.getString("Po_Num");            String c_Lot_Rec_Undo_Flag = resultSet2.getString("Undo_Flag");            String c_Lot_Rec_Nls_Code = resultSet2.getString("Nls_Code");            String c_Lot_Rec_So_Num = resultSet2.getString("So_Num");            String c_Lot_Rec_New_Department = resultSet2.getString("New_Department");            Date c_Lot_Rec_Creation_Date = resultSet2.getDate("Creation_Date");            String c_Lot_Rec_Subinv_Code = resultSet2.getString("Subinv_Code");            String c_Lot_Rec_Old_Bom_Level = resultSet2.getString("Old_Bom_Level");            String c_Lot_Rec_New_Lot_Id = resultSet2.getString("New_Lot_Id");            String c_Lot_Rec_Old_Lot_Type = resultSet2.getString("Old_Lot_Type");            String c_Lot_Rec_Transfer_Subinv_Code = resultSet2.getString("Transfer_Subinv_Code");            Date c_Lot_Rec_Transaction_Date = resultSet2.getDate("Transaction_Date");            String c_Lot_Rec_Old_Factory_Name = resultSet2.getString("Old_Factory_Name");            String c_Lot_Rec_Old_Operation = resultSet2.getString("Old_Operation");            Integer c_Lot_Rec_Distribution_Account_Id = resultSet2.getInt("Distribution_Account_Id");            String c_Lot_Rec_Action_Code = resultSet2.getString("Action_Code");            String c_Lot_Rec_Cost_Flag = resultSet2.getString("Cost_Flag");            Integer c_Lot_Rec_Transferlot_Txn_Qty = resultSet2.getInt("Transferlot_Txn_Qty");            Date c_Lot_Rec_Due_Date = resultSet2.getDate("Due_Date");            Date c_Lot_Rec_Start_Date = resultSet2.getDate("Start_Date");            String c_Lot_Rec_New_Uom_Code = resultSet2.getString("New_Uom_Code");            Integer c_Lot_Rec_Transfer_Locator_Id = resultSet2.getInt("Transfer_Locator_Id");            String c_Lot_Rec_New_Bom_Level = resultSet2.getString("New_Bom_Level");            Integer c_Lot_Rec_Due_Qty = resultSet2.getInt("Due_Qty");            Integer c_Lot_Rec_New_Txn_Qty = resultSet2.getInt("New_Txn_Qty");            String c_Lot_Rec_New_Operation = resultSet2.getString("New_Operation");            String c_Lot_Rec_New_State_Id = resultSet2.getString("New_State_Id");            String c_Lot_Rec_Operation_Sequence = resultSet2.getString("Operation_Sequence");            String c_Lot_Rec_New_Lot_Type = resultSet2.getString("New_Lot_Type");            String c_Lot_Rec_Oracle_Alternate_Designator = resultSet2.getString("Oracle_Alternate_Designator");            Integer c_Lot_Rec_Transaction_Id = resultSet2.getInt("Transaction_Id");            Integer c_Lot_Rec_Old_Txn_Qty = resultSet2.getInt("Old_Txn_Qty");            Integer c_Lot_Rec_Locator_Id = resultSet2.getInt("Locator_Id");            String c_Lot_Rec_Timezone = resultSet2.getString("Timezone");            String c_Lot_Rec_Fab_Lot_Number = resultSet2.getString("Fab_Lot_Number");            String c_Lot_Rec_Account_Alias = resultSet2.getString("Account_Alias");            Integer c_Lot_Rec_Error_Code = resultSet2.getInt("Error_Code");            t_Stmt_Num = 71;            try {                // added by vyshnavi                // --Deepak 18 Dec,02  for tracking unhandled exception                // --Suds SiRF Feb, 2009, for debugging date format issue. Check later                Sql = "SELECT  Value " + " From V$nls_Parameters " + " Where Parameter = ?  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, "NLS_DATE_FORMAT");                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Nls_Date_Format = resultSet.getString(1);                }                procedureParams_OutputMap = Log_Message("2: The NLS Date format after C_LOT_REC is -" + t_Nls_Date_Format);                t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";                preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                }                procedureParams_OutputMap = Log_Message("//-----------------------------------------------------------------------------------");                procedureParams_OutputMap = Log_Message("Thread Initial txnid/date-" + c_Lot_Rec_Transaction_Id + "--" + c_Lot_Rec_Transaction_Date);                procedureParams_OutputMap = Log_Message("//-----------------------------------------------------------------------------------");                // --Suds SiRF Feb, 2009                /*vishnu 29 june 2009, commented below if condition for duplicate message id check.                                     un-necessary check being done. message_id is the link between the t_reason_accounts and tpla.                                     the message_id in tpla and reason_code in t_reason_accounts table joining columns,                                     hence it is possible that same message id can be used for multiple transaction in tpla, so the below check is not required.                                     */                /*      if c_lot_rec.message_id is not null                                     then                                     begin                                     --deepak 21 jan, 03 :check for duplicate message ids being subscribed                                     select x                                     into t_dummy                                     from t_parent_lots_api                                     where transaction_id < c_lot_rec.transaction_id and                                     new_factory_name = i_factory_name and                                     message_id = c_lot_rec.message_id and rownum = 1;                                     update t_parent_lots_api                                     set status_code   = success_code,                                     error_message = duplicate message id                                     where transaction_id = c_lot_rec.transaction_id;                                     goto end_transact_loop;                                     exception                                     when no_data_found then                                     null;                                     end;                                     end if;                                     */                t_Stmt_Num = 75;                Sql = "UPDATE t_Child_Lots_Api " + " Set Lot_Id = Trim  (  Lot_Id )  " + " Where Transaction_Id = ?  ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, c_Lot_Rec_Transaction_Id);                preparedStatement.executeUpdate();                t_Lot_Rec.Transaction_Id = c_Lot_Rec_Transaction_Id;                t_Lot_Rec.Status_Code = c_Lot_Rec_Status_Code;                t_Lot_Rec.Old_Factory_Name = c_Lot_Rec_Old_Factory_Name;                t_Lot_Rec.New_Factory_Name = c_Lot_Rec_New_Factory_Name;                t_Lot_Rec.ERROR_CODE = c_Lot_Rec_Error_Code;                t_Lot_Rec.Error_Message = c_Lot_Rec_Error_Message;                t_Lot_Rec.Action_Code = c_Lot_Rec_Action_Code;                t_Lot_Rec.Lot_Id = c_Lot_Rec_Lot_Id.toString();                t_Lot_Rec.New_Lot_Id = c_Lot_Rec_New_Lot_Id;                t_Lot_Rec.Transfer_Lot_Id = c_Lot_Rec_Transfer_Lot_Id;                t_Lot_Rec.Old_Operation = c_Lot_Rec_Old_Operation;                t_Lot_Rec.New_Operation = c_Lot_Rec_New_Operation;                t_Lot_Rec.Operation_Sequence = c_Lot_Rec_Operation_Sequence;                t_Lot_Rec.Old_Txn_Qty = c_Lot_Rec_Old_Txn_Qty;                t_Lot_Rec.New_Txn_Qty = c_Lot_Rec_New_Txn_Qty;                t_Lot_Rec.Transferlot_Txn_Qty = c_Lot_Rec_Transferlot_Txn_Qty;                t_Lot_Rec.Old_Department = c_Lot_Rec_Old_Department;                t_Lot_Rec.New_Department = c_Lot_Rec_New_Department;                // convert date to calendar                Calendar c = Calendar.getInstance();                c.setTime(c_Lot_Rec_Transaction_Date);                // manipulate date -- Adding days                int numberOfDays = Integer.parseInt(t_Timezone) / 24 > 0 ? Integer.parseInt(t_Timezone) / 24 : 0;                c.add(Calendar.DATE, numberOfDays);                // convert calendar to date                // Deepak 14 Jan,2003                t_Lot_Rec.Transaction_Date = (java.sql.Date) c.getTime();                t_Lot_Rec.Old_Lot_Type = c_Lot_Rec_Old_Lot_Type;                t_Lot_Rec.New_Lot_Type = c_Lot_Rec_New_Lot_Type;                t_Lot_Rec.Old_Routing = c_Lot_Rec_Old_Routing;                t_Lot_Rec.New_Routing = c_Lot_Rec_New_Routing;                t_Lot_Rec.New_Bom_Level = c_Lot_Rec_New_Bom_Level;                t_Lot_Rec.Old_Bom_Level = c_Lot_Rec_Old_Bom_Level;                t_Lot_Rec.Po_Num = c_Lot_Rec_Po_Num;                t_Lot_Rec.Po_Line_Num = c_Lot_Rec_Po_Line_Num;                t_Lot_Rec.So_Num = c_Lot_Rec_So_Num;                t_Lot_Rec.So_Line_Num = c_Lot_Rec_So_Line_Num;                t_Lot_Rec.Due_Date = new java.sql.Date(c_Lot_Rec_Due_Date.getTime());                t_Lot_Rec.Due_Qty = c_Lot_Rec_Due_Qty;                t_Lot_Rec.Priority = c_Lot_Rec_Priority;                t_Lot_Rec.Old_Uom_Code = c_Lot_Rec_Old_Uom_Code;                t_Lot_Rec.New_Uom_Code = c_Lot_Rec_New_Uom_Code;                t_Lot_Rec.Old_State_Id = c_Lot_Rec_Old_State_Id;                t_Lot_Rec.New_State_Id = c_Lot_Rec_New_State_Id;                t_Lot_Rec.Timezone = c_Lot_Rec_Timezone;                t_Lot_Rec.Nls_Code = c_Lot_Rec_Nls_Code;                t_Lot_Rec.Undo_Flag = c_Lot_Rec_Undo_Flag;                t_Lot_Rec.Message_Id = c_Lot_Rec_Message_Id;                t_Lot_Rec.Start_Date = new java.sql.Date(c_Lot_Rec_Start_Date.getTime());                // added for inventory                t_Lot_Rec.Last_UpDate_Date = new java.sql.Date(c_Lot_Rec_Last_Update_Date.getTime());                t_Lot_Rec.Creation_Date = new java.sql.Date(c_Lot_Rec_Creation_Date.getTime());                t_Lot_Rec.Transfer_Factory_Name = c_Lot_Rec_Transfer_Factory_Name;                t_Lot_Rec.Subinv_Code = c_Lot_Rec_Subinv_Code;                t_Lot_Rec.Transfer_Subinv_Code = c_Lot_Rec_Transfer_Subinv_Code;                t_Lot_Rec.Distribution_Account_Id = c_Lot_Rec_Distribution_Account_Id;                t_Lot_Rec.Account_Alias = c_Lot_Rec_Account_Alias;                t_Lot_Rec.Locator_Id = c_Lot_Rec_Locator_Id;                t_Lot_Rec.Transfer_Locator_Id = c_Lot_Rec_Transfer_Locator_Id;                t_Lot_Rec.Shipment_Number = c_Lot_Rec_Shipment_Number;                // Hari K, Microtune IBM solution, reusing existing column                t_Lot_Rec.Cost_Flag = c_Lot_Rec_Cost_Flag;                // Vishnu Gutta, for PI,May1                t_Lot_Rec.Fab_Lot_Number = c_Lot_Rec_Fab_Lot_Number;                // By MohanVamsi/Mahendra on 27 Oct"09 for BOM alternates                t_Lot_Rec.Oracle_Alternate_Designator = c_Lot_Rec_Oracle_Alternate_Designator;                // --  dbms_output.put_line(t_lot_rec.transaction_date-||t_lot_rec.transaction_date);                t_Status_Code = Reset_Code;                t_Found_Flag = false;                t_Merge_Flag = false;                t_Oracle_Uom = null;                t_Error_Code = null;                t_Error_Message = null;                x_Wip_Qty = 0;                // Deepak 03 Jan,03                t_Check_Bom = true;                // Deepak 03 Jan,03                t_Same_Bom_Level = false;                // Deepak 03 Jan,03                t_Skip_Bom_Level = false;                // Deepak 03 Jan,03                t_Undo = false;                // --  t_txn_qty1:=t_lot_rec.new_txn_qty;  --Deepak 03 Jan,03  --for UNDOS                // --  t_uom1:=t_lot_rec.new_uom_code;   --Deepak 03 Jan,03                // -- since the waiting model updates records                // -- to waiting after the cursor was opened                // --Added by MohanVamsi/Mahendra, 24th Mar2010 since the Txns are not getting picked if Invalid Action is passed.                t_Stmt_Num = 76;                if (t_Lot_Rec.Action_Code == null) {                    t_Status_Code = Reject_Code;                    t_Error_Code = 76;                    t_Error_Message = "Transact_Lots: Action Code cannot be null";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                } else if (!("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code) || "CONSUME".equals(t_Lot_Rec.Action_Code) || "TERMINATE".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code) || "MOVE".equals(t_Lot_Rec.Action_Code) || "UNDO MOVE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code) || "SPLIT".equals(t_Lot_Rec.Action_Code) || "CHANGE ITEM".equals(t_Lot_Rec.Action_Code) || "CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGE QTY".equals(t_Lot_Rec.Action_Code) || "LOT LINK".equals(t_Lot_Rec.Action_Code) || "COMPLETE".equals(t_Lot_Rec.Action_Code) || "TRANSFER".equals(t_Lot_Rec.Action_Code) || "HOLD".equals(t_Lot_Rec.Action_Code) || "RELEASE".equals(t_Lot_Rec.Action_Code) || "UNSTART".equals(t_Lot_Rec.Action_Code) || "START".equals(t_Lot_Rec.Action_Code) || "UNCONSUME".equals(t_Lot_Rec.Action_Code) || "UNCOMPLETE".equals(t_Lot_Rec.Action_Code) || "UNSCRAP".equals(t_Lot_Rec.Action_Code) || "SCRAP".equals(t_Lot_Rec.Action_Code) || "CANCEL".equals(t_Lot_Rec.Action_Code) || "CHANGE ROUTING".equals(t_Lot_Rec.Action_Code) || "UN LINK".equals(t_Lot_Rec.Action_Code) || "UNDOS".equals(t_Lot_Rec.Action_Code) || "BONUS QTY".equals(t_Lot_Rec.Action_Code) || "MERGE".equals(t_Lot_Rec.Action_Code) || "REVERSE".equals(t_Lot_Rec.Action_Code))) {                    t_Status_Code = Reject_Code;                    t_Error_Code = (int) 76.01;                    t_Error_Message = "Transact_Lots: Please check the Action Code";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --Added by MohanVamsi/Mahendra, 24th Mar2010 for validating Action Codes.                t_Stmt_Num = 80;                Sql = "SELECT  Status_Code " + " From t_Parent_Lots_Api " + " Where Transaction_Id = ?  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Status_Code = resultSet.getInt(1);                }                if (t_Status_Code == Waiting_Code) {                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // -- Changed and Moved the waiting Model to here by MohanVamsi/Mahendra on 05th Feb10                // -----------------CLose CURSOR Waiting Model Starts--------------------                // -- Added code to get the lot id in the TCLA                // -- Added the if condition for direct org transfer as the waiting model is different for direct org transfer                t_Stmt_Num = 85;                if (("DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code))) {                    // -- Direct org should only wait for the lots in its own factory                    // -- and should only wait if the current factory is a destination factory in previos transaction                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                    // --Below Elsif Added by MohanVamsi/Hari-K 22-Feb-2012, to Make Consume Txn Wait until Previous Consume is                    // --Successful which uses same Component-Lots                    /**                     * *********************************************************************************************                     */                    /**                     * **********************************************************************************************                     *                                             |                                                                                                 |                     *                                             |             UNCOMMENT THIS FOR Any-Other Clients except SUNPOWER                                |                     *                                             /************************************************************************************************                     */                    /**                     * *********************************************************************************************                     */                    /*Elsif t_Lot_Rec.Action_Code = CONSUME Then                                             T_Stmt_Num := 85.1;                                             Open Parent_Wait_Rec For                                             Select Tpla.Transaction_Id, Tcla.Lot_Id                                             From Apps.t_Parent_Lots_Api Tpla,                                             Apps.t_Child_Lots_Api Tcla ,                                             Apps.t_child_lots_api x2                                             Where Tpla.Transaction_Id = Tcla.Transaction_Id(+)                                             And x2.Transaction_Id   < tpla.Transaction_Id                                             And ( Nvl(Tpla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(New_Lot_Id, x)  = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(x2.lot_id,X)    = Nvl(tcla.lot_id,Y)                                             )                                             And Tpla.Transaction_Id   < t_Lot_Rec.Transaction_Id                                             And ( Nvl(New_Factory_Name, x)  = i_Factory_Name Or                                             Nvl(New_Factory_Name, x)  = Nvl(t_Lot_Rec.Transfer_Factory_Name, y) Or                                             Nvl(Transfer_Factory_Name, x) = i_Factory_Name Or                                             Nvl(Transfer_Factory_Name, x) = Nvl(t_Lot_Rec.Transfer_Factory_Name, y)                                             )                                             And ( Tpla.Status_Code = Reset_Code Or                                             Tpla.Status_Code = Failure_Code Or                                             Tpla.Status_Code = Reject_Code Or                                             Tpla.Status_Code = Waiting_Code Or                                             Tpla.Status_Code = Found_Code Or                                             Tpla.Status_Code = Api_Error_Code Or                                             Tpla.Status_Code = Onhold_Code                                             )                                             And Rownum = 1;                                             Loop                                             Fetch Parent_Wait_Rec                                             Into t_Transaction_Id, t_Wait_Child_Lot;                                             Exit When Parent_Wait_Rec%Notfound;                                             Update t_Parent_Lots_Api                                             Set Status_Code   = Waiting_Code,                                             Error_Message = Wtg.parent for Consume:  || t_Transaction_Id ||, at stmt: ||t_Stmt_Num                                             Where Lot_Id                          = t_Lot_Rec.Lot_Id                                             And Transaction_Id                 >= t_Lot_Rec.Transaction_Id                                             And (Nvl(New_Factory_Name, x)     = i_Factory_Name Or                                             Nvl(New_Factory_Name, x)      = Nvl(t_Lot_Rec.Transfer_Factory_Name, y) Or                                             Nvl(Transfer_Factory_Name, x) = i_Factory_Name Or                                             Nvl(Transfer_Factory_Name, x) = Nvl(t_Lot_Rec.Transfer_Factory_Name, y))                                             And Status_Code = Reset_Code;                                             Close Parent_Wait_Rec;                                             Goto End_Transact_Loop;                                             End Loop;                                             Close Parent_Wait_Rec;   */                    /**                     * *********************************************************************************************                     */                    /**                     * **********************************************************************************************                     *                                             |                                                                                                 |                     *                                             |             UNCOMMENT TILL HERE FOR Any-Other Clients except SUNPOWER                           |                     *                                             /************************************************************************************************                     */                    /**                     * *********************************************************************************************                     */                    // --Special Case for SUNPOWER, SPLIT of Child Lot used in previous Consume of Parent                    // --should not wait Ex: SPLIT of WF should not wait for DIE CONSUME                } else if (t_Lot_Rec.Action_Code.equals("SPLIT")) {                    t_Stmt_Num = (int) 85.2;                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  " + // -- Or  Nvl(New_Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y)                    // -- Or  Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y)                    " )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        // --t_wait_child_lot is only used for instransit Receipt                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                } else {                    t_Stmt_Num = 86;                    // --for all other action codes in tpla                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        // --t_wait_child_lot is only used for instransit Receipt                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                }                // -- For Waitng model for IntransitShipment .Intransit Receipt and IINTREQINTRANSITRECEIPT)                // -- Looks FOR THE particular RECORD IN THE TCLA FOR THE child lot AND keeps THE RECORD IN TPLA waiting                t_Stmt_Num = 87;                if (("INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wait_Child_Lot = resultSet.getString(1);                    }                    Sql = "SELECT  Min ( Tpla.Transaction_Id) " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )   ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Transaction_Id = resultSet.getInt(1);                    }                    if (t_Transaction_Id != null) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                t_Stmt_Num = (int) 87.5;                if (("CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT   " + /*+ INDEX ( A,T_PARENT_LOTS_API_N1)  */                    " Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  Or " + " Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  )  " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? )  " + " And  Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Previous lot transaction for new_lot_id waiting , Check this is incorrect data. || " + " ? " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Failure_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id > t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                }                // -- start transactions will wait if the consumption lot  direct org transfer is still pending                // -- check if the tcla entry has pending record in other faactories tpla/tcla                // -- check for the tcla entry has any pending record in current factories tcla/tpla                t_Stmt_Num = 89;                if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Sql = "SELECT  Tcla1.Lot_Id " + " From t_Child_Lots_Api Tcla1, t_Parent_Lots_Api Tpla1 " + " Where Tpla1.Transaction_Id = Tcla1.Transaction_Id " + " And Tpla1.New_Factory_Name = ? " + " And Tpla1.Transaction_Id = ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, i_Factory_Name);                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                    Child_Wait_Rec1_ResultSet = preparedStatement.executeQuery();                    while (Child_Wait_Rec1_ResultSet.next()) {                        Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  )  " + " And Tpla.Action_Code Not Like START " + " And Tpla.Status_Code In   (  ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ? )  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, i_Factory_Name);                        preparedStatement.setObject(2, i_Factory_Name);                        preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.setObject(5, Waiting_Code);                        preparedStatement.setObject(6, Reject_Code);                        preparedStatement.setObject(7, Failure_Code);                        preparedStatement.setObject(8, Api_Error_Code);                        preparedStatement.setObject(9, Found_Code);                        preparedStatement.setObject(10, Onhold_Code);                        Child_Wait_Rec_ResultSet = preparedStatement.executeQuery();                        while (Child_Wait_Rec_ResultSet.next()) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Child- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Waiting_Code);                            preparedStatement.setObject(2, t_Transaction_Id);                            preparedStatement.setObject(3, t_Stmt_Num);                            preparedStatement.setObject(4, Reset_Code);                            preparedStatement.executeUpdate();                            // Child_Wait_Rec.close ( );                            // Child_Wait_Rec.close ( );                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // Child_Wait_Rec.close ( );                    }                    // Child_Wait_Rec.close ( );                }                t_Stmt_Num = (int) 89.01;                if (t_Lot_Rec.Action_Code.equals("TRANSFER")) {                    Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Api_Error_Code);                    preparedStatement.setObject(9, Found_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Transfer_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Transfer_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? || " + "  , at stmt:  || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.executeUpdate();                        // Transfer_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Transfer_Wait_Rec.close ( );                }                t_Stmt_Num = (int) 89.02;                if (("SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MERGE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Sql = "SELECT  Tcla1.Lot_Id " + " From t_Child_Lots_Api Tcla1, t_Parent_Lots_Api Tpla1 " + " Where Tpla1.Transaction_Id = Tcla1.Transaction_Id " + " And Tpla1.New_Factory_Name = ? " + " And Tpla1.Transaction_Id = ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, i_Factory_Name);                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                    Child_Wait_Rec1_ResultSet = preparedStatement.executeQuery();                    while (Child_Wait_Rec1_ResultSet.next()) {                        Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.New_Factory_Name = ? " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  " + // --Or Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Id, y)                        // --Uncomment for any other Client other than SunPower                        // --Commented by MohanVamsi/Hari-K 22-Feb-2012                        " )  " + " And Tpla.Status_Code In   (  ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ? )  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, i_Factory_Name);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(3, Reset_Code);                        preparedStatement.setObject(4, Waiting_Code);                        preparedStatement.setObject(5, Reject_Code);                        preparedStatement.setObject(6, Failure_Code);                        preparedStatement.setObject(7, Api_Error_Code);                        preparedStatement.setObject(8, Found_Code);                        preparedStatement.setObject(9, Onhold_Code);                        Child_Wait_Rec_ResultSet = preparedStatement.executeQuery();                        while (Child_Wait_Rec_ResultSet.next()) {                            if ((!t_Lot_Rec.Action_Code.toUpperCase().equals("SPLIT"))) {                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Child- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Waiting_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.setObject(3, t_Stmt_Num);                                preparedStatement.setObject(4, Reset_Code);                                preparedStatement.executeUpdate();                                // Child_Wait_Rec.close ( );                                // Child_Wait_Rec.close ( );                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("SPLIT")) {                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Previous lot transaction for child lot_id waiting , Check this is incorrect data. || " + " ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Failure_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.executeUpdate();                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id > t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Waiting_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.setObject(3, t_Stmt_Num);                                preparedStatement.setObject(4, Reset_Code);                                preparedStatement.executeUpdate();                                // Child_Wait_Rec.close ( );                                // Child_Wait_Rec.close ( );                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // Child_Wait_Rec.close ( );                    }                    // Child_Wait_Rec.close ( );                }                // -----------------CLose CURSOR Waiting Model Ends--------------------                // -- wake up the rest, next record                t_Transaction_Id = null;                logger.debug("t_Lot_Rec.Lot_Id: " + t_Lot_Rec.Lot_Id);                logger.debug("t_Lot_Rec.Transaction_Id: " + t_Lot_Rec.Transaction_Id);                logger.debug("t_Lot_Rec.Transfer_Factory_Name: " + t_Lot_Rec.Transfer_Factory_Name);                logger.debug("i_Factory_Name: " + i_Factory_Name);                logger.debug("Waiting_Code , Reject_Code , Api_Error_Code , Failure_Code" + Waiting_Code + " , " + Reject_Code + " , " + Api_Error_Code + " , " + Failure_Code);                t_Stmt_Num = (int) 89.03;                Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   Waiting_Code, " + " Reject_Code, " + " Api_Error_Code, " + " ?  )  ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                preparedStatement.setObject(2, i_Factory_Name);                preparedStatement.setObject(3, i_Factory_Name);                preparedStatement.setObject(4, Failure_Code);                resultSet3 = preparedStatement.executeQuery();                while (resultSet3.next()) {                    Integer Wake_Rec_Transaction_Id = resultSet3.getInt("Transaction_Id");                    // This will return a null value if the action code is CHANGELOTID.                    t_Transaction_Id = Wake_Rec_Transaction_Id;                    logger.debug("T_Transaction_Id1:" + t_Transaction_Id);                }                if (("CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = " + " Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   Waiting_Code, " + " Reject_Code, " + " Api_Error_Code, " + " ?  )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Failure_Code);                    resultSet4 = preparedStatement.executeQuery();                    while (resultSet4.next()) {                        Integer Wake_Rec1_Transaction_Id = resultSet4.getInt("Transaction_Id");                        // ---changes made for waking up the next transaction of the new lot id                        if (t_Transaction_Id == null) {                            t_Transaction_Id = Wake_Rec1_Transaction_Id;                        } else if (t_Transaction_Id > Wake_Rec1_Transaction_Id) {                            t_Transaction_Id = Wake_Rec1_Transaction_Id;                        }                    }                }                logger.debug("T_Transaction_Id2: " + t_Transaction_Id);                t_Stmt_Num = (int) 89.04;                if (t_Transaction_Id != null) {                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Reset- || t_Lot_Rec.Transaction_Id || " + "  , at stmt:  || ? " + " Where Transaction_Id = ? " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )   ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, Reset_Code);                    preparedStatement.setObject(2, t_Stmt_Num);                    preparedStatement.setObject(3, t_Transaction_Id);                    preparedStatement.executeUpdate();                }                t_Stmt_Num = (int) 89.05;                Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                resultSet5 = preparedStatement.executeQuery();                while (resultSet5.next()) {                    Integer Wake_Rec2_Lot_Id = resultSet5.getInt("Lot_Id");                    Integer Wake_Rec2_Transaction_Id = resultSet5.getInt("Transaction_Id");                    Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = " + " Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   ?, " + " ?, " + " ?, " + " ?  )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, Wake_Rec2_Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Waiting_Code);                    preparedStatement.setObject(5, Reject_Code);                    preparedStatement.setObject(6, Api_Error_Code);                    preparedStatement.setObject(7, Failure_Code);                    resultSet6 = preparedStatement.executeQuery();                    while (resultSet6.next()) {                        Integer Wake_Rec3_Transaction_Id = resultSet6.getInt("Transaction_Id");                        // --Reset child records if present                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Reset- || t_Lot_Rec.Transaction_Id || " + "  , at stmt:  || ? " + " Where Transaction_Id = ? " + " And    (   Nvl   (   New_Factory_Name , x  )   = ? Or " + " Nvl   (   New_Factory_Name , x  )   = " + " Nvl   (   t_Lot_Rec.Transfer_Factory_Name , y  )   Or " + " Nvl   (   Transfer_Factory_Name , x  )   = ? Or " + " Nvl   (   Transfer_Factory_Name , x  )   = " + " Nvl   (   t_Lot_Rec.Transfer_Factory_Name , y  )    )   " + " And Status_Code In " + "   (   ? , ? , ? , ?  )    ,? ,? ,Wake_Rec3_Transaction_Id ,? ,i_Factory_Name ,i_Factory_Name ,Failure_Code )   ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, Reject_Code);                        preparedStatement.setObject(3, Api_Error_Code);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.setObject(5, t_Stmt_Num);                        preparedStatement.executeUpdate();                    }                }                // -- Waiting  model ends                // -- Added till here by MohanVamsi/Mahendra on 05th Feb10 to change and move Waiting Model                // --------- scrub and take actions based on lot type----------                // ------------get lot type details ---------                t_Stmt_Num = 90;                if (!("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code))) {                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Lot_Type_Details(t_Factory_Id, t_Lot_Rec.New_Lot_Type, //                     x_Track_In_Oracle, t_Class_Code, t_Bonus_Account_Id, t_Suspense_Account_Id, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Track_In_Oracle") != null) {                        x_Track_In_Oracle = (java.lang.Integer) procedureParams_OutputMap.get("o_Track_In_Oracle");                    }                    if (procedureParams_OutputMap.get("o_Class_Code") != null) {                        t_Class_Code = (java.lang.String) procedureParams_OutputMap.get("o_Class_Code");                    }                    if (procedureParams_OutputMap.get("o_Bonus_Account_Id") != null) {                        t_Bonus_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Bonus_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Suspense_Account_Id") != null) {                        t_Suspense_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Suspense_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    logger.debug("Transact_Lots: status code at" + t_Stmt_Num + ":" + t_Status_Code);                    if (t_Status_Code != Success_Code) {                        try {                            // --Harikrishna June 02 for setting to waiting code in case of a non-successful parent record                            /* SELECT TRANSACTION_ID                                                         INTO T_CHILD_TXN_ID                                                         FROM T_PARENT_LOTS_API                                                         WHERE NEW_FACTORY_NAME = T_LOT_REC.NEW_FACTORY_NAME                                                         AND LOT_ID = T_LOT_REC.LOT_ID                                                         AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                                         AND (STATUS_CODE = RESET_CODE OR                                                         STATUS_CODE = FAILURE_CODE OR                                                         STATUS_CODE = REJECT_CODE OR                                                         STATUS_CODE = WAITING_CODE OR                                                         STATUS_CODE = FOUND_CODE OR                                                         STATUS_CODE = API_ERROR_CODE OR                                                         STATUS_CODE = ONHOLD_CODE)                                                         AND ROWNUM = 1;                                                         UPDATE T_PARENT_LOTS_API                                                         SET STATUS_CODE   = WAITING_CODE,                                                         ERROR_MESSAGE = Wtg.Parent- || T_CHILD_TXN_ID                                                         WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                                         GOTO END_TRANSACT_LOOP;*/                            // -- Commented Above and Added below for Wakeup By MohanVamsi/Mahendra on 5th Feb10                            Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And New_Factory_Name = ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(3, Reset_Code);                            preparedStatement.setObject(4, Failure_Code);                            preparedStatement.setObject(5, Reject_Code);                            preparedStatement.setObject(6, Waiting_Code);                            preparedStatement.setObject(7, Found_Code);                            preparedStatement.setObject(8, Api_Error_Code);                            preparedStatement.setObject(9, Onhold_Code);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Child_Txn_Id = resultSet.getInt(1);                            }                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Waiting_Code);                            preparedStatement.setObject(2, t_Child_Txn_Id);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // -- Added Till here By MohanVamsi/Mahendra on 5th Feb10                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -----global assignment                    g_Track_In_Oracle = x_Track_In_Oracle;                    procedureParams_OutputMap = Log_Message("Transact_Lots: Transaction Id: " + t_Lot_Rec.Transaction_Id);                    logger.debug("Transact_Lots: Track in Oracle: " + x_Track_In_Oracle);                    if (g_Track_In_Oracle == 1) {                        t_New_Routing = t_Lot_Rec.New_Routing;                        t_Stmt_Num = 100;                        if (t_Lot_Rec.New_Operation != null) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Lot_Rec.New_Factory_Name, t_New_Routing, t_Lot_Rec.New_Operation, t_Lot_Rec.Operation_Sequence, // Deepak 22 Mar, 03                            t_Lot_Rec.Transaction_Date, o_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("i_New_Routing") != null) {                                t_New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                            }                            if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                                o_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                            }                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                            // --When new routing is not provied in TPLA, the update bom level procedure of tLotUtilsObject gets                            // --the new routing from the routing attributes in bor and bos and popualtes it back into tpla,                            // --the fetched routing should be assigned to lot_rec                            t_Lot_Rec.New_Routing = t_New_Routing;                            procedureParams_OutputMap = Log_Message("Transact_Lots: BOM Level: " + o_Bom_Level + ", New Routing: " + t_New_Routing);                            procedureParams_OutputMap = Log_Message("Transact_Lots: Status Code:" + t_Status_Code);                            if (t_Status_Code != Success_Code) {                                try {                                    // --Harikrishna June 02 for setting to waiting code in case of a non-successful parent record                                    /*                  SELECT TRANSACTION_ID                                                                     INTO T_CHILD_TXN_ID                                                                     FROM T_PARENT_LOTS_API                                                                     WHERE NEW_FACTORY_NAME = T_LOT_REC.NEW_FACTORY_NAME                                                                     AND LOT_ID = T_LOT_REC.LOT_ID                                                                     AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                                                     AND (STATUS_CODE = RESET_CODE OR                                                                     STATUS_CODE = FAILURE_CODE OR                                                                     STATUS_CODE = REJECT_CODE OR                                                                     STATUS_CODE = WAITING_CODE OR                                                                     STATUS_CODE = FOUND_CODE OR                                                                     STATUS_CODE = API_ERROR_CODE OR                                                                     STATUS_CODE = ONHOLD_CODE)                                                                     AND ROWNUM = 1;                                                                     UPDATE T_PARENT_LOTS_API                                                                     SET STATUS_CODE   = WAITING_CODE,                                                                     ERROR_MESSAGE = Wtg.Parent- || T_CHILD_TXN_ID                                                                     WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                                                     GOTO END_TRANSACT_LOOP;*/                                    // -- Commented Above and Added below for Wakeup By MohanVamsi/Mahendra on 5th Feb10                                    Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.New_Factory_Name = ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                    preparedStatement.setObject(3, Reset_Code);                                    preparedStatement.setObject(4, Failure_Code);                                    preparedStatement.setObject(5, Reject_Code);                                    preparedStatement.setObject(6, Waiting_Code);                                    preparedStatement.setObject(7, Found_Code);                                    preparedStatement.setObject(8, Api_Error_Code);                                    preparedStatement.setObject(9, Onhold_Code);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Child_Txn_Id = resultSet.getInt(1);                                    }                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Waiting_Code);                                    preparedStatement.setObject(1, t_Child_Txn_Id);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                    // -- Added Till here By MohanVamsi/Mahendra on 5th Feb10                                } catch (No_Data_Found e) {                                    logger.error(e);                                }                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                        }                        // operation null                    }                    // -- Added from here By MohanVamsi/Mahendra on 10th Nov09 to check positive Qtys                    t_Stmt_Num = 105;                    if (t_Lot_Rec.New_Txn_Qty == 0) {                        t_Status_Code = Success_Code;                        t_Error_Code = 200;                        t_Error_Message = "Txn Qty is Zero, So Making this Transaction Success at stmt: " + t_Stmt_Num;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Lot_Rec.New_Txn_Qty < 0 && !("CONSUME".equals(t_Lot_Rec.Action_Code) || "UNCONSUME".equals(t_Lot_Rec.Action_Code))) {                        t_Status_Code = Reject_Code;                        t_Error_Code = 210;                        t_Error_Message = "Txn Qty Cannot be Negative for Action Code  " + t_Lot_Rec.Action_Code + " at stmt: " + t_Stmt_Num;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added till here By MohanVamsi/Mahendra on 10th Nov09 to check positive Qtys                    t_Stmt_Num = 110;                    procedureParams_OutputMap = t_Clean_Mess(i_Factory_Name, t_Lot_Rec.Transaction_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, // Deepak 21 Dec,02                    t_Error_Message);                    if (procedureParams_OutputMap.get("t_Lot_Rec") != null) {                        t_Lot_Rec = (beans.tlotutils.T_Lotrec_Type) procedureParams_OutputMap.get("t_Lot_Rec");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code == Success_Code) {                        // -- defect  -- on success                        // -- consume -- on failure                        // -- actions -- not linked to oracle                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Deepak 21 Oct,02                    connection.commit();                    /* taken down below 130 Hari Krishnan,  Feb 07                                                 t_stmt_num :=120;                                                 dbms_output.put_line(incomingtransaction id- status code-||t_lot_rec.transaction_id||-->||t_lot_rec.status_code);                                                 begin                                                 select open_flag                                                 into t_period_open_flag                                                 from org_acct_periods                                                 where organization_id = t_organization_id                                                 --and period_close_date is null -- Hari Krishnan  Feb 07 Oracle 11.5.10. invttmtx.tdatechk                                                 and  period_start_date <= trunc(t_lot_rec.transaction_date)                                                 and schedule_close_date >= trunc(t_lot_rec.transaction_date);                                                 exception                                                 when no_data_found then                                                 begin                                                 select open_flag                                                 into t_period_open_flag                                                 from org_acct_periods                                                 where organization_id = t_organization_id                                                 and  period_start_date <= trunc(sysdate)                                                 and schedule_close_date >= trunc(sysdate);                                                 exception                                                 when no_data_found then                                                 t_period_open_flag :=N;                                                 end;                                                 end;                                                 */                    t_Stmt_Num = 130;                    // -- check if a period is open for the current date                    // -- to avoid OSFM defects                    // Hari K, resetting to false.                    t_First_Pass = false;                    if (t_First_Pass == false) {                        try {                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods " + " Where Organization_Id = ? " + " And Period_Start_Date <= Trunc  (  Sysdate )  " + " And Schedule_Close_Date >= Trunc  (  Sysdate )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Period_Open_Flag = "N";                        }                        if (t_Period_Open_Flag.equals("N")) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 250;                            t_Error_Message = "Accounting Period not open  for current date.Stopping Lots eDapter ";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 1);                            preparedStatement.setObject(2, i_Factory_Name);                            preparedStatement.executeUpdate();                            // --And User_Type          = 1;                            // ---Added by MohanVamsi for on 17 Sep08                            // Deepak 27 Dec,02                            connection.commit();                            // better to stop the run for the factory,hence return                            return methodParams_OutputMap;                        }                        // --***** UnComment this If PO and GL periods are Required. *****---                        /*   --Added By MohanVamsi for PO and GL period Check on Dec4th08                                                     BEGIN                                                     T_STMT_NUM := 131;                                                     SELECT 1                                                     INTO T_DUMMY                                                     FROM GL_PERIOD_STATUSES                                                     WHERE APPLICATION_ID = 201 ---201 for PO, 101 for GL (Check fnd_application table)                                                     AND SET_OF_BOOKS_ID =                                                     (SELECT SET_OF_BOOKS_ID                                                     FROM ORG_ORGANIZATION_DEFINITIONS                                                     WHERE ORGANIZATION_ID = T_ORGANIZATION_ID) AND                                                     TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE AND                                                     CLOSING_STATUS = O;                                                     EXCEPTION                                                     WHEN NO_DATA_FOUND THEN                                                     T_STATUS_CODE   := REJECT_CODE;                                                     T_ERROR_CODE    := 255;                                                     T_ERROR_MESSAGE := PO Period is not Open for the Organization.Stopping Lots eDapter. at stmt num  ||                                                     T_STMT_NUM;                                                     tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                     NULL,                                                     T_STATUS_CODE,                                                     T_ERROR_CODE,                                                     T_ERROR_MESSAGE,                                                     SET);                                                     UPDATE T_FACTORIES                                                     SET LOT_PROCESS_STATUS = 1                                                     WHERE FACTORY_NAME = I_FACTORY_NAME;                                                     COMMIT;                                                     RETURN;                                                     END;                                                     BEGIN                                                     T_STMT_NUM := 132;                                                     SELECT 1                                                     INTO T_DUMMY                                                     FROM GL_PERIOD_STATUSES                                                     WHERE APPLICATION_ID = 101 ---201 for PO, 101 for GL (Check fnd_application table)                                                     AND SET_OF_BOOKS_ID =                                                     (SELECT SET_OF_BOOKS_ID                                                     FROM ORG_ORGANIZATION_DEFINITIONS                                                     WHERE ORGANIZATION_ID = T_ORGANIZATION_ID) AND                                                     TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE AND                                                     CLOSING_STATUS = O AND ADJUSTMENT_PERIOD_FLAG = N;                                                     EXCEPTION                                                     WHEN NO_DATA_FOUND THEN                                                     T_STATUS_CODE   := REJECT_CODE;                                                     T_ERROR_CODE    := 257;                                                     T_ERROR_MESSAGE := GL Period is not Open for the Organization.Stopping Lots eDapter. at stmt num  ||                                                     T_STMT_NUM;                                                     tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                     NULL,                                                     T_STATUS_CODE,                                                     T_ERROR_CODE,                                                     T_ERROR_MESSAGE,                                                     SET);                                                     UPDATE T_FACTORIES                                                     SET LOT_PROCESS_STATUS = 1                                                     WHERE FACTORY_NAME = I_FACTORY_NAME;                                                     COMMIT;                                                     RETURN;                                                     END; --Added by MohanVamsi Till Here 4 Dec08                                                     */                        // -- else  -- Hari commented Feb 07                        t_First_Pass = true;                    }                    // Hari, brought down from above stmt 130, Feb 07 Validation is incorrect.                    t_Stmt_Num = (int) 120.1;                    logger.debug("Transact_Lots: Incoming Transaction Id , Status code: " + t_Lot_Rec.Transaction_Id + " , " + t_Lot_Rec.Status_Code);                    if (t_First_Pass) {                        try {                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods " + " Where Organization_Id = ? " + // Hari Krishnan  Feb 07 Oracle 11.5.10. invttmtx.tdatechk                            " And Period_Close_Date == null  " + " And Period_Start_Date <= Trunc  (  ? )  " + " And Schedule_Close_Date >= " + " Trunc  (  ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 251;                            t_Error_Message = "Accounting Period not open for the transaction date.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 1);                            preparedStatement.setObject(2, i_Factory_Name);                            preparedStatement.executeUpdate();                            // ---Added by MohanVamsi for on 17 Sep08                            // Deepak 27 Dec,02                            connection.commit();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // not returning as period is open and other txns can be considerd except this one.                    }                    // Hari Feb 07                    // -- chk later auto recovery                    if (t_Period_Open_Flag.equals("N")) {                        t_Status_Code = Reject_Code;                        t_Error_Code = 250;                        t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date. Cannot proceed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                        Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 1);                        preparedStatement.setObject(2, i_Factory_Name);                        preparedStatement.executeUpdate();                        // ---Added by MohanVamsi for on 17 Sep08                        // Deepak 27 Dec,02                        connection.commit();                        return methodParams_OutputMap;                    }                    t_Stmt_Num = 140;                    // --check for duplicate oracle jobs and return                    // --if the action is start and it already exists , error out and stop                    if (t_Lot_Rec.Action_Code.equals("START")) {                        if (t_Job_Prefix != null) {                            Sql = "SELECT  t_Job_Prefix || t_Job_Separator || t_Lot_Rec.Lot_Id || " + " t_Job_Separator || t_Lot_Suffix " + " From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Check_Job_Name = resultSet.getString(1);                            }                            Sql = "SELECT  Length ( t_Check_Job_Name) From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Job_Len = resultSet.getInt(1);                            }                            try {                                Sql = "SELECT  Substr ( We.Wip_Entity_Name, 1, t_Job_Len), " + " Status_Type " + " From Wip_Entities We, Wip_Discrete_Jobs Wdj " + " Where We.Organization_Id = ? " + // -- and substr(we.wip_entity_name,1,t_job_len) =t_check_job_name                                " And We.Wip_Entity_Name = ? " + " And Wdj.Wip_Entity_Id = We.Wip_Entity_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Check_Job_Name);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Check_Job_Name = resultSet.getString(1);                                    t_Status_Type = resultSet.getInt(2);                                }                                if (t_Status_Type != 1) {                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 360;                                    t_Error_Message = "Attempt to start same lot, Check T Lots and T Oracle Jobs. Actions: In T_LOTS, Change Status; In T ORCL Jobs, Change Status and Active flag to appropriate values";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                            } catch (Too_Many_Rows e) {                                logger.error(e);                                try {                                    t_Stmt_Num = 150;                                    Sql = // Deepak 26 Dec,02                                    "SELECT  Unique_Id, Status  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 04 Dec,02                                    " And Bom_Level = ?   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                        t_Status = resultSet.getString(2);                                    }                                    if (t_Status.equals("T")) {                                        // null;                                    }                                    Sql = "SELECT  Status_Type " + " From Wip_Discrete_Jobs " + " Where Organization_Id = ? " + " And Wip_Entity_Id = " + "  (  Select Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ? " + " And Factory_Id = ? )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Unique_Id);                                    preparedStatement.setObject(3, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Status_Type = resultSet.getInt(1);                                    }                                    if (t_Status_Type != 1) {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 509;                                        t_Error_Message = "Attempt to start same lot.Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                } catch (Too_Many_Rows e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 525;                                    t_Error_Message = "Attempt to start same lot in same factory.Possible errors in T_LOTS table";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } else {                            t_Stmt_Num = 160;                            Sql = "SELECT  t_Lot_Rec.Lot_Id || t_Job_Separator || t_Lot_Suffix " + " From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Check_Job_Name = resultSet.getString(1);                            }                            Sql = "SELECT  Length ( t_Check_Job_Name) From Dual";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Job_Len = resultSet.getInt(1);                            }                            try {                                Sql = "SELECT  Substr ( We.Wip_Entity_Name, 1, t_Job_Len), " + " Status_Type  " + " From Wip_Entities We, Wip_Discrete_Jobs Wdj " + " Where We.Organization_Id = ? " + // -- and substr(we.wip_entity_name,1,t_job_len) =t_check_job_name                                " And We.Wip_Entity_Name = ? " + " And Wdj.Wip_Entity_Id = We.Wip_Entity_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Check_Job_Name);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Check_Job_Name = resultSet.getString(1);                                    t_Status_Type = resultSet.getInt(2);                                }                                if (t_Status_Type == 3) {                                    try {                                        Sql = "SELECT  Reset_Code, " + "  Waiting for lot to be completed in previous sector " + " From Wsm_Lot_Move_Txn_Interface " + " Where Wip_Entity_Name = ? " + " And Transaction_Type In   (  1, ? )  " + " And Status <> ? " + " And  Rownum = 1";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Check_Job_Name);                                        preparedStatement.setObject(2, 2);                                        preparedStatement.setObject(3, 4);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Code = resultSet.getInt(1);                                            t_Error_Message = resultSet.getString(2);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                    }                                    try {                                        Sql = "SELECT  Reset_Code, " + "  Errored/Pending  transaction in  previous sector exist " + " From t_Parent_Lots_Api " + " Where Lot_Id = ? " + " And Transaction_Id < ? " + " And New_Factory_Name = ? " + " And Status_Code <> ? " + " And  Rownum = 1";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Check_Job_Name);                                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                        preparedStatement.setObject(3, t_Lot_Rec.New_Factory_Name);                                        preparedStatement.setObject(4, 3);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Code = resultSet.getInt(1);                                            t_Error_Message = resultSet.getString(2);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                    }                                    if (t_Status_Code == Reset_Code && t_Error_Message != null) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                }                                if (t_Status_Type != 1) {                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 390;                                    t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                            } catch (Too_Many_Rows e) {                                logger.error(e);                                try {                                    t_Stmt_Num = 170;                                    Sql = "SELECT  Unique_Id, Status " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 04 Dec,02                                    " And Bom_Level = ?   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                        t_Status = resultSet.getString(2);                                    }                                    if (t_Status.equals("T")) {                                        // null;                                    }                                    Sql = "SELECT  Status_Type " + " From Wip_Discrete_Jobs " + " Where Organization_Id = ? " + " And Wip_Entity_Id = " + "  (  Select Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ? " + " And Factory_Id = ? )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Unique_Id);                                    preparedStatement.setObject(3, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Status_Type = resultSet.getInt(1);                                    }                                    if (t_Status_Type != 1) {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 591;                                        t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                } catch (Too_Many_Rows e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 607;                                    t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        }                    }                    // -- LOG_MESSAGE(Before waiting model);                    // --  T_STMT_NUM := 180;                }                // -- waiting event  model                // -- WM after validate/check interface introduced                // --START not to be put in waiting                // -- Hari K Feb 07 removed commented waiting model using for loop. Not reqd anymore                // -----------------CLose CURSOR Waiting Model Starts--------------------                /*OPEN PARENT_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH PARENT_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.parent- || T_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID >= T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             OPEN PARENT_WAIT_REC FOR                                             SELECT \*+ INDEX(A,T_PARENT_LOTS_API_N1)  *\                                             TRANSACTION_ID                                             FROM T_PARENT_LOTS_API A                                             WHERE TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NEW_LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             --  if parent_wait_rec.transaction_id is not null                                             --  then                                             FETCH PARENT_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || T_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             --  end if;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             T_STMT_NUM := 190;                                             OPEN CHILD_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND EXISTS                                             (SELECT TCL.TRANSACTION_ID                                             FROM T_CHILD_LOTS_API  TCL,                                             T_PARENT_LOTS_API TPL                                             WHERE TCL.TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND TCL.FACTORY_NAME = I_FACTORY_NAME                                             AND TCL.LOT_ID = T_LOT_REC.LOT_ID                                             AND TPL.TRANSACTION_ID = TCL.TRANSACTION_ID                                             AND (TPL.STATUS_CODE = RESET_CODE OR                                             TPL.STATUS_CODE = WAITING_CODE OR                                             TPL.STATUS_CODE = REJECT_CODE OR                                             TPL.STATUS_CODE = FAILURE_CODE OR                                             TPL.STATUS_CODE = API_ERROR_CODE OR                                             TPL.STATUS_CODE = FOUND_CODE OR                                             TPL.STATUS_CODE = ONHOLD_CODE));                                             LOOP                                             FETCH CHILD_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN CHILD_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Child- || T_LOT_REC.TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE CHILD_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE CHILD_WAIT_REC;                                             IF T_LOT_REC.ACTION_CODE = TRANSFER                                             THEN                                             OPEN TRANSFER_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.TRANSFER_LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = ONHOLD_CODE);                                             LOOP                                             FETCH TRANSFER_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN TRANSFER_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || T_TRANSACTION_ID                                             WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                             CLOSE TRANSFER_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE TRANSFER_WAIT_REC;                                             END IF;                                             T_STMT_NUM := 200;                                             IF UPPER(T_LOT_REC.ACTION_CODE) = MERGE                                             THEN                                             OPEN CHILD_LOTS_REC FOR                                             SELECT LOT_ID                                             FROM T_CHILD_LOTS_API                                             WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID                                             AND FACTORY_NAME = I_FACTORY_NAME;                                             LOOP                                             FETCH CHILD_LOTS_REC                                             INTO T_LOT_ID;                                             EXIT WHEN CHILD_LOTS_REC%NOTFOUND;                                             OPEN PARENT_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR                                             STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR                                             STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR                                             STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH PARENT_WAIT_REC                                             INTO TP_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || TP_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             OPEN CHILD_WAIT_REC FOR                                             SELECT TCL.TRANSACTION_ID                                             FROM T_CHILD_LOTS_API  TCL,                                             T_PARENT_LOTS_API TPL                                             WHERE TCL.TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND TCL.FACTORY_NAME = I_FACTORY_NAME                                             AND TCL.LOT_ID = T_LOT_ID                                             AND TPL.TRANSACTION_ID = TCL.TRANSACTION_ID(+)                                             AND (TPL.STATUS_CODE = RESET_CODE OR                                             TPL.STATUS_CODE = WAITING_CODE OR                                             TPL.STATUS_CODE = REJECT_CODE OR                                             TPL.STATUS_CODE = FAILURE_CODE OR                                             TPL.STATUS_CODE = API_ERROR_CODE OR                                             TPL.STATUS_CODE = FOUND_CODE OR                                             TPL.STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH CHILD_WAIT_REC                                             INTO TC_TRANSACTION_ID;                                             EXIT WHEN CHILD_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || TC_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE CHILD_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE CHILD_WAIT_REC;                                             END LOOP;                                             CLOSE CHILD_LOTS_REC;                                             END IF; */                // -- Commented above and Added below to Check in tpla as well as tcla                // -----------------CLose CURSOR Waiting Model Ends--------------------                // --wake up the rest, next record                /*  FOR WAKE_REC IN (SELECT MIN(TRANSACTION_ID) TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             --    and status_code =waiting_code    --Deepak 14 Dec,02                                             --    and status_code in (waiting_code,reject_code,api_error_code,failure_code) -- Hari Krishnan Jan 07                                             AND STATUS_CODE IN                                             (WAITING_CODE, REJECT_CODE, API_ERROR_CODE) -- dont wake up failure code as data is inserted into tpla with that.Let users wake up those records                                             )                                             LOOP                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = RESET_CODE,                                             ERROR_MESSAGE = Reset- || T_LOT_REC.TRANSACTION_ID                                             WHERE TRANSACTION_ID = WAKE_REC.TRANSACTION_ID                                             AND LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME;                                             EXIT;                                             END LOOP;*/                // ---- waiting  model ends                // --------- check the interface,rigid check                t_Stmt_Num = 210;                // -- LOG_MESSAGE(After waiting model);                if (((t_Ignore_Sample != null ? t_Ignore_Sample : 2) == 1) && ((x_Track_In_Oracle != null ? x_Track_In_Oracle : 2) != 1)) {                    try {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Sample_Lot(t_Lot_Rec.Transaction_Id, t_Lot_Rec, t_Organization_Id, t_Factory_Name, t_Factory_Id, t_Ignore_Sample, x_Track_In_Oracle, t_Sample_Success_Flag);                        if (procedureParams_OutputMap.get("o_Success_Flag") != null) {                            t_Sample_Success_Flag = (java.lang.Integer) procedureParams_OutputMap.get("o_Success_Flag");                        }                        if (t_Sample_Success_Flag == 1) {                            t_Status_Code = Success_Code;                            t_Error_Code = null;                            t_Error_Message = null;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            logger.debug("Transact_Lots: Status After Ignore Sample:" + t_Sample_Success_Flag);                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } catch (Exception e) {                        logger.error(e, e);                    }                }                if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    t_Check_Interface = false;                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --Added by MohanVamsi 4th Dec08 for Erroring in T_PARENT_LOTS_API                // --if Date Released in greater than Date Provided in TPLA.                if (!("START".equals(t_Lot_Rec.Action_Code) || "CREATE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code) || "UNDO MOVE".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code) || "INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code))) {                    // -- Added from here on 1st Feb10                    t_Stmt_Num = (int) 210.01;                    // -- Calling t_update_bom_level to update BOM level in T_LOT_ITEMS_API                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Factory_Name, t_Lot_Rec.New_Routing, t_Lot_Rec.New_Operation, t_Lot_Rec.Operation_Sequence, t_Lot_Rec.Transaction_Date, t_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_New_Routing") != null) {                        t_Lot_Rec.New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                    }                    if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                        t_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("Transact_Lots: After Update Bom Level - T_BOM_LEVEL" + t_Bom_Level);                    if (t_Status_Code != Success_Code) {                        t_Error_Code = (int) 3380.11;                        t_Error_Message = "T_TRANSACT_LOTS: Error in updating Item Bom Level, at Stmt Num " + t_Stmt_Num + " " + // Substr ( t_Error_Message,  1,  260);                        t_Error_Message.substring(1 - 1, 260 + (1 - 1));                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Get the ITEM ID based on T_LOT_ITEMS_API                    t_Stmt_Num = (int) 210.02;                    procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: After Get Lot Item, T_Inventory_Item_ID: " + t_Inventory_Item_Id);                    if (t_Status_Code != Success_Code) {                        t_Error_Code = (int) 3380.12;                        t_Error_Message = "T_TRANSACT_LOTS: Error in T_GET_LOT_ITEM, in getting Item_ID, at Stmt Num " + t_Stmt_Num + " " + // Substr ( t_Error_Message,  1,  260);                        t_Error_Message.substring(1 - 1, 260 + (1 - 1));                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added till here on 1st Feb10                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Action_Code: " + t_Lot_Rec.Action_Code + " , Inv-Id: " + t_Inventory_Item_Id + ", Txn-Date: " + t_Lot_Rec.Transaction_Date);                    if (!("CHANGE ITEM".equals(t_Lot_Rec.Action_Code) || "MERGE".equals(t_Lot_Rec.Action_Code))) {                        // --12-May-2012 MERGE included, Since NEW LOT-Name cane be used which doest exists in Oracle                        // --Added above IF condition by MohanVamsi, to avoid CHANGE ITEM transactions,                        // --as this will fetch the new Item Provided in TLIA(Tri2: IS023628)                        try {                            t_Stmt_Num = (int) 210.03;                            Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + // Added or Commented by Mahendra 29 Aug09 for Complete Unscrap                            " And Quantity_Scrapped <> Start_Quantity  " + " And Lot_Number = ? " + // Added on 1st Feb10                            " And Primary_Item_Id = ?  " + // 3 Release , ? Hold                            " And Status_Type Not In   (  3, ? )    ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Inventory_Item_Id);                            preparedStatement.setObject(4, 6);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 3380.13;                            t_Error_Message = "Job is Already Completed, Unable to Process thru eDapter.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // return methodParams_OutputMap;                        } catch (No_Data_Found e) {                            logger.error(e);                            // --Added by Mahendra 29 Aug09 for Complete Unscrap                            try {                                t_Stmt_Num = (int) 210.04;                                Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + " And Quantity_Scrapped = Start_Quantity " + " And Lot_Number = ? " + // Added on 1st Feb10                                " And Primary_Item_Id = ?  " + " And Status_Type = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(3, t_Inventory_Item_Id);                                preparedStatement.setObject(4, 4);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                // --Added till here by Mahendra 29 Aug09 for Complete Unscrap                            } catch (No_Data_Found e2) {                                logger.error(e2);                                try {                                    t_Stmt_Num = (int) 210.05;                                    Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + // Added on 1st Feb10                                    " And Primary_Item_Id = ?  " + " And Lot_Number = ? " + " And Status_Type In   (  3, ? )  " + " And Date_Released <= ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(4, 6);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    try {                                        // --Check if Lot-Item-Org Combination exists                                        t_Stmt_Num = (int) 210.06;                                        Sql = "SELECT  Item_Number " + " From Mtl_Item_Flexfields " + " Where Inventory_Item_Id = ? " + " And Organization_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Organization_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Item_Num = resultSet.getString(1);                                        }                                        // --No Exception for this select, since this will fail intially when fetching                                        // --T_Inventory_Item_ID itself in case of any exception.                                        Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + " And Primary_Item_Id = ? " + " And Lot_Number = ? " + " And Status_Type In   (  3, ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Organization_Id);                                        preparedStatement.setObject(2, t_Inventory_Item_Id);                                        preparedStatement.setObject(3, t_Lot_Rec.Lot_Id);                                        preparedStatement.setObject(4, 6);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Dummy = resultSet.getString(1);                                        }                                        t_Status_Code = Reject_Code;                                        t_Error_Code = (int) 3380.15;                                        DateFormat format = new SimpleDateFormat("DD-MON-YY HH24:MI:SS");                                        t_Error_Message = format.format(t_Lot_Rec.Transaction_Date) + ", Org: " + t_Organization_Code + ", Item Num: " + t_Item_Num + ", Lot: " + t_Lot_Rec.Lot_Id + "." + " Transaction Date earlier than Release Date of the Job in OSFM";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                        // return methodParams_OutputMap;                                    } catch (No_Data_Found e4) {                                        logger.error(e4);                                        t_Status_Code = Reject_Code;                                        t_Error_Code = (int) 3380.16;                                        t_Error_Message = "Job does not exists for this combination:" + " Org : " + t_Organization_Code + ", Item Num: " + t_Item_Num + ", Lot: " + t_Lot_Rec.Lot_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                        // return methodParams_OutputMap;                                    }                                }                            }                        }                    }                    // Close Change ITEM IF                    // --Added Above End If avoid CHANGE ITEM transactions, as this will fetch the new Item                    // --provided in TLIA(Tri2: IS023628)                }                // --Added by MohanVamsi 4th Dec08  Till Here                // ---------------------CALL REVERSE PROCEDURE HERE----------------------------------------------                procedureParams_OutputMap = Log_Message("Before calling REVERSE TXNS Proc");                t_Stmt_Num = (int) 210.10;                if (t_Lot_Rec.Action_Code.equals("REVERSE")) {                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, t_Lot_Rec.Transaction_Id:" + t_Lot_Rec.Transaction_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, t_Lot_Rec.Lot_Id:" + t_Lot_Rec.Lot_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, T_Organization_Id:" + t_Organization_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, T_Organization_Code:" + t_Organization_Code);                    procedureParams_OutputMap = tltAdatptSubObject.t_Reverse_Txn_Api(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Organization_Id.toString(), t_Organization_Code, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ---------------------CALL INV PROCEDURE HERE----------------------------------------------                // --------------------********Start Check for Inventory Transactions*********----------------                procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Calling INV Txn Proc");                if (("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code))) {                    // --Added by MohanVamsi 7th Aug09                    // --Check if Accounting periods for scheduled factory and Transfer factory are Open or not                    try {                        t_Stmt_Num = (int) 210.20;                        Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods Oap, Mtl_Parameters Mp, t_Factories Tf " + // t_lot_rec.transfer_factory_name                        " Where Tf.Factory_Name = ?  " + " And Tf.Organization_Code = Mp.Organization_Code " + " And Oap.Organization_Id = Mp.Organization_Id " + " And Period_Close_Date == null " + " And Period_Start_Date <= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )  " + " And Schedule_Close_Date >= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Period_Open_Flag = resultSet.getString(1);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = (int) 251.02;                        t_Error_Message = "Accounting Period not Open for the transaction date, for Source Factory :" + t_Lot_Rec.New_Factory_Name;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        connection.commit();                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // not returning as period is open and other txns can be considerd except this one.                    if (t_Period_Open_Flag.equals("N")) {                        t_Status_Code = Reject_Code;                        t_Error_Code = (int) 251.03;                        t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date. Cannot proceed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        connection.commit();                        return methodParams_OutputMap;                    }                    if (t_Lot_Rec.Action_Code.equals("DIRINTERORGTRANSFER")) {                        try {                            t_Stmt_Num = (int) 210.30;                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods Oap, " + " Mtl_Parameters   Mp, " + " t_Factories      Tf " + " Where Tf.Factory_Name = ? " + " And Tf.Organization_Code = Mp.Organization_Code " + " And Oap.Organization_Id = Mp.Organization_Id " + " And Period_Close_Date == null " + " And Period_Start_Date <= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )  " + " And Schedule_Close_Date >= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transfer_Factory_Name);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 251.04;                            t_Error_Message = "Accounting Period not Open for the transaction date, for Transfer Factory :" + t_Lot_Rec.Transfer_Factory_Name;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            connection.commit();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // not returning as period is open and other txns can be considerd except this one.                        // -- chk later auto recovery                        if (t_Period_Open_Flag.equals("N")) {                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 251.05;                            t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date . Cannot proceed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            connection.commit();                            return methodParams_OutputMap;                        }                    }                    // --Added by MohanVamsi 7th Aug09 for Accounting Period Check Ends here.                    // --Added by MohanVamsi 7th Aug09 to Check Interface Tables for Inventory Transactions                    if (("INVMERGE".equals(t_Lot_Rec.Action_Code))) {                        Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = " + " ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet7 = preparedStatement.executeQuery();                        while (resultSet7.next()) {                            Integer t_Inv_Rec_Lot_Id = resultSet7.getInt("Lot_Id");                            t_Stmt_Num = (int) 210.31;                            procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Inv_Rec_Lot_Id.toString(), // x_wip_entity_id                            null, // t_organization_id                            null, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                    }                    t_Stmt_Num = (int) 210.32;                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, // x_wip_entity_id                    null, // t_organization_id,                    null, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    logger.debug("T_TRANSACT_LOTS: Status code after T_Check_Lot_Interface, at stmt no:" + t_Stmt_Num + " :" + t_Status_Code);                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        // -- t_error_message := t_error_message || lot ||t_lot_rec.lot_id|| still in interface tables at stmt no:||t_stmt_num;                        logger.debug("T_TRANSACT_LOTS: " + t_Error_Message);                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added by MohanVamsi 7th Aug09 Till Here to Check Interface Tables for Inventory Transactions.                    // --Hari Krishnan Nov 06 Added(I_Resp_Id, I_Resp_Appl_Id) for Tinvadapt receive transactions                    procedureParams_OutputMap = tinvAdaptObject.t_Inv_Txn(t_Organization_Id, i_User_Id, t_Lot_Rec.Transaction_Id, t_Status_Code, t_Error_Code, t_Error_Message, i_Resp_Id, i_Resp_Appl_Id);                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // --Added by MohanVamsi 4th May09 to WakeUp Errored Transactions failing because of INV Transactions                    // --If Inventory Transactions are successfully processed then WakeUp transactions, failing because of                    // --these Inventory Transactions. T_WAKEUP_REC this cursor will get the minimum transaction from tpla,tcla                    // --existing after Inventory Transaction in TPLA and wakes it up.(status_code = 1)                    if (t_Status_Code == Success_Code) {                        Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id, " + " Tcla.Line_Number " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id > " + " ? " + " And Tpla.Transaction_Id = " + " Tcla.Transaction_Id " + " And Tpla.Lot_Id = ? " + " And Tpla.Status_Code <> ? " + " Group By Tcla.Line_Number ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(3, Success_Code);                        resultSet8 = preparedStatement.executeQuery();                        while (resultSet8.next()) {                            Integer t_Wakeup_Rec_Transaction_Id = resultSet8.getInt("Transaction_Id");                            Integer t_Wakeup_Rec_Line_Number = resultSet8.getInt("Line_Number");                            t_Status_Code = Reset_Code;                            t_Error_Code = null;                            t_Error_Message = "Transaction WakeUp by eDapter as Child Lot got processed.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Wakeup_Rec_Transaction_Id, t_Wakeup_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                        // WakeUp{Ends                    }                    // Status Code If Ends                    // --Added Till here 4th May09                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ----------------*************End Check for Inventory Transactions******--------------                procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: After INV Txn Proc");                if (t_Auto_Recover == false) {                    // -- get wip_entity_id/job name for the lot                    procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, Integer.toString(t_Status_Type), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                        t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                    }                    if (procedureParams_OutputMap.get("o_Status_Type") != null) {                        t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                    }                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, T_Job_Name: " + t_Job_Name);                    // --start wip lot transactions                    t_Stmt_Num = 220;                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, X_Track_In_Oracle: " + x_Track_In_Oracle);                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, X_Job_Name:" + t_Job_Name);                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, T_Lot_Position: " + t_Lot_Position);                    if (x_Track_In_Oracle == 1 && t_Job_Name == null || t_Lot_Position.equals("I") && !("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MERGE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "C");                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                            t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                        }                        if (procedureParams_OutputMap.get("o_Status_Type") != null) {                            t_Status_Type = Integer.parseInt(procedureParams_OutputMap.get("o_Status_Type").toString());                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Job_Name == null || t_Lot_Position.equals("I")) {                            procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "N");                            if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                                t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                            }                            if (procedureParams_OutputMap.get("o_Job_Name") != null) {                                t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                            }                            if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                                x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                            }                            if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                                x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                            }                            if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                                t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                            }                            if (procedureParams_OutputMap.get("o_Status_Type") != null) {                                t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                            }                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                        procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check ( 2) T_Job_Name: " + t_Job_Name);                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("MERGE")) {                            t_Startup = false;                            // --Added by K.L.Venkatraman, 27 July 2009                            t_Stmt_Num = (int) 220.01;                            try {                                Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Factory_Name = ? ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                preparedStatement.setObject(2, i_Factory_Name);                                resultSet9 = preparedStatement.executeQuery();                                while (resultSet9.next()) {                                    Integer k_Lot_Id = resultSet9.getInt("Lot_Id");                                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(k_Lot_Id.toString(), // x_wip_entity_id                                    null, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } else {                                        // null;                                    }                                }                            } catch (SQLException e) {                                logger.error(e, e);                                t_Status_Code = 9;                                t_Error_Code = (int) 220;                                t_Error_Message = "Error at stmt no:" + t_Stmt_Num;                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --Added by K.L.Venkatraman, 27 July 2009 Till Here                        }                        // -- Hari Krishnan, Nov 06, Since t_startup flag will be ultimately removed from code and                        // -- made configurable, have included Or clause to do bonus transactions using                        // -- BONUS action code (this was not possible under the current setup                        // -- and this seemed to be least intrusive to do it                        if (t_Startup == true && t_Lot_Rec.Action_Code.equals("MOVE") && t_Job_Name == null || t_Lot_Rec.Action_Code.equals("BONUS") && t_Job_Name == null) {                            procedureParams_OutputMap = t_Initial_Start_Up(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec, t_Lot_Rec.Action_Code, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // -- Hari Krishnan, Nov 06, this prevents a BONUS action code from proceeding.                            // -- hence including BONUS in the not in clause                        } else if (t_Startup == true && !("MOVE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code)) && t_Job_Name == null) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 1000;                            t_Error_Message = "Cannot Proceed - Inital Bonus only on move action";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            t_Check_Interface = false;                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    t_Stmt_Num = 230;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_JOB_NAME at stmt no: " + t_Stmt_Num + ":, ORG :" + t_Organization_Id + ", JOB : " + t_Lot_Rec.Lot_Id);                    // --Added by MohanVamsi 13th May09 to check Interfaces for START Action Code                    if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Check_Interface == true) {                        t_Wip_Entity_Id = x_Wip_Entity_Id;                        x_Wip_Entity_Id = null;                        // --Added by K.L.Venkatraman,24 July 2009                        t_Stmt_Num = (int) 230.01;                        /* select lot_id                                                         into x_tcla_lot_id                                                         from t_child_lots_api                                                         where transaction_id = t_lot_rec.transaction_id                                                         and rownum =1;*/                        // --why is this required                        // --1st Jun2010 MohanVamsi commented the below if Clause, since X_TCLA_LOT_ID is no where selected                        // --hence it will be always null                        // -- IF X_TCLA_LOT_ID IS NOT NULL                        // -- THEN                        Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet10 = preparedStatement.executeQuery();                        while (resultSet10.next()) {                            Integer k_Lot_Id = resultSet10.getInt("Lot_Id");                            procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(k_Lot_Id.toString(), // x_wip_entity_id                            null, // t_organization_id                            null, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no: " + t_Stmt_Num + " :" + t_Status_Code);                            if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // --Added By K.L.Venkatraman, 24 July 2009 Till Here                        // -- ELSE-------                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, x_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, t_Wip_Entity_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        t_Stmt_Num = (int) 230.02;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no: " + t_Stmt_Num + " :" + t_Status_Code);                        if (!(t_Status_Code == Success_Code || t_Status_Code == Api_Success_Code)) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- END IF;----                    }                    // --Added by MohanVamsi 13th May09 Till here                    t_Stmt_Num = (int) 230.03;                    if (!("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Check_Interface == true && t_Job_Name != null) {                        // Deepak 24 Oct,02                        t_Wip_Entity_Id = x_Wip_Entity_Id;                        // for current only, later correct/make changes to the chk interface program and then enable                        x_Wip_Entity_Id = null;                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Job_Name, x_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, t_Wip_Entity_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        t_Stmt_Num = 240;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no:" + t_Stmt_Num + ":" + t_Status_Code);                        if (t_Status_Code != Api_Success_Code) {                            // -- update those parents where this lot is a child                            // -- chk later                            // --Suds SiRF May26, 2009, for debugging date format issue. Check Later                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2The NLS Date format after C_LOT_REC: " + t_Nls_Date_Format);                            t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";                            // Execute Immediate t ;                            preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                            }                            // --Suds SiRF May26, 2009                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                // interface check based on auto recovery-false                t_Stmt_Num = 249;                // ---MohanVamsi - 8/Nov/2011 Serial Check Starts                // --call tlsutils, version 1, only specific action codes are supported                // --Ex a MOVE resulting in a SCRAP is not supported                // --Added by MohanVamsi 6-Dec-2011, when running for Multiple Bom-Levels                // --Wip entity id is being carried from Previous record :(                if (x_Track_In_Oracle == 1 && t_Job_Name == null && t_Lot_Position == null) {                    t_Wip_Entity_Id = null;                }                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before Calling Tlsutils.T_Validate_SN_Api //>> X Inv Item Id:" + x_Inventory_Item_Id + ",   T_Inv_Item_id: " + t_Inventory_Item_Id + ",   Wip Id:" + t_Wip_Entity_Id);                /*                                             If T_Wip_Entity_Id Is Not Null Then                                             Tlthread.T_Item_Serial_Enabled := N;                                             Select Decode(t_Lot_Rec.Action_Code, CHANGE ITEM,X_Inventory_Item_Id, T_Inventory_Item_Id) ,                                             Decode(t_Lot_Rec.Action_Code, CHANGE ITEM,T_Inventory_Item_Id, X_Inventory_Item_Id)                                             Into T_Inv_Item ,                                             T_Chg_Item                                             From Dual ;                                             \*  Tlsutils.T_Validate_SN_Api (                                             t_Lot_Rec.Transaction_Id ,                                             T_Organization_Id        ,                                             t_Lot_Rec.Action_Code    ,                                             t_Lot_Rec.Lot_id         ,                                             T_Inv_Item               ,                                             T_Wip_Entity_Id          ,                                             T_Chg_Item               , --New Item for CHANGE ITEM Action Code                                             T_Status_Code            ,                                             T_Error_Code             ,                                             T_Error_Message                                             );*\                                             If T_Status_Code = Failure_Code Then                                             tLotUtilsObject.T_Update_Txn_Status( t_Lot_Rec.Transaction_Id,                                             Null,                                             T_Status_Code  ,                                             T_Error_Code   ,                                             T_Error_Message,                                             SET                                             );                                             Goto End_Transact_Loop;                                             End If;                                             End If;*/                // ---MohanVamsi - 8/Nov/2011 Serial Check Ends                t_Stmt_Num = (int) 250.1;                // ----------------interface check ends- rigid check                procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Status_Type: " + t_Status_Type);                // --,MERGE      --Harikrishna June 03 2003 for validating in case of merge as well for non-production lots                if (("CONSUME".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOMOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "LOTLINK".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "COMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSTART".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNCONSUME".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNCOMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEROUTING".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNLINK".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUSQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Passed Modifications ( 1)");                    // --For SiRF ,Hari D 19 Sep 2008                    // --There are few cases for WIP transactions being sucessfull even if the wrong item is passed                    // --Included this IF block to validate if item in edapter.T_LOT_ITEMS_API                    // --MTL_SYSTEM_ITEMS and segment1 is hard coded as i need this fix very quickly                    // --Derive the the harded coded values from t_factories.                    logger.debug("T_Transact_Lots: T_STATUS_TYPE :" + t_Status_Type);                    if (t_Status_Type == 3 && !("CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        try {                            // --Suds SiRF May14, 09. The below query changed to use wip_entities instead of wip_discrete_jobs to avoid multiple fetch                            // --Also included MIF instead of MSI. Also used t_factories for organization instead of tpla                            /*                                                                 SELECT 1                                                                 INTO T_DUMMY                                                                 FROM EDAPTER.T_PARENT_LOTS_API TPLA,                                                                 EDAPTER.T_LOT_ITEMS_API   TLIA,                                                                 APPS.WIP_DISCRETE_JOBS    WDJ,                                                                 MTL_PARAMETERS            MP,                                                                 APPS.MTL_SYSTEM_ITEMS     MSI                                                                 WHERE TPLA.TRANSACTION_ID = TLIA.TRANSACTION_ID AND                                                                 TPLA.LOT_ID = T_LOT_REC.LOT_ID AND                                                                 TPLA.TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID AND                                                                 WDJ.LOT_NUMBER = TPLA.LOT_ID AND                                                                 MP.ORGANIZATION_CODE = TPLA.NEW_FACTORY_NAME AND                                                                 MSI.ORGANIZATION_ID = MP.ORGANIZATION_ID AND                                                                 MSI.INVENTORY_ITEM_ID = WDJ.PRIMARY_ITEM_ID AND                                                                 MSI.SEGMENT1 = TLIA.NEW_ITEM;                                                                 */                            Sql = "SELECT  1 " + " From t_Parent_Lots_Api   Tpla, " + " t_Lot_Items_Api     Tlia, " + " Wip_Entities        We, " + " Mtl_Parameters      Mp, " + " t_Factories         Tf, " + " Mtl_Item_Flexfields Mif " + " Where Tpla.Transaction_Id = Tlia.Transaction_Id " + " And Tpla.Lot_Id = ? " + " And Tpla.Transaction_Id = ? " + " And We.Wip_Entity_Name = Tpla.Lot_Id " + " And We.Organization_Id = Mp.Organization_Id " + " And Tpla.New_Factory_Name = Tf.Factory_Name " + " And Tf.Organization_Code = Mp.Organization_Code " + " And We.Primary_Item_Id = Mif.Inventory_Item_Id " + " And We.Organization_Id = Mif.Organization_Id " + " And Tlia.New_Item = Mif.Item_Number  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            // --Suds SiRF May14, 09.                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 9192008;                            t_Error_Message = "Specified item for the lot is invalid.  " + "Action: Populate correct Item_Number in new_item column T_Lot_Items_Api table or" + "Operation Desc in T_Parent_Lots_Api to fetch Item_Number by Lot eDapter";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // --Added 30Apr09 by MohanVamsi for Bonus Qty to Reuse Change Qty                    // --To be able to reuse the existing code, the action_code Bonus Qty is being                    // --converted into Change Qty                    // --Use Bonus Qty action code when you get the incremental qty in TPLA.                    if (("BONUSQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Stmt_Num = (int) 250.01;                        try {                            logger.debug("T_Transact_Lots: X_WIP_ENTITY_ID:" + x_Wip_Entity_Id);                            logger.debug("T_Transact_Lots: T_WIP_ENTITY_ID:" + t_Wip_Entity_Id);                            // --Getting the Current Quantity from Wip_Operations. This is the Net Quantity                            // --of the job before carrying out Bonus Quantity.                            Sql = "SELECT  Nvl ( Quantity_Waiting_To_Move, 0) + " + " Nvl ( Quantity_Running, 0) + Nvl ( Quantity_In_Queue, 0) " + " From Wip_Operations Wo " + // X_WIP_ENTITY_ID                            " Where Wip_Entity_Id = ?  " + " And   (  Quantity_Waiting_To_Move > ? Or Quantity_Running > ? Or " + " Quantity_In_Queue > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Net_Quantity = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 1000.01;                            t_Error_Message = "Job does not exists in WIP, Please check if Job is Completed or Closed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Lot_Rec.Action_Code = "CHANGE QTY";                        t_Lot_Rec.New_Txn_Qty = t_Lot_Rec.New_Txn_Qty + t_Net_Quantity;                        // --Adding incremental quantity to the original quantity. Updating TCLA with                        // --OracleQty + incremental quantity i.e. populated in TPLA Qty to load into Resulting Jobs                        Sql = "UPDATE t_Child_Lots_Api Tcla " + " Set Txn_Qty = t_Lot_Rec.New_Txn_Qty " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.executeUpdate();                        connection.commit();                    }                    // --From here BONUS QTY action is Changed to CHNAGE QTY and Proceeds with QTY as                    // --TPLA_QTY + Current Lot QTY                    // --Added by MohanVamsi For Bonus Qty Till Here                    // --Modified by Harikrishna on Jul-27-2003 for unclosing jobs                    if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15) && ("RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Status_Code = Success_Code;                        t_Error_Code = null;                        t_Error_Message = null;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Wip Entity ID of Closed Job: " + x_Wip_Entity_Id);                    if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15) && ("TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        if (x_Wip_Entity_Id != null) {                            Sql = "SELECT  Sum ( Start_Quantity - Quantity_Scrapped) " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, x_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Cur_Qty = resultSet.getInt(1);                            }                        } else {                            t_Wip_Cur_Qty = 0;                        }                        if (t_Wip_Cur_Qty == 0) {                            t_Status_Code = Success_Code;                            t_Error_Code = null;                            t_Error_Message = null;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    if ((t_Status_Type == 12 || t_Status_Type == 15) && t_Auto_Recover == false) {                        if (("UNDOS".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                            if (((x_Wip_Entity_Id != null ? x_Wip_Entity_Id : 0) == 0)) {                                try {                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = C " + " And Tl.Status = C " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )  " + " And  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, 12);                                    preparedStatement.setObject(4, 2);                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(6, t_Factory_Id);                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(8, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        x_Wip_Entity_Id = resultSet.getInt(1);                                    }                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 1078.2;                                    t_Error_Message = " Cannot find lot to be Unclosed in Oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Attempting Job Unclose");                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(x_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job Unclose attmepted");                            if (t_Status_Code == Success_Code) {                                logger.debug("T_Transact_Lots: Success in Unclosing the Job");                                t_Status_Type = 4;                                t_Wip_Entity_Id = x_Wip_Entity_Id;                            } else {                                t_Status_Code = Failure_Code;                                t_Error_Code = (int) 1078.1;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        } else {                            t_Status_Code = Failure_Code;                            t_Error_Code = 1078;                            t_Error_Message = "Oracle Job is Closed ( 12) or Failed Close ( 15)in wip_discrete_jobs, Cannot transact further on this Lot. Unclose job in Oracle";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // vyshnavi last                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Passed Modifications ( 2)");                    t_Stmt_Num = 260;                    if (!("RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Status_Type == 6) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_ID: " + t_Wip_Entity_Id);                        // -- release the job                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.setObject(3, t_Organization_Id);                        preparedStatement.executeUpdate();                        // --update t_lots also                        Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 24 Oct,02                        " And Status In   (  H, A )    ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Unique_Id = resultSet.getInt(1);                        }                        Sql = "UPDATE t_Lots Set Status = A Where Unique_Id = ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Unique_Id);                        preparedStatement.executeUpdate();                        Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = A " + " Where Lot_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Unique_Id);                        preparedStatement.executeUpdate();                    }                    /*  --normal completion with operation null.                                                     if (t_lot_rec.action_code = MOVE and t_lot_rec.new_operation is null)                                                     then                                                     t_stmt_num:=812;                                                     begin                                                     select wip_entity_id                                                     into   t_wip_entity_id                                                     from   t_oracle_jobs                                                     where  lot_id = (select max(unique_id)                                                     from   t_lots where lot_id = t_lot_rec.lot_id                                                     and    factory_id = t_factory_id);                                                     t_stmt_num:=820;                                                     select primary_item_id                                                     into   o_inventory_item_id                                                     from   wip_discrete_jobs                                                     where  wip_entity_id = t_wip_entity_id;                                                     t_stmt_num:=825;                                                     t_sql_string:=select bos.||t_routing_field;                                                     if t_operation_field is not null                                                     then                                                     t_sql_string:=t_sql_string||, bos.||t_operation_field;                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     t_sql_string:=t_sql_string||,bos.||t_step_seq_field;                                                     end if;                                                     t_sql_string:=t_sql_string|| from bom_operation_sequences bos,wip_discrete_jobs wdj ||                                                      where  wdj.wip_entity_id = :x_wip_entity_id ||                                                      and    bos.routing_sequence_id    = wdj.common_routing_sequence_id ||                                                      and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1)) ||                                                      and    bos.operation_sequence_id not in(select from_op_seq_id ||                                                      from bom_operation_networks ||                                                      where from_op_seq_id = bos.operation_sequence_id) ;                                                     begin                                                     t_cursor:=dbms_sql.open_cursor;                                                     dbms_sql.parse(t_cursor, t_sql_string, dbms_sql.native);                                                     dbms_sql.define_column(t_cursor,1,t_new_routing,255);                                                     if t_operation_field is not null                                                     then                                                     dbms_sql.define_column(t_cursor,2,t_to_operation_code,255);                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     dbms_sql.define_column(t_cursor,3,t_operation_seq,50);                                                     end if;                                                     dbms_sql.bind_variable(t_cursor,x_wip_entity_id,t_wip_entity_id);                                                     x_status_code:=dbms_sql.execute_and_fetch(t_cursor);                                                     if x_status_code=1                                                     then                                                     dbms_sql.column_value(t_cursor,1,t_new_routing);                                                     if t_operation_field is not null                                                     then                                                     dbms_sql.column_value(t_cursor,2,t_to_operation_code);                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     dbms_sql.column_value(t_cursor,3,t_operation_seq);                                                     end if;                                                     elsif x_status_code>1                                                     then                                                     t_status_code := failure_code;                                                     t_error_code  := 1078;                                                     t_error_message := Multiple last operations ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     else                                                     t_status_code := failure_code;                                                     t_error_code  := 1078;                                                     t_error_message := No last operation found ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     dbms_sql.close_cursor(t_cursor);                                                     exception                                                     when others then                                                     if dbms_sql.is_open(t_cursor)                                                     then                                                     dbms_sql.close_cursor(t_cursor);                                                     end if;                                                     t_status_code := failure_code;                                                     t_error_code  := sqlcode;                                                     t_error_message := Error - ||sqlerrm|| -in selecting last operation ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     t_stmt_num:=839;                                                     begin                                                     select state_name                                                     into   t_new_state                                                     from   t_state_step_mappings                                                     where  intraoperation_step  =3                                                     and    factory_id   =t_factory_id                                                     and    rownum<2;                                                     exception                                                     when no_data_found                                                     then                                                     t_status_code := failure_code;                                                     t_error_code:=834;                                                     t_error_message:=state name for intraoperation step 3 not defined;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     tLotUtilsObject.t_update_lot_bom_level (t_lot_rec.transaction_id,                                                     t_lot_rec.new_factory_name,                                                     t_new_routing,                                                     t_to_operation_code,                                                     t_operation_seq,                                                     o_bom_level,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message);                                                     dbms_output.put_line(bom level change-o_bom_level-||o_bom_level);                                                     dbms_output.put_line(bom level change-t_status_code-||t_status_code);                                                     if t_status_code=success_code                                                     then                                                     update  t_parent_lots_api                                                     set new_routing=t_new_routing,new_operation=t_to_operation_code,                                                     operation_sequence=t_operation_seq, new_state_id=t_new_state                                                     where transaction_id=t_lot_rec.transaction_id;                                                     else                                                     tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     tltadapt.t_validate_lot_api                                                     (                                                     t_lot_rec.transaction_id,                                                     null,                                                     t_factory_id,                                                     t_lot_rec.new_txn_qty,                                                     t_wip_entity_id,                                                     t_operation_seq_num,                                                     t_intra_op_step,                                                     o_inventory_item_id,                                                     t_lot_position,                                                     t_lot_number,                                                     t_job_name,                                                     t_lot_status,                                                     t_oracle_uom,                                                     i_user_id,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message                                                     );                                                     if t_status_code !=success_code                                                     then                                                     tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     tltadapt.t_move_lot_api                                                     (                                                     t_lot_rec.transaction_id,                                                     null,                                                     t_factory_id,                                                     t_lot_rec.new_txn_qty,                                                     t_wip_entity_id,                                                     o_inventory_item_id,                                                     t_job_name,                                                     i_user_id,                                                     t_lot_rec.transaction_date,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message                                                     );                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     GET                                                     );                                                     if t_status_code in (success_code,reprocess_code)                                                     then                                                     if t_status_code=success_code                                                     then                                                     tLotUtilsObject.t_update_oracle_job(   t_lot_rec.transaction_id,                                                     t_factory_id,                                                     t_lot_rec.lot_id,                                                     t_error_code,                                                     t_error_message);                                                     end if;                                                     goto end_transact_loop;                                                     else                                                     t_status_code := failure_code;                                                     t_error_message :=Error returned while completing-||t_error_message;                                                     end if;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     exception                                                     when no_data_found                                                     then                                                     t_status_code := failure_code;                                                     t_error_message :=no data found at||t_stmt_num;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     end if;                                                     */                    // --*****JUMP BOM LEVEL STARTS******************************                    /*26/12/2001                                                     case1:trackout from last operation of old sector                                                     case2:trackout from last operation of old sector with scrap                                                     case3:Jump to first operation of new sector.Jump is mapped realtime.Qty might be in Die or Slice.                                                     case4:Jump to second or subsequent operation of new sector.Jump is mapped realtime.Qty might be in Die or Slice.                                                     case5:Jump to first operation of new sector and trackout.Jump is mapped to trackout.                                                     case6:Jump to second or subsequent operation of new sector and trackout.Jump is mapped to trackout.                                                     case7:Jump to new sector which is not immediate one.(AS-->FG)                                                     case8:jump back to previous sector                                                     case9:move/jump into next sector after jump backwards                                                     Jan 07: Hari Krishnan, Added case when MES has modular routings and a move from one sector to other does not come as a Start                                                     Also, though the routings are modular, the incoming device is the same for many levels                                                     */                    t_Stmt_Num = 270;                    // -- AND UPPER(T_LOT_REC.ACTION_CODE) = MOVE                    /*Commented the above Action Code Condition by MohanVamsi on 1st Dec08 for allowing                                                     any action as 1st txn in edapter to have entries in T_Lots and T_Oracle_Jobs                                                     for SI and can be Done anywhere if commented */                    if (x_Track_In_Oracle == 1) {                        // -- Hari K Feb 07, brought it up as this can be done irrespective of lot is in tlots or not                        // -- part of Lot Reverse Insert fix                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // new inventory item corr to tlia                        t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Get Lot Item, Err Msg: " + t_Error_Message);                        if (t_Status_Code != Success_Code) {                            t_Error_Code = 1321;                            t_Error_Message = "Error: T_Transact_Lots- in fetching lot item-" + // Substr ( t_Error_Message,  1,  260);                            t_Error_Message.substring(1 - 1, 260 + (1 - 1));                            procedureParams_OutputMap = Log_Message(t_Error_Message);                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        try {                            Sql = "SELECT  Bom_Level " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C, H )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Bom_Level = resultSet.getString(1);                            }                            // --Added H to check the HOLD Lots, or else selecting previous sector Completed Lots.                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Bom_Level: " + t_Bom_Level);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec.New_Bom_Level: " + t_Lot_Rec.New_Bom_Level);                            if (((t_Lot_Rec.New_Bom_Level != null ? t_Lot_Rec.New_Bom_Level : t_Bom_Level) != t_Bom_Level)) {                                // --jump across bom level                                t_Stmt_Num = 280;                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change");                                Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C )  )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Wip_Entity_Id = resultSet.getInt(1);                                }                                Sql = "SELECT  Primary_Item_Id, Status_Type " + // Hari K, Jan 07 brought forward from below for performance                                " t_Status_Type  " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    o_Inventory_Item_Id = resultSet.getInt(1);                                }                                t_Stmt_Num = 290;                                /* Hari Krishnan Feb 07 .taken up a few lines                                                                 tltadapt.t_get_lot_item(t_lot_rec.transaction_id,                                                                 t_factory_id,                                                                 t_organization_id,                                                                 t_inventory_item_id,  --new inventory item corr to tlia                                                                 t_lot_rec,                                                                 t_status_code,                                                                 t_error_code,                                                                 t_error_message                                                                 );                                                                 if t_status_code !=success_code                                                                 then                                                                 t_error_code :=1321;                                                                 t_error_message :=Error- t_transact_lots- in fetching lot item;                                                                 tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                                 null,                                                                 t_status_code,                                                                 t_error_code,                                                                 t_error_message,                                                                 SET                                                                 );                                                                 goto end_transact_loop;                                                                 end if;                                                                 -- Hari Krishnan commenting ends                                                                 */                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change, O_Inventory_Item_ID:" + // old item                                o_Inventory_Item_Id);                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change, T_Inventory_Item_ID:" + // new item                                t_Inventory_Item_Id);                                if (o_Inventory_Item_Id != t_Inventory_Item_Id) {                                    t_Stmt_Num = 300;                                    try {                                        Sql = "SELECT  Item_Sequence " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        preparedStatement.setObject(3, t_Inventory_Item_Id);                                        preparedStatement.setObject(4, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Level = resultSet.getInt(1);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1233;                                        t_Error_Message = "Bom level not defined for inventory_item_id: " + t_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1366;                                        t_Error_Message = "Multiple rows defined for max session id for inventory_item_id: " + t_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    try {                                        Sql = "SELECT  Item_Sequence " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, o_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        preparedStatement.setObject(3, o_Inventory_Item_Id);                                        preparedStatement.setObject(4, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Current_Level = resultSet.getInt(1);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1265;                                        t_Error_Message = "BOM level not defined for inventory_item_id. Create Primary routing through routing edapter for Inventory item id:" + o_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1404;                                        t_Error_Message = "Multiple rows defined for max session id for inventory_item_id:" + o_Inventory_Item_Id + "- Check t_item_crossreferences_api";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    // -- Hari K Jan 07. Move across BOM level fix when Routings in MES are modular, but no Start event comes for next bom level                                    t_Stmt_Num = 305;                                    if (t_Level == t_Current_Level) {                                        // --Perform the following checks                                        // --1.is the move to a next level or to a lower one                                        // --2.If it is not immediate, leave the t_level and t_current_level variables as is so that it will error out                                        // --3.This feature is only for immediate moves. Not skipping levels. Once data flow becomes clear, we can handle that.                                        // --4.The xref table will have item_sequence as 1 always as routings are modular                                        try {                                            // -- move is to immediate next higher level,say from AS to TS                                            Sql = "SELECT  x " + " From T_Component_v Bic, Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = ? " + " And Bom.Organization_Id = ? " + " And Bic.Component_Item_Id = ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, Primary )  = " + " Nvl  (  t_Alternate_Designator, Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + "  (  ? + ? )  )   ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Inventory_Item_Id);                                            preparedStatement.setObject(2, t_Organization_Id);                                            preparedStatement.setObject(3, o_Inventory_Item_Id);                                            preparedStatement.setObject(4, 1);                                            preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                            preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                            preparedStatement.setObject(7, 1);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Dummy = resultSet.getString(1);                                            }                                            // not designed to handle case when next level involves a skip                                            t_Current_Level = t_Current_Level + 1;                                            // -- should not arise in this kind of setup                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            // -- move is to immediate next lower level,say from TS back to AS                                            try {                                                Sql = "SELECT  x " + " From T_Component_v         Bic, " + " Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = ? " + " And Bom.Organization_Id = ? " + " And Bic.Component_Item_Id = " + " ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, " + " Primary )  = " + " Nvl  (  t_Alternate_Designator, Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + "  (  ? + ? )  )   ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, o_Inventory_Item_Id);                                                preparedStatement.setObject(2, t_Organization_Id);                                                preparedStatement.setObject(3, t_Inventory_Item_Id);                                                preparedStatement.setObject(4, 1);                                                preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                                preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                                preparedStatement.setObject(7, 1);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Dummy = resultSet.getString(1);                                                }                                                t_Level = t_Level + 1;                                            } catch (No_Data_Found e1) {                                                logger.error(e1);                                            }                                            // it needs to error                                        }                                        Log_Msg = "Jump Bom level with same level info. Modified values of t_level and t_current_level are: " + t_Level + "," + t_Current_Level;                                        procedureParams_OutputMap = Log_Message(Log_Msg);                                        logger.debug(Log_Msg);                                    }                                    // --Hari K Jan 07. Move across BOM level fix when Routings in MES are modular, but no Start event comes for next bom level                                    t_Stmt_Num = 310;                                    if (t_Level < t_Current_Level) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: TPLA bom level ( " + t_Lot_Rec.New_Bom_Level + ") is higher than existing");                                        try {                                            Sql = // check if lot already exists in sector.if yes,just jump                                            "SELECT  Unique_Id  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Bom_Level = ? " + " And Status = A  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Unique_Id = resultSet.getInt(1);                                            }                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Unique_id: " + t_Unique_Id);                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            // --complete the lot and start in next sector                                            t_Level = t_Current_Level - 1;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: New Level Sequence: " + t_Level);                                            while (1 == 1) {                                                try {                                                    // -- Hari Krishnan Jan 07, removed unecessary code duplication                                                    // --if t_system_item_flag=2                                                    // --then                                                    Sql = "SELECT  Case t_System_Item_Flag " + " When 2 Then " + " New_Enterprise_Item " + " When 1 Then " + " New_Item End " + " From t_Lot_Items_Api " + " Where Transaction_Id = " + " ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Lot_Item1 = resultSet.getString(1);                                                    }                                                    t_Stmt_Num = 320;                                                    try {                                                        // --Hari K Jan 07                                                        // -- Hari K  Jan 07. First chck for the exact item in the txn.                                                        Sql = "SELECT  Bom_Level, Inventory_Item_Id " + " From t_Item_Crossreferences_Api " + " Where Item_Sequence = ? " + " And Factory_Id = ? " + " And Inventory_Item_Id = " + " ? " + " And Alternate_Designator = Primary " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = " + " ? " + " And Item_Sequence = ? " + " And Alternate_Designator = " + " Primary " + " And Factory_Id = ? )   ";                                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                        preparedStatement.setObject(1, t_Level);                                                        preparedStatement.setObject(2, t_Factory_Id);                                                        preparedStatement.setObject(3, t_Inventory_Item_Id);                                                        preparedStatement.setObject(4, t_Inventory_Item_Id);                                                        preparedStatement.setObject(5, t_Level);                                                        preparedStatement.setObject(6, t_Factory_Id);                                                        resultSet = preparedStatement.executeQuery();                                                        resultSet.last();                                                        totalRows = resultSet.getRow();                                                        resultSet.beforeFirst();                                                        if (totalRows > 1) {                                                            throw new SQLException("Too Many Rows");                                                        }                                                        if (resultSet.next() == false) {                                                            throw new No_Data_Found("No Data Found");                                                        } else {                                                            o_Bom_Level = resultSet.getString(1);                                                            t_Inventory_Item_Id = resultSet.getInt(2);                                                        }                                                        // --Hari K Jan 07                                                    } catch (No_Data_Found e1) {                                                        logger.error(e1);                                                        t_Stmt_Num = 330;                                                        try {                                                            // -- old original code,                                                            Sql = "SELECT  Bom_Level, Inventory_Item_Id " + " From t_Item_Crossreferences_Api " + " Where Item_Sequence = ? " + " And Factory_Id = ? " + " And Item = ? " + " And Alternate_Designator = Primary " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Item = ? " + " And Item_Sequence = ? " + " And Alternate_Designator = " + " Primary " + " And Factory_Id = ? )   ";                                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                            preparedStatement.setObject(1, t_Level);                                                            preparedStatement.setObject(2, t_Factory_Id);                                                            preparedStatement.setObject(3, t_Lot_Item1);                                                            preparedStatement.setObject(4, t_Lot_Item1);                                                            preparedStatement.setObject(5, t_Level);                                                            preparedStatement.setObject(6, t_Factory_Id);                                                            resultSet = preparedStatement.executeQuery();                                                            resultSet.last();                                                            totalRows = resultSet.getRow();                                                            resultSet.beforeFirst();                                                            if (totalRows > 1) {                                                                throw new SQLException("Too Many Rows");                                                            }                                                            if (resultSet.next() == false) {                                                                throw new No_Data_Found("No Data Found");                                                            } else {                                                                o_Bom_Level = resultSet.getString(1);                                                                t_Inventory_Item_Id = resultSet.getInt(2);                                                            }                                                        } catch (SQLException e2) {                                                            logger.error(e2, e2);                                                            t_Status_Code = Failure_Code;                                                            t_Error_Code = 1456;                                                            t_Error_Message = "Error while fetching new bom level from t_item_crossreferences_api. Msg: " + e2.getSQLState();                                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                            }                                                            // Goto End_Transact_Loop;                                                            break end_Transact_Loop;                                                        }                                                    }                                                    // Hari K Jan 07                                                    // --else --sys item flag                                                    /* select  new_item                                                                                     into  t_lot_item1                                                                                     from  t_lot_items_api                                                                                     where transaction_id=t_lot_rec.transaction_id;                                                                                     t_stmt_num :=330;                                                                                     begin                                                                                     select  bom_level,inventory_item_id                                                                                     into  o_bom_level,t_inventory_item_id                                                                                     from  t_item_crossreferences_api                                                                                     where item_sequence=t_level                                                                                     and factory_id=t_factory_id                                                                                     and oracle_item=t_lot_item1                                                                                     and alternate_designator=Primary                                                                                     and     session_id= (select max(session_id)                                                                                     from t_item_crossreferences_api                                                                                     where oracle_item=t_lot_item1                                                                                     and  item_sequence=t_level                                                                                     and  alternate_designator=Primary                                                                                     and  factory_id=t_factory_id);                                                                                     exception                                                                                     when others then                                                                                     t_status_code    :=failure_code;                                                                                     t_error_code   :=1490;                                                                                     t_error_message    :=Error while fetching new bom level from t_item_crossreferences_api-||sqlerrm;                                                                                     tLotUtilsObject.T_Update_Txn_Status ( t_lot_rec.transaction_id,                                                                                     null,                                                                                     t_status_code,                                                                                     t_error_code,                                                                                     t_error_message,                                                                                     SET                                                                                     );                                                                                     goto end_transact_loop;                                                                                     end;                                                                                     end if; --sys item flag                                                                                     */                                                    // -- Hari Krishnan Jan 07, the decode will handle these two segments                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1327;                                                    t_Error_Message = "T_Transact_Lots: Next Bom Level not defined";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                // for entire sys item check                                                try {                                                    Sql = "SELECT  z " + // included for dummy bom levels  ( viral)                                                    " From Bom_Operational_Routings  " + " Where Organization_Id = ? " + " And Assembly_Item_Id = ? " + // check for primary only                                                    " And Alternate_Routing_Designator == null   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Dummy = resultSet.getString(1);                                                    }                                                    break;                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Level = t_Level - 1;                                                    t_Skip_Bom_Level = true;                                                }                                            }                                            // While{for Skip bom level                                            t_Stmt_Num = 340;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: New Bom Level: " + o_Bom_Level);                                            Sql = "UPDATE t_Lot_Items_Api " + " Set New_Bom_Level = ? " + " Where Transaction_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, o_Bom_Level);                                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                            preparedStatement.executeUpdate();                                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                                            /*                                                                             update t_parent_lots_api                                                                             set    new_bom_level=o_bom_level                                                                             where  transaction_id=t_lot_rec.transaction_id;                                                                             */                                            /* took it up,Hari K Jan 07 as a select on wdj was already there                                                                             select  status_type   --4 complete                                                                             into  t_status_type --chk later, stat type from get lot status already there                                                                             from  wip_discrete_jobs                                                                             where   wip_entity_id = t_wip_entity_id;                                                                             */                                            t_Stmt_Num = 350;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Status_Type:" + t_Status_Type);                                            if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15)) {                                                // --start                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Start the Lot in next sector");                                                t_Component_Lot = t_Lot_Rec.Lot_Id;                                                try {                                                    Sql = "SELECT  Inventory_Item_Id, Transaction_Quantity " + " From Mtl_Onhand_Quantities " + " Where Organization_Id = ? " + " And Lot_Number = ? " + // Deepak 11 Dec,02                                                    " And Inventory_Item_Id = ?   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Component_Lot);                                                    preparedStatement.setObject(3, o_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Component_Item_Id = resultSet.getInt(1);                                                        t_Component_Qty = resultSet.getInt(2);                                                    }                                                    Sql = "SELECT  Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Component_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Component_Item = resultSet.getString(1);                                                    }                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 994;                                                    t_Error_Message = "No onhand exists for -" + t_Component_Lot;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (Too_Many_Rows e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1005;                                                    t_Error_Message = "Multiple lots exists in Inventory: " + t_Component_Lot;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 360;                                                Sql = "SELECT  Primary_Uom_Code " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                preparedStatement.setObject(2, t_Component_Item_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Uom_Code = resultSet.getString(1);                                                }                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level Change, T_Uom_Code: " + t_Uom_Code);                                                Sql = "SELECT  t_Child_Lots_Api_s.Nextval " + " From Dual ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Line_Number_s = resultSet.getInt(1);                                                }                                                // --        delete  from t_child_lots_api                                                // --        where transaction_id=t_lot_rec.transaction_id;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Item , " + " Txn_Qty , " + " Uom_Code , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, t_Component_Lot);                                                preparedStatement.setObject(5, t_Component_Item);                                                preparedStatement.setObject(6, t_Component_Qty);                                                preparedStatement.setObject(7, t_Uom_Code);                                                preparedStatement.setObject(8, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Stmt_Num = 370;                                                t_Check_Bom = false;                                                procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, "START", i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, null);                                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                                }                                                // --            tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                // --                    null,                                                // --                    t_status_code,                                                // --                    t_error_code,                                                // --                    t_error_message,                                                // --                    GET                                                // --                 );                                                if (t_Status_Code == Success_Code) {                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    Sql = // check later...may return multiple rows                                                    "UPDATE t_Lots  " + " Set Status = N " + " Where Unique_Id = " + "  ( Select Max ( Unique_Id) " + " From t_Lots " + " Where Factory_Id = ? " + " And Lot_Id = ? " + // Deepak 04 Dec,02                                                    " And Bom_Level = ?  " + // Deepak 26 Dec,02;                                                    " And Status != T )";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Factory_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, t_Bom_Level);                                                    preparedStatement.executeUpdate();                                                    // --      factory_id=t_factory_id                                                    // --      and lot_id=t_lot_rec.lot_id                                                    // --      and bom_level=t_bom_level;  --Deepak 04/12/02                                                    // --  and bom_level!=o_bom_level;                                                    Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = N " + " Where Lot_Id In " + // unique_id                                                    "  ( Select Max ( Unique_Id)  " + " From t_Lots " + " Where Factory_Id = ? " + " And Lot_Id = ? " + // Deepak 04 Dec,02                                                    " And Bom_Level = ?  " + // Deepak 26 Dec,02;                                                    " And Status != T )";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Factory_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, t_Bom_Level);                                                    preparedStatement.executeUpdate();                                                    // --    and bom_level!=o_bom_level);                                                    t_Status_Code = Reset_Code;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                }                                                Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.executeUpdate();                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            } else {                                                // --complete the lot.                                                t_Stmt_Num = 380;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Complete the Lot in previous sector");                                                Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Last_Op_Seq_Num = resultSet.getInt(1);                                                }                                                try {                                                    // --lot is completed but status type not updated                                                    Sql = // Deepak 25 Dec,02                                                    "SELECT  x  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                                    preparedStatement.setObject(2, t_Last_Op_Seq_Num);                                                    preparedStatement.setObject(3, 0);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Dummy = resultSet.getString(1);                                                    }                                                    t_Status_Code = Reset_Code;                                                    t_Error_Message = "Waiting for lot to be completed";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                }                                                t_Stmt_Num = 390;                                                // --t_new_operation1:=t_lot_rec.new_operation;                                                // --t_oper_seq1 :=t_lot_rec.operation_sequence;                                                // --t_new_routing1:=t_lot_rec.new_routing;                                                // --t_new_department1:=t_lot_rec.new_department;                                                // --t_new_state1:=t_lot_rec.new_state_id;                                                // --t_new_txn_qty1:=t_lot_rec.new_txn_qty;                                                // --t_new_uom_code1:=t_lot_rec.new_uom_code;                                                t_Sql_String = "select bos." + t_Operation_Field;                                                if (t_Routing_Field != null) {                                                    t_Sql_String = t_Sql_String + ", bos." + t_Routing_Field;                                                }                                                if (t_Step_Seq_Field != null) {                                                    t_Sql_String = t_Sql_String + ",bos." + t_Step_Seq_Field;                                                }                                                t_Sql_String = t_Sql_String + " from bom_operation_sequences bos,wip_discrete_jobs wdj " + // Dbms_Sql.Parse  (  t_Cursor ,                                                " where  wdj.wip_entity_id  =   " + t_Wip_Entity_Id + "  " + " and    bos.routing_sequence_id    =  wdj.common_routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + " + 1 )  )   " + " and    bos.operation_sequence_id not in  (  select from_op_seq_id  " + " from bom_operation_networks  " + " where from_op_seq_id  =  bos.operation_sequence_id )   ";                                                try {                                                    // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                                    // Dbms_Sql.Parse  (  t_Cursor ,                                                    // t_Sql_String ,                                                    // Dbms_Sql.Native )  ;                                                    // Dbms_Sql.Define_Column  (  t_Cursor ,                                                    // 1 ,                                                    // t_To_Operation_Code ,                                                    // 255 )  ;                                                    if (t_Routing_Field != null) {                                                        // Dbms_Sql.Define_Column  (  t_Cursor ,                                                        // 2 ,                                                        // t_New_Routing ,                                                        // 255 )  ;                                                    }                                                    if (t_Step_Seq_Field != null) {                                                        // Dbms_Sql.Define_Column  (  t_Cursor ,                                                        // 3 ,                                                        // t_Operation_Seq ,                                                        // 50 )  ;                                                    }                                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                                    // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                                    preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    x_Status_Code = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    resultSet.next();                                                    if (x_Status_Code == 1) {                                                        // Dbms_Sql.Column_Value ( t_Cursor, 1,t_To_Operation_Code);                                                        t_To_Operation_Code = resultSet.getString(1);                                                        if (t_Routing_Field != null) {                                                            // Dbms_Sql.Column_Value ( t_Cursor, 2,t_New_Routing);                                                            t_New_Routing = resultSet.getString(2);                                                        }                                                        if (t_Step_Seq_Field != null) {                                                            // Dbms_Sql.Column_Value ( t_Cursor, 3,t_Operation_Seq);                                                            t_Operation_Seq = resultSet.getString(3);                                                        }                                                    } else if (x_Status_Code > 1) {                                                        // if  (  Dbms_Sql.Is_Opent_Cursor )                                                        {                                                            // Dbms_Sql.Close_Cursor ( t_Cursor);                                                        }                                                        t_Status_Code = Failure_Code;                                                        t_Error_Code = 1078;                                                        t_Error_Message = "Multiple last operations ";                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    } else {                                                        // if  (  Dbms_Sql.Is_Opent_Cursor )                                                        {                                                            // Dbms_Sql.Close_Cursor ( t_Cursor);                                                        }                                                        t_Status_Code = Failure_Code;                                                        t_Error_Code = 1078;                                                        t_Error_Message = "No last operation found ";                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    }                                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                                } catch (SQLException e1) {                                                    logger.error(e1, e1);                                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                                    {                                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                                    }                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1080;                                                    t_Error_Message = "Error: " + e1.getSQLState() + ", in selecting last operation";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 400;                                                try {                                                    Sql = "SELECT  State_Name " + " From t_State_Step_Mappings " + " Where Intraoperation_Step = ? " + " And Factory_Id = ? " + " And  Rownum = 1";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, 3);                                                    preparedStatement.setObject(2, t_Factory_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_New_State = resultSet.getString(1);                                                    }                                                } catch (No_Data_Found e2) {                                                    logger.error(e2);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1152;                                                    t_Error_Message = "state name for intraoperation step 3 not defined";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                preparedStatement.setObject(2, o_Inventory_Item_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Uom = resultSet.getString(1);                                                }                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside Bom Level Change, T_UOM:" + t_Uom);                                                try {                                                    Sql = "SELECT  Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or " + " Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                                    preparedStatement.setObject(2, 0);                                                    preparedStatement.setObject(3, 0);                                                    preparedStatement.setObject(4, 0);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_New_Txn_Qty = resultSet.getInt(1);                                                    }                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1445;                                                    t_Error_Message = "Cannot find operation with +ve Qty in wip_operations for wip_entity_id: " + t_Wip_Entity_Id;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (Too_Many_Rows e2) {                                                    logger.error(e2);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1457;                                                    t_Error_Message = "Qty split between operations or intra-operation steps for wip_entity_id: " + t_Wip_Entity_Id;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                // vyshnavi - last                                                t_Stmt_Num = 410;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Lot_Rec.New_Factory_Name, t_New_Routing, t_To_Operation_Code, t_Operation_Seq, t_Lot_Rec.Transaction_Date, o_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                                                if (procedureParams_OutputMap.get("i_New_Routing") != null) {                                                    t_New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                                                }                                                if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                                                    o_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                                                }                                                if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                }                                                t_Lot_Rec.New_Bom_Level = o_Bom_Level;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, O_Bom_Level: " + o_Bom_Level);                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code:" + t_Status_Code);                                                if (t_Status_Code != Success_Code) {                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                Sql = "SELECT  Case ? " + " When ? Then " + " ? " + " Else ? End " + " From Dual ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Lot_Rec.New_Uom_Code);                                                preparedStatement.setObject(2, t_Uom);                                                preparedStatement.setObject(3, t_Lot_Rec.New_Txn_Qty);                                                preparedStatement.setObject(4, t_New_Txn_Qty);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_New_Txn_Qty = resultSet.getInt(1);                                                }                                                t_Lot_Rec.New_Routing = t_New_Routing;                                                t_Lot_Rec.New_Operation = t_To_Operation_Code;                                                t_Lot_Rec.Operation_Sequence = t_Operation_Seq;                                                t_Lot_Rec.New_State_Id = t_New_State;                                                t_Lot_Rec.New_Department = null;                                                t_Lot_Rec.New_Uom_Code = t_Uom;                                                t_Lot_Rec.New_Txn_Qty = t_New_Txn_Qty;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec.New_Operation: " + t_Lot_Rec.New_Operation);                                                t_Stmt_Num = 420;                                                // t_oracle_uom is used in move_lot_api also.                                                tltAdatpObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, o_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api: " + t_Status_Code);                                                if (t_Status_Code != Success_Code) {                                                    /*                                                                                     update t_parent_lots_api                                                                                     set    new_operation=t_new_operation1,                                                                                     operation_sequence=t_oper_seq1,                                                                                     new_state_id=t_new_state1,                                                                                     new_routing=t_new_routing1,                                                                                     new_department=t_new_department1,                                                                                     new_bom_level=null,                                                                                     new_txn_qty=t_new_txn_qty1,                                                                                     new_uom_code=t_new_uom_code1                                                                                     where  transaction_id=t_lot_rec.transaction_id;                                                                                     */                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 430;                                                procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                                }                                                /*                                                                                 update t_parent_lots_api                                                                                 set    new_operation=t_new_operation1,operation_sequence=t_oper_seq1,                                                                                 new_state_id=t_new_state1,new_routing=t_new_routing1,new_department=t_new_department1,                                                                                 new_bom_level=null,new_txn_qty=t_new_txn_qty1,new_uom_code=t_new_uom_code1                                                                                 where  transaction_id=t_lot_rec.transaction_id;                                                                                 */                                                // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                // --                null,                                                // --                t_status_code,                                                // --                t_error_code,                                                // --                t_error_message,                                                // --                GET                                                // --                    );                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Bom Level change status after T_Move_Lot_Api: " + t_Status_Code);                                                if (t_Status_Code == Success_Code) {                                                    Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Uom = resultSet.getString(1);                                                    }                                                    // --**** Added input parameter - transaction_id Kunal -15/11                                                    t_Stmt_Num = 440;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Alternate_Designator(t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Routing, t_Alternate_Designator, t_Status_Code, t_Error_Code, t_Error_Message, t_Lot_Rec);                                                    if (procedureParams_OutputMap.get("o_Alternate_Designator") != null) {                                                        t_Alternate_Designator = (java.lang.String) procedureParams_OutputMap.get("o_Alternate_Designator");                                                    }                                                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    if (t_Status_Code != Success_Code) {                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    }                                                    t_Stmt_Num = 450;                                                    if (t_Skip_Bom_Level) {                                                        Component_Qty_t = 1;                                                    } else {                                                        try {                                                            Sql = "SELECT  Bic.Component_Quantity " + // --  from  bom_inventory_components bic, --Deepak 22 Mar, 03                                                            " From T_Component_v         Bic, " + " Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = " + " ? " + " And Bom.Organization_Id = " + " ? " + " And Bic.Component_Item_Id = " + " ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, " + " Primary )  = " + " Nvl  (  ?, " + " Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + // Deepak 22 Mar, 03                                                            "  (  ? + ? )  )    ";                                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                            preparedStatement.setObject(1, t_Inventory_Item_Id);                                                            preparedStatement.setObject(2, t_Organization_Id);                                                            preparedStatement.setObject(3, o_Inventory_Item_Id);                                                            preparedStatement.setObject(4, 1);                                                            preparedStatement.setObject(5, t_Alternate_Designator);                                                            preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                                            preparedStatement.setObject(7, t_Lot_Rec.Transaction_Date);                                                            preparedStatement.setObject(8, 1);                                                            resultSet = preparedStatement.executeQuery();                                                            resultSet.last();                                                            totalRows = resultSet.getRow();                                                            resultSet.beforeFirst();                                                            if (totalRows > 1) {                                                                throw new SQLException("Too Many Rows");                                                            }                                                            if (resultSet.next() == false) {                                                                throw new No_Data_Found("No Data Found");                                                            } else {                                                                Component_Qty_t = resultSet.getInt(1);                                                            }                                                            // --              and     trunc(sysdate) between trunc(bic.effectivity_date) and                                                            // --                nvl(bic.disable_date, (sysdate + 1));                                                        } catch (No_Data_Found e1) {                                                            logger.error(e1);                                                            t_Status_Code = Failure_Code;                                                            t_Error_Code = 1981;                                                            t_Error_Message = "Could not find effective BOM with the alternate designator: " + t_Alternate_Designator;                                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                            }                                                            // Goto End_Transact_Loop;                                                            break end_Transact_Loop;                                                        }                                                    }                                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Component_Qty_T: " + Component_Qty_t);                                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Updating Txn Qty: " + t_Lot_Rec.New_Txn_Qty);                                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set New_Uom_Code = ? , " + " New_Txn_Qty  = Case ? " + " When ? Then " + " ? " + " Else Round  (  ? / " + " ? , " + " ? )  End " + " Where Transaction_Id = " + " ?  ";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Uom);                                                    preparedStatement.setObject(2, t_Lot_Rec.New_Uom_Code);                                                    preparedStatement.setObject(3, t_Uom);                                                    preparedStatement.setObject(4, t_Lot_Rec.New_Txn_Qty);                                                    preparedStatement.setObject(5, t_Lot_Rec.New_Txn_Qty);                                                    preparedStatement.setObject(6, Component_Qty_t);                                                    preparedStatement.setObject(7, 0);                                                    preparedStatement.setObject(8, t_Lot_Rec.Transaction_Id);                                                    preparedStatement.executeUpdate();                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    t_Status_Code = Reset_Code;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                }                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            }                                        }                                        // end start or complete the lot                                        // end check if lot already exists in sector                                        t_Stmt_Num = 460;                                    } else if (t_Level > t_Current_Level) {                                        // --Deepak 25 Oct,02                                        Sql = // 4 complete                                        "SELECT  Wdj.Status_Type, We.Wip_Entity_Name  " + " From Wip_Discrete_Jobs Wdj, Wip_Entities We " + " Where Wdj.Wip_Entity_Id = We.Wip_Entity_Id " + " And We.Wip_Entity_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Wip_Entity_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Type = resultSet.getInt(1);                                            t_Job_Name = resultSet.getString(2);                                        }                                        if (t_Status_Type == 4) {                                            // --lot need to be returned to wip first                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Return to wip before jump  of ring for jump backwards");                                            Sql = "SELECT  Primary_Uom_Code " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Organization_Id);                                            preparedStatement.setObject(2, o_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom_Code = resultSet.getString(1);                                            }                                            t_Stmt_Num = 470;                                            procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                            null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                            }                                            if (t_Status_Code == Success_Code) {                                                t_Status_Code = Reset_Code;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                }                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 480;                                        try {                                            Sql = // uom code of active lot                                            "SELECT  Uom_Code  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom = resultSet.getString(1);                                            }                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 2410;                                            t_Error_Message = "No active lot available";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        if (t_Lot_Rec.New_Uom_Code != t_Uom) {                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 1987;                                            t_Error_Message = "Jump back across bom level with different UOM is not allowed";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Jump  of ring for jump backwards");                                        Sql = "UPDATE t_Lot_Items_Api " + " Set New_Bom_Level = ? " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Bom_Level);                                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Stmt_Num = 490;                                        // t_oracle_uom is used in move_lot_api also.                                        tltAdatpObject.t_Validate_Lot_Api(// 1                                        t_Lot_Rec.Transaction_Id, // 2                                        null, // 3                                        t_Factory_Id, // 4                                        t_Lot_Rec.New_Txn_Qty, null, // 5                                        t_Operation_Seq_Num, // 6                                        t_Intra_Op_Step, // 7                                        o_Inventory_Item_Id, // 8                                        t_Lot_Position, // 9                                        t_Lot_Rec.Lot_Id, // 10                                        t_Job_Name, // 11 chr                                        Character.toString(t_Lot_Status), // 12                                        t_Oracle_Uom, // 13                                        i_User_Id, // 14                                        t_Lot_Rec, // 15                                        t_Status_Code, // 16                                        t_Error_Code, // 17                                        t_Error_Message);                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api:" + t_Status_Code);                                        if (t_Status_Code != Success_Code) {                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 500;                                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                        // --                null,                                        // --                t_status_code,                                        // --                t_error_code,                                        // --                t_error_message,                                        // --                GET                                        // --                    );                                        if (t_Status_Code == Success_Code) {                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } else {                                        t_Status_Code = Reject_Code;                                        t_Error_Code = 1961;                                        t_Error_Message = "Lots not in sequence of the bom levels in t_lots table.Actions : If Cutover - Change unique_id in t_lots/t_oracle_jobs";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } else {                                    // --no change of item so just perform jump. lot would come here when jump forward to next sector comes                                    // --after jump jump back was done sometime back. So no need to complete and start lot.                                    // --lot is still in same sector although it jumped to operations in other sector                                    t_Stmt_Num = 510;                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Jump into Routing for jump forwards");                                    // t_oracle_uom is used in move_lot_api also.                                    tltAdatpObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, o_Inventory_Item_Id, t_Lot_Position, t_Lot_Rec.Lot_Id, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api:" + t_Status_Code);                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 520;                                    procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                    // --                null,                                    // --                t_status_code,                                    // --                t_error_code,                                    // --                t_error_message,                                    // --                GET                                    // --                    );                                    if (t_Status_Code == Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                        }                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            // no change in bom level                        } catch (No_Data_Found e) {                            logger.error(e);                            // -- check if Lot in WIP for the very item , if so, then insert into t_lots,but still error out.                            // -- Hari K Feb 07 , reverse insert into t lots table if the lot has been created in Oracle.                            // -- if this flag is set to true in Client Site. This may not be applicable for all situations                            // --This has to be done carefully.Side effects include  headache,indigestion, mails from the big boss                            // -- and nasty looks/mails from the client.                            if (t_Reverse_Insert_From_Oracle && t_Lot_Rec.New_Bom_Level != null) {                                try {                                    // -- check if lot is created in Oracle from frontend or other sources                                    Log_Msg = "T_Transact_Lots: Item/org before Reverse-Insert: " + t_Inventory_Item_Id + "," + t_Organization_Id;                                    logger.debug(Log_Msg);                                    procedureParams_OutputMap = Log_Message(Log_Msg);                                    Sql = "SELECT  Primary_Item_Id, Status_Type, Wip_Entity_Id " + " From Wip_Discrete_Jobs " + " Where Lot_Number = ? " + " And Organization_Id = ? " + " And Primary_Item_Id = ? " + // strict check to keep this at a minimum.So moves causing start to next bom level etc will fail                                    " And Status_Type In   (  3, ? )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Organization_Id);                                    preparedStatement.setObject(3, t_Inventory_Item_Id);                                    preparedStatement.setObject(4, 6);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        o_Inventory_Item_Id = resultSet.getInt(1);                                        t_Status_Type = resultSet.getInt(2);                                        t_Wip_Entity_Id = resultSet.getInt(3);                                    }                                } catch (No_Data_Found e2) {                                    logger.error(e2);                                    t_Error_Code = 1264;                                    t_Error_Message = "No Released Lot found in Oracle. Cannot Reverse Insert.If this is a valid lot to be transacted, then create Lot in Oracle and Resubmit";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Failure_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        Failure_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // check if lot is created in Oracle from frontend or other sources                                // -- want to keep code length small, hence cramped.                                try {                                    // -- check once more, remember there can be side effects !                                    Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C, H )  )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                    // --Added H Status by Mahendra on 29 Aug 09 for HOLD check                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    Sql = "SELECT  t_Lots_s.Nextval " + " From Dual ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Reverse_Insert_Unique_Id = resultSet.getInt(1);                                    }                                    Sql = "INSERT Into t_Lots " + "   (  Unique_Id , " + " Lot_Id , " + " Txn_Qty , " + " Factory_Id , " + " Creation_Date , " + " Status , " + " Remarks , " + " Bom_Level , " + " Lot_Type " + // --Added By MohanVamsi 10-Nov-2011, without this If Scrap is first Txn then                                    // --Failing                                    "  )  " + " Values " + "   (  ? , " + " ?, " + " ? , " + " ? , " + " Sysdate , " + // as only released or on hold jobs considered, hence fixed                                    " A ,  " + " TLTHREAD:Reverseinsert from Oracle , " + " ? , " + " ? )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Reverse_Insert_Unique_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Txn_Qty);                                    preparedStatement.setObject(4, t_Factory_Id);                                    preparedStatement.setObject(5, t_Lot_Rec.New_Bom_Level);                                    preparedStatement.setObject(6, t_Lot_Rec.New_Lot_Type);                                    preparedStatement.executeUpdate();                                    Sql = "INSERT Into t_Oracle_Jobs " + "   (  Lot_Id , " + " Factory_Id , " + " Wip_Entity_Id , " + " Parent_Wip_Entity_Id , " + " Status , " + " Active_Flag )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " A )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Reverse_Insert_Unique_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Wip_Entity_Id);                                    preparedStatement.setObject(4, t_Wip_Entity_Id);                                    preparedStatement.setObject(5, 1);                                    preparedStatement.executeUpdate();                                    t_Error_Code = (int) 1264.1;                                    t_Error_Message = "TLTHREAD.Reverse Insert  ( into t_lots) Flag is ON. Record Inserted into t_lots.";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Reset_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        Reset_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                                // --Need to Uncomment from Line(GOTO END_TRANSACT_LOOP) to line (GOTO END_TRANSACT_LOOP;---23456)                                // --and comment below for not Allowing to process any action code from Lot eDapter                                // --when Lot Starts outside Lot eDapter till 33333333                                // --Added by MohanVamsi for SI can be uncomment if required                                try {                                    Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  H )  )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            try {                                Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  H )  )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Failure_Code;                                t_Error_Code = 1265;                                t_Error_Message = "Lot does not exist in t_lots." + "Reasons: 1)Lot was Started from front end 2)Prior Transaction closed/completed the lot" + " Corresponding Actions  :1.Reverse insert into t_lots/t_oracle_jobs 2.Check why lot got completed and act accordingly";                                procedureParams_OutputMap = Log_Message(t_Error_Message);                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // Added or Commented by MohanVamsi                        /*  GOTO END_TRANSACT_LOOP;                                                                 END IF; -- Hari K, end of reverse insert..I hope it works without causing any side-effects.                                                                 T_STATUS_CODE   := FAILURE_CODE;                                                                 T_ERROR_CODE    := 1265;                                                                 T_ERROR_MESSAGE := Lot does not exist in t_lots. ||                                                                 Reasons: 1)Lot was Started from front end 2)Prior Transaction closed/completed the lot ||                                                                  Corresponding Actions :1.Reverse insert into t_lots/t_oracle_jobs 2.Check why lot got completed and act accordingly;                                                                 LOG_MESSAGE(T_ERROR_MESSAGE);                                                                 tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                                 NULL,                                                                 T_STATUS_CODE,                                                                 T_ERROR_CODE,                                                                 T_ERROR_MESSAGE,                                                                 SET);                                                                 GOTO END_TRANSACT_LOOP;---23456                                                                 */                        // bom level change first select                    }                    // track in oracle                    // --***************JUMP ACROSS BOM LEVEL END***************                    t_Stmt_Num = 530;                    // --Deepak 29 Nov,02                    if (x_Track_In_Oracle == 1 && t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS")) {                        /*                                                     begin                                                     select toj.wip_entity_id , status_type, primary_item_id                                                     into   t_wip_entity_id, t_status_type, t_inventory_item_id                                                     from   t_oracle_jobs toj,wip_discrete_jobs wdj                                                     where  toj.lot_id = (select max(unique_id)                                                     from   t_lots                                                     where  lot_id     = t_lot_rec.lot_id                                                     and    factory_id = t_factory_id                                                     and    status =C)                                                     and    toj.wip_entity_id =wdj.wip_entity_id;                                                     dbms_output.put_line( before return to wip t_status_type- ||t_status_type);                                                     exception                                                     when no_data_found then                                                     null;                                                     end;                                                     */                        // --Added by Harikrishna for unclose lots on 27-Aug-2003                        if (t_Status_Type == 12) {                            if (((x_Wip_Entity_Id != null ? x_Wip_Entity_Id : 0) == 0)) {                                try {                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = C " + " And Tl.Status = C " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )  " + " And  Rownum = 1";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, 12);                                    preparedStatement.setObject(4, 2);                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(6, t_Factory_Id);                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(8, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        x_Wip_Entity_Id = resultSet.getInt(1);                                    }                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 1078.2;                                    t_Error_Message = " Cannot find lot to be Unclosed in oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(t_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            if (t_Status_Code == Success_Code) {                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Success in unclosing the Job");                                logger.debug("T_Transact_Lots: Success in unclosing the Job");                                t_Status_Type = 4;                                t_Wip_Entity_Id = x_Wip_Entity_Id;                            } else {                                t_Status_Code = Failure_Code;                                t_Error_Code = (int) 2751.1;                                t_Error_Message = " Cannot unclose" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        if (t_Status_Type == 4) {                            // --lot need to be returned to wip first                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Return to WIP first ");                            // check if job is in inactive state.handled below                            tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "C");                            if (t_Status_Code != Success_Code) {                                t_Status_Code = Failure_Code;                                t_Error_Message = "Error-" + t_Error_Message + " in t_get_lot_status for uncomplete in undos";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --Chcking for full scrap                            // -- Added by Harikrishna on July 04                            if (t_Job_Name != null) {                                Sql = "SELECT  Primary_Uom_Code, Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, x_Inventory_Item_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Uom_Code = resultSet.getString(1);                                    t_Lot_Rec.New_Uom_Code = resultSet.getString(2);                                }                                Sql = "SELECT  Quantity_Completed " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                                }                                if (t_Lot_Rec.New_Txn_Qty == 0) {                                    // --Quantity is fully scrapped                                    try {                                        Sql = "SELECT  Quantity_Scrapped, Operation_Seq_Num " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Quantity_Completed = Quantity_Scrapped " + " And Quantity_Completed > ? " + " And Count_Point_Type = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Wip_Entity_Id);                                        preparedStatement.setObject(2, 0);                                        preparedStatement.setObject(3, 1);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Wip_Qty = resultSet.getInt(1);                                            t_Operation_Seq_Num = resultSet.getInt(2);                                        }                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 2751;                                        t_Error_Message = "Quantity Fully Scrapped Cannot det oprn" + e.getSQLState();                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    if (t_Wip_Qty > 0) {                                        t_Lot_Rec.Action_Code = "UNTERMINATE";                                        t_Undo = true;                                    } else {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 2751;                                        t_Error_Message = "Quantity Fully Scrapped Cannot det oprn";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    // Goto t_Unterminate;                                    break t_Unterminate;                                } else {                                    // --quantity is completed                                    try {                                        Sql = // Deepak 26 Dec,02. bom level should not change in t_lots                                        "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Bom_Level = resultSet.getString(1);                                        }                                        t_Lot_Rec.New_Bom_Level = t_Bom_Level;                                        procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, // t_inventory_item_id,                                        x_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        try {                                            Sql = "SELECT  Bom_Level " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = N )   ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Bom_Level = resultSet.getString(1);                                            }                                        } catch (No_Data_Found e2) {                                            logger.error(e2);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 2752;                                            t_Error_Message = "1.Undos.No completed lot available";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                }                                // Checking for Fully Scrap                            }                            // Job Name is not null                        } else {                            Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Last_Op_Seq_Num = resultSet.getInt(1);                            }                            try {                                // --lot is completed but status type not updated                                Sql = // Deepak 26 Dec,02                                "SELECT  x  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Last_Op_Seq_Num);                                preparedStatement.setObject(3, 0);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                t_Status_Code = Reset_Code;                                t_Error_Message = "Undos.Waiting for lot to be completed";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } catch (No_Data_Found e) {                                logger.error(e);                            }                            // no uncomplete required                        }                        // --  end if;                        t_Stmt_Num = 540;                        // --******UNDO MOVE ACROSS BOM LEVEL STARTS*************                        // --  if x_track_in_oracle = 1 and upper(t_lot_rec.action_code) =UNDOS--UNDO MOVE --Deepak 16 Dec,02                        // --  then                        try {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside UNDO move across BOM Level");                            Sql = "SELECT  Max ( Unique_Id) " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Unique_Id = resultSet.getInt(1);                            }                            if (t_Unique_Id == null) {                                Sql = "SELECT  Max ( Unique_Id) " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = T  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            }                            Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Unique_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_ID: " + t_Wip_Entity_Id + ", at stmt no: " + t_Stmt_Num);                            try {                                Sql = // operation_sequence_id                                "SELECT  Standard_Operation_Id  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Quantity_In_Queue > ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, 0);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Wo_Std_Op_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                // --t_operation_seq_id:=null;                                t_Wo_Std_Op_Id = null;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wo_Std_Op_ID: " + t_Wo_Std_Op_Id);                            t_Stmt_Num = 542;                            try {                                Sql = "SELECT  x " + " From Bom_Operation_Sequences Bos, Wip_Discrete_Jobs Wdj " + // --   where   bos.operation_sequence_id=t_operation_seq_id  --ok since used for first operation                                " Where Bos.Standard_Operation_Id = ?  " + // Deepak 18 Jan,03                                " And Wdj.Wip_Entity_Id = ?  " + // Kunal 24 Jan,03                                " And Wdj.Common_Routing_Sequence_Id = " + // Kunal 24 Jan,03                                " Bos.Routing_Sequence_Id  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bos.Effectivity_Date )  And " + " Nvl  (  Bos.Disable_Date, " + // Deepak 22 Mar,03                                "  (  ? + ? )  )   " + // --  and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1))                                " And Bos.Operation_Sequence_Id Not In " + "  (  Select To_Op_Seq_Id " + " From Bom_Operation_Networks " + " Where To_Op_Seq_Id = Bos.Operation_Sequence_Id )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wo_Std_Op_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                                preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                preparedStatement.setObject(5, 1);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                try {                                    Sql = // Deepak 25 Dec,02. this is to check if its across bom level                                    "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Unique_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Bom_Level = resultSet.getString(1);                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 2850;                                    t_Error_Message = "2.Undos.No active/cancelled lot available";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                if (t_Bom_Level == t_Lot_Rec.New_Bom_Level) {                                    // --this is within same bom level                                    t_Dummy = null;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                t_Dummy = null;                            }                            t_Stmt_Num = 550;                            try {                                // --check if this is undo intraoperation step and not undo operation                                Sql = "SELECT  y " + " From Wip_Move_Transactions " + " Where Transaction_Id = " + "  (  Select Max  (  Transaction_Id )  " + " From Wip_Move_Transactions " + " Where Organization_Id = ? " + " And Wip_Entity_Id = ? " + " And To_Operation_Seq_Num = ? " + " And   (  Fm_Operation_Seq_Num = To_Operation_Seq_Num And " + " Fm_Intraoperation_Step_Type < " + " To_Intraoperation_Step_Type )  " + " And Wsm_Undo_Txn_Id == null )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                preparedStatement.setObject(3, t_Operation_Seq_Num);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                // null;                            }                            // this is undo operation. t_dummy should not be updated.                            if (t_Dummy.equals("y")) {                                t_Dummy = null;                            }                            if (t_Dummy.equals("x")) {                                // --if undo move is from first operation only                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Undo move is from first operation");                                t_Stmt_Num = 552;                                try {                                    // --added for undos with multiple components. return only primary component.                                    Sql = // Deepak 7 Mar, 03                                    "SELECT  Common_Bom_Sequence_Id  " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Bom_Seq_Id = resultSet.getInt(1);                                    }                                    t_Stmt_Num = 553;                                    Sql = "SELECT  Min ( Operation_Seq_Num) " + // --        from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, 1);                                    preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(5, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Op_Seq_Num = resultSet.getInt(1);                                    }                                    // --        and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                    t_Stmt_Num = 554;                                    Sql = "SELECT  Min ( Item_Num) " + // --    from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Operation_Seq_Num = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, t_Op_Seq_Num);                                    preparedStatement.setObject(3, 1);                                    preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(6, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Item_Seq_Num = resultSet.getInt(1);                                    }                                    // --    and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                    t_Stmt_Num = 555;                                    Sql = "SELECT  Component_Item_Id " + // -- from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Operation_Seq_Num = ? " + " And Item_Num = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, t_Op_Seq_Num);                                    preparedStatement.setObject(3, t_Item_Seq_Num);                                    preparedStatement.setObject(4, 1);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(7, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Comp_Item_Id = resultSet.getInt(1);                                    }                                    // -- and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 3048;                                    t_Error_Message = "Error in fetching primary component for UNDOS, Msg:" + e.getSQLState() + ", at stmt: " + t_Stmt_Num;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                t_Stmt_Num = 556;                                try {                                    Sql = "SELECT  x " + " From Mtl_Material_Transactions Mmt " + " Where Mmt.Organization_Id = ? " + // Deepak 7 Mar, 03                                    " And Mmt.Inventory_Item_Id = ?  " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Comp_Item_Id);                                    preparedStatement.setObject(3, 5);                                    preparedStatement.setObject(4, 43);                                    preparedStatement.setObject(5, t_Wip_Entity_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                    t_Stmt_Num = 557;                                    if (t_Status_Type == 3) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Need to cancel the latest Job");                                        t_Job_Name = null;                                    } else {                                        // check if job is cancelled                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "T");                                        if (t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for cancelled lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Job_Name: " + t_Job_Name);                                    t_Stmt_Num = 560;                                    if (t_Job_Name == null) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Cancel the Lot");                                        // check if job is in wip                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                                        if (t_Job_Name == null || t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for wip lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 570;                                        procedureParams_OutputMap = // cancel the lot                                        tltAdatptSubObject.t_Cancel_Wiplot_Api(// cancel the lot                                        t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Organization_Id, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        // --          tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                        // --                  null,                                        // --                  t_status_code,                                        // --                  t_error_code,                                        // --                  t_error_message,                                        // --                  GET                                        // --                      );                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After cancel T_Status_Code: " + t_Status_Code);                                        if (t_Status_Code == Success_Code) {                                            // can go ahead with uncomplete                                            t_Undo = true;                                        } else {                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    } else {                                        // can go ahead with uncomplete                                        t_Undo = true;                                    }                                    t_Stmt_Num = 580;                                    if (t_Undo == true) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Uncomplete the Lot");                                        // --if job is cancelled then uncomplete the lot in previous sector                                        // check if job is in inactive state                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "N");                                        if (t_Job_Name == null) {                                            // --this was undo lot start                                            t_Status_Code = Success_Code;                                            t_Error_Code = null;                                            t_Error_Message = null;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        } else if (t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error:" + t_Error_Message + ", in t_get_lot_status for inactive lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        try {                                            Sql = "SELECT  Primary_Uom_Code, Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Organization_Id);                                            preparedStatement.setObject(2, t_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom_Code = resultSet.getString(1);                                                t_Lot_Rec.New_Uom_Code = resultSet.getString(2);                                            }                                            Sql = "SELECT  Quantity_Completed " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Wip_Entity_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                                            }                                        } catch (SQLException e) {                                            logger.error(e, e);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 3225;                                            t_Error_Message = "Undos: Error selecting job details-" + e.getSQLState();                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        // --Added by Harikrishna for unclose lots on 27-Aug-2003                                        if (t_Status_Type == 12) {                                            if (((t_Wip_Entity_Id != null ? t_Wip_Entity_Id : 0) == 0)) {                                                try {                                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = N " + " And Tl.Status = N " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = N )  " + " And  Rownum = 1";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, 12);                                                    preparedStatement.setObject(4, 2);                                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(6, t_Factory_Id);                                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(8, t_Factory_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Wip_Entity_Id = resultSet.getInt(1);                                                    }                                                } catch (SQLException e) {                                                    logger.error(e, e);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = (int) 1078.3;                                                    t_Error_Message = " Cannot find lot to be Unclosed in oracle";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                            }                                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(t_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                            }                                            if (t_Status_Code == Success_Code) {                                                t_Status_Type = 4;                                                procedureParams_OutputMap = Log_Message("Success in unclosing the job-");                                            } else {                                                t_Status_Code = Failure_Code;                                                t_Error_Code = (int) 3225.1;                                                t_Error_Message = " Cannot unclose" + t_Error_Message;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                }                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            }                                        }                                        // this is undo across bom level                                        tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    // --perform unconsume first                                    // check if job is in wip                                    tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (t_Job_Name == null || t_Status_Code != Success_Code) {                                        t_Status_Code = Failure_Code;                                        t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for wip lot";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 590;                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Perform UnConsume first");                                    Sql = "SELECT  t_Child_Lots_Api_s.Nextval " + " From Dual ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Line_Number_s = resultSet.getInt(1);                                    }                                    // -- delete  from t_child_lots_api                                    // -- where transaction_id=t_lot_rec.transaction_id;                                    Sql = // assuming that there is only one component in BOM                                    "INSERT Into t_Child_Lots_Api  " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.setObject(2, i_Factory_Name);                                    preparedStatement.setObject(3, t_Line_Number_s);                                    preparedStatement.setObject(4, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(5, Reset_Code);                                    preparedStatement.executeUpdate();                                    // unconsume the component lot                                    tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                    null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                    // --                null,                                    // --                t_status_code,                                    // --                t_error_code,                                    // --                t_error_message,                                    // --                GET                                    // --                    );                                    if (t_Status_Code == Success_Code) {                                        t_Status_Code = Reset_Code;                                    }                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 3093;                            t_Error_Message = "Undos:lot does not exists in t_lots";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // <<t_Unterminate>>                    // --******UNDO MOVE ACROSS BOM LEVEL ENDS*************                    t_Stmt_Num = 600;                    if (x_Track_In_Oracle == 1 && (!t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS"))) {                        // --Deepak 26 Dec,02                        try {                            Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 07 Mar,03                            " And Status In   (  A, H, T, C )  )    ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            // --   and bom_level=t_lot_rec.new_bom_level); --Deepak 04 Dec,02                            Sql = "SELECT  Status_Type, Start_Quantity, Quantity_Scrapped " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Status_Type = resultSet.getInt(1);                                t_Original_Qty = resultSet.getInt(2);                                t_Qty_Scrapped = resultSet.getInt(3);                            }                            if (t_Status_Type == 4 && t_Original_Qty == t_Qty_Scrapped && t_Lot_Rec.Action_Code.equals("TERMINATE")) {                                t_Status_Code = Success_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if (t_Status_Type == 1) {                                if (t_Lot_Rec.Action_Code.equals("TERMINATE")) {                                    procedureParams_OutputMap = tltAdatptSubObject.t_Release_Wip_Lot(t_Wip_Entity_Id, t_Organization_Id.toString(), t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Message, t_Error_Code, "Y");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Status_Code = Success_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                    // ---added Code by Vamsi  Feb309                                } else if (t_Lot_Rec.Action_Code.equals("RELEASE")) {                                    Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, 3);                                    preparedStatement.setObject(2, t_Wip_Entity_Id);                                    preparedStatement.setObject(3, t_Organization_Id);                                    preparedStatement.executeUpdate();                                    /*                                                     --update t_lots also                                                     select unique_id                                                     into t_unique_id                                                     from t_lots                                                     where lot_id = t_lot_rec.lot_id                                                     and factory_id = t_factory_id                                                     and status  in (H,A); --Deepak 24 Oct,02                                                     update t_lots                                                     set    status=A                                                     where unique_id=t_unique_id;                                                     update t_oracle_jobs                                                     set active_flag=A                                                     where lot_id=t_unique_id;*/                                    // --Added till here                                } else {                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = TRANSACTION on UNRELEASED JOB " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Reject_Code);                                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            // --Code to handle transactions for Lots started from front end -HariD Sep 3 08 for SiRF                            try {                                Sql = "SELECT  Wip_Entity_Id " + " From Apps.Wip_Discrete_Jobs " + " Where Lot_Number = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Tlot_Check_Lot_Number = resultSet.getString(1);                                }                                // --Commented by MohanVamsi, Lots will be inserted by Reverse Insert Concept,                                // --instead of separate procedure.                                /*IF T_TLOT_CHECK_LOT_NUMBER > 0                                                     THEN                                                     T_T_LOTS_ENTRY(T_LOT_REC.LOT_ID,                                                     T_LOT_REC.TRANSACTION_ID,                                                     T_FACTORY_ID);                                                     END IF;*/                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Reject_Code;                                t_Error_Code = 782;                                t_Error_Message = "Transaction on uncreated LOT ID" + t_Lot_Rec.Lot_Id;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    t_Stmt_Num = 610;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before Validate Lot");                    procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, t_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                        t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                    }                    if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                        t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                        t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                        t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                    }                    if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                        t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    if (t_Job_Name == null) {                        // Goto End_Transact_Loop; //not tracked in oracle                        break end_Transact_Loop;                    }                    // ------UNDOS .                    t_Stmt_Num = (int) 610.01;                    if (x_Track_In_Oracle == 1 && t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Start UNDOS");                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_Id: " + t_Wip_Entity_Id + ", at stmt no:" + t_Stmt_Num);                        try {                            t_Stmt_Num = 611;                            Sql = // Deepak 26 Dec,02. bom level should not change in t_lots                            "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Bom_Level = resultSet.getString(1);                            }                            if (t_Lot_Rec.New_Bom_Level == t_Bom_Level) {                                t_Same_Bom_Level = true;                            } else {                                // for updating t_lots                                t_Lot_Rec.New_Bom_Level = t_Bom_Level;                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 4285;                            t_Error_Message = "3.Undos.No active lot available";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = (int) 611.01;                        Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Inventory_Item_Id = ? " + " And Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Inventory_Item_Id);                        preparedStatement.setObject(2, t_Organization_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.New_Uom_Code = resultSet.getString(1);                        }                        t_Stmt_Num = (int) 611.02;                        Sql = "SELECT   ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move), " + " Operation_Seq_Num " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )  " + " And  Rownum = 1";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, 0);                        preparedStatement.setObject(3, 0);                        preparedStatement.setObject(4, 0);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                            t_Operation_Seq_Num = resultSet.getInt(2);                        }                        if (t_Same_Bom_Level) {                            t_Stmt_Num = (int) 611.03;                            Sql = // operation_sequence_id,                            "SELECT  Standard_Operation_Id,  " + " Quantity_In_Queue, " + " Quantity_Running, " + " Quantity_Waiting_To_Move, " + " Quantity_Scrapped " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wo_Std_Op_Id = resultSet.getInt(1);                                t_Quantity_In_Queue = resultSet.getInt(2);                                t_Quantity_Running = resultSet.getInt(3);                                t_Quantity_Waiting_To_Move = resultSet.getInt(4);                                t_Quantity_Scrapped = resultSet.getInt(5);                            }                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = // bos.operation_sequence_id  "+                            " select bos.standard_operation_id  " + " from   bom_operation_sequences bos ,    " + "     wip_discrete_jobs     wdj     " + " where  wdj.wip_entity_id     =   " + t_Wip_Entity_Id + "  " + " and     bos.routing_sequence_id   =  wdj.common_routing_sequence_id  " + " and    trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                            " + 1 )  )   " + // " and    trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                            " and    " + "bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Step_Seq_Field + "  =  " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            try {                                t_Stmt_Num = 612;                                // t_Cursor    =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Bos_Std_Op_Id )  ; //x_operation_seq_id )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_step_seq",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: X_Status_Code: " + x_Status_Code + ", at stmt no: " + t_Stmt_Num);                                if (x_Status_Code == 1) {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Bos_Std_Op_Id); //x_operation_seq_id);                                    // x_operation_seq_id = resultSet.getnull ( 1);                                    t_Bos_Std_Op_Id = resultSet.getInt(1);                                } else {                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 4109;                                    t_Error_Message = "Operation doesnot exists in Routing. Cannot undo";                                    t_Stmt_Num = 613;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 4110;                                t_Error_Message = "Error executing dynamic sql: " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_wo_std_op_id: " + t_Wo_Std_Op_Id + ", at stmt no: " + t_Stmt_Num);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Bos_std_op_id:" + t_Bos_Std_Op_Id + ", at stmt no: " + t_Stmt_Num);                            if (t_Quantity_In_Queue > 0) {                                t_Oracle_Intraope_Step_Type = 1;                            } else if (t_Quantity_Running > 0) {                                t_Oracle_Intraope_Step_Type = 2;                            } else if (t_Quantity_Waiting_To_Move > 0) {                                t_Oracle_Intraope_Step_Type = 3;                            }                            t_Stmt_Num = 614;                            procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_State(t_Factory_Id, t_Lot_Rec.New_State_Id, t_Tpla_Intraope_Step_Type, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Intraop_Step") != null) {                                t_Tpla_Intraope_Step_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Intraop_Step");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Tpla_Intraope_Step_Type: " + t_Tpla_Intraope_Step_Type);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Oracle_Intraope_Step_Type: " + t_Oracle_Intraope_Step_Type);                        }                        // --    select decode(t_uom1,t_lot_rec.new_uom_code,t_txn_qty1,t_lot_rec.new_txn_qty) --Deepak 03 Jan,03                        // --    into   t_txn_qty1                        // --    from   dual;                        // -- or (t_txn_qty1!=t_lot_rec.new_txn_qty)                        if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id || t_Oracle_Intraope_Step_Type != t_Tpla_Intraope_Step_Type || t_Quantity_Scrapped > 0 || !t_Same_Bom_Level) {                            // --perform undo move                            t_Stmt_Num = 615;                            if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id) {                                Sql = "SELECT  * " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = " + " ? " + " And Organization_Id = " + " ? " + " And Operation_Seq_Num = " + " ? " + " And Wip_Supply_Type = ? " + " And Quantity_Issued > ? ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Organization_Id);                                preparedStatement.setObject(3, t_Operation_Seq_Num);                                preparedStatement.setObject(4, 1);                                preparedStatement.setObject(5, 0);                                resultSet11 = preparedStatement.executeQuery();                                while (resultSet11.next()) {                                    Integer Comp_Return_Loop_Quantity_Issued = resultSet11.getInt("Quantity_Issued");                                    Integer Comp_Return_Loop_Wip_Entity_Id = resultSet11.getInt("Wip_Entity_Id");                                    Integer Comp_Return_Loop_Organization_Id = resultSet11.getInt("Organization_Id");                                    Integer Comp_Return_Loop_Inventory_Item_Id = resultSet11.getInt("Inventory_Item_Id");                                    t_Stmt_Num = 616;                                    Sql = "SELECT  Sum ( Quantity_Issued) " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ? " + " And Wip_Supply_Type = ? " + " And Inventory_Item_Id = " + " ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                    preparedStatement.setObject(2, t_Organization_Id);                                    preparedStatement.setObject(3, 1);                                    preparedStatement.setObject(4, Comp_Return_Loop_Inventory_Item_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Return_Quantity = resultSet.getInt(1);                                    }                                    t_Stmt_Num = 617;                                    if (t_Return_Quantity > 0) {                                        // vyshnavi Least plsql to java pending - Least                                        t_Return_Quantity = Math.min(Comp_Return_Loop_Quantity_Issued, t_Return_Quantity);                                        t_Returned_Quantity = 0;                                        t_Stmt_Num = 618;                                        Sql = "SELECT  Lot_Control_Code, Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = " + " ? " + " And Inventory_Item_Id = " + " ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Lot_Control_Code = resultSet.getInt(1);                                            t_Component_Item_Number = resultSet.getString(2);                                        }                                        t_Stmt_Num = 619;                                        Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Line_Number_s = 0;                                        t_Child_Exist = 0;                                        if (t_Lot_Control_Code == 2) {                                            t_Stmt_Num = 620;                                            Sql = "SELECT  Mtl.Lot_Number, " + " Abs (  Mtl.Transaction_Quantity ) Txn_Qty " + " From Mtl_Material_Transactions Mmt, " + " Mtl_Transaction_Lot_Numbers Mtl " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mtl.Transaction_Id = " + " Mmt.Transaction_Id " + " And Mtl.Inventory_Item_Id = " + " Mmt.Inventory_Item_Id " + " And Mtl.Organization_Id = " + " Mmt.Organization_Id " + " And Mtl.Transaction_Source_Type_Id = ? " + " Order By Mtl.Transaction_Id Desc ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                            preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                            preparedStatement.setObject(3, Comp_Return_Loop_Wip_Entity_Id);                                            preparedStatement.setObject(4, 35);                                            preparedStatement.setObject(5, 5);                                            resultSet12 = preparedStatement.executeQuery();                                            while (resultSet12.next()) {                                                String Return_Lot_Rec_Lot_Number = resultSet12.getString("Lot_Number");                                                Integer Return_Lot_Rec_Txn_Qty = resultSet12.getInt("Txn_Qty");                                                t_Stmt_Num = 621;                                                if (Return_Lot_Rec_Lot_Number != t_Lot_Rec.Lot_Id) {                                                    t_Line_Number_s = t_Line_Number_s + 1;                                                    t_Stmt_Num = 622;                                                    if (t_Returned_Quantity >= t_Return_Quantity) {                                                        break;                                                    } else {                                                        Return_Lot_Rec_Txn_Qty = Math.min(Return_Lot_Rec_Txn_Qty, t_Return_Quantity - t_Returned_Quantity);                                                        t_Returned_Quantity = t_Returned_Quantity + Return_Lot_Rec_Txn_Qty;                                                    }                                                    t_Stmt_Num = 623;                                                    Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                    preparedStatement.setObject(2, i_Factory_Name);                                                    preparedStatement.setObject(3, t_Line_Number_s);                                                    preparedStatement.setObject(4, Return_Lot_Rec_Lot_Number);                                                    preparedStatement.setObject(5, Return_Lot_Rec_Txn_Qty);                                                    preparedStatement.setObject(6, Reset_Code);                                                    preparedStatement.executeUpdate();                                                    t_Child_Exist = 1;                                                }                                            }                                            t_Stmt_Num = 623;                                        } else {                                            Sql = // Harikrishna Apr 23                                            "SELECT  Sum ( Abs ( Mmt.Transaction_Quantity))  " + " From Mtl_Material_Transactions Mmt " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                            preparedStatement.setObject(2, 5);                                            preparedStatement.setObject(3, 35);                                            preparedStatement.setObject(4, Comp_Return_Loop_Wip_Entity_Id);                                            preparedStatement.setObject(5, Comp_Return_Loop_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Returned_Quantity = resultSet.getInt(1);                                            }                                            t_Line_Number_s = t_Line_Number_s + 1;                                            t_Stmt_Num = 624;                                            if (((t_Returned_Quantity != null ? t_Returned_Quantity : 0) > 0)) {                                                t_Stmt_Num = 625;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Item , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, t_Component_Item_Number);                                                preparedStatement.setObject(5, t_Returned_Quantity);                                                preparedStatement.setObject(6, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Child_Exist = 1;                                            }                                        }                                        t_Stmt_Num = 626;                                        if (t_Child_Exist == 1) {                                            // unconsume the component lot                                            tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        }                                        t_Stmt_Num = 627;                                        Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Stmt_Num = 628;                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                        } else {                                            t_Error_Code = 2022;                                            t_Error_Message = "Error in Unconsume on undo";                                            t_Stmt_Num = 629;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                }                            }                            // for unconsume                            t_Lot_Rec.Action_Code = "UNDO MOVE";                            t_Stmt_Num = 630;                            // --  x_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            t_Stmt_Num = 631;                            if ((t_Status_Code == Success_Code || t_Status_Code == Reset_Code)) {                                t_Status_Code = Reset_Code;                            }                            t_Stmt_Num = 632;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else {                            t_Stmt_Num = 633;                            Sql = "SELECT  * " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = " + " ? " + " And Organization_Id = " + " ? " + " And Operation_Seq_Num = " + " ? " + " And Wip_Supply_Type = ? " + " And Quantity_Issued > ? ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Organization_Id);                            preparedStatement.setObject(3, t_Operation_Seq_Num);                            preparedStatement.setObject(4, 1);                            preparedStatement.setObject(5, 0);                            resultSet13 = preparedStatement.executeQuery();                            while (resultSet13.next()) {                                Integer Comp_Return_Loop_Quantity_Issued = resultSet13.getInt("Quantity_Issued");                                Integer Comp_Return_Loop_Wip_Entity_Id = resultSet13.getInt("Wip_Entity_Id");                                Integer Comp_Return_Loop_Organization_Id = resultSet13.getInt("Organization_Id");                                Integer Comp_Return_Loop_Inventory_Item_Id = resultSet13.getInt("Inventory_Item_Id");                                t_Stmt_Num = 634;                                Sql = "SELECT  Sum ( Quantity_Issued) " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ? " + " And Wip_Supply_Type = ? " + " And Inventory_Item_Id = " + " ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Organization_Id);                                preparedStatement.setObject(3, 1);                                preparedStatement.setObject(4, Comp_Return_Loop_Inventory_Item_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Return_Quantity = resultSet.getInt(1);                                }                                t_Stmt_Num = 635;                                if (t_Return_Quantity > 0) {                                    t_Return_Quantity = Math.min(Comp_Return_Loop_Quantity_Issued, t_Return_Quantity);                                    t_Returned_Quantity = 0;                                    t_Stmt_Num = 636;                                    Sql = "SELECT  Lot_Control_Code, Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = ? " + " And Inventory_Item_Id = " + " ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                    preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Lot_Control_Code = resultSet.getInt(1);                                        t_Component_Item_Number = resultSet.getString(2);                                    }                                    t_Stmt_Num = 637;                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    t_Line_Number_s = 0;                                    t_Child_Exist = 1;                                    if (t_Lot_Control_Code == 2) {                                        t_Stmt_Num = 638;                                        Sql = "SELECT  Mtl.Lot_Number, " + " Abs (  Mtl.Transaction_Quantity ) Txn_Qty " + " From Mtl_Material_Transactions Mmt, " + " Mtl_Transaction_Lot_Numbers Mtl, " + " Wip_Discrete_Jobs Wdj " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mtl.Transaction_Id = " + " Mmt.Transaction_Id " + " And Mtl.Inventory_Item_Id = " + " Mmt.Inventory_Item_Id " + " And Mtl.Organization_Id = " + " Mmt.Organization_Id " + " And Wdj.Wip_Entity_Id = " + " ? " + " And Wdj.Organization_Id = " + " ? " + // -- and     to_char(wdj.scheduled_start_date, DD-MON-YYYY HH24:MI)<> to_char(mmt.transaction_date, DD-MON-YYYY HH24:MI)                                        " And Abs  (   Wdj.Scheduled_Start_Date - " + " Mmt.Transaction_Date  )  * ? * ? > ? " + " Order By Mtl.Transaction_Id Desc ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                        preparedStatement.setObject(3, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(4, 35);                                        preparedStatement.setObject(5, 5);                                        preparedStatement.setObject(6, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(7, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(8, 24);                                        preparedStatement.setObject(9, 60);                                        preparedStatement.setObject(10, 1);                                        resultSet14 = preparedStatement.executeQuery();                                        while (resultSet14.next()) {                                            String Return_Lot_Rec_Lot_Number = resultSet14.getString("Lot_Number");                                            Integer Return_Lot_Rec_Txn_Qty = resultSet14.getInt("Txn_Qty");                                            t_Stmt_Num = 639;                                            if (Return_Lot_Rec_Lot_Number != t_Lot_Rec.Lot_Id) {                                                t_Line_Number_s = t_Line_Number_s + 1;                                                if (t_Returned_Quantity >= t_Return_Quantity) {                                                    break;                                                } else {                                                    Return_Lot_Rec_Txn_Qty = Math.min(Return_Lot_Rec_Txn_Qty, t_Return_Quantity - t_Returned_Quantity);                                                    t_Returned_Quantity = t_Returned_Quantity + Return_Lot_Rec_Txn_Qty;                                                }                                                t_Stmt_Num = 640;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, Return_Lot_Rec_Lot_Number);                                                preparedStatement.setObject(5, Return_Lot_Rec_Txn_Qty);                                                preparedStatement.setObject(6, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Child_Exist = 1;                                            }                                        }                                        t_Stmt_Num = 641;                                    } else {                                        Sql = // Harikrishna Apr 23                                        "SELECT  Sum ( Abs ( Mmt.Transaction_Quantity))  " + " From Mtl_Material_Transactions Mmt, " + " Wip_Discrete_Jobs         Wdj " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Organization_Id = " + " ? " + " And Wdj.Organization_Id = " + " ? " + " And Wdj.Wip_Entity_Id = " + " ? " + // -- and    to_char(wdj.scheduled_start_date, DD-MON-YYYY HH24:MI)<> to_char(mmt.transaction_date, DD-MON-YYYY HH24:MI)                                        " And Abs  (  Wdj.Scheduled_Start_Date - " + " Mmt.Transaction_Date )  * ? * ? > ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, 5);                                        preparedStatement.setObject(3, 35);                                        preparedStatement.setObject(4, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(5, Comp_Return_Loop_Inventory_Item_Id);                                        preparedStatement.setObject(6, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(7, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(8, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(9, 24);                                        preparedStatement.setObject(10, 60);                                        preparedStatement.setObject(11, 1);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Returned_Quantity = resultSet.getInt(1);                                        }                                        t_Stmt_Num = 642;                                        t_Line_Number_s = t_Line_Number_s + 1;                                        if (((t_Returned_Quantity != null ? t_Returned_Quantity : 0) > 0)) {                                            Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Item , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                            preparedStatement.setObject(2, i_Factory_Name);                                            preparedStatement.setObject(3, t_Line_Number_s);                                            preparedStatement.setObject(4, t_Component_Item_Number);                                            preparedStatement.setObject(5, t_Returned_Quantity);                                            preparedStatement.setObject(6, Reset_Code);                                            preparedStatement.executeUpdate();                                            t_Child_Exist = 1;                                        }                                    }                                    t_Stmt_Num = 643;                                    if (t_Child_Exist == 1) {                                        // unconsume the component lot                                        tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    }                                    if (t_Status_Code == Success_Code) {                                        t_Status_Code = Reset_Code;                                    } else {                                        t_Error_Code = 2022;                                        t_Error_Message = "Error in Unconsume on undo";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.executeUpdate();                                }                            }                            t_Stmt_Num = 644;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            // Deepak 25 Dec,02                            t_Status_Code = Success_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // -----UNDOS                    t_Stmt_Num = 620;                    Sql = "SELECT  Status_Type, Start_Quantity, Quantity_Scrapped " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Status_Type = resultSet.getInt(1);                        t_Original_Qty = resultSet.getInt(2);                        t_Qty_Scrapped = resultSet.getInt(3);                    }                    // -- chk later not ok                    if (t_Original_Qty == 0 && t_Qty_Scrapped > 0 && !("UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Status_Code = Failure_Code;                        t_Error_Code = 520;                        t_Error_Message = "Lot is completely scrapped. Only UNSCRAP, UNTERMINATE or CHANGE QTY action allowed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    /* --moved above                                     if upper(t_lot_rec.action_code) not in (RELEASE,CANCEL) and t_status_type =6                                     then                                     -- release the job                                     update wip_discrete_jobs                                     set status_type =3                                     where wip_entity_id =t_wip_entity_id                                     and   organization_id = t_organization_id;                                     --update t_lots also                                     select unique_id                                     into t_unique_id                                     from t_lots                                     where lot_id = t_lot_rec.lot_id                                     and factory_id = t_factory_id                                     and status =H;                                     update t_lots                                     set    status=A                                     where unique_id=t_unique_id;                                     update t_oracle_jobs                                     set active_flag=A                                     where lot_id=t_unique_id;                                     insert into t_lot_properties_api                                     values( t_lot_rec.transaction_id,                                     TRINITIeDapterAutoReleaseForRecovery,                                     Job-||t_job_name||- AutoReleased by TRINITIeDapter from Hold Status due to transaction-||t_lot_rec.transaction_id);                                     end if;                                     */                    if (t_Lot_Rec.Action_Code.toUpperCase().equals("RELEASE") && t_Status_Type == 3) {                        procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- check the interface                    if (x_Track_In_Oracle == 1) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name before check Lot Interface: " + t_Job_Name);                        // --(Tri2: IS023931)1st Jun2010 MohanVamsi modified the variable as X_Wip_Entity_Id is always null                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Job_Name, // X_WIP_ENTITY_ID,                        t_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status after check Lot Interface: " + t_Status_Code);                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // check interaface for track in oracle                }                // validating the parent lots api                // ------------------end of tpla validation-------------------                t_Stmt_Num = 630;                // -- action codes                if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    t_Proceed = false;                    try {                        Sql = "SELECT  Lot_Id, Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, H )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.Lot_Id = resultSet.getString(1);                            t_Unique_Id = resultSet.getInt(2);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Proceed = true;                    }                    Sql = "SELECT  Upper ( t_Lot_Rec.Action_Code) From Dual";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Action = resultSet.getString(1);                    }                    if (x_Track_In_Oracle == 1) {                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        logger.debug("T_Transact_Lots: Status Code after Get Lot Item: " + t_Status_Code);                        if (t_Status_Code != Success_Code) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Code    = ? , " + " Error_Message = ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Status_Code);                            preparedStatement.setObject(2, t_Error_Code);                            preparedStatement.setObject(3, t_Error_Message);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (!t_Proceed) {                            // -- check if lot already exists                            procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                                t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                            }                            if (procedureParams_OutputMap.get("o_Job_Name") != null) {                                t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                            }                            if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                                t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                            }                            if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                                x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                            }                            if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                                t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                            }                            if (procedureParams_OutputMap.get("o_Status_Type") != null) {                                t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                            }                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                t_Proceed = true;                                // --**** 2                            } else {                                if (t_Status_Type == 1) {                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before calling T_Release_Wip_Lot");                                    procedureParams_OutputMap = tltAdatptSubObject.t_Release_Wip_Lot(t_Wip_Entity_Id, t_Organization_Id.toString(), t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Message, t_Error_Code, null);                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 640;                                    Log_Msg = "Calling Xtended_validations at stmt no:" + t_Stmt_Num;                                    procedureParams_OutputMap = Log_Message(Log_Msg);                                    logger.debug(Log_Msg);                                    // --material consumption                                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, x_Inventory_Item_Id, // ****9 uom_code is changed to new_uom_code                                    t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, "RELEASE", t_Status_Code, t_Error_Code, t_Error_Message, // **** 12 to execute t_get_current_operation properly                                    10, // **** 12 to execute t_get_current_operation properly                                    t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, // **** 11to capture change routing in start                                    i_User_Id);                                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                                    }                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    if (t_Status_Code == Failure_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Status_Code = Success_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // -- to track error messages , like routing not there                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Error_Code    = ? , " + " Error_Message = ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Error_Code);                                    preparedStatement.setObject(2, t_Error_Message);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // status type 1                                t_Proceed = true;                            }                            if (t_Inventory_Item_Id == x_Inventory_Item_Id) {                                if (t_Auto_Recover == true) {                                    /*                                             insert into t_lot_properties_api                                             values                                             (t_lot_rec.transaction_id,                                             TRINITIeDapterDuplicateLotFromMES-||t_lot_rec.transaction_id,                                             Duplicate for existing MES lot/Oracle Job-||t_job_name||-transaction_id-||t_lot_rec.transaction_id                                             );                                             */                                    procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Duplicate Lot from MES, Ignored by Lot eDapter");                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Duplicate Lot from MES- Start ignored by TRINITI eDapter " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Success_Code);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                } else {                                    t_Status_Code = Success_Code;                                    t_Error_Code = 10000;                                    t_Error_Message = "T_Transact_Lots: Cannot start already existing lot: " + t_Lot_Rec.Lot_Id;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        }                        // if t_proceed is false                    } else {                        // --*****Lot type not tracked in Oracle started after create                        if (!t_Proceed && t_Lot_Rec.Action_Code.toUpperCase().equals("START")) {                            t_Status_Code = Success_Code;                            // --t_error_code  := 5880;                            t_Error_Message = "Lot type not tracked in Oracle";                            t_Status_Code = Success_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            Sql = "UPDATE t_Lots Set Status = A Where Unique_Id = ? ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // track in oracle is yes                    t_Stmt_Num = 650;                    if (t_Proceed) {                        // -- get the item code for the raw material to be issued/backflushed                        try {                            Sql = "SELECT  x " + " From t_Lot_Types " + " Where Factory_Id = ? " + " And Lot_Type = " + " Nvl  (  t_Lot_Rec.New_Lot_Type, ? )  " + // for differentiating between eng. and prod lots. no consumption                            " And Backflush_Flag = Y   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Factory_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Old_Lot_Type);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            // --for eng lots                            // -- Hari K, March 07,  Prevent starts if no child record data for backflush flag =Y                            if (t_Dummy.equals("x") && t_Lot_Rec.Action_Code.equals("START")) {                                try {                                    Sql = "SELECT  x " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And  Rownum = 1";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    t_Error_Message = "Cannot Consume-No Record Found in TCLA for this txn";                                    t_Error_Code = 650;                                    t_Status_Code = Failure_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            t_Stmt_Num = 660;                            Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                            procedureParams_OutputMap = Log_Message(Log_Msg);                            logger.debug(Log_Msg);                            procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                            (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, null, null, null, null, null);                            if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            t_Stmt_Num = 670;                            if (t_Status_Code == Failure_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } else if (t_Status_Code == Reject_Code) {                                // no consumption                                t_Consume = "NC";                            } else if (t_Status_Code == Success_Code) {                                t_Consume = null;                            }                            if (("CREATE".equals(t_Lot_Rec.Action_Code))) {                                t_Consume = "NC";                            }                            if (((t_Consume_Flag != null ? t_Consume_Flag : 0) == 0)) {                                t_Consume = "NC";                            }                            if (t_Consume.equals("NC") && t_Lot_Rec.Action_Code.equals("START") && t_Consume_Flag == 1) {                                t_Status_Code = Failure_Code;                                t_Error_Code = 2246;                                t_Error_Message = "Fail in consumption. Check T_Child_Lots_Api for this transaction";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Consume: " + t_Consume);                            procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, // **** 3                            "START", i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, t_Consume);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Action, i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, "NC");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        }                    }                    /*handled before calling start lot api                             if t_consume =NC                             then                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             if t_status_code =success_code                             then                             t_error_message :=Consumption was not done for this Lot.Check t_child_lots_api for this transaction;                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             end if;                             end if;                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             */                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: After start Lot T_Status_Code: " + t_Status_Code);                    if (t_Status_Code == Success_Code) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Update_Oracle_Job try{s");                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                        }                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                        }                        logger.debug("T_Transact_Lots: T_Update_Oracle_Job ends");                    }                    procedureParams_OutputMap = // Deepak 13 Nov,02                    tLotUtilsObject.T_Update_Txn_Status(// Deepak 13 Nov,02                    t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // action is start                // --------XTENDED VALIDATIONS                t_Stmt_Num = 680;                if (("COMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    logger.debug(Log_Msg);                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code || t_Proceed == false) {                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    if (t_Merge_Flag == true) {                        t_Lot_Rec.Action_Code = "MERGE";                    }                }                t_Stmt_Num = 690;                if (("MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Operation_Seq_Num: " + t_Operation_Seq_Num);                    try {                        Sql = "SELECT  Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, t_Operation_Seq_Num);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            x_Wip_Qty = resultSet.getInt(1);                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: x_wip_qty: " + x_Wip_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.action_code: " + t_Lot_Rec.Action_Code);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                    } catch (No_Data_Found e) {                        logger.error(e);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: NO DATA found for UNTERMINATE/SCRAP");                        if (("UNSCRAP".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code) || "CHANGE QTY".equals(t_Lot_Rec.Action_Code))) {                            x_Wip_Qty = 0;                        } else {                            t_Status_Code = Reject_Code;                            t_Error_Code = 910;                            t_Error_Message = "Error fetching qty from wip_operations for wip_entity_id-" + t_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                t_Stmt_Num = 700;                if (t_Lot_Rec.Action_Code.equals("UNTERMINATE") && x_Wip_Qty > 0) {                    if (t_Lot_Rec.New_Txn_Qty == x_Wip_Qty) {                        t_Status_Code = Success_Code;                        // processing already done or termination did not happen in Oracle                        t_Error_Message = "IG-UP.";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // -- for unscrap- full qty after unscrap comes in tpla                // -- unterminate can have diff qty if extract stopped                // -- unterminate precedes an unscrap action                if (("UNSCRAP".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Quantity_Scrapped " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    preparedStatement.setObject(2, t_Operation_Seq_Num);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Scrapped_Qty = resultSet.getInt(1);                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_operation_seq_num-" + t_Operation_Seq_Num);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_scrapped_qty-" + t_Scrapped_Qty);                }                if (t_Lot_Rec.Action_Code.equals("UNSCRAP")) {                    t_Unscrap_Qty = t_Lot_Rec.New_Txn_Qty - x_Wip_Qty;                    if (t_Unscrap_Qty > t_Scrapped_Qty) {                        t_Lot_Rec.Action_Code = "CHANGE QTY";                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: unscrap resulting in cq");                    } else if (t_Unscrap_Qty <= t_Scrapped_Qty) {                        t_Lot_Rec.Action_Code = "UNSCRAP";                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: unscrap resulting in us");                    } else if (t_Unscrap_Qty == 0) {                        t_Status_Code = Success_Code;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                t_Stmt_Num = 710;                // ---------MOVE/UNDO MOVE                if ((!t_Lot_Rec.Action_Code.toUpperCase().equals("UNTERMINATE"))) {                    t_Undo = false;                }                if (("MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOMOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: start move");                    if (t_Lot_Rec.New_Operation == null && t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE")) {                        t_Status_Code = Failure_Code;                        t_Error_Code = 4170;                        t_Error_Message = "New Operation cannot be null for move transactions";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 712;                    // --start jump from last operation. Oracle bug: cannot jump from last operation. So undo first                    if (t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE")) {                        Sql = // operation_sequence_id                        "SELECT  Standard_Operation_Id  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, 0);                        preparedStatement.setObject(3, 0);                        preparedStatement.setObject(4, 0);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wo_Std_Op_Id = resultSet.getInt(1);                        }                        try {                            // --check if this is last operation                            Sql = "SELECT  Bos.Operation_Seq_Num " + " From Bom_Operation_Sequences Bos, Wip_Discrete_Jobs Wdj " + // Deepak 18 Jan,03                            " Where Bos.Standard_Operation_Id = ?  " + // Kunal 24 Jan,03                            " And Wdj.Wip_Entity_Id = ?  " + " And Wdj.Common_Routing_Sequence_Id = " + // Kunal 24 Jan,03                            " Bos.Routing_Sequence_Id  " + // --   where   bos.operation_sequence_id=t_operation_seq_id  --ok since this is last operation                            " And Trunc  (  ? )  Between " + " Trunc  (  Bos.Effectivity_Date )  And " + // Deepak 22 Feb, 03                            " Nvl  (  Bos.Disable_Date,   (  ? + ? )  )   " + // --   and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1))                            " And Bos.Operation_Sequence_Id Not In " + "  (  Select From_Op_Seq_Id " + " From Bom_Operation_Networks " + " Where From_Op_Seq_Id = Bos.Operation_Sequence_Id )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wo_Std_Op_Id);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(5, 1);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Operation_Seq_Num = resultSet.getInt(1);                            }                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = // bos.operation_sequence_id  "+                            " select bos.standard_operation_id  " + " from   bom_operation_sequences bos ,    " + "     wip_discrete_jobs     wdj     " + " where  wdj.wip_entity_id     =   " + t_Wip_Entity_Id + "  " + " and     bos.routing_sequence_id   =  wdj.common_routing_sequence_id  " + " and    trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar , 03                            " + 1 )  )   " + " and    " + "bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Step_Seq_Field + "  =  " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Bos_Std_Op_Id )  ; //x_operation_seq_id )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_step_seq",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                procedureParams_OutputMap = Log_Message("x_status_code-" + x_Status_Code);                                if (x_Status_Code != 1) {                                    // null; //jump  of ring. but first need to undo last operation                                } else {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Bos_Std_Op_Id); //x_operation_seq_id);                                    // x_operation_seq_id = resultSet.getnull ( 1);                                    t_Bos_Std_Op_Id = resultSet.getInt(1);                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 5800;                                t_Error_Message = "TLTHREAD: Error executing dynamic sql " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            /*                                                 t_new_operation:=t_lot_rec.new_operation;                                                 t_operation_sequence:=t_lot_rec.operation_sequence;                                                 t_new_routing1:=t_lot_rec.new_routing;                                                 begin                                                 if t_routing_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_operation_sequence;                                                 elsif t_step_seq_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_new_routing1;                                                 elsif t_routing_field is null and t_step_seq_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation;                                                 else                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_new_routing1,t_operation_sequence;                                                 end if;                                                 exception                                                 when no_data_found then                                                 x_operation_seq_id:=null; --jump out of routing. but first need to undo last operation                                                 when others then                                                 t_status_code   := failure_code;                                                 t_error_code  := sqlcode;                                                 t_error_message := Error executing dynamic sql ||t_sql_string;                                                 tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                 null,                                                 t_status_code,                                                 t_error_code,                                                 t_error_message,                                                 SET                                                 );                                                 goto end_transact_loop;                                                 end;                                                 */                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_wo_std_op_id-" + t_Wo_Std_Op_Id);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_bos_std_op_id-" + t_Bos_Std_Op_Id);                            // --  if t_operation_seq_id!=x_operation_seq_id or x_operation_seq_id is null                            if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id || t_Bos_Std_Op_Id == null) {                                // --check if this is jump                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: This is Jump from last operation");                                t_Undo = true;                                t_Lot_Rec.Undo_Flag = "Y";                                // --        update t_parent_lots_api                                // --        set undo_flag =Y                                // --        where transaction_id =t_lot_rec.transaction_id;                            }                        } catch (No_Data_Found e) {                            logger.error(e);                        }                    }                    t_Stmt_Num = 720;                    // --  x_operation_seq_num,                    // --  t_intra_op_step,                    procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // --    tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                    // --            null,                    // --            t_status_code,                    // --            t_error_code,                    // --            t_error_message,                    // --            GET                    // --                );                    if (t_Status_Code == Success_Code) {                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE") && t_Undo) {                            // --check if this is jump                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: This is Jump from last operation, Reset code");                            t_Status_Code = Reset_Code;                            // --        update t_parent_lots_api                            // --        set undo_flag =null                            // --        where transaction_id =t_lot_rec.transaction_id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                        }                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                        }                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --------- MOVE/UNDO MOVE                t_Stmt_Num = 730;                // ---ADJUST QTY                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CHANGEQTY")) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_original_qty-" + t_Original_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.x_wip_qty-" + x_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                        procedureParams_OutputMap = Log_Message("3.x_wip_qty-" + x_Wip_Qty);                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty - t_Lot_Rec.New_Txn_Qty;                        if (t_Lot_Position.equals("W")) {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: inside wrap-ti_wip_entity_name" + t_Wip_Entity_Name);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: inside wrap-t_job_name" + t_Job_Name);                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, t_Wip_Entity_Id, // t_wip_entity_name,                            t_Job_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.New_Txn_Qty, // t_lot_rec.new_uom_code,                            t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else if (t_Lot_Position.equals("I")) {                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, t_Inventory_Item_Id, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                            t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // --update inside the procedure                            // -- handle unscrap there                            // -- dummy this one for the time being                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } else if (x_Wip_Qty == t_Lot_Rec.New_Txn_Qty) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (x_Wip_Qty == 0) {                        t_Lot_Rec.Action_Code = "UNSCRAP";                        t_Unscrap_Qty = t_Lot_Rec.New_Txn_Qty;                    }                }                // -- ADJUST QTY                t_Stmt_Num = 740;                // --------------------------SPLIT STARTS--------------------------------------                // -- handles only 2 resulting lots, chk later for multiple lots                if (("SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // ---Added by Dheeraj                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code || t_Proceed == false) {                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // ---Addition Complete                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 1306 before call to split- t_original_qty-" + t_Original_Qty);                    Sql = "SELECT  Upper ( t_Lot_Rec.Action_Code) From Dual ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Action = resultSet.getString(1);                    }                    if (t_System_Item_Flag == 2) {                        Sql = "SELECT  Nvl ( New_Enterprise_Item, Old_Enterprise_Item) " + " From t_Lot_Items_Api " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Item1 = resultSet.getString(1);                        }                        Sql = "UPDATE t_Child_Lots_Api " + " Set Enterprise_Item = ? " + " Where Transaction_Id = ? " + " And Enterprise_Item == null  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Item1);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                    } else {                        Sql = "SELECT  Nvl ( New_Item, Old_Item) " + " From t_Lot_Items_Api " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Item2 = resultSet.getString(1);                        }                        Sql = "UPDATE t_Child_Lots_Api " + " Set Item = ? " + " Where Transaction_Id = ? " + " And Item == null  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Item2);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                    }                    t_Stmt_Num = 750;                    // -- if translation reqd, must be done                    // -- FW specific- fwlot has only updated qty                    if (t_Lot_Rec.Action_Code.equals("SPLIT")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: x_wip_qty in split section-" + x_Wip_Qty);                        // used when new txn qty comes as zero                        t_Lot_Rec.Old_Txn_Qty = t_Lot_Rec.New_Txn_Qty;                        // to trace back                        t_Parent_Qty = x_Wip_Qty;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 1.t_parent_qty in split section-" + t_Parent_Qty);                        procedureParams_OutputMap = tedutilsObject.T_Get_Item_Conversion(t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Routing, // Deepak 22 Mar, 03                        t_Lot_Rec.Transaction_Date, // Nvl ( t_Lot_Rec.New_Uom_Code,                        // t_Lot_Rec.Old_Uom_Code),                        t_Lot_Rec.New_Uom_Code != null ? t_Lot_Rec.New_Uom_Code : t_Lot_Rec.Old_Uom_Code, t_Parent_Qty, t_Oracle_Uom, t_Status_Code, t_Error_Code, t_Error_Message, // reverse                        "R");                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Parent_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code == Failure_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.t_parent_qty in split section-" + t_Parent_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_parent_qty-" + t_Parent_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                        // -- call move proc                        // -- for change qty, recover the lot to the transactable status                        try {                            Sql = "SELECT  Sum ( Txn_Qty) " + " From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Total_Child_Qty = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        // error condition                        t_Stmt_Num = 760;                        if (t_Parent_Qty != t_Total_Child_Qty) {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move");                            // --  t_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Total_Child_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // --      tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                            // --              NULL,                            // --              t_status_code,                            // --              t_error_code,                            // --              t_error_message,                            // --              GET                            // --                 );                            if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                t_Error_Code = 4577;                                t_Error_Message = "1.Error executing t_move_lot_api for split-" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                t_Status_Code = Reset_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --  goto end_transact_loop;                        }                        /*                                                     begin                                                     select sum(txn_qty)                                                     into t_child_qty                                                     from t_child_lots_api                                                     where transaction_id = t_lot_rec.transaction_id                                                     and   lot_id       != t_lot_rec.lot_id;                                                     dbms_output.put_line(wrapper-split-t_child_qty-||t_child_qty);                                                     dbms_output.put_line(wrapper-split-t_total_child_qty-||t_total_child_qty);                                                     if t_total_child_qty != t_lot_rec.new_txn_qty --make qty same for lot in tpla and tcla                                                     then                                                     dbms_output.put_line(wrapper-split-t_total_child_qty-update:2||t_total_child_qty);                                                     update t_child_lots_api tcl                                                     set txn_qty = t_parent_qty - t_child_qty                                                     where transaction_id = t_lot_rec.transaction_id                                                     and lot_id       = t_lot_rec.lot_id;                                                     end if;                                                     exception                                                     when no_data_found then                                                     null;                                                     end;                                                     */                        // update tpla with actual wip qty                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty;                        t_Stmt_Num = 770;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.old_txn_qty-" + t_Lot_Rec.Old_Txn_Qty);                        // -- site specific, parent comes with zero qty and complete                        // -- qty is in the child,in effect a change lotid would suffice                        // --    if t_lot_rec.old_txn_qty =0                        // --    then                        try {                            Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Lot_Id != ? " + " And Txn_Qty = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Parent_Qty);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Child_Lot = resultSet.getString(1);                            }                            /*    --Deepak 06 Dec,02                                                         delete from t_child_lots_api                                                         where  transaction_id = t_lot_rec.transaction_id                                                         and lot_id       = t_lot_rec.lot_id;                                                         */                            /*                                                         update t_parent_lots_api                                                         set new_txn_qty = t_parent_qty                                                         where transaction_id = t_lot_rec.transaction_id;                                                         */                            t_Lot_Rec.New_Txn_Qty = t_Parent_Qty;                            t_Lot_Rec.New_Lot_Id = t_Child_Lot;                            t_Lot_Rec.Action_Code = "CHANGE LOTID";                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        // --    end if;                        // -- chk if actual good split has happend                        Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " Order By Line_Number " + // -- order by decode(lot_id,t_lot_rec.lot_id,1,2)                        " ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet15 = preparedStatement.executeQuery();                        while (resultSet15.next()) {                            Integer Ch_Rec_Transaction_Id = resultSet15.getInt("Transaction_Id");                            Integer Ch_Rec_Lot_Id = resultSet15.getInt("Lot_Id");                            Integer Ch_Rec_Line_Number = resultSet15.getInt("Line_Number");                            Sql = "UPDATE t_Child_Lots_Api " + " Set Status_Code = ? " + " Where Transaction_Id = ? " + " And Line_Number = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Reset_Code);                            preparedStatement.setObject(2, Ch_Rec_Transaction_Id);                            preparedStatement.setObject(3, Ch_Rec_Line_Number);                            preparedStatement.executeUpdate();                        }                    }                    // split                    t_Stmt_Num = 780;                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wip_Qty = resultSet.getInt(1);                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_wip_qty-" + t_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    // -- call move proc                    // -- for change qty, recover the lot to the transactable status                    if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3) || t_Wip_Qty != t_Lot_Rec.New_Txn_Qty && ("SPLIT".equals(t_Action) || "CHANGE LOTID".equals(t_Action))) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move");                        // --  t_operation_seq_num,                        // --  t_intra_op_step,                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // --    tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                        // --            null,                        // --            t_status_code,                        // --            t_error_code,                        // --            t_error_message,                        // --            GET                        // --               );                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            t_Error_Code = 4715;                            t_Error_Message = "2.Error executing t_move_lot_api for split-" + t_Error_Message;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                            t_Status_Code = Reset_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- goto end_transact_loop;                    }                    // intraop step not in 1,3                    // -- loop for the child and chk whether the child lot already exists                    // -- only one can exist- FW helps for now                    // -- check if the child lots require translation --take from ur original wrapper --later                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to split- t_original_qty-" + t_Original_Qty);                    t_Stmt_Num = 790;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to split- qty-" + t_Lot_Rec.New_Txn_Qty);                    // -- call the split proc                    procedureParams_OutputMap = tltAdatptSubObject.t_Split_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Action_Code, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // --  tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                    // --           null,                    // --           t_status_code,                    // --           t_error_code,                    // --           t_error_message,                    // --           GET                    // --          );                    if (t_Status_Code == Failure_Code) {                        t_Error_Code = 4781;                        t_Error_Message = "Error executing t_split_wip_lot_api-" + t_Error_Message;                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Txn_Qty > ? " + " Order By Line_Number ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(2, 0);                        resultSet16 = preparedStatement.executeQuery();                        while (resultSet16.next()) {                            Integer Ch_Rec_Transaction_Id = resultSet16.getInt("Transaction_Id");                            Integer Ch_Rec_Lot_Id = resultSet16.getInt("Lot_Id");                            Integer Ch_Rec_Line_Number = resultSet16.getInt("Line_Number");                            try {                                t_Stmt_Num = 800;                                Sql = "SELECT  Toj.Wip_Entity_Id " + " From t_Lots Tl, t_Oracle_Jobs Toj " + " Where Tl.Lot_Id = ? " + " And Tl.Status = A " + " And Tl.Factory_Id = ? " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Factory_Id = Tl.Factory_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, Ch_Rec_Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Child_Wip_Entity_Id = resultSet.getInt(1);                                }                                if (t_Wip_Entity_Id != t_Child_Wip_Entity_Id) {                                    procedureParams_OutputMap = tLotUtilsObject.T_Copy_Lot_Attributes(t_Wip_Entity_Id, t_Child_Wip_Entity_Id, t_Error_Code, t_Error_Message);                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                    }                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            } catch (SQLException e) {                                logger.error(e, e);                                t_Error_Message = "Error: " + e.getSQLState() + ", before t_copy_lot_attributes";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                    }                }                // action is split .toUpperCase()                // --------------------------SPLIT ENDS--------------------------------------                // -------------------------MERGE------------------------------------------------                t_Stmt_Num = 810;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("MERGE")) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Merge Starts ");                    try {                        Sql = "SELECT  Lot_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Number = resultSet.getString(1);                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_lot_number" + t_Lot_Number);                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Lot_Number = null;                    } catch (Too_Many_Rows e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = 1335;                        t_Error_Message = "Multiple active lots in T_Lots.";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --Checking if lot ids in TCLA exsists in T_LOTS----                    Sql = "SELECT  Lot_Id, Transaction_Id, Txn_Qty " + " From t_Child_Lots_Api Tcl " + " Where Tcl.Transaction_Id = " + " ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet17 = preparedStatement.executeQuery();                    while (resultSet17.next()) {                        Integer Merge_Child_Rec_Txn_Qty = resultSet17.getInt("Txn_Qty");                        Integer Merge_Child_Rec_Lot_Id = resultSet17.getInt("Lot_Id");                        try {                            logger.debug("T_Transact_Lots: MERGE_CHILD_REC Txn Qty: " + Merge_Child_Rec_Txn_Qty);                            t_Stmt_Num = (int) 810.01;                            Sql = "SELECT  X " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, Merge_Child_Rec_Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            try {                                t_Stmt_Num = (int) 810.02;                                Sql = "SELECT  Y " + " From Apps.Wip_Discrete_Jobs " + " Where Lot_Number = ? " + " And Status_Type = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, Merge_Child_Rec_Lot_Id);                                preparedStatement.setObject(2, 3);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                /* IF T_DUMMY = Y                                                             THEN                                                             T_T_LOTS_ENTRY(MERGE_CHILD_REC.LOT_ID,                                                             MERGE_CHILD_REC.TRANSACTION_ID,                                                             T_FACTORY_ID);                                                             END IF;*/                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Reject_Code;                                t_Error_Code = 782;                                t_Error_Message = "Transaction on UnCreated Lot ID" + t_Lot_Rec.Lot_Id;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                        }                    }                    // --Checking if lot ids in TCLA exsists in T_LOTS----                    // --validate the resulting job                    if (t_Lot_Number != null) {                        t_Stmt_Num = (int) 810.03;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Validate_Lot_Api st Stmt no: " + t_Stmt_Num);                        /*   DBMS_OUTPUT.PUT_LINE(At Stmt No 810.03:  T_PARENT_WIP_ENTITY_ID: || T_PARENT_WIP_ENTITY_ID||                                                     , T_LOT_REC.NEW_TXN_QTY: || T_LOT_REC.NEW_TXN_QTY); */                        procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Parent_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, t_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            t_Parent_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                            t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                        }                        if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                            t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                            t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                            t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (t_Job_Name == null) {                            // --Deepak 13 Dec,02                            // Goto End_Transact_Loop; //not tracked in oracle                            break end_Transact_Loop;                        }                        if (t_Job_Name != null) {                            // -- check the interface                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_Check_Lot_Interface");                            procedureParams_OutputMap = // i_lot_id                            tLotUtilsObject.T_Check_Lot_Interface(// i_lot_id                            t_Job_Name, t_Parent_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if (t_Status_Code != Api_Success_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Stmt_Num = 820;                            procedureParams_OutputMap = Log_Message("T_Transact_Lots:  T_Intra_Op_Step:" + t_Intra_Op_Step + ", at Stmt no: " + t_Stmt_Num);                            if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3)) {                                // --  x_operation_seq_num,                                // --  t_intra_op_step,                                procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Parent_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                }                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                }                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                }                                // --      tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                // --              null,                                // --              t_status_code,                                // --              t_error_code,                                // --              t_error_message,                                // --              GET                                // --                  );                                if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                    t_Error_Code = 4970;                                    t_Error_Message = "1.Error executing t_move_lot_api for merge-" + t_Error_Message;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                    t_Status_Code = Reset_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            // move if not in 1,3                        }                        // job name is null                    } else {                        t_Stmt_Num = 830;                        t_Wip_Entity_Id = null;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots:  Before T_Get_Lot_Item, at Stmt No: " + t_Stmt_Num);                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            t_Error_Code = 1425;                            t_Error_Message = "Error- t_transact_lots- in fetching lot item";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // ---Added by Dheeraj                    // --Merge does not has value of t_operation_seq_num                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Wip entity id: " + t_Wip_Entity_Id);                    /*  select operation_seq_num                                                 into   t_operation_seq_num                                                 from wip_operations                                                 where wip_entity_id =t_wip_entity_id                                                 and  ( quantity_in_queue >0                                                 or quantity_running >0                                                 or quantity_waiting_to_move >0                                                 );                                                 */                    /*--commented temporarily 2 Oct 2007                                                 t_xtended_validations ( t_factory_id,                                                 t_lot_rec.transaction_id,                                                 t_lot_rec,                                                 null,                                                 t_lot_rec.lot_id,                                                 t_organization_id,                                                 t_inventory_item_id,                                                 t_lot_rec.new_uom_code,                                                 t_lot_rec.new_txn_qty,                                                 null,                                                 upper(t_lot_rec.action_code),                                                 t_status_code,                                                 t_error_code,                                                 t_error_message,                                                 t_operation_seq_num,                                                 t_operation_field,                                                 t_routing_field,                                                 t_step_seq_field                                                 );                                                 if t_status_code !=success_code or t_proceed =false                                                 then                                                 goto end_transact_loop;                                                 end if;                                                 */                    // ---Addition Complete                    // --loop on child lots api                    t_Need_Xlation = false;                    t_Total_Qty = 0;                    t_First_Time = false;                    Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " Order By Line_Number ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet18 = preparedStatement.executeQuery();                    while (resultSet18.next()) {                        String Child_Rec_Lot_Id = resultSet18.getString("Lot_Id");                        Integer Child_Rec_Line_Number = resultSet18.getInt("Line_Number");                        Integer Child_Rec_Transaction_Id = resultSet18.getInt("Transaction_Id");                        Integer Child_Rec_Txn_Qty = resultSet18.getInt("Txn_Qty");                        t_Stmt_Num = 840;                        // -- validate the child lot                        procedureParams_OutputMap = Log_Message("T_Transact_Lots:  Before T_Validate_Lot_Api, at Stmt no: " + t_Stmt_Num);                        /*   DBMS_OUTPUT.PUT_LINE(At Stmt No 840:  T_WIP_ENTITY_ID: || T_WIP_ENTITY_ID||                                                     , CHILD_REC.TXN_QTY: || CHILD_REC.TXN_QTY); */                        // --Added by MohanVamsi 2Feb10 to get the Qty from Oracle when Qty not provided                        logger.debug("T_Transact_Lots: t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        logger.debug("T_Transact_Lots: Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        if (Child_Rec_Txn_Qty == null) {                            logger.debug("Inside T_Transact_Lots:  Wip_entity_Id : " + t_Wip_Entity_Id);                            Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                Child_Rec_Txn_Qty = resultSet.getInt(1);                            }                        }                        // --Added till here by MohanVamsi 2Feb10                        procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, Child_Rec_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, x_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            Child_Rec_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                            t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                        }                        if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                            t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                            t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                            t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        logger.debug("T_Transact_Lots: After Change Wip_entity_Id : " + t_Wip_Entity_Id);                        logger.debug("T_Transact_Lots: After Change t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        logger.debug("T_Transact_Lots: After Change Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Change t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Change Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        if (t_Job_Name == null) {                            // --Deepak 13 Dec,02                            // Goto End_Transact_Loop; //not tracked in oracle                            break end_Transact_Loop;                        }                        /*--merge                                                     --if t_job_name is null and child_rec.lot_id != t_lot_rec.lot_id                                                     --then                                                     update t_lots                                                     set status =C                                                     remarks =Lot closed due to merge transaction-||t_lot_rec.transaction_id                                                     where lot_id = child_rec.lot_id                                                     and factory_id = t_factory_id                                                     and status =A;                                                     tltadapt.t_update_lot_properties(t_lot_rec.transaction_id,child_rec.lot_id,t_factory_id);                                                     --end if;                                                     */                        t_Stmt_Num = 850;                        // -- check the interface                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name before T_Check_Lot_Interface" + t_Job_Name + ", at Stmt No: " + t_Stmt_Num);                        procedureParams_OutputMap = // i_lot_id                        tLotUtilsObject.T_Check_Lot_Interface(// i_lot_id                        t_Job_Name, t_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Total_Qty = t_Total_Qty + Child_Rec_Txn_Qty;                        if (t_Inventory_Item_Id != x_Inventory_Item_Id) {                            t_Need_Xlation = true;                            t_Stmt_Num = 860;                            // --for change routing/item at different operation in new routing than existing one                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = " select bos.operation_seq_num   " + " from bom_operation_sequences bos , bom_operational_routings bor  " + " where bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  " + " and bos.routing_sequence_id = bor.routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                            " + 1 )  )   " + // -   " and trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                            " and bor.assembly_item_id =   " + t_Inventory_Item_Id + "  " + " and bor.organization_id =  " + t_Organization_Id + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + "and bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + "and bos. " + t_Step_Seq_Field + "  =   " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            /*                                                            t_new_operation:=t_lot_rec.new_operation;                                                            t_operation_sequence:=t_lot_rec.operation_sequence;                                                            t_new_routing1:=t_lot_rec.new_routing;                                                            try{                                                            if t_routing_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_operation_sequence;                                                            elsif t_step_seq_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_new_routing1;                                                            elsif t_routing_field is null and t_step_seq_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id;                                                            else                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_new_routing1,t_operation_sequence;                                                            end if;                                                            exception                                                            when no_data_found then                                                            null;   //use existing operation sequence of lot passed from t_validate_lot_api                                                            when others then                                                            t_status_code   := failure_code;                                                            t_error_code  := sqlcode;                                                            t_error_message := "Error executing dynamic sql "||t_sql_string;                                                            tLotUtilsObject.T_Update_Txn_Status (  t_lot_rec.transaction_id,                                                            null,                                                            t_status_code,                                                            t_error_code,                                                            t_error_message,                                                            "SET"                                                            );                                                            goto end_transact_loop;                                                                                                                        */                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Operation_Seq_Num )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_inventory_item_id",t_Inventory_Item_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_organization_id",t_Organization_Id);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation_sequence",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                if (x_Status_Code != 1) {                                    // --      null;   --use existing operation sequence of lot passed from t_validate_lot_api                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    // Added by Suchi                                    Sql = "INSERT Into t_Debug Values  ( 5321, Sysdate, t_Sql_String) ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.executeUpdate();                                    connection.commit();                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 5321;                                    t_Error_Message = "XLATE: Routing or Operation doesnot exists in oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                } else {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Operation_Seq_Num);                                    t_Operation_Seq_Num = resultSet.getInt(1);                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 6790;                                t_Error_Message = "Error executing dynamic sql " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Stmt_Num = 870;                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_Xlate_Wip_Lot_Api at Stmt no: " + t_Stmt_Num);                            procedureParams_OutputMap = tltAdatptSubObject.t_Xlate_Wip_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, t_Wip_Entity_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec.New_Routing, t_Operation_Seq_Num, t_Intra_Op_Step, Child_Rec_Txn_Qty, t_Uom_Code, t_Inventory_Item_Id, i_User_Id, t_Lot_Rec.Transaction_Date, // Deepak 02 Dec,02                            "CHANGE ROUTING", t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            /*                                                     insert into t_lot_properties_api                                                     values                                                     ( t_lot_rec.transaction_id,                                                     TRINITIeDapterLotXBME-||t_lot_rec.transaction_id,                                                     Wip entity id-||t_wip_entity_id||-was translated by TRINITI LOTS eDapter                                                      );                                                     */                        }                        // --removed if. should do operation check for each lot                        // --  if t_intra_op_step not in (1,3) or t_need_xlation =true                        // --  then                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_id for Current Operation -" + t_Wip_Entity_Id);                        t_Stmt_Num = 880;                        procedureParams_OutputMap = tLotUtilsObject.T_Get_Current_Operation(t_Lot_Rec.Transaction_Id, null, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, t_Create_Standard_Operations, t_Standard_Operations_Flag, t_Current_Operation, t_Outside_Resource, t_Current_Routing, t_Current_Operation_Seq, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Operation") != null) {                            t_Current_Operation = (java.lang.String) procedureParams_OutputMap.get("o_Operation");                        }                        if (procedureParams_OutputMap.get("o_Outside_Resource") != null) {                            t_Outside_Resource = (java.lang.String) procedureParams_OutputMap.get("o_Outside_Resource");                        }                        if (procedureParams_OutputMap.get("o_Routing") != null) {                            t_Current_Routing = (java.lang.String) procedureParams_OutputMap.get("o_Routing");                        }                        if (procedureParams_OutputMap.get("o_Operation_Sequence") != null) {                            t_Current_Operation_Seq = (java.lang.String) procedureParams_OutputMap.get("o_Operation_Sequence");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status after Calling T_Get_Current_Operation: " + t_Status_Code);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Current_Operation after T_Get_Current_Operation: " + t_Current_Operation);                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // ---Added by Dheeraj                        if (Child_Rec_Lot_Id != t_Lot_Rec.Lot_Id) {                            // --Merge does not has value of t_operation_seq_num                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Child Wip entity id: " + t_Wip_Entity_Id);                            /*  select operation_seq_num                                                         into   t_operation_seq_num                                                         from wip_operations                                                         where wip_entity_id =t_wip_entity_id                                                         and  ( quantity_in_queue >0                                                         or quantity_running >0                                                         or quantity_waiting_to_move >0                                                         );                                                         */                            procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, Child_Rec_Transaction_Id, t_Lot_Rec, Child_Rec_Line_Number, Child_Rec_Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, Child_Rec_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                            (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                            if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                Child_Rec_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code || t_Proceed == false) {                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // ---Addition Complete                        Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wip_Qty = resultSet.getInt(1);                        }                        // -- move child lot to where merged entity is to be                        if (((t_Lot_Rec.New_Operation != null ? t_Lot_Rec.New_Operation : t_Current_Operation) != t_Current_Operation) || t_Wip_Qty != Child_Rec_Txn_Qty) {                            t_Stmt_Num = 890;                            // -- call move proc                            // -- reqd if the current intraop step is not 1 or 3                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_move_Lot_Api, at Stmt no: " + t_Stmt_Num);                            // --  x_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, Child_Rec_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                t_Error_Code = 5343;                                t_Error_Message = "2.Error executing t_move_lot_api for merge-" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, Child_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                t_Status_Code = Reset_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // operations dont match                        // -- update the child with the wip entity id and the operation seq num                        Sql = "UPDATE t_Child_Lots_Api " + " Set Wip_Entity_Id     = ? , " + " Operation_Seq_Num = ? " + " Where Transaction_Id = " + t_Lot_Rec.Transaction_Id + // use sequence to genarate line no initially;                        " And Line_Number = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, t_Operation_Seq_Num);                        preparedStatement.setObject(3, Child_Rec_Line_Number);                        preparedStatement.executeUpdate();                        if (t_Lot_Rec.Lot_Id == Child_Rec_Lot_Id && t_First_Time == false) {                            t_First_Time = true;                            t_Parent_Qty = Child_Rec_Txn_Qty;                            t_Rep_Operation_Seq_Num = t_Operation_Seq_Num;                        }                    }                    t_Stmt_Num = 900;                    if (t_First_Time == false) {                        t_Parent_Qty = t_Lot_Rec.New_Txn_Qty;                        try {                            Sql = // representative lot                            "SELECT  Wip_Entity_Id, Operation_Seq_Num  " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Line_Number = " + "  (  Select Min  (  Line_Number )  " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Parent_Wip_Entity_Id = resultSet.getInt(1);                                t_Operation_Seq_Num = resultSet.getInt(2);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 5422;                            t_Error_Message = "No row found txn id-" + t_Lot_Rec.Transaction_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Rep_Operation_Seq_Num = t_Operation_Seq_Num;                    }                    t_Stmt_Num = 910;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Merge wip lot procedure starts");                    procedureParams_OutputMap = tltAdatptSubObject.t_Merge_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Parent_Wip_Entity_Id, t_Inventory_Item_Id, t_Rep_Operation_Seq_Num, t_Intra_Op_Step, // - must be present in child lot                    t_Lot_Rec.Lot_Id, t_Parent_Qty, // t_lot_rec.new_uom_code,                    t_Oracle_Uom, t_Total_Qty, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code == Success_Code) {                        t_Stmt_Num = 920;                        try {                            Sql = "SELECT  Toj.Wip_Entity_Id " + " From t_Lots Tl, t_Oracle_Jobs Toj " + " Where Tl.Lot_Id = ? " + " And Tl.Status = A " + " And Tl.Factory_Id = ? " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Factory_Id = Tl.Factory_Id  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            if (t_Wip_Entity_Id != t_Parent_Wip_Entity_Id) {                                procedureParams_OutputMap = tLotUtilsObject.T_Copy_Lot_Attributes(t_Parent_Wip_Entity_Id, t_Wip_Entity_Id, t_Error_Code, t_Error_Message);                                if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                }                                if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                }                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                        } catch (SQLException e) {                            logger.error(e, e);                            t_Error_Message = "Error: " + e.getSQLState() + " - before t_copy_lot_attributes";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // action is merge                // -------------------------MERGE END ------------------------------------------------                t_Stmt_Num = 930;                // -- translate lots                if (("CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEROUTING".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // -- taken out from validate                    // --  if upper(t_lot_rec.action_code) =CHANGE ITEM                    // --  then                    t_Min_Wip_Qty = 0;                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations a " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = " + "  (  Select Min  (  b.Operation_Seq_Num )  " + " From Wip_Operations b " + " Where b.Wip_Entity_Id = a.Wip_Entity_Id )   ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Min_Wip_Qty = resultSet.getInt(1);                    }                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wip_Qty = resultSet.getInt(1);                    }                    if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3) || t_Wip_Qty != t_Lot_Rec.New_Txn_Qty && t_Min_Wip_Qty == 0) {                        // --no need to scrap for first operation. let the next txn do that                        // -- move the lot or scrap/bonus the qty                        // -- chk later                        // --  x_operation_seq_num,                        // --  t_intra_op_step,                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            t_Error_Code = 5561;                            t_Error_Message = "Error executing t_move_lot_api for translate-" + t_Error_Message;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                            t_Status_Code = Reset_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // -- fetch the item to which it is changed                    /*                                             begin                                             select substr(new_item,1,1)                                             into t_dummy                                             from t_lot_items_api                                             where transaction_id =t_lot_rec.transaction_id;                                             update t_lot_items_api tl                                             set new_enterprise_item = nvl(tl.new_item, tl.new_enterprise_item)                                             where transaction_id = t_lot_rec.transaction_id;                                             update t_lot_items_api                                             set new_item =null                                             where transaction_id = t_lot_rec.transaction_id;                                             exception                                             when no_data_found then                                             null;                                             end;                                             */                    // --    end if;-- if change item                    procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, o_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        o_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 940;                    // --for change routing/item at different operation in new routing than existing one                    // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                    t_Sql_String = " select bos.operation_seq_num   " + " from bom_operation_sequences bos , bom_operational_routings bor  " + " where bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  " + " and bos.routing_sequence_id = bor.routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                    " + 1 )  )   " + // " and trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                    " and bor.assembly_item_id =   " + o_Inventory_Item_Id + "  " + " and bor.organization_id =  " + t_Organization_Id + "  ";                    if (t_Routing_Field != null) {                        t_Sql_String = t_Sql_String + "and bos. " + t_Routing_Field + "  =   " + t_Lot_Rec.New_Routing + "  ";                    }                    if (t_Step_Seq_Field != null) {                        t_Sql_String = t_Sql_String + "and bos. " + t_Step_Seq_Field + "  =   " + t_Lot_Rec.Operation_Sequence + "  ";                    }                    /*    t_new_operation:=t_lot_rec.operation_sequence;    t_operation_sequence:=t_lot_rec.operation_sequence;    t_new_routing1:=t_lot_rec.new_routing;    try{    if t_routing_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_operation_sequence;    elsif t_step_seq_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_new_routing1;    elsif t_routing_field is null and t_step_seq_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id;    else    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_new_routing1,t_operation_sequence;    end if;    exception    when no_data_found then    null;   //use existing operation sequence of lot passed from t_validate_lot_api    when others then    t_status_code   := failure_code;    t_error_code  := sqlcode;    t_error_message := "Error executing dynamic sql "||t_sql_string;    tLotUtilsObject.T_Update_Txn_Status (  t_lot_rec.transaction_id,    null,    t_status_code,    t_error_code,    t_error_message,    "SET"    );    goto end_transact_loop;        */                    try {                        // t_Cursor  =  Dbms_Sql.Open_Cursor ;                        // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                        // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Operation_Seq_Num )  ;                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_inventory_item_id",o_Inventory_Item_Id);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_organization_id",t_Organization_Id);                        if (t_Routing_Field != null) {                            // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                        }                        if (t_Step_Seq_Field != null) {                            // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation_sequence",t_Lot_Rec.Operation_Sequence);                        }                        // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                        preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        x_Status_Code = resultSet.getRow();                        resultSet.beforeFirst();                        resultSet.next();                        procedureParams_OutputMap = Log_Message("TLTHREAD: At Stmt 940, x_operation: " + t_Lot_Rec.New_Operation + ", x_inventory_item_id: " + o_Inventory_Item_Id + ", x_organization_id: " + t_Organization_Id + ", X_routing: " + t_Lot_Rec.New_Routing);                        if (x_Status_Code != 1) {                            // --     null;   --use existing operation sequence of lot passed from t_validate_lot_api                            // if  (  Dbms_Sql.Is_Opent_Cursor )                            {                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            }                            // Added by Suchi                            Sql = "INSERT Into t_Debug Values  ( 5321.01, Sysdate, t_Sql_String) ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.executeUpdate();                            connection.commit();                            t_Status_Code = Failure_Code;                            t_Error_Code = (int) 5321.01;                            t_Error_Message = "XLATE: Routing or Operation doesnot exists in oracle";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else {                            // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Operation_Seq_Num);                            t_Operation_Seq_Num = resultSet.getInt(1);                        }                        // Dbms_Sql.Close_Cursor ( t_Cursor);                    } catch (SQLException e) {                        logger.error(e, e);                        // if  (  Dbms_Sql.Is_Opent_Cursor )                        {                            // Dbms_Sql.Close_Cursor ( t_Cursor);                        }                        t_Status_Code = Failure_Code;                        t_Error_Code = 7320;                        t_Error_Message = "Error executing dynamic sql " + t_Sql_String;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 950;                    procedureParams_OutputMap = tltAdatptSubObject.t_Xlate_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec.New_Routing, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, t_Uom_Code, t_Inventory_Item_Id, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec.Action_Code, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                }                // end translate                // -- ----------------------scrap lot------------------------                t_Stmt_Num = 960;                if (("SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // -- the qty sent in is the qty to be scrapped                    try {                        Sql = "SELECT  Wip_Entity_Name " + " From Wip_Entities " + " Where Organization_Id = ? " + " And Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Organization_Id);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wip_Entity_Name = resultSet.getString(1);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = 1410;                        t_Error_Message = "Invalid Wip Entity Id -" + t_Wip_Entity_Id;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    /* ---Added by Dheeraj T_XTENDED_VALIDATIONS(T_FACTORY_ID, T_LOT_REC.TRANSACTION_ID, T_LOT_REC, NULL, T_LOT_REC.LOT_ID, T_ORGANIZATION_ID, T_INVENTORY_ITEM_ID, T_LOT_REC.NEW_UOM_CODE, T_LOT_REC.NEW_TXN_QTY, NULL, UPPER(T_LOT_REC.ACTION_CODE), T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, T_OPERATION_SEQ_NUM, T_OPERATION_FIELD, T_ROUTING_FIELD, T_STEP_SEQ_FIELD); IF T_STATUS_CODE != SUCCESS_CODE OR T_PROCEED = FALSE THEN GOTO END_TRANSACT_LOOP; END IF; ---Addition Complete */                    // --Commented by MohanVamsi as this is not part of Standard Lot eDapter on 9th Jul09                    if (t_Lot_Rec.Action_Code.equals("UNSCRAP")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2063 x_wip_qty: " + x_Wip_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2063 t_lot_rec.new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                        if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                            // -- T_LOT_REC.NEW_TXN_QTY := X_WIP_QTY - T_LOT_REC.NEW_TXN_QTY;                            // -- T_LOT_REC.ACTION_CODE := SCRAP;                            // --Added by MohanVamsi 24 Jun09                            t_Lot_Rec.Action_Code = "UNSCRAP";                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2070 uns resulting in sc:3 , Lot Position :" + t_Lot_Position);                        } else {                            t_Lot_Rec.New_Txn_Qty = t_Unscrap_Qty;                            Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 3);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.executeUpdate();                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Unscrap qty is -" + t_Lot_Rec.New_Txn_Qty);                        }                    }                    if (t_Lot_Rec.Action_Code.equals("UNTERMINATE")) {                        // --undo the last scrap only                        t_Lot_Rec.Action_Code = "UNSCRAP";                        // --t_lot_rec.new_txn_qty := t_scrapped_qty; --before osfm fix                        t_Stmt_Num = 970;                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.executeUpdate();                        try {                            Sql = "SELECT  Nvl ( Transaction_Quantity, 0) " + " From Wip_Move_Transactions " + " Where Wip_Entity_Id = ? " + " And Transaction_Id = " + "  (  Select Max  (  Transaction_Id )  " + " From Wip_Move_Transactions " + " Where Wip_Entity_Id = ? " + " And To_Intraoperation_Step_Type = ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.setObject(3, 5);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 1925;                            t_Error_Message = "Cannot find scrap details at the operation";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- wake up the job --to fix osfm defect                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.executeUpdate();                        // --dbms_output.put_line( before the unterminate t_oracle_uom is -||t_oracle_uom);                    }                    // unterminate                    if (t_Lot_Rec.Action_Code.equals("TERMINATE")) {                        t_Lot_Rec.Action_Code = "SCRAP";                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty;                    }                    // --dbms_output.put_line(returning before scrap call);                    // -- testing return;                    t_Stmt_Num = 980;                    if (t_Lot_Position.equals("W")) {                        procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, t_Wip_Entity_Id, t_Wip_Entity_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.New_Txn_Qty, // t_lot_rec.new_uom_code,                        t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, t_Lot_Rec.Action_Code);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // --update inside the procedure                        if (t_Undo && t_Status_Code == Success_Code) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code = ? " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Reset_Code);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            preparedStatement.executeUpdate();                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Lot_Position.equals("I")) {                        // -- to be tested                        procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // i_lot_number,                        t_Wip_Entity_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                        // t_Lot_Rec.Old_Lot_Type),                        t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, t_Inventory_Item_Id, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                        t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // --update inside the procedure                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // of scrap txn                // -- terminate lot                /* -- mapped to scrap if upper(t_lot_rec.action_code)=TERMINATE then --As Oracle API does not handle it currently t_status_code :=success_code; t_error_message :=Currently Oracle API does not support Lot Termination or cancellation. Please do from front end; tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id, null, t_status_code, t_error_code, t_error_message, SET ); goto end_transact_loop; tltadapt.t_cancel_wiplot_api ( t_lot_rec.transaction_id, null, t_factory_id, t_organization_id, t_wip_entity_id, t_inventory_item_id, t_lot_rec.transaction_date, i_user_id ); end if;-- terminate */                // -- terminate lot ends                t_Stmt_Num = 990;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("COMPLETE")) {                    procedureParams_OutputMap = tltAdatptSubObject.t_Complete_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Organization_Code, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Lot_Rec.Transaction_Date, i_User_Id, t_Oracle_Uom, // in   number,                    t_Status_Code, // in   varchar2,                    t_Error_Message, // in   number,                    t_Error_Code);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ****                // -- transfer lot                if (t_Lot_Rec.Action_Code.toUpperCase().equals("TRANSFER")) {                    t_Transfer = true;                    // --------process lot from which transfer is happening                    // -- use of variables                    procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transfer_Lot_Id, t_Transfer_Lot_Position, t_Transfer_Job_Name, x_Transfer_Wip_Entity_Id, x_Transfer_Inventory_Item_Id, t_Dummy_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Transfer_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Transfer_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        x_Transfer_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        x_Transfer_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                        t_Dummy_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                    }                    if (procedureParams_OutputMap.get("o_Status_Type") != null) {                        t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                    }                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    if (t_Transfer_Job_Name == null) {                        procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Transfer_Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        t_Transfer = false;                    }                    // --check the interface                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name for check interface for transfer: " + t_Job_Name);                    if (t_Transfer == true) {                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Transfer_Job_Name, x_Transfer_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = 1000;                        try {                            Sql = "SELECT  Operation_Seq_Num, " + " Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, x_Transfer_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Transfer_Operation_Seq_Num = resultSet.getInt(1);                                x_Transfer_Wip_Qty = resultSet.getInt(2);                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: X_transfer_wip_qty: " + x_Transfer_Wip_Qty);                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 510;                            t_Error_Message = "Cannot find operation with +ve Qty in wip_operations for wip_entity_id- " + x_Transfer_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = tedutilsObject.T_Get_Item_Conversion(t_Factory_Id, t_Organization_Id, x_Transfer_Inventory_Item_Id, t_Lot_Rec.New_Routing, // Deepak 22 Mar, 03                        t_Lot_Rec.Transaction_Date, // Nvl ( t_Lot_Rec.New_Uom_Code,                        // t_Lot_Rec.Old_Uom_Code),                        t_Lot_Rec.New_Uom_Code != null ? t_Lot_Rec.New_Uom_Code : t_Lot_Rec.Old_Uom_Code, t_Lot_Rec.Transferlot_Txn_Qty, t_Oracle_Uom, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.Transferlot_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code == Failure_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (x_Transfer_Wip_Qty < t_Lot_Rec.Transferlot_Txn_Qty) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 1900;                            t_Error_Message = "Oracle Job does not have sufficient quantity to transfer-" + t_Job_Name;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = 1010;                        if (t_Transfer_Lot_Position.equals("W")) {                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, x_Transfer_Wip_Entity_Id, t_Transfer_Job_Name, t_Transfer_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.Transferlot_Txn_Qty, // t_lot_rec.new_uom_code,                            t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // --update inside the procedure                        } else if (t_Transfer_Lot_Position.equals("I")) {                            // -- to take care of this later, chk                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // i_lot_number,                            t_Transfer_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, x_Transfer_Inventory_Item_Id, t_Lot_Rec.Transferlot_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                            t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // --update inside the procedure                        }                    }                    // transfer is true                    // -- xfrer lot ends                    // -- change/scrap of lot id starts                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before transfer lot -x_wip_qty: " + x_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before transfer lot -t_lot_rec.new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                    if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                        // -- for data consistencey/recovery                        t_Stmt_Num = 1020;                        if (t_Lot_Position.equals("W")) {                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, x_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, x_Wip_Qty - t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        } else if (t_Lot_Position.equals("I")) {                            // -- to take care of this later, chk                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, x_Inventory_Item_Id, x_Wip_Qty - t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                    } else if (x_Wip_Qty < t_Lot_Rec.New_Txn_Qty) {                        t_Stmt_Num = 1030;                        procedureParams_OutputMap = tltAdatptSubObject.t_Split_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code,t_lot_rec.old_uom_code),                        t_Oracle_Uom, t_Lot_Rec.New_Lot_Type, // upper ( t_lot_rec.action_code),                        "CHANGE QTY", i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                    } else {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --    tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                    // --             null,                    // --             t_status_code,                    // --             t_error_code,                    // --             t_error_message,                    // --             GET                    // --            );                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // transfer components                // -- transfer lot                t_Stmt_Num = 1040;                // -- uncomplete lot                if (t_Lot_Rec.Action_Code.toUpperCase().equals("UNCOMPLETE")) {                    /* insert into t_lot_properties_api values (t_lot_rec.transaction_id, TRINITIeDapterLotUncompleteTxn, Oracle Job-||t_job_name||- was uncompleted by transaction_id-||t_lot_rec.transaction_id ); */                    // --Inv Interface Lot Check added by K.L.Venkatraman                    // --on 21 Jul 2009 for pi uncomplete txn                    // --checking lot status in Inventory just in case you have any inventory txns pending                    // --after job completion.                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, // x_wip_entity_id                    null, // t_organization_id,                    null, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    t_Stmt_Num = (int) 1040.01;                    logger.debug("T_Transact_Lots: Status code after t_check_lot_interface at stmt no: " + t_Stmt_Num + ":" + t_Status_Code);                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        logger.debug("T_Transact_Lots: T_error_message :" + t_Error_Message);                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -------- Added by K.L.Venkatraman on 21 Jul 2009 Till here                    if (t_Status_Type == 4) {                        procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                        t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // -- tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                        // --          null,                        // --          t_status_code,                        // --          t_error_code,                        // --          t_error_message,                        // --          GET                        // --         );                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } else {                        // --Deepak 24 Dec,02  --lot is completed but status type not updated.                        Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Organization_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Last_Op_Seq_Num = resultSet.getInt(1);                        }                        try {                            Sql = "SELECT  x " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Last_Op_Seq_Num);                            preparedStatement.setObject(3, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            t_Status_Code = Reset_Code;                            t_Error_Message = "Cannot Uncomplete.Waiting for lot to be completed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reset_Code;                            t_Error_Code = 6186;                            t_Error_Message = "Cannot Uncomplete.Lot is not completed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                t_Stmt_Num = 1050;                // --Hold or Release Lot                // --,CHANGESCHEDDATE --Add this later MohanVamsi                if (("HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && (t_Status_Type == 3 || t_Status_Type == 6)) {                    t_Rows_Updated = 0;                    x_Status_Code = 0;                    // --Added from here By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface,                    // --Get Lot Type Details, Even though its not required it is being invoked for now, after testing remove this.                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Lot_Type_Details(t_Factory_Id, t_Lot_Rec.New_Lot_Type, x_Track_In_Oracle, t_Class_Code, t_Bonus_Account_Id, t_Suspense_Account_Id, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Track_In_Oracle") != null) {                        x_Track_In_Oracle = (java.lang.Integer) procedureParams_OutputMap.get("o_Track_In_Oracle");                    }                    if (procedureParams_OutputMap.get("o_Class_Code") != null) {                        t_Class_Code = (java.lang.String) procedureParams_OutputMap.get("o_Class_Code");                    }                    if (procedureParams_OutputMap.get("o_Bonus_Account_Id") != null) {                        t_Bonus_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Bonus_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Suspense_Account_Id") != null) {                        t_Suspense_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Suspense_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    logger.debug("T_Transact_Lots: Action_Code is: " + t_Lot_Rec.Action_Code);                    logger.debug("T_Transact_Lots: Action_Code is: " + t_Lot_Rec.Action_Code);                    if (t_Lot_Rec.Action_Code.equals("HOLD")) {                        t_Wip_Status = "H";                    } else if (t_Lot_Rec.Action_Code.equals("RELEASE")) {                        t_Wip_Status = "R";                    } else if (t_Lot_Rec.Action_Code.equals("CANCEL")) {                        t_Wip_Status = "C";                    } else if (t_Lot_Rec.Action_Code.equals("CHANGESCHEDDATE")) {                        t_Wip_Status = "U";                    }                    logger.debug("T_Transact_Lots: Before Calling Tltadapt.T_Update_Wip_Status_Api, T_Wip_Status: " + t_Wip_Status);                    logger.debug("T_Transact_Lots: Before Calling Tltadapt.T_Update_Wip_Status_Api, T_Wip_Status: " + t_Wip_Status);                    try {                        t_Stmt_Num = (int) 1050.10;                        procedureParams_OutputMap = tltAdatptSubObject.t_Update_Wip_Status_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Wip_Entity_Id, t_Inventory_Item_Id, // T_FIRM_PLANNED_FLAG, Use this if required for Planning                        null, t_Lot_Rec.Transaction_Date, i_User_Id, t_Wip_Status, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                    } catch (Exception e2) {                        logger.error(e2, e2);                        logger.debug("T_Transact_Lots: Error in calling Proc:" + ((SQLException) e2).getSQLState() + ", At Stmt_num-" + t_Stmt_Num);                        logger.debug("T_Transact_Lots: Error in calling Proc:" + ((SQLException) e2).getSQLState() + ", At Stmt_num-" + t_Stmt_Num);                    }                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        logger.debug("T_Transact_Lots: After Calling Tltadapt.T_Update_Wip_Status_Api, Status: " + t_Status_Code);                        logger.debug("T_Transact_Lots: After Calling Tltadapt.T_Update_Wip_Status_Api, Status: " + t_Status_Code);                        logger.debug("T_Transact_Lots: Going to Update T_Lots and T_Oracle_Jobs");                        logger.debug("T_Transact_Lots: Going to Update T_Lots and T_Oracle_Jobs");                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("HOLD")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for HOLD");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for HOLD");                            try {                                t_Stmt_Num = (int) 1050.25;                                Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                try {                                    t_Stmt_Num = (int) 1050.30;                                    Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                    }                                    t_Status_Code = 3;                                    t_Error_Code = (int) 8319.25;                                    t_Error_Message = "Lot is already in Hold, Transaction Ignored-" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                } catch (No_Data_Found e3) {                                    logger.error(e3);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 8319.30;                                    t_Error_Message = "Check if Lot is Completed -" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            }                            Sql = "UPDATE t_Lots " + " Set Remarks = ? , Status = H " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Lot_Rec.Message_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Factory_Id);                            updateCount = preparedStatement.executeUpdate();                            Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = H " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            updateCount = preparedStatement.executeUpdate();                            t_Status_Code = Success_Code;                            // -- END IF;                        } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("RELEASE")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for RELEASE");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for RELEASE");                            try {                                t_Stmt_Num = (int) 1050.35;                                Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                try {                                    t_Stmt_Num = (int) 1050.40;                                    Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                    }                                    t_Status_Code = 3;                                    t_Error_Code = (int) 8319.35;                                    t_Error_Message = "Lot is already Released, Transaction Ignored-" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                } catch (No_Data_Found e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 8319.40;                                    t_Error_Message = "Check if Lot is Completed -" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            }                            // --Will Ignore the Txn if Lot is already Released                            Sql = "UPDATE t_Lots " + " Set Remarks = null , Status = A " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            updateCount = preparedStatement.executeUpdate();                            Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = A " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            updateCount = preparedStatement.executeUpdate();                            t_Hold_Value = null;                            t_Status_Code = Success_Code;                            // --END IF;                        } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("CANCEL")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for CANCEL");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for CANCEL");                            try {                                t_Stmt_Num = (int) 1050.45;                                Sql = "UPDATE t_Oracle_Jobs " + // Inactive                                " Set Status      = ? ,  " + // Terminated                                " Active_Flag = T  " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, 2);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                updateCount = preparedStatement.executeUpdate();                                Sql = "UPDATE t_Lots " + // Terminated                                " Set Status = T ,  " + // --Lot_Id= CANCEL~||decode(substr(lot_id,1,7),CANCEL~,substr(lot_id,8),lot_id), --Deepak 26 Dec,02                                " Remarks = Lot cancelled due to transaction- || " + " ? " + " Where Unique_Id In " + "  ( Select Lot_Id " + " From t_Oracle_Jobs " + " Where Wip_Entity_Id = ? )   ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, i_Transaction_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                updateCount = preparedStatement.executeUpdate();                                t_Status_Code = Success_Code;                            } catch (SQLException e) {                                logger.error(e, e);                                t_Status_Code = Reject_Code;                            }                            if (t_Status_Code == Success_Code) {                                procedureParams_OutputMap = Log_Message("Lot is Successfully Cancelled");                                t_Error_Code = null;                                t_Error_Message = null;                            } else {                                procedureParams_OutputMap = Log_Message("Errored in Cancelling the Lot: " + t_Error_Message);                            }                        }                        logger.debug("T_Transact_Lots: Successfully Updated T_Lots and T_Oracle_Jobs for Action: " + t_Lot_Rec.Action_Code);                        logger.debug("T_Transact_Lots: Successfully Updated T_Lots and T_Oracle_Jobs for Action: " + t_Lot_Rec.Action_Code);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --Added By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface                    /* --Commented below By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface IF UPPER(T_LOT_REC.ACTION_CODE) = HOLD THEN UPDATE WIP_DISCRETE_JOBS SET STATUS_TYPE = 6 WHERE WIP_ENTITY_ID = T_WIP_ENTITY_ID; --Commented and Added with Exception by MohanVamsi 4th Dec09 --to ignore if Lot is already in Hold --SELECT UNIQUE_ID --  INTO T_UNIQUE_ID --  FROM T_LOTS -- WHERE LOT_ID = T_LOT_REC.LOT_ID --   AND FACTORY_ID = T_FACTORY_ID --   AND STATUS = A; BEGIN T_STMT_NUM := 1050.25; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; EXCEPTION WHEN NO_DATA_FOUND THEN BEGIN T_STMT_NUM := 1050.30; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; T_STATUS_CODE   := 3; T_ERROR_CODE    := 8319.25; T_ERROR_MESSAGE := Lot is already in Hold, Transaction Ignored- || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); EXCEPTION WHEN NO_DATA_FOUND THEN T_STATUS_CODE   := FAILURE_CODE; T_ERROR_CODE    := 8319.30; T_ERROR_MESSAGE := Check if Lot is Completed - || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); END; END; -- Added by MohanVamsi to ignore if Lot is already in Hold UPDATE T_LOTS SET REMARKS = T_LOT_REC.MESSAGE_ID, STATUS  = H WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; UPDATE T_ORACLE_JOBS SET ACTIVE_FLAG = H WHERE LOT_ID = T_UNIQUE_ID; T_STATUS_CODE := SUCCESS_CODE; END IF; IF UPPER(T_LOT_REC.ACTION_CODE) = RELEASE THEN UPDATE WIP_DISCRETE_JOBS SET STATUS_TYPE = 3 WHERE WIP_ENTITY_ID = T_WIP_ENTITY_ID AND STATUS_TYPE = 6; --Commented and Added with Exception by MohanVamsi 4th Dec09 -- to ignore if Lot is already Released --SELECT UNIQUE_ID --  INTO T_UNIQUE_ID --  FROM T_LOTS -- WHERE LOT_ID = T_LOT_REC.LOT_ID --   AND FACTORY_ID = T_FACTORY_ID --   AND STATUS = H; BEGIN T_STMT_NUM := 1050.35; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; EXCEPTION WHEN NO_DATA_FOUND THEN BEGIN T_STMT_NUM := 1050.40; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; T_STATUS_CODE   := 3; T_ERROR_CODE    := 8319.35; T_ERROR_MESSAGE := Lot is already Released, Transaction Ignored- || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); EXCEPTION WHEN NO_DATA_FOUND THEN T_STATUS_CODE   := FAILURE_CODE; T_ERROR_CODE    := 8319.40; T_ERROR_MESSAGE := Check if Lot is Completed - || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); END; END; --Added by MohanVamsi to ignore if Lot is already Released UPDATE T_LOTS SET REMARKS = NULL, STATUS  = A WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; UPDATE T_ORACLE_JOBS SET ACTIVE_FLAG = A WHERE LOT_ID = T_UNIQUE_ID; --update t_parent_lots_Api --set status_code =success_code --where transaction_id = t_lot_rec.transaction_id; T_HOLD_VALUE := NULL; T_STATUS_CODE := SUCCESS_CODE; END IF; IF UPPER(T_LOT_REC.ACTION_CODE) = CANCEL THEN BEGIN TLTADAPT.T_CANCEL_WIPLOT_API(T_LOT_REC.TRANSACTION_ID, --  i_transaction_id 0, --  i_line_number T_FACTORY_ID, --  i_factory_id T_ORGANIZATION_ID, --  i_organization_id T_WIP_ENTITY_ID, --  i_wip_entity_id T_INVENTORY_ITEM_ID, --  i_inventory_item_id T_LOT_REC.TRANSACTION_DATE, --  i_transaction_date I_USER_ID, --  i_user_id T_STATUS_CODE, --      out T_ERROR_CODE, --     out T_ERROR_MESSAGE --         out ); IF T_STATUS_CODE = 3 THEN LOG_MESSAGE(Successfully cancelled the lot); T_ERROR_CODE    := NULL; T_ERROR_MESSAGE := NULL; ELSE LOG_MESSAGE(Errored in Cancel proc  || T_ERROR_MESSAGE); END IF; EXCEPTION WHEN OTHERS THEN LOG_MESSAGE(Error in calling proc- || SQLERRM || - at stmt_num- || T_STMT_NUM); END; END IF;*/                    // --Commented By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface                    // Sql%Rowcount;                    t_Rows_Updated = updateCount;                    // --t_status_code :=success_code;                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                    if (t_Lot_Rec.Action_Code.equals("RELEASE") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "3";                    } else if (t_Lot_Rec.Action_Code.equals("HOLD") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "6";                    } else if (t_Lot_Rec.Action_Code.equals("CANCEL") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "7";                    } else if (t_Lot_Rec.Action_Code.equals("RELEASE") && (!t_Hold_Column.equals("STATUS_TYPE"))) {                        t_Hold_Value = "LotReleased";                    }                    t_Stmt_Num = 1060;                    // -- update the attribute columns, message_id stores the hold reason                    if (("HOLD".equals(t_Lot_Rec.Action_Code) || "RELEASE".equals(t_Lot_Rec.Action_Code))) {                        if (t_Rows_Updated == 1) {                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = " update wip_discrete_jobs  " + " set  " + t_Hold_Column + "  =  " + t_Lot_Rec.Message_Id + "  " + " where wip_entity_id      =  " + t_Wip_Entity_Id + "  ";                            /*    t_message_id:=  t_lot_rec.message_id;    try{    execute immediate t_sql_string using t_message_id,t_wip_entity_id;    exception    when others then    t_status_code :=failure_code;    t_error_code  :=2460;    t_error_message :="Error in dyn sql while updating job details-"||sqlerrm;    tLotUtilsObject.T_Update_Txn_Status ( t_lot_rec.transaction_id,    null,    t_status_code,    t_error_code,    t_error_message,    "SET"    );    goto end_transact_loop;        */                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "t_hold_value",t_Lot_Rec.Message_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "t_wip_entity_id",t_Wip_Entity_Id);                                // x_Status_Code  =  Dbms_Sql.Execute  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String);                                x_Status_Code = preparedStatement.executeUpdate();                                if (x_Status_Code == 1) {                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    // Added by Suchi                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 2460;                                t_Error_Message = "Error in dyn sql while updating job details-" + e.getSQLState();                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        } else {                            t_Status_Code = Failure_Code;                            t_Error_Code = 2480;                            t_Error_Message = "Job must be in transactable status.Released ( 3),complete ( 4) or On Hold ( 6) . Check wip_discrete_jobs-" + t_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // rowcount is 1                    }                    // hold/release                } else if (("HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && !(t_Status_Type == 3 || t_Status_Type == 6)) {                    t_Status_Code = Success_Code;                    t_Error_Message = "Lot not in transactable status in Oracle. Cannot Hold/Release";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // hold/release                t_Stmt_Num = 1070;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CONSUME")) {                    Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    procedureParams_OutputMap = Log_Message(Log_Msg);                    // -- how to differentiate between push and return :1                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, null, null, null, null, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        // --t_check_bom:=false; --Deepak 03 Jan,03                        procedureParams_OutputMap = tltAdatpObject.t_Consume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, // i_transaction_interface_id,                        null, t_Wip_Entity_Id, Y, i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // --return components.                t_Stmt_Num = 1080;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("UNCONSUME")) {                    // check if job is in wip                    tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (t_Job_Name == null || t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    procedureParams_OutputMap = tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CHANGEATTRIBUTE")) {                    // --**** IG Transactions not usefull                    t_Status_Code = Success_Code;                    t_Error_Message = "IG Transaction";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                }                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper is thru with the validations");                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper Wip Entity ID: " + t_Wip_Entity_Id);                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper Job:" + t_Job_Name);                t_Stmt_Num = 1090;                connection.commit();                // --  t_rows_processed := t_rows_processed + 1;                // <<end_Transact_Loop>>                // null;                t_Stmt_Num = 1100;                // if  (  Dbms_Sql.Is_Opent_Cursor )                {                    // Dbms_Sql.Close_Cursor ( t_Cursor);                }                // --Deepak 18/12/02 for tracking unhandled exception            } catch (SQLException e) {                logger.error(e, e);                // if  (  Dbms_Sql.Is_Opent_Cursor )                {                    // Dbms_Sql.Close_Cursor ( t_Cursor);                }                t_Status_Code = Failure_Code;                t_Error_Code = 8320;                t_Error_Message = "T_Transact_Lots: Error in Lot_Rec{at stmt: " + t_Stmt_Num + ", Err Msg:" + e.getSQLState();                try {                    // --Added Begin/Exception by MohanVamsi 12th May 2010 to Error Out in TPLA and So that User                    // --can understand the error                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                } catch (Exception e2) {                    logger.error(e2, e2);                    // --As we cant make use of tLotUtilsObject.T_Update_Txn_Status if tLotUtilsObject is in INVALID.                    Sql = "UPDATE t_Parent_Lots_Api Tpla " + " Set Status_Code      = ? , " + " Error_Code       = ? , " + " Error_Message    = ? , " + " Last_Update_Date = Sysdate " + " Where Transaction_Id = " + t_Lot_Rec.Transaction_Id;                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Status_Code);                    preparedStatement.setObject(2, t_Error_Code);                    preparedStatement.setObject(3, t_Error_Message);                    preparedStatement.executeUpdate();                    connection.commit();                    logger.debug(i_Error_Message);                    procedureParams_OutputMap = Log_Message(i_Error_Message);                }                // --Added by MohanVamsi 12th May 2010 to Error Out in TPLA and So that User                // --can understand the error            }        }        // Main{        if (i_Transaction_Id == null) {            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Id = ?  ";            preparedStatement = connection.prepareStatement(Sql);            preparedStatement.setObject(1, 1);            preparedStatement.setObject(2, t_Factory_Id);            preparedStatement.executeUpdate();        }        // if  (  Dbms_Sql.Is_Opent_Cursor )        {            // Dbms_Sql.Close_Cursor ( t_Cursor);        }        i_Error_Code = null;        i_Error_Message = null;        connection.commit();        return methodParams_OutputMap;    }}');
            nodesArr.push('Line No-22000: return methodParams_OutputMap;');
            nodesArr.push('Stop');

            var gapBetweenNodes = 40;
            maxNodeWidth = getMaxNodeWidthByNames(nodesArr);


            var rect139 = ellipse.clone();
            rect139.addTo(javaStatementsGraph);
            rect139.attr('text/text', 'Start');
            rect139.attr('circle/fill', 'green');

            rootNode = rect139;

            flowChartNode = getBrokenText('Line No-5824: i_Transaction_Id = null;    ');
            var rect140 = rect.clone();
            rect140.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect140.attr('label/text', flowChartNode);
            rect140.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5825: i_Lot_Id = null;    ');
            var rect141 = rect.clone();
            rect141.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect141.attr('label/text', flowChartNode);
            rect141.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5826: i_Error_Records = false;    ');
            var rect142 = rect.clone();
            rect142.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect142.attr('label/text', flowChartNode);
            rect142.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5828: HashMap methodParams_OutputMap = new HashMap();    ');
            var rect143 = rect.clone();
            rect143.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect143.attr('label/text', flowChartNode);
            rect143.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5829: HashMap procedureParams_OutputMap = new HashMap();    ');
            var rect144 = rect.clone();
            rect144.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect144.attr('label/text', flowChartNode);
            rect144.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5830: ResultSet Child_Lots_Rec_ResultSet = null;    ');
            var rect145 = rect.clone();
            rect145.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect145.attr('label/text', flowChartNode);
            rect145.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5831: ResultSet Child_Wait_Rec_ResultSet = null;    ');
            var rect146 = rect.clone();
            rect146.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect146.attr('label/text', flowChartNode);
            rect146.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5832: ResultSet Child_Wait_Rec1_ResultSet = null;    ');
            var rect147 = rect.clone();
            rect147.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect147.attr('label/text', flowChartNode);
            rect147.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5833: ResultSet Parent_Wait_Rec_ResultSet = null;    ');
            var rect148 = rect.clone();
            rect148.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect148.attr('label/text', flowChartNode);
            rect148.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5834: ResultSet Transfer_Wait_Rec_ResultSet = null;    ');
            var rect149 = rect.clone();
            rect149.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect149.attr('label/text', flowChartNode);
            rect149.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5835: Integer totalRows;    ');
            var rect150 = rect.clone();
            rect150.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect150.attr('label/text', flowChartNode);
            rect150.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5837: String t    ');
            var rect151 = rect.clone();
            rect151.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect151.attr('label/text', flowChartNode);
            rect151.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5838: Integer i_Error_Code;    ');
            var rect152 = rect.clone();
            rect152.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect152.attr('label/text', flowChartNode);
            rect152.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5839: String i_Error_Message = null;    ');
            var rect153 = rect.clone();
            rect153.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect153.attr('label/text', flowChartNode);
            rect153.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5841: boolean t_Startup = false    ');
            var rect154 = rect.clone();
            rect154.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect154.attr('label/text', flowChartNode);
            rect154.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5842: boolean t_Reverse_Insert_From_Oracle = true;    ');
            var rect155 = rect.clone();
            rect155.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect155.attr('label/text', flowChartNode);
            rect155.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5844: Integer t_Reverse_Insert_Unique_Id    ');
            var rect156 = rect.clone();
            rect156.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect156.attr('label/text', flowChartNode);
            rect156.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5845: String t_Tlot_Check_Lot_Number;    ');
            var rect157 = rect.clone();
            rect157.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect157.attr('label/text', flowChartNode);
            rect157.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5846: String t_Dummy;    ');
            var rect158 = rect.clone();
            rect158.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect158.attr('label/text', flowChartNode);
            rect158.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5847: String t_Hold_Value;    ');
            var rect159 = rect.clone();
            rect159.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect159.attr('label/text', flowChartNode);
            rect159.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5848: Integer t_Rows_Updated;    ');
            var rect160 = rect.clone();
            rect160.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect160.attr('label/text', flowChartNode);
            rect160.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5849: Integer updateCount = null;    ');
            var rect161 = rect.clone();
            rect161.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect161.attr('label/text', flowChartNode);
            rect161.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5850: String t_Lot_Name;    ');
            var rect162 = rect.clone();
            rect162.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect162.attr('label/text', flowChartNode);
            rect162.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5851: Integer x_Wip_Entity_Id = null;    ');
            var rect163 = rect.clone();
            rect163.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect163.attr('label/text', flowChartNode);
            rect163.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5852: Integer t_Unprocessed_Rows;    ');
            var rect164 = rect.clone();
            rect164.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect164.attr('label/text', flowChartNode);
            rect164.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5853: Integer t_Original_Qty = null;    ');
            var rect165 = rect.clone();
            rect165.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect165.attr('label/text', flowChartNode);
            rect165.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5854: Integer t_Qty_Scrapped;    ');
            var rect166 = rect.clone();
            rect166.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect166.attr('label/text', flowChartNode);
            rect166.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5855: String t_Lot_Policy;    ');
            var rect167 = rect.clone();
            rect167.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect167.attr('label/text', flowChartNode);
            rect167.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5856: String t_Date_Format = "DD-MON-YYYY HH24:MI.SS";    ');
            var rect168 = rect.clone();
            rect168.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect168.attr('label/text', flowChartNode);
            rect168.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5857: Integer x_Transfer_Wip_Qty;    ');
            var rect169 = rect.clone();
            rect169.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect169.attr('label/text', flowChartNode);
            rect169.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5858: Integer t_Transfer_Operation_Seq_Num;    ');
            var rect170 = rect.clone();
            rect170.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect170.attr('label/text', flowChartNode);
            rect170.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5859: Integer x_Transfer_Wip_Entity_Id = null;    ');
            var rect171 = rect.clone();
            rect171.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect171.attr('label/text', flowChartNode);
            rect171.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5860: Integer x_Transfer_Inventory_Item_Id = null;    ');
            var rect172 = rect.clone();
            rect172.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect172.attr('label/text', flowChartNode);
            rect172.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5861: String t_Transfer_Lot_Position = null;    ');
            var rect173 = rect.clone();
            rect173.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect173.attr('label/text', flowChartNode);
            rect173.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5862: String t_Transfer_Job_Name = null;    ');
            var rect174 = rect.clone();
            rect174.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect174.attr('label/text', flowChartNode);
            rect174.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5863: Integer t_Dummy_Wip_Qty = null;    ');
            var rect175 = rect.clone();
            rect175.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect175.attr('label/text', flowChartNode);
            rect175.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5864: boolean t_Transfer = true;    ');
            var rect176 = rect.clone();
            rect176.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect176.attr('label/text', flowChartNode);
            rect176.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5865: Integer t_Unscrap_Qty = null;    ');
            var rect177 = rect.clone();
            rect177.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect177.attr('label/text', flowChartNode);
            rect177.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5866: Integer t_Scrapped_Qty = null;    ');
            var rect178 = rect.clone();
            rect178.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect178.attr('label/text', flowChartNode);
            rect178.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5867: boolean t_Found_Flag = false;    ');
            var rect179 = rect.clone();
            rect179.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect179.attr('label/text', flowChartNode);
            rect179.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5868: Integer t_Parent_Qty = null;    ');
            var rect180 = rect.clone();
            rect180.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect180.attr('label/text', flowChartNode);
            rect180.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5869: Integer t_Child_Qty;    ');
            var rect181 = rect.clone();
            rect181.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect181.attr('label/text', flowChartNode);
            rect181.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5870: Integer t_Total_Child_Qty = null;    ');
            var rect182 = rect.clone();
            rect182.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect182.attr('label/text', flowChartNode);
            rect182.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5871: String t_Outside_Resource = null;    ');
            var rect183 = rect.clone();
            rect183.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect183.attr('label/text', flowChartNode);
            rect183.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5872: String t_Current_Routing = null;    ');
            var rect184 = rect.clone();
            rect184.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect184.attr('label/text', flowChartNode);
            rect184.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5873: String t_Current_Operation_Seq = null;    ');
            var rect185 = rect.clone();
            rect185.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect185.attr('label/text', flowChartNode);
            rect185.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5874: Integer t_Transactions_Per_Run;    ');
            var rect186 = rect.clone();
            rect186.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect186.attr('label/text', flowChartNode);
            rect186.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5875: Integer x_Track_In_Oracle = null;    ');
            var rect187 = rect.clone();
            rect187.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect187.attr('label/text', flowChartNode);
            rect187.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5876: String t_Class_Code = null;    ');
            var rect188 = rect.clone();
            rect188.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect188.attr('label/text', flowChartNode);
            rect188.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5877: Integer t_Bonus_Account_Id = null;    ');
            var rect189 = rect.clone();
            rect189.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect189.attr('label/text', flowChartNode);
            rect189.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5878: Integer t_Suspense_Account_Id = null;    ');
            var rect190 = rect.clone();
            rect190.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect190.attr('label/text', flowChartNode);
            rect190.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5879: boolean t_First_Pass = false;    ');
            var rect191 = rect.clone();
            rect191.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect191.attr('label/text', flowChartNode);
            rect191.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5880: String t_Bom_Level = null;    ');
            var rect192 = rect.clone();
            rect192.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect192.attr('label/text', flowChartNode);
            rect192.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5881: Integer o_Inventory_Item_Id = null;    ');
            var rect193 = rect.clone();
            rect193.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect193.attr('label/text', flowChartNode);
            rect193.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5882: Integer t_Count;    ');
            var rect194 = rect.clone();
            rect194.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect194.attr('label/text', flowChartNode);
            rect194.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5883: Integer t_Number_Of_Digits;    ');
            var rect195 = rect.clone();
            rect195.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect195.attr('label/text', flowChartNode);
            rect195.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5884: String t_To_Operation_Code;    ');
            var rect196 = rect.clone();
            rect196.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect196.attr('label/text', flowChartNode);
            rect196.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5885: String t_Operation_Seq = null;    ');
            var rect197 = rect.clone();
            rect197.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect197.attr('label/text', flowChartNode);
            rect197.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5886: String t_New_Routing = null;    ');
            var rect198 = rect.clone();
            rect198.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect198.attr('label/text', flowChartNode);
            rect198.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5887: String t_New_Uom_Code1;    ');
            var rect199 = rect.clone();
            rect199.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect199.attr('label/text', flowChartNode);
            rect199.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5888: Integer t_Component_Item_Id;    ');
            var rect200 = rect.clone();
            rect200.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect200.attr('label/text', flowChartNode);
            rect200.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5889: Integer t_Component_Qty;    ');
            var rect201 = rect.clone();
            rect201.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect201.attr('label/text', flowChartNode);
            rect201.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5890: String t_Component_Item;    ');
            var rect202 = rect.clone();
            rect202.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect202.attr('label/text', flowChartNode);
            rect202.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5891: String t_New_Operation1;    ');
            var rect203 = rect.clone();
            rect203.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect203.attr('label/text', flowChartNode);
            rect203.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5892: String t_Oper_Seq1;    ');
            var rect204 = rect.clone();
            rect204.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect204.attr('label/text', flowChartNode);
            rect204.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5893: String t_New_Department1;    ');
            var rect205 = rect.clone();
            rect205.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect205.attr('label/text', flowChartNode);
            rect205.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5894: String t_Uom;    ');
            var rect206 = rect.clone();
            rect206.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect206.attr('label/text', flowChartNode);
            rect206.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5895: String t_Routing;    ');
            var rect207 = rect.clone();
            rect207.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect207.attr('label/text', flowChartNode);
            rect207.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5896: String t_New_State;    ');
            var rect208 = rect.clone();
            rect208.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect208.attr('label/text', flowChartNode);
            rect208.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5897: String t_New_State1;    ');
            var rect209 = rect.clone();
            rect209.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect209.attr('label/text', flowChartNode);
            rect209.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5898: Integer t_New_Txn_Qty1;    ');
            var rect210 = rect.clone();
            rect210.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect210.attr('label/text', flowChartNode);
            rect210.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5899: Integer t_New_Txn_Qty;    ');
            var rect211 = rect.clone();
            rect211.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect211.attr('label/text', flowChartNode);
            rect211.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5900: String o_Bom_Level = null;    ');
            var rect212 = rect.clone();
            rect212.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect212.attr('label/text', flowChartNode);
            rect212.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5901: Integer t_Unique_Id = null;    ');
            var rect213 = rect.clone();
            rect213.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect213.attr('label/text', flowChartNode);
            rect213.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5902: String t_Lot_Suffix;    ');
            var rect214 = rect.clone();
            rect214.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect214.attr('label/text', flowChartNode);
            rect214.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5903: Integer t_Lot_Process_Status;    ');
            var rect215 = rect.clone();
            rect215.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect215.attr('label/text', flowChartNode);
            rect215.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5904: Integer t_Current_Level;    ');
            var rect216 = rect.clone();
            rect216.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect216.attr('label/text', flowChartNode);
            rect216.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5905: Integer t_Level;    ');
            var rect217 = rect.clone();
            rect217.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect217.attr('label/text', flowChartNode);
            rect217.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5906: Integer t_Operation_Seq_Id;    ');
            var rect218 = rect.clone();
            rect218.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect218.attr('label/text', flowChartNode);
            rect218.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5907: Integer x_Operation_Seq_Id;    ');
            var rect219 = rect.clone();
            rect219.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect219.attr('label/text', flowChartNode);
            rect219.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5908: Integer t_Consume_Flag;    ');
            var rect220 = rect.clone();
            rect220.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect220.attr('label/text', flowChartNode);
            rect220.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5909: boolean t_Undo = false;    ');
            var rect221 = rect.clone();
            rect221.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect221.attr('label/text', flowChartNode);
            rect221.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5910: Integer t_Quantity_In_Queue;    ');
            var rect222 = rect.clone();
            rect222.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect222.attr('label/text', flowChartNode);
            rect222.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5911: Integer t_Quantity_Running;    ');
            var rect223 = rect.clone();
            rect223.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect223.attr('label/text', flowChartNode);
            rect223.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5912: Integer t_Quantity_Waiting_To_Move;    ');
            var rect224 = rect.clone();
            rect224.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect224.attr('label/text', flowChartNode);
            rect224.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5913: Integer t_Quantity_Scrapped = null;    ');
            var rect225 = rect.clone();
            rect225.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect225.attr('label/text', flowChartNode);
            rect225.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5914: Integer t_Oracle_Intraope_Step_Type = null;    ');
            var rect226 = rect.clone();
            rect226.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect226.attr('label/text', flowChartNode);
            rect226.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5915: Integer t_Tpla_Intraope_Step_Type = null;    ');
            var rect227 = rect.clone();
            rect227.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect227.attr('label/text', flowChartNode);
            rect227.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5916: boolean t_Same_Bom_Level = false;    ');
            var rect228 = rect.clone();
            rect228.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect228.attr('label/text', flowChartNode);
            rect228.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5917: String t_Timezone;    ');
            var rect229 = rect.clone();
            rect229.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect229.attr('label/text', flowChartNode);
            rect229.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5918: Date t_Actual_Txn_Date;    ');
            var rect230 = rect.clone();
            rect230.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect230.attr('label/text', flowChartNode);
            rect230.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5919: Integer t_Wo_Std_Op_Id = null;    ');
            var rect231 = rect.clone();
            rect231.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect231.attr('label/text', flowChartNode);
            rect231.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5920: Integer t_Bos_Std_Op_Id = null;    ');
            var rect232 = rect.clone();
            rect232.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect232.attr('label/text', flowChartNode);
            rect232.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5921: Integer t_Bom_Seq_Id;    ');
            var rect233 = rect.clone();
            rect233.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect233.attr('label/text', flowChartNode);
            rect233.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5922: Integer t_Op_Seq_Num;    ');
            var rect234 = rect.clone();
            rect234.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect234.attr('label/text', flowChartNode);
            rect234.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5923: Integer t_Item_Seq_Num;    ');
            var rect235 = rect.clone();
            rect235.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect235.attr('label/text', flowChartNode);
            rect235.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5924: Integer t_Comp_Item_Id;    ');
            var rect236 = rect.clone();
            rect236.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect236.attr('label/text', flowChartNode);
            rect236.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5925: Integer t_Min_Wip_Qty;    ');
            var rect237 = rect.clone();
            rect237.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect237.attr('label/text', flowChartNode);
            rect237.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5926: Integer t_Ignore_Sample;    ');
            var rect238 = rect.clone();
            rect238.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect238.attr('label/text', flowChartNode);
            rect238.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5927: Integer t_Sample_Success_Flag = null;    ');
            var rect239 = rect.clone();
            rect239.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect239.attr('label/text', flowChartNode);
            rect239.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5928: Date t_Txn_Date1;    ');
            var rect240 = rect.clone();
            rect240.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect240.attr('label/text', flowChartNode);
            rect240.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5931: Integer t_Wip_Cur_Qty    ');
            var rect241 = rect.clone();
            rect241.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect241.attr('label/text', flowChartNode);
            rect241.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5932: Integer t_Min_Op_Seq_Num;    ');
            var rect242 = rect.clone();
            rect242.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect242.attr('label/text', flowChartNode);
            rect242.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5933: Integer t_Returned_Quantity;    ');
            var rect243 = rect.clone();
            rect243.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect243.attr('label/text', flowChartNode);
            rect243.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5934: Integer t_Return_Quantity;    ');
            var rect244 = rect.clone();
            rect244.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect244.attr('label/text', flowChartNode);
            rect244.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5935: Integer t_Lot_Control_Code;    ');
            var rect245 = rect.clone();
            rect245.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect245.attr('label/text', flowChartNode);
            rect245.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5936: String t_Component_Item_Number;    ');
            var rect246 = rect.clone();
            rect246.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect246.attr('label/text', flowChartNode);
            rect246.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5938: Integer t_Child_Exist = 0;    ');
            var rect247 = rect.clone();
            rect247.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect247.attr('label/text', flowChartNode);
            rect247.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5939: Integer t_Child_Txn_Id;    ');
            var rect248 = rect.clone();
            rect248.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect248.attr('label/text', flowChartNode);
            rect248.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5940: String t_Item_Id;    ');
            var rect249 = rect.clone();
            rect249.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect249.attr('label/text', flowChartNode);
            rect249.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5942: Integer t_Parent_Wait_Transaction_Id;    ');
            var rect250 = rect.clone();
            rect250.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect250.attr('label/text', flowChartNode);
            rect250.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5943: Integer t_Wake_Rec_Transaction_Id;    ');
            var rect251 = rect.clone();
            rect251.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect251.attr('label/text', flowChartNode);
            rect251.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5944: Integer t_Wake_Txn_Id;    ');
            var rect252 = rect.clone();
            rect252.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect252.attr('label/text', flowChartNode);
            rect252.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5945: Integer t_Child_Wait_Transaction_Id;    ');
            var rect253 = rect.clone();
            rect253.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect253.attr('label/text', flowChartNode);
            rect253.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5946: Integer t_Wake_Rec_Txn_Id1;    ');
            var rect254 = rect.clone();
            rect254.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect254.attr('label/text', flowChartNode);
            rect254.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5947: Integer t_Child_Lot_Control_Code;    ');
            var rect255 = rect.clone();
            rect255.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect255.attr('label/text', flowChartNode);
            rect255.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5948: Integer t_Child_Item_Id;    ');
            var rect256 = rect.clone();
            rect256.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect256.attr('label/text', flowChartNode);
            rect256.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5949: String t_Wait_Child_Lot;    ');
            var rect257 = rect.clone();
            rect257.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect257.attr('label/text', flowChartNode);
            rect257.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5951: Integer t_Transaction_Id = null;    ');
            var rect258 = rect.clone();
            rect258.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect258.attr('label/text', flowChartNode);
            rect258.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5952: Integer Tp_Transaction_Id;    ');
            var rect259 = rect.clone();
            rect259.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect259.attr('label/text', flowChartNode);
            rect259.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5953: Integer Tc_Transaction_Id;    ');
            var rect260 = rect.clone();
            rect260.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect260.attr('label/text', flowChartNode);
            rect260.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5954: Integer t_Net_Quantity;    ');
            var rect261 = rect.clone();
            rect261.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect261.attr('label/text', flowChartNode);
            rect261.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5955: String t_Nls_Date_Format;    ');
            var rect262 = rect.clone();
            rect262.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect262.attr('label/text', flowChartNode);
            rect262.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5957: String t_Wip_Status = null;    ');
            var rect263 = rect.clone();
            rect263.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect263.attr('label/text', flowChartNode);
            rect263.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5960: String t_Lot_Id    ');
            var rect264 = rect.clone();
            rect264.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect264.attr('label/text', flowChartNode);
            rect264.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5962: String x_Tcla_Lot_Id;    ');
            var rect265 = rect.clone();
            rect265.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect265.attr('label/text', flowChartNode);
            rect265.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5964: String t_Child_Lot;    ');
            var rect266 = rect.clone();
            rect266.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect266.attr('label/text', flowChartNode);
            rect266.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5966: String t_Component_Lot;    ');
            var rect267 = rect.clone();
            rect267.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect267.attr('label/text', flowChartNode);
            rect267.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5968: String t_Item_Num = null;    ');
            var rect268 = rect.clone();
            rect268.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect268.attr('label/text', flowChartNode);
            rect268.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5970: Integer T_Inv_Item;    ');
            var rect269 = rect.clone();
            rect269.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect269.attr('label/text', flowChartNode);
            rect269.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5971: Integer T_Chg_Item;    ');
            var rect270 = rect.clone();
            rect270.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect270.attr('label/text', flowChartNode);
            rect270.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5972: TLotUtils tLotUtilsObject = new TLotUtils();    ');
            var rect271 = rect.clone();
            rect271.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect271.attr('label/text', flowChartNode);
            rect271.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5973: TedUtils tedutilsObject = new TedUtils();    ');
            var rect272 = rect.clone();
            rect272.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect272.attr('label/text', flowChartNode);
            rect272.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5974: TltAdapt tltAdatpObject = new TltAdapt();    ');
            var rect273 = rect.clone();
            rect273.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect273.attr('label/text', flowChartNode);
            rect273.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5975: TinvAdapt tinvAdaptObject = new TinvAdapt();    ');
            var rect274 = rect.clone();
            rect274.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect274.attr('label/text', flowChartNode);
            rect274.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5976: TltAdaptSubClass tltAdatptSubObject = new TltAdaptSubClass();    ');
            var rect275 = rect.clone();
            rect275.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect275.attr('label/text', flowChartNode);
            rect275.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-5978: t_Unterminate: {    end_Transact_Loop: {        Log_Msg = "TLTHREAD.T_Transact_Lots: Inside Procedure";        procedureParams_OutputMap = Log_Message(Log_Msg);        logger.debug(Log_Msg);        t_Stmt_Num = 10;        // --  if FND_PROFILE.VALUE(MRP_TRACE)=Y then        // --    dbms_session.set_sql_trace(true);        // --    select tlthread.t_transact_lots into t_trace_dummy from dual;        // --  end if;        try {            Sql = "SELECT  Routing_Field, " + " Operation_Field, " + " Mp.Organization_Id, " + " Job_Prefix, " + " Job_Separator, " + " Bom_Explode_Flag, " + " Routing_Type_Field, " + " Min_Operation_Seq, " + " Mp.Organization_Code, " + " Routing_On_The_Fly_Flag, " + " Factory_Id, " + " System_Item_Flag, " + " Hold_Column, " + " Hold_Value, " + " Completion_Subinventory, " + " Consume_Flag, " + " Std_Operations_Flag, " + " Create_Standard_Operations, " + " Operation_Seq_Field, " + " Transactions_Per_Run, " + " Lot_Suffix, " + " Number_Of_Digits, " + " Lot_Process_Status, " + " Department_Flag, " + " Timezone, " + " Ignore_Sample, " + " Serial_Enabled " + // --Added by MohanVamsi 8-Nov-2011 to check if Factory is Serial Enabled or not            " From Mtl_Parameters Mp, t_Factories Tf " + " Where Tf.Factory_Name = ? " + " And Tf.Organization_Code = Mp.Organization_Code  ";            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);            preparedStatement.setObject(1, i_Factory_Name);            resultSet = preparedStatement.executeQuery();            resultSet.last();            totalRows = resultSet.getRow();            resultSet.beforeFirst();            if (totalRows > 1) {                throw new SQLException("Too Many Rows");            }            if (resultSet.next() == false) {                throw new No_Data_Found("No Data Found");            } else {                t_Routing_Field = resultSet.getString(1);                t_Operation_Field = resultSet.getString(2);                t_Organization_Id = resultSet.getInt(3);                t_Job_Prefix = resultSet.getString(4);                t_Job_Separator = resultSet.getString(5);                t_Bom_Explode_Flag = resultSet.getString(6);                t_Routing_Type_Field = resultSet.getString(7);                t_Min_Operation_Seq = resultSet.getInt(8);                t_Organization_Code = resultSet.getString(9);                t_Routing_On_The_Fly_Flag = resultSet.getString(10);                t_Factory_Id = resultSet.getInt(11);                t_System_Item_Flag = resultSet.getInt(12);                t_Hold_Column = resultSet.getString(13);                t_Hold_Value = resultSet.getString(14);                t_Completion_Subinventory = resultSet.getString(15);                t_Consume_Flag = resultSet.getInt(16);                t_Standard_Operations_Flag = resultSet.getInt(17);                t_Create_Standard_Operations = resultSet.getInt(18);                t_Step_Seq_Field = resultSet.getString(19);                t_Transactions_Per_Run = resultSet.getInt(20);                t_Lot_Suffix = resultSet.getString(21);                t_Number_Of_Digits = resultSet.getInt(22);                t_Lot_Process_Status = resultSet.getInt(23);                t_Department_Flag = resultSet.getInt(24);                t_Timezone = resultSet.getString(25);                t_Ignore_Sample = resultSet.getInt(26);                T_Serial_Enabled_Factory = resultSet.getString(27);            }        } catch (SQLException e) {            logger.error(e, e);            t_Status_Code = Failure_Code;            t_Error_Code = 210;            t_Error_Message = "Error fetching factory details in wrapper, Err Msg:" + e.getSQLState();            procedureParams_OutputMap = Log_Message(t_Error_Message);            return methodParams_OutputMap;        }        t_Stmt_Num = 20;        if (i_Transaction_Id == null) {            // --if lot code is begin run for debugging one txn only            // --added to take care of multiple lot edapters for same factory            /*dbms_output.put_line(t_lot_process_status-||t_lot_process_status);                     if t_lot_process_status=2                     then                     dbms_output.put_line(Multiple threads are running);                     tLotUtilsObject.t_multi_thread;   --display message in output file                     return;                     else                     update  t_factories                     set lot_process_status=2                     where   factory_id=t_factory_id;                     commit;                     end if;*/            try {                Sql = "SELECT  Lot_Process_Status " + " From t_Factories " + " Where Factory_Id = ? " + " For Update Of Lot_Process_Status Nowait  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Factory_Id);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Lot_Process_Status = resultSet.getInt(1);                }                if (((t_Lot_Process_Status != null ? t_Lot_Process_Status : 2) == 2)) {                    Log_Msg = "Multiple threads are running,Check. If none are running then update lot_process_status in t_factories to 1 for this factory: " + i_Factory_Name;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    logger.debug(Log_Msg);                    logger.debug("Multiple Threads are running");                    logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                    logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                    logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                    // display message in output file                    tLotUtilsObject.T_Multi_Thread();                    Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = Nvl  (  Lot_Process_Status , ? )  " + " Where Factory_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, 1);                    preparedStatement.setObject(2, t_Factory_Id);                    preparedStatement.executeUpdate();                    connection.commit();                    // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                    // --Error Concurrent Request if Multiple Threads are Running.                    // --Some alert will hopefully catch this errored request                    // ------------------------------------------------------------------------------------------------------                    tLotUtilsObject.T_Global_Conc_Error = true;                    tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                    // ------------------------------------------------------------------------------------------------------                    // --To SET Concurrent Program Status, Added till here(Tri2:)                    return methodParams_OutputMap;                } else {                    Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, 2);                    preparedStatement.setObject(2, t_Factory_Id);                    preparedStatement.executeUpdate();                    connection.commit();                }                // }catch  ( t_No_Wait_Detected e) {            } catch (RuntimeException e) {                t_Error_Message = "Lot process status in T_FACTORIES is being updated by another thread";                procedureParams_OutputMap = Log_Message(t_Error_Message);                logger.debug(t_Error_Message);                logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                logger.debug(t_Error_Message);                tLotUtilsObject.T_Multi_Thread();                // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                // --Error Concurrent Request if Multiple Threads are Running.                // --Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                tLotUtilsObject.T_Global_Conc_Error = true;                tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                // --Error Concurrent Request if Multiple Threads are Running. Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                // --To SET Concurrent Program Status, Added till here(Tri2:)                return methodParams_OutputMap;            } catch (SQLException e) {                logger.error(e, e);                t_Error_Message = "Error in updating T_Factories, Err Msg: " + e.getSQLState();                procedureParams_OutputMap = Log_Message(t_Error_Message);                logger.debug(t_Error_Message);                logger.debug("Multiple Lot eDapter Concurrent Programs are running for this Factory/Org: " + i_Factory_Name);                logger.debug("Lot_process_status in T_FACTORIES is 2. Cannot Start processing Transactions, Exiting");                logger.debug(t_Error_Message);                logger.debug(t_Error_Message);                // --MohanVamsi 27 May2010, To SET Concurrent Program Status(Tri2:)                // --Error Concurrent Request if Multiple Threads are Running.                // --Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                tLotUtilsObject.T_Global_Conc_Error = true;                tLotUtilsObject.T_Global_Conc_Error_Msg = "Concurrent Request encountered one or more Errors. Check Log and Output.";                // --Error Concurrent Request if Multiple Threads are Running. Some alert will hopefully catch this errored request                // ------------------------------------------------------------------------------------------------------                // --To SET Concurrent Program Status, Added till here(Tri2:)                return methodParams_OutputMap;            }        }        t_Factory_Name = i_Factory_Name;        t_User_Id = i_User_Id;        t_Stmt_Num = 30;        Sql = "SELECT  * " + " From t_Property_Lots " + " Where Factory_Id = ? ";        preparedStatement = connection.prepareStatement(Sql);        preparedStatement.setObject(1, t_Factory_Id);        resultSet1 = preparedStatement.executeQuery();        while (resultSet1.next()) {            String t_Chk_Col_Rec_Destination_Table = resultSet1.getString("DESTINATION_TABLE");            String t_Chk_Col_Rec_Destination_Column = resultSet1.getString("DESTINATION_COLUMN");            try {                Sql = "SELECT  x " + " From All_Tab_Columns " + " Where Table_Name = ? " + " And Column_Name = ? ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Chk_Col_Rec_Destination_Table);                preparedStatement.setObject(2, t_Chk_Col_Rec_Destination_Column);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Dummy = resultSet.getString(1);                }            } catch (SQLException e) {                logger.error(e, e);                t_Status_Code = Failure_Code;                t_Error_Code = 323;                t_Error_Message = "T_Transact_Lots: Error checking column existence: " + e.getSQLState();                logger.debug("T_Transact_Lots: Error Msg: " + t_Error_Message + ", at Stmt no: " + t_Stmt_Num);                procedureParams_OutputMap = Log_Message(t_Error_Message);                return methodParams_OutputMap;            }        }        t_Stmt_Num = 60;        if (i_Error_Records) {            logger.debug("T_Transact_Lots: Picking errored records also");            t_Reject_Code = Reject_Code;            t_Failure_Code = Failure_Code;            t_Api_Error_Code = Api_Error_Code;        } else {            t_Reject_Code = Reset_Code;            t_Failure_Code = Reset_Code;            t_Api_Error_Code = Reset_Code;        }        /*added by vishnu,28/01/2009, for PI,                             at pi there is no interface_id in wlmti, hence the below check is being performed*/        try {            Sql_String = "SELECT INTERFACE_ID FROM WSM_LOT_MOVE_TXN_INTERFACE WHERE ROWNUM =1 ";            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);            resultSet = preparedStatement.executeQuery();            resultSet.last();            totalRows = resultSet.getRow();            resultSet.beforeFirst();            if (resultSet.next() == false) {                throw new No_Data_Found("No Data Found");            } else {                Rows_Processed = 1;            }            if (Rows_Processed == 1) {                T_Wlmti_Interface_Id_Check = "Y";            }        } catch (SQLException e) {            logger.error(e, e);            T_Wlmti_Interface_Id_Check = "N";        }        // -- added upto here, vishnu,29/01/2009 ,for pi        Log_Msg = "Inside Transact_lots: Ready to Start process after initial checks";        procedureParams_OutputMap = Log_Message(Log_Msg);        logger.debug(Log_Msg);        // --Suds SiRF May26, 2009, for debugging date format issue. It is happening before the cursor. Check later        Sql = "SELECT  Value " + " From V$nls_Parameters " + " Where Parameter = ? ";        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);        preparedStatement.setObject(1, "NLS_DATE_FORMAT");        resultSet = preparedStatement.executeQuery();        resultSet.last();        totalRows = resultSet.getRow();        resultSet.beforeFirst();        if (totalRows > 1) {            throw new SQLException("Too Many Rows");        }        if (resultSet.next() == false) {            throw new No_Data_Found("No Data Found");        } else {            t_Nls_Date_Format = resultSet.getString(1);        }        procedureParams_OutputMap = Log_Message("1: The NLS Date format before C_LOT_REC is -" + t_Nls_Date_Format);        t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";        preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);        resultSet = preparedStatement.executeQuery();        resultSet.last();        totalRows = resultSet.getRow();        resultSet.beforeFirst();        if (totalRows > 1) {            throw new SQLException("Too Many Rows");        }        if (resultSet.next() == false) {            throw new No_Data_Found("No Data Found");        } else {        }        // --Suds SiRF May26, 2009        t_Rows_Processed = 0;        Sql = "SELECT   " + /*+ ordered use_nl (  b a ) */        " b. * " + " From  (  Select  " + /*+ INDEX (  A T_PARENT_LOTS_API_n2 ) */        " Rowid " + " From t_Parent_Lots_Api a " + " Where Status_Code In " + "  (   ?, " + " ?, " + " ?, " + " ?, " + " ?  )  " + " And New_Factory_Name = ? " + " And Transaction_Id = " + " Nvl  (   ?, Transaction_Id  )  " + " And Nvl  (   Lot_Id, x  )  = " + " Nvl  (   ?, Nvl  (   Lot_Id, x  )   )  " + " Order By Transaction_Id  )  a, " + " t_Parent_Lots_Api b " + " Where a.Rowid = b.Rowid " + " And Rownum < ?  ";        preparedStatement = connection.prepareStatement(Sql);        preparedStatement.setObject(1, Reset_Code);        preparedStatement.setObject(2, Found_Code);        preparedStatement.setObject(3, t_Reject_Code);        preparedStatement.setObject(4, t_Failure_Code);        preparedStatement.setObject(5, t_Api_Error_Code);        preparedStatement.setObject(6, i_Factory_Name);        preparedStatement.setObject(7, i_Transaction_Id);        preparedStatement.setObject(8, i_Lot_Id);        preparedStatement.setObject(9, t_Transactions_Per_Run);        resultSet2 = preparedStatement.executeQuery();        while (resultSet2.next()) {            String c_Lot_Rec_Old_Uom_Code = resultSet2.getString("Old_Uom_Code");            String c_Lot_Rec_Po_Line_Num = resultSet2.getString("Po_Line_Num");            String c_Lot_Rec_Transfer_Factory_Name = resultSet2.getString("Transfer_Factory_Name");            String c_Lot_Rec_Error_Message = resultSet2.getString("Error_Message");            String c_Lot_Rec_Transfer_Lot_Id = resultSet2.getString("Transfer_Lot_Id");            Integer c_Lot_Rec_Status_Code = resultSet2.getInt("Status_Code");            String c_Lot_Rec_New_Factory_Name = resultSet2.getString("New_Factory_Name");            Date c_Lot_Rec_Last_Update_Date = resultSet2.getDate("Last_Update_Date");            String c_Lot_Rec_Old_Department = resultSet2.getString("Old_Department");            String c_Lot_Rec_So_Line_Num = resultSet2.getString("So_Line_Num");            Integer c_Lot_Rec_Priority = resultSet2.getInt("Priority");            String c_Lot_Rec_Old_State_Id = resultSet2.getString("Old_State_Id");            String c_Lot_Rec_New_Routing = resultSet2.getString("New_Routing");            Integer c_Lot_Rec_Lot_Id = resultSet2.getInt("Lot_Id");            String c_Lot_Rec_Message_Id = resultSet2.getString("Message_Id");            String c_Lot_Rec_Old_Routing = resultSet2.getString("Old_Routing");            String c_Lot_Rec_Shipment_Number = resultSet2.getString("Shipment_Number");            String c_Lot_Rec_Po_Num = resultSet2.getString("Po_Num");            String c_Lot_Rec_Undo_Flag = resultSet2.getString("Undo_Flag");            String c_Lot_Rec_Nls_Code = resultSet2.getString("Nls_Code");            String c_Lot_Rec_So_Num = resultSet2.getString("So_Num");            String c_Lot_Rec_New_Department = resultSet2.getString("New_Department");            Date c_Lot_Rec_Creation_Date = resultSet2.getDate("Creation_Date");            String c_Lot_Rec_Subinv_Code = resultSet2.getString("Subinv_Code");            String c_Lot_Rec_Old_Bom_Level = resultSet2.getString("Old_Bom_Level");            String c_Lot_Rec_New_Lot_Id = resultSet2.getString("New_Lot_Id");            String c_Lot_Rec_Old_Lot_Type = resultSet2.getString("Old_Lot_Type");            String c_Lot_Rec_Transfer_Subinv_Code = resultSet2.getString("Transfer_Subinv_Code");            Date c_Lot_Rec_Transaction_Date = resultSet2.getDate("Transaction_Date");            String c_Lot_Rec_Old_Factory_Name = resultSet2.getString("Old_Factory_Name");            String c_Lot_Rec_Old_Operation = resultSet2.getString("Old_Operation");            Integer c_Lot_Rec_Distribution_Account_Id = resultSet2.getInt("Distribution_Account_Id");            String c_Lot_Rec_Action_Code = resultSet2.getString("Action_Code");            String c_Lot_Rec_Cost_Flag = resultSet2.getString("Cost_Flag");            Integer c_Lot_Rec_Transferlot_Txn_Qty = resultSet2.getInt("Transferlot_Txn_Qty");            Date c_Lot_Rec_Due_Date = resultSet2.getDate("Due_Date");            Date c_Lot_Rec_Start_Date = resultSet2.getDate("Start_Date");            String c_Lot_Rec_New_Uom_Code = resultSet2.getString("New_Uom_Code");            Integer c_Lot_Rec_Transfer_Locator_Id = resultSet2.getInt("Transfer_Locator_Id");            String c_Lot_Rec_New_Bom_Level = resultSet2.getString("New_Bom_Level");            Integer c_Lot_Rec_Due_Qty = resultSet2.getInt("Due_Qty");            Integer c_Lot_Rec_New_Txn_Qty = resultSet2.getInt("New_Txn_Qty");            String c_Lot_Rec_New_Operation = resultSet2.getString("New_Operation");            String c_Lot_Rec_New_State_Id = resultSet2.getString("New_State_Id");            String c_Lot_Rec_Operation_Sequence = resultSet2.getString("Operation_Sequence");            String c_Lot_Rec_New_Lot_Type = resultSet2.getString("New_Lot_Type");            String c_Lot_Rec_Oracle_Alternate_Designator = resultSet2.getString("Oracle_Alternate_Designator");            Integer c_Lot_Rec_Transaction_Id = resultSet2.getInt("Transaction_Id");            Integer c_Lot_Rec_Old_Txn_Qty = resultSet2.getInt("Old_Txn_Qty");            Integer c_Lot_Rec_Locator_Id = resultSet2.getInt("Locator_Id");            String c_Lot_Rec_Timezone = resultSet2.getString("Timezone");            String c_Lot_Rec_Fab_Lot_Number = resultSet2.getString("Fab_Lot_Number");            String c_Lot_Rec_Account_Alias = resultSet2.getString("Account_Alias");            Integer c_Lot_Rec_Error_Code = resultSet2.getInt("Error_Code");            t_Stmt_Num = 71;            try {                // added by vyshnavi                // --Deepak 18 Dec,02  for tracking unhandled exception                // --Suds SiRF Feb, 2009, for debugging date format issue. Check later                Sql = "SELECT  Value " + " From V$nls_Parameters " + " Where Parameter = ?  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, "NLS_DATE_FORMAT");                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Nls_Date_Format = resultSet.getString(1);                }                procedureParams_OutputMap = Log_Message("2: The NLS Date format after C_LOT_REC is -" + t_Nls_Date_Format);                t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";                preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                }                procedureParams_OutputMap = Log_Message("//-----------------------------------------------------------------------------------");                procedureParams_OutputMap = Log_Message("Thread Initial txnid/date-" + c_Lot_Rec_Transaction_Id + "--" + c_Lot_Rec_Transaction_Date);                procedureParams_OutputMap = Log_Message("//-----------------------------------------------------------------------------------");                // --Suds SiRF Feb, 2009                /*vishnu 29 june 2009, commented below if condition for duplicate message id check.                                     un-necessary check being done. message_id is the link between the t_reason_accounts and tpla.                                     the message_id in tpla and reason_code in t_reason_accounts table joining columns,                                     hence it is possible that same message id can be used for multiple transaction in tpla, so the below check is not required.                                     */                /*      if c_lot_rec.message_id is not null                                     then                                     begin                                     --deepak 21 jan, 03 :check for duplicate message ids being subscribed                                     select x                                     into t_dummy                                     from t_parent_lots_api                                     where transaction_id < c_lot_rec.transaction_id and                                     new_factory_name = i_factory_name and                                     message_id = c_lot_rec.message_id and rownum = 1;                                     update t_parent_lots_api                                     set status_code   = success_code,                                     error_message = duplicate message id                                     where transaction_id = c_lot_rec.transaction_id;                                     goto end_transact_loop;                                     exception                                     when no_data_found then                                     null;                                     end;                                     end if;                                     */                t_Stmt_Num = 75;                Sql = "UPDATE t_Child_Lots_Api " + " Set Lot_Id = Trim  (  Lot_Id )  " + " Where Transaction_Id = ?  ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, c_Lot_Rec_Transaction_Id);                preparedStatement.executeUpdate();                t_Lot_Rec.Transaction_Id = c_Lot_Rec_Transaction_Id;                t_Lot_Rec.Status_Code = c_Lot_Rec_Status_Code;                t_Lot_Rec.Old_Factory_Name = c_Lot_Rec_Old_Factory_Name;                t_Lot_Rec.New_Factory_Name = c_Lot_Rec_New_Factory_Name;                t_Lot_Rec.ERROR_CODE = c_Lot_Rec_Error_Code;                t_Lot_Rec.Error_Message = c_Lot_Rec_Error_Message;                t_Lot_Rec.Action_Code = c_Lot_Rec_Action_Code;                t_Lot_Rec.Lot_Id = c_Lot_Rec_Lot_Id.toString();                t_Lot_Rec.New_Lot_Id = c_Lot_Rec_New_Lot_Id;                t_Lot_Rec.Transfer_Lot_Id = c_Lot_Rec_Transfer_Lot_Id;                t_Lot_Rec.Old_Operation = c_Lot_Rec_Old_Operation;                t_Lot_Rec.New_Operation = c_Lot_Rec_New_Operation;                t_Lot_Rec.Operation_Sequence = c_Lot_Rec_Operation_Sequence;                t_Lot_Rec.Old_Txn_Qty = c_Lot_Rec_Old_Txn_Qty;                t_Lot_Rec.New_Txn_Qty = c_Lot_Rec_New_Txn_Qty;                t_Lot_Rec.Transferlot_Txn_Qty = c_Lot_Rec_Transferlot_Txn_Qty;                t_Lot_Rec.Old_Department = c_Lot_Rec_Old_Department;                t_Lot_Rec.New_Department = c_Lot_Rec_New_Department;                // convert date to calendar                Calendar c = Calendar.getInstance();                c.setTime(c_Lot_Rec_Transaction_Date);                // manipulate date -- Adding days                int numberOfDays = Integer.parseInt(t_Timezone) / 24 > 0 ? Integer.parseInt(t_Timezone) / 24 : 0;                c.add(Calendar.DATE, numberOfDays);                // convert calendar to date                // Deepak 14 Jan,2003                t_Lot_Rec.Transaction_Date = (java.sql.Date) c.getTime();                t_Lot_Rec.Old_Lot_Type = c_Lot_Rec_Old_Lot_Type;                t_Lot_Rec.New_Lot_Type = c_Lot_Rec_New_Lot_Type;                t_Lot_Rec.Old_Routing = c_Lot_Rec_Old_Routing;                t_Lot_Rec.New_Routing = c_Lot_Rec_New_Routing;                t_Lot_Rec.New_Bom_Level = c_Lot_Rec_New_Bom_Level;                t_Lot_Rec.Old_Bom_Level = c_Lot_Rec_Old_Bom_Level;                t_Lot_Rec.Po_Num = c_Lot_Rec_Po_Num;                t_Lot_Rec.Po_Line_Num = c_Lot_Rec_Po_Line_Num;                t_Lot_Rec.So_Num = c_Lot_Rec_So_Num;                t_Lot_Rec.So_Line_Num = c_Lot_Rec_So_Line_Num;                t_Lot_Rec.Due_Date = new java.sql.Date(c_Lot_Rec_Due_Date.getTime());                t_Lot_Rec.Due_Qty = c_Lot_Rec_Due_Qty;                t_Lot_Rec.Priority = c_Lot_Rec_Priority;                t_Lot_Rec.Old_Uom_Code = c_Lot_Rec_Old_Uom_Code;                t_Lot_Rec.New_Uom_Code = c_Lot_Rec_New_Uom_Code;                t_Lot_Rec.Old_State_Id = c_Lot_Rec_Old_State_Id;                t_Lot_Rec.New_State_Id = c_Lot_Rec_New_State_Id;                t_Lot_Rec.Timezone = c_Lot_Rec_Timezone;                t_Lot_Rec.Nls_Code = c_Lot_Rec_Nls_Code;                t_Lot_Rec.Undo_Flag = c_Lot_Rec_Undo_Flag;                t_Lot_Rec.Message_Id = c_Lot_Rec_Message_Id;                t_Lot_Rec.Start_Date = new java.sql.Date(c_Lot_Rec_Start_Date.getTime());                // added for inventory                t_Lot_Rec.Last_UpDate_Date = new java.sql.Date(c_Lot_Rec_Last_Update_Date.getTime());                t_Lot_Rec.Creation_Date = new java.sql.Date(c_Lot_Rec_Creation_Date.getTime());                t_Lot_Rec.Transfer_Factory_Name = c_Lot_Rec_Transfer_Factory_Name;                t_Lot_Rec.Subinv_Code = c_Lot_Rec_Subinv_Code;                t_Lot_Rec.Transfer_Subinv_Code = c_Lot_Rec_Transfer_Subinv_Code;                t_Lot_Rec.Distribution_Account_Id = c_Lot_Rec_Distribution_Account_Id;                t_Lot_Rec.Account_Alias = c_Lot_Rec_Account_Alias;                t_Lot_Rec.Locator_Id = c_Lot_Rec_Locator_Id;                t_Lot_Rec.Transfer_Locator_Id = c_Lot_Rec_Transfer_Locator_Id;                t_Lot_Rec.Shipment_Number = c_Lot_Rec_Shipment_Number;                // Hari K, Microtune IBM solution, reusing existing column                t_Lot_Rec.Cost_Flag = c_Lot_Rec_Cost_Flag;                // Vishnu Gutta, for PI,May1                t_Lot_Rec.Fab_Lot_Number = c_Lot_Rec_Fab_Lot_Number;                // By MohanVamsi/Mahendra on 27 Oct"09 for BOM alternates                t_Lot_Rec.Oracle_Alternate_Designator = c_Lot_Rec_Oracle_Alternate_Designator;                // --  dbms_output.put_line(t_lot_rec.transaction_date-||t_lot_rec.transaction_date);                t_Status_Code = Reset_Code;                t_Found_Flag = false;                t_Merge_Flag = false;                t_Oracle_Uom = null;                t_Error_Code = null;                t_Error_Message = null;                x_Wip_Qty = 0;                // Deepak 03 Jan,03                t_Check_Bom = true;                // Deepak 03 Jan,03                t_Same_Bom_Level = false;                // Deepak 03 Jan,03                t_Skip_Bom_Level = false;                // Deepak 03 Jan,03                t_Undo = false;                // --  t_txn_qty1:=t_lot_rec.new_txn_qty;  --Deepak 03 Jan,03  --for UNDOS                // --  t_uom1:=t_lot_rec.new_uom_code;   --Deepak 03 Jan,03                // -- since the waiting model updates records                // -- to waiting after the cursor was opened                // --Added by MohanVamsi/Mahendra, 24th Mar2010 since the Txns are not getting picked if Invalid Action is passed.                t_Stmt_Num = 76;                if (t_Lot_Rec.Action_Code == null) {                    t_Status_Code = Reject_Code;                    t_Error_Code = 76;                    t_Error_Message = "Transact_Lots: Action Code cannot be null";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                } else if (!("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code) || "CONSUME".equals(t_Lot_Rec.Action_Code) || "TERMINATE".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code) || "MOVE".equals(t_Lot_Rec.Action_Code) || "UNDO MOVE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code) || "SPLIT".equals(t_Lot_Rec.Action_Code) || "CHANGE ITEM".equals(t_Lot_Rec.Action_Code) || "CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGE QTY".equals(t_Lot_Rec.Action_Code) || "LOT LINK".equals(t_Lot_Rec.Action_Code) || "COMPLETE".equals(t_Lot_Rec.Action_Code) || "TRANSFER".equals(t_Lot_Rec.Action_Code) || "HOLD".equals(t_Lot_Rec.Action_Code) || "RELEASE".equals(t_Lot_Rec.Action_Code) || "UNSTART".equals(t_Lot_Rec.Action_Code) || "START".equals(t_Lot_Rec.Action_Code) || "UNCONSUME".equals(t_Lot_Rec.Action_Code) || "UNCOMPLETE".equals(t_Lot_Rec.Action_Code) || "UNSCRAP".equals(t_Lot_Rec.Action_Code) || "SCRAP".equals(t_Lot_Rec.Action_Code) || "CANCEL".equals(t_Lot_Rec.Action_Code) || "CHANGE ROUTING".equals(t_Lot_Rec.Action_Code) || "UN LINK".equals(t_Lot_Rec.Action_Code) || "UNDOS".equals(t_Lot_Rec.Action_Code) || "BONUS QTY".equals(t_Lot_Rec.Action_Code) || "MERGE".equals(t_Lot_Rec.Action_Code) || "REVERSE".equals(t_Lot_Rec.Action_Code))) {                    t_Status_Code = Reject_Code;                    t_Error_Code = (int) 76.01;                    t_Error_Message = "Transact_Lots: Please check the Action Code";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --Added by MohanVamsi/Mahendra, 24th Mar2010 for validating Action Codes.                t_Stmt_Num = 80;                Sql = "SELECT  Status_Code " + " From t_Parent_Lots_Api " + " Where Transaction_Id = ?  ";                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                resultSet = preparedStatement.executeQuery();                resultSet.last();                totalRows = resultSet.getRow();                resultSet.beforeFirst();                if (totalRows > 1) {                    throw new SQLException("Too Many Rows");                }                if (resultSet.next() == false) {                    throw new No_Data_Found("No Data Found");                } else {                    t_Status_Code = resultSet.getInt(1);                }                if (t_Status_Code == Waiting_Code) {                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // -- Changed and Moved the waiting Model to here by MohanVamsi/Mahendra on 05th Feb10                // -----------------CLose CURSOR Waiting Model Starts--------------------                // -- Added code to get the lot id in the TCLA                // -- Added the if condition for direct org transfer as the waiting model is different for direct org transfer                t_Stmt_Num = 85;                if (("DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code))) {                    // -- Direct org should only wait for the lots in its own factory                    // -- and should only wait if the current factory is a destination factory in previos transaction                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                    // --Below Elsif Added by MohanVamsi/Hari-K 22-Feb-2012, to Make Consume Txn Wait until Previous Consume is                    // --Successful which uses same Component-Lots                    /**                     * *********************************************************************************************                     */                    /**                     * **********************************************************************************************                     *                                             |                                                                                                 |                     *                                             |             UNCOMMENT THIS FOR Any-Other Clients except SUNPOWER                                |                     *                                             /************************************************************************************************                     */                    /**                     * *********************************************************************************************                     */                    /*Elsif t_Lot_Rec.Action_Code = CONSUME Then                                             T_Stmt_Num := 85.1;                                             Open Parent_Wait_Rec For                                             Select Tpla.Transaction_Id, Tcla.Lot_Id                                             From Apps.t_Parent_Lots_Api Tpla,                                             Apps.t_Child_Lots_Api Tcla ,                                             Apps.t_child_lots_api x2                                             Where Tpla.Transaction_Id = Tcla.Transaction_Id(+)                                             And x2.Transaction_Id   < tpla.Transaction_Id                                             And ( Nvl(Tpla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(New_Lot_Id, x)  = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y) Or                                             Nvl(x2.lot_id,X)    = Nvl(tcla.lot_id,Y)                                             )                                             And Tpla.Transaction_Id   < t_Lot_Rec.Transaction_Id                                             And ( Nvl(New_Factory_Name, x)  = i_Factory_Name Or                                             Nvl(New_Factory_Name, x)  = Nvl(t_Lot_Rec.Transfer_Factory_Name, y) Or                                             Nvl(Transfer_Factory_Name, x) = i_Factory_Name Or                                             Nvl(Transfer_Factory_Name, x) = Nvl(t_Lot_Rec.Transfer_Factory_Name, y)                                             )                                             And ( Tpla.Status_Code = Reset_Code Or                                             Tpla.Status_Code = Failure_Code Or                                             Tpla.Status_Code = Reject_Code Or                                             Tpla.Status_Code = Waiting_Code Or                                             Tpla.Status_Code = Found_Code Or                                             Tpla.Status_Code = Api_Error_Code Or                                             Tpla.Status_Code = Onhold_Code                                             )                                             And Rownum = 1;                                             Loop                                             Fetch Parent_Wait_Rec                                             Into t_Transaction_Id, t_Wait_Child_Lot;                                             Exit When Parent_Wait_Rec%Notfound;                                             Update t_Parent_Lots_Api                                             Set Status_Code   = Waiting_Code,                                             Error_Message = Wtg.parent for Consume:  || t_Transaction_Id ||, at stmt: ||t_Stmt_Num                                             Where Lot_Id                          = t_Lot_Rec.Lot_Id                                             And Transaction_Id                 >= t_Lot_Rec.Transaction_Id                                             And (Nvl(New_Factory_Name, x)     = i_Factory_Name Or                                             Nvl(New_Factory_Name, x)      = Nvl(t_Lot_Rec.Transfer_Factory_Name, y) Or                                             Nvl(Transfer_Factory_Name, x) = i_Factory_Name Or                                             Nvl(Transfer_Factory_Name, x) = Nvl(t_Lot_Rec.Transfer_Factory_Name, y))                                             And Status_Code = Reset_Code;                                             Close Parent_Wait_Rec;                                             Goto End_Transact_Loop;                                             End Loop;                                             Close Parent_Wait_Rec;   */                    /**                     * *********************************************************************************************                     */                    /**                     * **********************************************************************************************                     *                                             |                                                                                                 |                     *                                             |             UNCOMMENT TILL HERE FOR Any-Other Clients except SUNPOWER                           |                     *                                             /************************************************************************************************                     */                    /**                     * *********************************************************************************************                     */                    // --Special Case for SUNPOWER, SPLIT of Child Lot used in previous Consume of Parent                    // --should not wait Ex: SPLIT of WF should not wait for DIE CONSUME                } else if (t_Lot_Rec.Action_Code.equals("SPLIT")) {                    t_Stmt_Num = (int) 85.2;                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  " + // -- Or  Nvl(New_Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y)                    // -- Or  Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Rec.Lot_Id, y)                    " )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        // --t_wait_child_lot is only used for instransit Receipt                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                } else {                    t_Stmt_Num = 86;                    // --for all other action codes in tpla                    Sql = "SELECT  Tpla.Transaction_Id, Tcla.Lot_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        // --t_wait_child_lot is only used for instransit Receipt                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                }                // -- For Waitng model for IntransitShipment .Intransit Receipt and IINTREQINTRANSITRECEIPT)                // -- Looks FOR THE particular RECORD IN THE TCLA FOR THE child lot AND keeps THE RECORD IN TPLA waiting                t_Stmt_Num = 87;                if (("INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wait_Child_Lot = resultSet.getString(1);                    }                    Sql = "SELECT  Min ( Tpla.Transaction_Id) " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  Or " + " Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Wait_Child_Lot, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )   ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Transaction_Id = resultSet.getInt(1);                    }                    if (t_Transaction_Id != null) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                t_Stmt_Num = (int) 87.5;                if (("CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT   " + /*+ INDEX ( A,T_PARENT_LOTS_API_N1)  */                    " Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  Or " + " Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.New_Lot_Id, y )  )  " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? Or " + " Tcla.Status_Code = ? )  " + " And  Rownum = 1";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Found_Code);                    preparedStatement.setObject(9, Api_Error_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Parent_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Parent_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Previous lot transaction for new_lot_id waiting , Check this is incorrect data. || " + " ? " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Failure_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id > t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.executeUpdate();                        // Parent_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Parent_Wait_Rec.close ( );                }                // -- start transactions will wait if the consumption lot  direct org transfer is still pending                // -- check if the tcla entry has pending record in other faactories tpla/tcla                // -- check for the tcla entry has any pending record in current factories tcla/tpla                t_Stmt_Num = 89;                if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Sql = "SELECT  Tcla1.Lot_Id " + " From t_Child_Lots_Api Tcla1, t_Parent_Lots_Api Tpla1 " + " Where Tpla1.Transaction_Id = Tcla1.Transaction_Id " + " And Tpla1.New_Factory_Name = ? " + " And Tpla1.Transaction_Id = ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, i_Factory_Name);                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                    Child_Wait_Rec1_ResultSet = preparedStatement.executeQuery();                    while (Child_Wait_Rec1_ResultSet.next()) {                        Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  )  " + " And Tpla.Action_Code Not Like START " + " And Tpla.Status_Code In   (  ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ? )  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, i_Factory_Name);                        preparedStatement.setObject(2, i_Factory_Name);                        preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.setObject(5, Waiting_Code);                        preparedStatement.setObject(6, Reject_Code);                        preparedStatement.setObject(7, Failure_Code);                        preparedStatement.setObject(8, Api_Error_Code);                        preparedStatement.setObject(9, Found_Code);                        preparedStatement.setObject(10, Onhold_Code);                        Child_Wait_Rec_ResultSet = preparedStatement.executeQuery();                        while (Child_Wait_Rec_ResultSet.next()) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Child- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Waiting_Code);                            preparedStatement.setObject(2, t_Transaction_Id);                            preparedStatement.setObject(3, t_Stmt_Num);                            preparedStatement.setObject(4, Reset_Code);                            preparedStatement.executeUpdate();                            // Child_Wait_Rec.close ( );                            // Child_Wait_Rec.close ( );                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // Child_Wait_Rec.close ( );                    }                    // Child_Wait_Rec.close ( );                }                t_Stmt_Num = (int) 89.01;                if (t_Lot_Rec.Action_Code.equals("TRANSFER")) {                    Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  New_Factory_Name, x )  = ? Or " + " Nvl  (  New_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  Or " + " Nvl  (  Transfer_Factory_Name, x )  = ? Or " + " Nvl  (  Transfer_Factory_Name, x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name, y )  )  " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Reset_Code);                    preparedStatement.setObject(5, Failure_Code);                    preparedStatement.setObject(6, Reject_Code);                    preparedStatement.setObject(7, Waiting_Code);                    preparedStatement.setObject(8, Api_Error_Code);                    preparedStatement.setObject(9, Found_Code);                    preparedStatement.setObject(10, Onhold_Code);                    Transfer_Wait_Rec_ResultSet = preparedStatement.executeQuery();                    while (Transfer_Wait_Rec_ResultSet.next()) {                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? || " + "  , at stmt:  || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, t_Transaction_Id);                        preparedStatement.setObject(3, t_Stmt_Num);                        preparedStatement.executeUpdate();                        // Transfer_Wait_Rec.close ( );                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Transfer_Wait_Rec.close ( );                }                t_Stmt_Num = (int) 89.02;                if (("SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MERGE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Sql = "SELECT  Tcla1.Lot_Id " + " From t_Child_Lots_Api Tcla1, t_Parent_Lots_Api Tpla1 " + " Where Tpla1.Transaction_Id = Tcla1.Transaction_Id " + " And Tpla1.New_Factory_Name = ? " + " And Tpla1.Transaction_Id = ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, i_Factory_Name);                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                    Child_Wait_Rec1_ResultSet = preparedStatement.executeQuery();                    while (Child_Wait_Rec1_ResultSet.next()) {                        Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.New_Factory_Name = ? " + " And Tpla.Transaction_Id < ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Id, y )  " + // --Or Nvl(Tcla.Lot_Id, x) = Nvl(t_Lot_Id, y)                        // --Uncomment for any other Client other than SunPower                        // --Commented by MohanVamsi/Hari-K 22-Feb-2012                        " )  " + " And Tpla.Status_Code In   (  ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ?, " + " ? )  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, i_Factory_Name);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(3, Reset_Code);                        preparedStatement.setObject(4, Waiting_Code);                        preparedStatement.setObject(5, Reject_Code);                        preparedStatement.setObject(6, Failure_Code);                        preparedStatement.setObject(7, Api_Error_Code);                        preparedStatement.setObject(8, Found_Code);                        preparedStatement.setObject(9, Onhold_Code);                        Child_Wait_Rec_ResultSet = preparedStatement.executeQuery();                        while (Child_Wait_Rec_ResultSet.next()) {                            if ((!t_Lot_Rec.Action_Code.toUpperCase().equals("SPLIT"))) {                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Child- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id >= t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Waiting_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.setObject(3, t_Stmt_Num);                                preparedStatement.setObject(4, Reset_Code);                                preparedStatement.executeUpdate();                                // Child_Wait_Rec.close ( );                                // Child_Wait_Rec.close ( );                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("SPLIT")) {                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Previous lot transaction for child lot_id waiting , Check this is incorrect data. || " + " ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Failure_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.executeUpdate();                                Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.parent- || ? || " + "  , at stmt:  || ? " + " Where Lot_Id = t_Lot_Rec.Lot_Id " + " And Transaction_Id > t_Lot_Rec.Transaction_Id " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )  " + " And Status_Code = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, Waiting_Code);                                preparedStatement.setObject(2, t_Transaction_Id);                                preparedStatement.setObject(3, t_Stmt_Num);                                preparedStatement.setObject(4, Reset_Code);                                preparedStatement.executeUpdate();                                // Child_Wait_Rec.close ( );                                // Child_Wait_Rec.close ( );                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // Child_Wait_Rec.close ( );                    }                    // Child_Wait_Rec.close ( );                }                // -----------------CLose CURSOR Waiting Model Ends--------------------                // -- wake up the rest, next record                t_Transaction_Id = null;                logger.debug("t_Lot_Rec.Lot_Id: " + t_Lot_Rec.Lot_Id);                logger.debug("t_Lot_Rec.Transaction_Id: " + t_Lot_Rec.Transaction_Id);                logger.debug("t_Lot_Rec.Transfer_Factory_Name: " + t_Lot_Rec.Transfer_Factory_Name);                logger.debug("i_Factory_Name: " + i_Factory_Name);                logger.debug("Waiting_Code , Reject_Code , Api_Error_Code , Failure_Code" + Waiting_Code + " , " + Reject_Code + " , " + Api_Error_Code + " , " + Failure_Code);                t_Stmt_Num = (int) 89.03;                Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   Waiting_Code, " + " Reject_Code, " + " Api_Error_Code, " + " ?  )  ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                preparedStatement.setObject(2, i_Factory_Name);                preparedStatement.setObject(3, i_Factory_Name);                preparedStatement.setObject(4, Failure_Code);                resultSet3 = preparedStatement.executeQuery();                while (resultSet3.next()) {                    Integer Wake_Rec_Transaction_Id = resultSet3.getInt("Transaction_Id");                    // This will return a null value if the action code is CHANGELOTID.                    t_Transaction_Id = Wake_Rec_Transaction_Id;                    logger.debug("T_Transaction_Id1:" + t_Transaction_Id);                }                if (("CHANGE LOTID".equals(t_Lot_Rec.Action_Code) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = " + " Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   t_Lot_Rec.New_Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   Waiting_Code, " + " Reject_Code, " + " Api_Error_Code, " + " ?  )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Failure_Code);                    resultSet4 = preparedStatement.executeQuery();                    while (resultSet4.next()) {                        Integer Wake_Rec1_Transaction_Id = resultSet4.getInt("Transaction_Id");                        // ---changes made for waking up the next transaction of the new lot id                        if (t_Transaction_Id == null) {                            t_Transaction_Id = Wake_Rec1_Transaction_Id;                        } else if (t_Transaction_Id > Wake_Rec1_Transaction_Id) {                            t_Transaction_Id = Wake_Rec1_Transaction_Id;                        }                    }                }                logger.debug("T_Transaction_Id2: " + t_Transaction_Id);                t_Stmt_Num = (int) 89.04;                if (t_Transaction_Id != null) {                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Reset- || t_Lot_Rec.Transaction_Id || " + "  , at stmt:  || ? " + " Where Transaction_Id = ? " + " And   (  Nvl  (  New_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  New_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  Or " + " Nvl  (  Transfer_Factory_Name , x )  = i_Factory_Name Or " + " Nvl  (  Transfer_Factory_Name , x )  = " + " Nvl  (  t_Lot_Rec.Transfer_Factory_Name , y )  )   ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, Reset_Code);                    preparedStatement.setObject(2, t_Stmt_Num);                    preparedStatement.setObject(3, t_Transaction_Id);                    preparedStatement.executeUpdate();                }                t_Stmt_Num = (int) 89.05;                Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? ";                preparedStatement = connection.prepareStatement(Sql);                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                resultSet5 = preparedStatement.executeQuery();                while (resultSet5.next()) {                    Integer Wake_Rec2_Lot_Id = resultSet5.getInt("Lot_Id");                    Integer Wake_Rec2_Transaction_Id = resultSet5.getInt("Transaction_Id");                    Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = " + " Tcla.Transaction_Id  (   +  )  " + " And   (   Nvl  (   Tpla.Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )  Or " + " Nvl  (   Tpla.New_Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )  Or " + " Nvl  (   Tcla.Lot_Id, x  )  = " + " Nvl  (   Wake_Rec2_Lot_Id, y  )   )  " + " And Tpla.Transaction_Id > " + " ? " + " And   (   Nvl  (   New_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   New_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )  Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " ? Or " + " Nvl  (   Transfer_Factory_Name, x  )  = " + " Nvl  (   t_Lot_Rec.Transfer_Factory_Name, y  )   )  " + " And Tpla.Status_Code In " + "  (   ?, " + " ?, " + " ?, " + " ?  )  ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, Wake_Rec2_Transaction_Id);                    preparedStatement.setObject(2, i_Factory_Name);                    preparedStatement.setObject(3, i_Factory_Name);                    preparedStatement.setObject(4, Waiting_Code);                    preparedStatement.setObject(5, Reject_Code);                    preparedStatement.setObject(6, Api_Error_Code);                    preparedStatement.setObject(7, Failure_Code);                    resultSet6 = preparedStatement.executeQuery();                    while (resultSet6.next()) {                        Integer Wake_Rec3_Transaction_Id = resultSet6.getInt("Transaction_Id");                        // --Reset child records if present                        Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Reset- || t_Lot_Rec.Transaction_Id || " + "  , at stmt:  || ? " + " Where Transaction_Id = ? " + " And    (   Nvl   (   New_Factory_Name , x  )   = ? Or " + " Nvl   (   New_Factory_Name , x  )   = " + " Nvl   (   t_Lot_Rec.Transfer_Factory_Name , y  )   Or " + " Nvl   (   Transfer_Factory_Name , x  )   = ? Or " + " Nvl   (   Transfer_Factory_Name , x  )   = " + " Nvl   (   t_Lot_Rec.Transfer_Factory_Name , y  )    )   " + " And Status_Code In " + "   (   ? , ? , ? , ?  )    ,? ,? ,Wake_Rec3_Transaction_Id ,? ,i_Factory_Name ,i_Factory_Name ,Failure_Code )   ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, Waiting_Code);                        preparedStatement.setObject(2, Reject_Code);                        preparedStatement.setObject(3, Api_Error_Code);                        preparedStatement.setObject(4, Reset_Code);                        preparedStatement.setObject(5, t_Stmt_Num);                        preparedStatement.executeUpdate();                    }                }                // -- Waiting  model ends                // -- Added till here by MohanVamsi/Mahendra on 05th Feb10 to change and move Waiting Model                // --------- scrub and take actions based on lot type----------                // ------------get lot type details ---------                t_Stmt_Num = 90;                if (!("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code))) {                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Lot_Type_Details(t_Factory_Id, t_Lot_Rec.New_Lot_Type, //                     x_Track_In_Oracle, t_Class_Code, t_Bonus_Account_Id, t_Suspense_Account_Id, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Track_In_Oracle") != null) {                        x_Track_In_Oracle = (java.lang.Integer) procedureParams_OutputMap.get("o_Track_In_Oracle");                    }                    if (procedureParams_OutputMap.get("o_Class_Code") != null) {                        t_Class_Code = (java.lang.String) procedureParams_OutputMap.get("o_Class_Code");                    }                    if (procedureParams_OutputMap.get("o_Bonus_Account_Id") != null) {                        t_Bonus_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Bonus_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Suspense_Account_Id") != null) {                        t_Suspense_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Suspense_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    logger.debug("Transact_Lots: status code at" + t_Stmt_Num + ":" + t_Status_Code);                    if (t_Status_Code != Success_Code) {                        try {                            // --Harikrishna June 02 for setting to waiting code in case of a non-successful parent record                            /* SELECT TRANSACTION_ID                                                         INTO T_CHILD_TXN_ID                                                         FROM T_PARENT_LOTS_API                                                         WHERE NEW_FACTORY_NAME = T_LOT_REC.NEW_FACTORY_NAME                                                         AND LOT_ID = T_LOT_REC.LOT_ID                                                         AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                                         AND (STATUS_CODE = RESET_CODE OR                                                         STATUS_CODE = FAILURE_CODE OR                                                         STATUS_CODE = REJECT_CODE OR                                                         STATUS_CODE = WAITING_CODE OR                                                         STATUS_CODE = FOUND_CODE OR                                                         STATUS_CODE = API_ERROR_CODE OR                                                         STATUS_CODE = ONHOLD_CODE)                                                         AND ROWNUM = 1;                                                         UPDATE T_PARENT_LOTS_API                                                         SET STATUS_CODE   = WAITING_CODE,                                                         ERROR_MESSAGE = Wtg.Parent- || T_CHILD_TXN_ID                                                         WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                                         GOTO END_TRANSACT_LOOP;*/                            // -- Commented Above and Added below for Wakeup By MohanVamsi/Mahendra on 5th Feb10                            Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And New_Factory_Name = ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(3, Reset_Code);                            preparedStatement.setObject(4, Failure_Code);                            preparedStatement.setObject(5, Reject_Code);                            preparedStatement.setObject(6, Waiting_Code);                            preparedStatement.setObject(7, Found_Code);                            preparedStatement.setObject(8, Api_Error_Code);                            preparedStatement.setObject(9, Onhold_Code);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Child_Txn_Id = resultSet.getInt(1);                            }                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Waiting_Code);                            preparedStatement.setObject(2, t_Child_Txn_Id);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Id);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // -- Added Till here By MohanVamsi/Mahendra on 5th Feb10                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -----global assignment                    g_Track_In_Oracle = x_Track_In_Oracle;                    procedureParams_OutputMap = Log_Message("Transact_Lots: Transaction Id: " + t_Lot_Rec.Transaction_Id);                    logger.debug("Transact_Lots: Track in Oracle: " + x_Track_In_Oracle);                    if (g_Track_In_Oracle == 1) {                        t_New_Routing = t_Lot_Rec.New_Routing;                        t_Stmt_Num = 100;                        if (t_Lot_Rec.New_Operation != null) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Lot_Rec.New_Factory_Name, t_New_Routing, t_Lot_Rec.New_Operation, t_Lot_Rec.Operation_Sequence, // Deepak 22 Mar, 03                            t_Lot_Rec.Transaction_Date, o_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("i_New_Routing") != null) {                                t_New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                            }                            if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                                o_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                            }                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                            // --When new routing is not provied in TPLA, the update bom level procedure of tLotUtilsObject gets                            // --the new routing from the routing attributes in bor and bos and popualtes it back into tpla,                            // --the fetched routing should be assigned to lot_rec                            t_Lot_Rec.New_Routing = t_New_Routing;                            procedureParams_OutputMap = Log_Message("Transact_Lots: BOM Level: " + o_Bom_Level + ", New Routing: " + t_New_Routing);                            procedureParams_OutputMap = Log_Message("Transact_Lots: Status Code:" + t_Status_Code);                            if (t_Status_Code != Success_Code) {                                try {                                    // --Harikrishna June 02 for setting to waiting code in case of a non-successful parent record                                    /*                  SELECT TRANSACTION_ID                                                                     INTO T_CHILD_TXN_ID                                                                     FROM T_PARENT_LOTS_API                                                                     WHERE NEW_FACTORY_NAME = T_LOT_REC.NEW_FACTORY_NAME                                                                     AND LOT_ID = T_LOT_REC.LOT_ID                                                                     AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                                                     AND (STATUS_CODE = RESET_CODE OR                                                                     STATUS_CODE = FAILURE_CODE OR                                                                     STATUS_CODE = REJECT_CODE OR                                                                     STATUS_CODE = WAITING_CODE OR                                                                     STATUS_CODE = FOUND_CODE OR                                                                     STATUS_CODE = API_ERROR_CODE OR                                                                     STATUS_CODE = ONHOLD_CODE)                                                                     AND ROWNUM = 1;                                                                     UPDATE T_PARENT_LOTS_API                                                                     SET STATUS_CODE   = WAITING_CODE,                                                                     ERROR_MESSAGE = Wtg.Parent- || T_CHILD_TXN_ID                                                                     WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                                                     GOTO END_TRANSACT_LOOP;*/                                    // -- Commented Above and Added below for Wakeup By MohanVamsi/Mahendra on 5th Feb10                                    Sql = "SELECT  Tpla.Transaction_Id " + " From t_Parent_Lots_Api Tpla, t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id = Tcla.Transaction_Id  (  + )  " + " And Tpla.New_Factory_Name = ? " + " And   (  Nvl  (  Tpla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tpla.New_Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  Or " + " Nvl  (  Tcla.Lot_Id, x )  = " + " Nvl  (  t_Lot_Rec.Lot_Id, y )  )  " + " And Tpla.Transaction_Id < ? " + " And   (  Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? Or " + " Tpla.Status_Code = ? )  " + " And  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                    preparedStatement.setObject(3, Reset_Code);                                    preparedStatement.setObject(4, Failure_Code);                                    preparedStatement.setObject(5, Reject_Code);                                    preparedStatement.setObject(6, Waiting_Code);                                    preparedStatement.setObject(7, Found_Code);                                    preparedStatement.setObject(8, Api_Error_Code);                                    preparedStatement.setObject(9, Onhold_Code);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Child_Txn_Id = resultSet.getInt(1);                                    }                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Wtg.Parent- || ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Waiting_Code);                                    preparedStatement.setObject(1, t_Child_Txn_Id);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                    // -- Added Till here By MohanVamsi/Mahendra on 5th Feb10                                } catch (No_Data_Found e) {                                    logger.error(e);                                }                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                        }                        // operation null                    }                    // -- Added from here By MohanVamsi/Mahendra on 10th Nov09 to check positive Qtys                    t_Stmt_Num = 105;                    if (t_Lot_Rec.New_Txn_Qty == 0) {                        t_Status_Code = Success_Code;                        t_Error_Code = 200;                        t_Error_Message = "Txn Qty is Zero, So Making this Transaction Success at stmt: " + t_Stmt_Num;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Lot_Rec.New_Txn_Qty < 0 && !("CONSUME".equals(t_Lot_Rec.Action_Code) || "UNCONSUME".equals(t_Lot_Rec.Action_Code))) {                        t_Status_Code = Reject_Code;                        t_Error_Code = 210;                        t_Error_Message = "Txn Qty Cannot be Negative for Action Code  " + t_Lot_Rec.Action_Code + " at stmt: " + t_Stmt_Num;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added till here By MohanVamsi/Mahendra on 10th Nov09 to check positive Qtys                    t_Stmt_Num = 110;                    procedureParams_OutputMap = t_Clean_Mess(i_Factory_Name, t_Lot_Rec.Transaction_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, // Deepak 21 Dec,02                    t_Error_Message);                    if (procedureParams_OutputMap.get("t_Lot_Rec") != null) {                        t_Lot_Rec = (beans.tlotutils.T_Lotrec_Type) procedureParams_OutputMap.get("t_Lot_Rec");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code == Success_Code) {                        // -- defect  -- on success                        // -- consume -- on failure                        // -- actions -- not linked to oracle                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // Deepak 21 Oct,02                    connection.commit();                    /* taken down below 130 Hari Krishnan,  Feb 07                                                 t_stmt_num :=120;                                                 dbms_output.put_line(incomingtransaction id- status code-||t_lot_rec.transaction_id||-->||t_lot_rec.status_code);                                                 begin                                                 select open_flag                                                 into t_period_open_flag                                                 from org_acct_periods                                                 where organization_id = t_organization_id                                                 --and period_close_date is null -- Hari Krishnan  Feb 07 Oracle 11.5.10. invttmtx.tdatechk                                                 and  period_start_date <= trunc(t_lot_rec.transaction_date)                                                 and schedule_close_date >= trunc(t_lot_rec.transaction_date);                                                 exception                                                 when no_data_found then                                                 begin                                                 select open_flag                                                 into t_period_open_flag                                                 from org_acct_periods                                                 where organization_id = t_organization_id                                                 and  period_start_date <= trunc(sysdate)                                                 and schedule_close_date >= trunc(sysdate);                                                 exception                                                 when no_data_found then                                                 t_period_open_flag :=N;                                                 end;                                                 end;                                                 */                    t_Stmt_Num = 130;                    // -- check if a period is open for the current date                    // -- to avoid OSFM defects                    // Hari K, resetting to false.                    t_First_Pass = false;                    if (t_First_Pass == false) {                        try {                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods " + " Where Organization_Id = ? " + " And Period_Start_Date <= Trunc  (  Sysdate )  " + " And Schedule_Close_Date >= Trunc  (  Sysdate )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Period_Open_Flag = "N";                        }                        if (t_Period_Open_Flag.equals("N")) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 250;                            t_Error_Message = "Accounting Period not open  for current date.Stopping Lots eDapter ";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 1);                            preparedStatement.setObject(2, i_Factory_Name);                            preparedStatement.executeUpdate();                            // --And User_Type          = 1;                            // ---Added by MohanVamsi for on 17 Sep08                            // Deepak 27 Dec,02                            connection.commit();                            // better to stop the run for the factory,hence return                            return methodParams_OutputMap;                        }                        // --***** UnComment this If PO and GL periods are Required. *****---                        /*   --Added By MohanVamsi for PO and GL period Check on Dec4th08                                                     BEGIN                                                     T_STMT_NUM := 131;                                                     SELECT 1                                                     INTO T_DUMMY                                                     FROM GL_PERIOD_STATUSES                                                     WHERE APPLICATION_ID = 201 ---201 for PO, 101 for GL (Check fnd_application table)                                                     AND SET_OF_BOOKS_ID =                                                     (SELECT SET_OF_BOOKS_ID                                                     FROM ORG_ORGANIZATION_DEFINITIONS                                                     WHERE ORGANIZATION_ID = T_ORGANIZATION_ID) AND                                                     TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE AND                                                     CLOSING_STATUS = O;                                                     EXCEPTION                                                     WHEN NO_DATA_FOUND THEN                                                     T_STATUS_CODE   := REJECT_CODE;                                                     T_ERROR_CODE    := 255;                                                     T_ERROR_MESSAGE := PO Period is not Open for the Organization.Stopping Lots eDapter. at stmt num  ||                                                     T_STMT_NUM;                                                     tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                     NULL,                                                     T_STATUS_CODE,                                                     T_ERROR_CODE,                                                     T_ERROR_MESSAGE,                                                     SET);                                                     UPDATE T_FACTORIES                                                     SET LOT_PROCESS_STATUS = 1                                                     WHERE FACTORY_NAME = I_FACTORY_NAME;                                                     COMMIT;                                                     RETURN;                                                     END;                                                     BEGIN                                                     T_STMT_NUM := 132;                                                     SELECT 1                                                     INTO T_DUMMY                                                     FROM GL_PERIOD_STATUSES                                                     WHERE APPLICATION_ID = 101 ---201 for PO, 101 for GL (Check fnd_application table)                                                     AND SET_OF_BOOKS_ID =                                                     (SELECT SET_OF_BOOKS_ID                                                     FROM ORG_ORGANIZATION_DEFINITIONS                                                     WHERE ORGANIZATION_ID = T_ORGANIZATION_ID) AND                                                     TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE AND                                                     CLOSING_STATUS = O AND ADJUSTMENT_PERIOD_FLAG = N;                                                     EXCEPTION                                                     WHEN NO_DATA_FOUND THEN                                                     T_STATUS_CODE   := REJECT_CODE;                                                     T_ERROR_CODE    := 257;                                                     T_ERROR_MESSAGE := GL Period is not Open for the Organization.Stopping Lots eDapter. at stmt num  ||                                                     T_STMT_NUM;                                                     tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                     NULL,                                                     T_STATUS_CODE,                                                     T_ERROR_CODE,                                                     T_ERROR_MESSAGE,                                                     SET);                                                     UPDATE T_FACTORIES                                                     SET LOT_PROCESS_STATUS = 1                                                     WHERE FACTORY_NAME = I_FACTORY_NAME;                                                     COMMIT;                                                     RETURN;                                                     END; --Added by MohanVamsi Till Here 4 Dec08                                                     */                        // -- else  -- Hari commented Feb 07                        t_First_Pass = true;                    }                    // Hari, brought down from above stmt 130, Feb 07 Validation is incorrect.                    t_Stmt_Num = (int) 120.1;                    logger.debug("Transact_Lots: Incoming Transaction Id , Status code: " + t_Lot_Rec.Transaction_Id + " , " + t_Lot_Rec.Status_Code);                    if (t_First_Pass) {                        try {                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods " + " Where Organization_Id = ? " + // Hari Krishnan  Feb 07 Oracle 11.5.10. invttmtx.tdatechk                            " And Period_Close_Date == null  " + " And Period_Start_Date <= Trunc  (  ? )  " + " And Schedule_Close_Date >= " + " Trunc  (  ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 251;                            t_Error_Message = "Accounting Period not open for the transaction date.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 1);                            preparedStatement.setObject(2, i_Factory_Name);                            preparedStatement.executeUpdate();                            // ---Added by MohanVamsi for on 17 Sep08                            // Deepak 27 Dec,02                            connection.commit();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // not returning as period is open and other txns can be considerd except this one.                    }                    // Hari Feb 07                    // -- chk later auto recovery                    if (t_Period_Open_Flag.equals("N")) {                        t_Status_Code = Reject_Code;                        t_Error_Code = 250;                        t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date. Cannot proceed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // ---Added by MohanVamsi for on 17 Sep08 useful during month ends,to process Factory Records                        Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Name = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 1);                        preparedStatement.setObject(2, i_Factory_Name);                        preparedStatement.executeUpdate();                        // ---Added by MohanVamsi for on 17 Sep08                        // Deepak 27 Dec,02                        connection.commit();                        return methodParams_OutputMap;                    }                    t_Stmt_Num = 140;                    // --check for duplicate oracle jobs and return                    // --if the action is start and it already exists , error out and stop                    if (t_Lot_Rec.Action_Code.equals("START")) {                        if (t_Job_Prefix != null) {                            Sql = "SELECT  t_Job_Prefix || t_Job_Separator || t_Lot_Rec.Lot_Id || " + " t_Job_Separator || t_Lot_Suffix " + " From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Check_Job_Name = resultSet.getString(1);                            }                            Sql = "SELECT  Length ( t_Check_Job_Name) From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Job_Len = resultSet.getInt(1);                            }                            try {                                Sql = "SELECT  Substr ( We.Wip_Entity_Name, 1, t_Job_Len), " + " Status_Type " + " From Wip_Entities We, Wip_Discrete_Jobs Wdj " + " Where We.Organization_Id = ? " + // -- and substr(we.wip_entity_name,1,t_job_len) =t_check_job_name                                " And We.Wip_Entity_Name = ? " + " And Wdj.Wip_Entity_Id = We.Wip_Entity_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Check_Job_Name);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Check_Job_Name = resultSet.getString(1);                                    t_Status_Type = resultSet.getInt(2);                                }                                if (t_Status_Type != 1) {                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 360;                                    t_Error_Message = "Attempt to start same lot, Check T Lots and T Oracle Jobs. Actions: In T_LOTS, Change Status; In T ORCL Jobs, Change Status and Active flag to appropriate values";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                            } catch (Too_Many_Rows e) {                                logger.error(e);                                try {                                    t_Stmt_Num = 150;                                    Sql = // Deepak 26 Dec,02                                    "SELECT  Unique_Id, Status  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 04 Dec,02                                    " And Bom_Level = ?   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                        t_Status = resultSet.getString(2);                                    }                                    if (t_Status.equals("T")) {                                        // null;                                    }                                    Sql = "SELECT  Status_Type " + " From Wip_Discrete_Jobs " + " Where Organization_Id = ? " + " And Wip_Entity_Id = " + "  (  Select Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ? " + " And Factory_Id = ? )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Unique_Id);                                    preparedStatement.setObject(3, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Status_Type = resultSet.getInt(1);                                    }                                    if (t_Status_Type != 1) {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 509;                                        t_Error_Message = "Attempt to start same lot.Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                } catch (Too_Many_Rows e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 525;                                    t_Error_Message = "Attempt to start same lot in same factory.Possible errors in T_LOTS table";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } else {                            t_Stmt_Num = 160;                            Sql = "SELECT  t_Lot_Rec.Lot_Id || t_Job_Separator || t_Lot_Suffix " + " From Dual ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Check_Job_Name = resultSet.getString(1);                            }                            Sql = "SELECT  Length ( t_Check_Job_Name) From Dual";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Job_Len = resultSet.getInt(1);                            }                            try {                                Sql = "SELECT  Substr ( We.Wip_Entity_Name, 1, t_Job_Len), " + " Status_Type  " + " From Wip_Entities We, Wip_Discrete_Jobs Wdj " + " Where We.Organization_Id = ? " + // -- and substr(we.wip_entity_name,1,t_job_len) =t_check_job_name                                " And We.Wip_Entity_Name = ? " + " And Wdj.Wip_Entity_Id = We.Wip_Entity_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Check_Job_Name);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Check_Job_Name = resultSet.getString(1);                                    t_Status_Type = resultSet.getInt(2);                                }                                if (t_Status_Type == 3) {                                    try {                                        Sql = "SELECT  Reset_Code, " + "  Waiting for lot to be completed in previous sector " + " From Wsm_Lot_Move_Txn_Interface " + " Where Wip_Entity_Name = ? " + " And Transaction_Type In   (  1, ? )  " + " And Status <> ? " + " And  Rownum = 1";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Check_Job_Name);                                        preparedStatement.setObject(2, 2);                                        preparedStatement.setObject(3, 4);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Code = resultSet.getInt(1);                                            t_Error_Message = resultSet.getString(2);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                    }                                    try {                                        Sql = "SELECT  Reset_Code, " + "  Errored/Pending  transaction in  previous sector exist " + " From t_Parent_Lots_Api " + " Where Lot_Id = ? " + " And Transaction_Id < ? " + " And New_Factory_Name = ? " + " And Status_Code <> ? " + " And  Rownum = 1";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Check_Job_Name);                                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                        preparedStatement.setObject(3, t_Lot_Rec.New_Factory_Name);                                        preparedStatement.setObject(4, 3);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Code = resultSet.getInt(1);                                            t_Error_Message = resultSet.getString(2);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                    }                                    if (t_Status_Code == Reset_Code && t_Error_Message != null) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                }                                if (t_Status_Type != 1) {                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 390;                                    t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                            } catch (Too_Many_Rows e) {                                logger.error(e);                                try {                                    t_Stmt_Num = 170;                                    Sql = "SELECT  Unique_Id, Status " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 04 Dec,02                                    " And Bom_Level = ?   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                        t_Status = resultSet.getString(2);                                    }                                    if (t_Status.equals("T")) {                                        // null;                                    }                                    Sql = "SELECT  Status_Type " + " From Wip_Discrete_Jobs " + " Where Organization_Id = ? " + " And Wip_Entity_Id = " + "  (  Select Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ? " + " And Factory_Id = ? )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Unique_Id);                                    preparedStatement.setObject(3, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Status_Type = resultSet.getInt(1);                                    }                                    if (t_Status_Type != 1) {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 591;                                        t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table or OSFM package WSMPLBJI";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                } catch (Too_Many_Rows e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 607;                                    t_Error_Message = "Attempt to start same lot. Possible errors in T_LOTS table";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        }                    }                    // -- LOG_MESSAGE(Before waiting model);                    // --  T_STMT_NUM := 180;                }                // -- waiting event  model                // -- WM after validate/check interface introduced                // --START not to be put in waiting                // -- Hari K Feb 07 removed commented waiting model using for loop. Not reqd anymore                // -----------------CLose CURSOR Waiting Model Starts--------------------                /*OPEN PARENT_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH PARENT_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.parent- || T_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID >= T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             OPEN PARENT_WAIT_REC FOR                                             SELECT \*+ INDEX(A,T_PARENT_LOTS_API_N1)  *\                                             TRANSACTION_ID                                             FROM T_PARENT_LOTS_API A                                             WHERE TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NEW_LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             --  if parent_wait_rec.transaction_id is not null                                             --  then                                             FETCH PARENT_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || T_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             --  end if;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             T_STMT_NUM := 190;                                             OPEN CHILD_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND EXISTS                                             (SELECT TCL.TRANSACTION_ID                                             FROM T_CHILD_LOTS_API  TCL,                                             T_PARENT_LOTS_API TPL                                             WHERE TCL.TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND TCL.FACTORY_NAME = I_FACTORY_NAME                                             AND TCL.LOT_ID = T_LOT_REC.LOT_ID                                             AND TPL.TRANSACTION_ID = TCL.TRANSACTION_ID                                             AND (TPL.STATUS_CODE = RESET_CODE OR                                             TPL.STATUS_CODE = WAITING_CODE OR                                             TPL.STATUS_CODE = REJECT_CODE OR                                             TPL.STATUS_CODE = FAILURE_CODE OR                                             TPL.STATUS_CODE = API_ERROR_CODE OR                                             TPL.STATUS_CODE = FOUND_CODE OR                                             TPL.STATUS_CODE = ONHOLD_CODE));                                             LOOP                                             FETCH CHILD_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN CHILD_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Child- || T_LOT_REC.TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE CHILD_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE CHILD_WAIT_REC;                                             IF T_LOT_REC.ACTION_CODE = TRANSFER                                             THEN                                             OPEN TRANSFER_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.TRANSFER_LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = FOUND_CODE OR STATUS_CODE = ONHOLD_CODE);                                             LOOP                                             FETCH TRANSFER_WAIT_REC                                             INTO T_TRANSACTION_ID;                                             EXIT WHEN TRANSFER_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || T_TRANSACTION_ID                                             WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID;                                             CLOSE TRANSFER_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE TRANSFER_WAIT_REC;                                             END IF;                                             T_STMT_NUM := 200;                                             IF UPPER(T_LOT_REC.ACTION_CODE) = MERGE                                             THEN                                             OPEN CHILD_LOTS_REC FOR                                             SELECT LOT_ID                                             FROM T_CHILD_LOTS_API                                             WHERE TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID                                             AND FACTORY_NAME = I_FACTORY_NAME;                                             LOOP                                             FETCH CHILD_LOTS_REC                                             INTO T_LOT_ID;                                             EXIT WHEN CHILD_LOTS_REC%NOTFOUND;                                             OPEN PARENT_WAIT_REC FOR                                             SELECT TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_ID                                             AND TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND (STATUS_CODE = RESET_CODE OR                                             STATUS_CODE = FAILURE_CODE OR                                             STATUS_CODE = REJECT_CODE OR                                             STATUS_CODE = WAITING_CODE OR                                             STATUS_CODE = FOUND_CODE OR                                             STATUS_CODE = API_ERROR_CODE OR                                             STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH PARENT_WAIT_REC                                             INTO TP_TRANSACTION_ID;                                             EXIT WHEN PARENT_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || TP_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE PARENT_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE PARENT_WAIT_REC;                                             OPEN CHILD_WAIT_REC FOR                                             SELECT TCL.TRANSACTION_ID                                             FROM T_CHILD_LOTS_API  TCL,                                             T_PARENT_LOTS_API TPL                                             WHERE TCL.TRANSACTION_ID < T_LOT_REC.TRANSACTION_ID                                             AND TCL.FACTORY_NAME = I_FACTORY_NAME                                             AND TCL.LOT_ID = T_LOT_ID                                             AND TPL.TRANSACTION_ID = TCL.TRANSACTION_ID(+)                                             AND (TPL.STATUS_CODE = RESET_CODE OR                                             TPL.STATUS_CODE = WAITING_CODE OR                                             TPL.STATUS_CODE = REJECT_CODE OR                                             TPL.STATUS_CODE = FAILURE_CODE OR                                             TPL.STATUS_CODE = API_ERROR_CODE OR                                             TPL.STATUS_CODE = FOUND_CODE OR                                             TPL.STATUS_CODE = ONHOLD_CODE)                                             AND ROWNUM = 1;                                             LOOP                                             FETCH CHILD_WAIT_REC                                             INTO TC_TRANSACTION_ID;                                             EXIT WHEN CHILD_WAIT_REC%NOTFOUND;                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = WAITING_CODE,                                             ERROR_MESSAGE = Wtg.Parent- || TC_TRANSACTION_ID                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             AND STATUS_CODE = RESET_CODE;                                             CLOSE CHILD_WAIT_REC;                                             GOTO END_TRANSACT_LOOP;                                             END LOOP;                                             CLOSE CHILD_WAIT_REC;                                             END LOOP;                                             CLOSE CHILD_LOTS_REC;                                             END IF; */                // -- Commented above and Added below to Check in tpla as well as tcla                // -----------------CLose CURSOR Waiting Model Ends--------------------                // --wake up the rest, next record                /*  FOR WAKE_REC IN (SELECT MIN(TRANSACTION_ID) TRANSACTION_ID                                             FROM T_PARENT_LOTS_API                                             WHERE LOT_ID = T_LOT_REC.LOT_ID                                             AND TRANSACTION_ID > T_LOT_REC.TRANSACTION_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME                                             --    and status_code =waiting_code    --Deepak 14 Dec,02                                             --    and status_code in (waiting_code,reject_code,api_error_code,failure_code) -- Hari Krishnan Jan 07                                             AND STATUS_CODE IN                                             (WAITING_CODE, REJECT_CODE, API_ERROR_CODE) -- dont wake up failure code as data is inserted into tpla with that.Let users wake up those records                                             )                                             LOOP                                             UPDATE T_PARENT_LOTS_API                                             SET STATUS_CODE   = RESET_CODE,                                             ERROR_MESSAGE = Reset- || T_LOT_REC.TRANSACTION_ID                                             WHERE TRANSACTION_ID = WAKE_REC.TRANSACTION_ID                                             AND LOT_ID = T_LOT_REC.LOT_ID                                             AND NVL(NEW_FACTORY_NAME,                                             OLD_FACTORY_NAME) = I_FACTORY_NAME;                                             EXIT;                                             END LOOP;*/                // ---- waiting  model ends                // --------- check the interface,rigid check                t_Stmt_Num = 210;                // -- LOG_MESSAGE(After waiting model);                if (((t_Ignore_Sample != null ? t_Ignore_Sample : 2) == 1) && ((x_Track_In_Oracle != null ? x_Track_In_Oracle : 2) != 1)) {                    try {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Sample_Lot(t_Lot_Rec.Transaction_Id, t_Lot_Rec, t_Organization_Id, t_Factory_Name, t_Factory_Id, t_Ignore_Sample, x_Track_In_Oracle, t_Sample_Success_Flag);                        if (procedureParams_OutputMap.get("o_Success_Flag") != null) {                            t_Sample_Success_Flag = (java.lang.Integer) procedureParams_OutputMap.get("o_Success_Flag");                        }                        if (t_Sample_Success_Flag == 1) {                            t_Status_Code = Success_Code;                            t_Error_Code = null;                            t_Error_Message = null;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            logger.debug("Transact_Lots: Status After Ignore Sample:" + t_Sample_Success_Flag);                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } catch (Exception e) {                        logger.error(e, e);                    }                }                if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    t_Check_Interface = false;                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --Added by MohanVamsi 4th Dec08 for Erroring in T_PARENT_LOTS_API                // --if Date Released in greater than Date Provided in TPLA.                if (!("START".equals(t_Lot_Rec.Action_Code) || "CREATE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code) || "UNDO MOVE".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code) || "INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code))) {                    // -- Added from here on 1st Feb10                    t_Stmt_Num = (int) 210.01;                    // -- Calling t_update_bom_level to update BOM level in T_LOT_ITEMS_API                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Factory_Name, t_Lot_Rec.New_Routing, t_Lot_Rec.New_Operation, t_Lot_Rec.Operation_Sequence, t_Lot_Rec.Transaction_Date, t_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_New_Routing") != null) {                        t_Lot_Rec.New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                    }                    if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                        t_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("Transact_Lots: After Update Bom Level - T_BOM_LEVEL" + t_Bom_Level);                    if (t_Status_Code != Success_Code) {                        t_Error_Code = (int) 3380.11;                        t_Error_Message = "T_TRANSACT_LOTS: Error in updating Item Bom Level, at Stmt Num " + t_Stmt_Num + " " + // Substr ( t_Error_Message,  1,  260);                        t_Error_Message.substring(1 - 1, 260 + (1 - 1));                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Get the ITEM ID based on T_LOT_ITEMS_API                    t_Stmt_Num = (int) 210.02;                    procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: After Get Lot Item, T_Inventory_Item_ID: " + t_Inventory_Item_Id);                    if (t_Status_Code != Success_Code) {                        t_Error_Code = (int) 3380.12;                        t_Error_Message = "T_TRANSACT_LOTS: Error in T_GET_LOT_ITEM, in getting Item_ID, at Stmt Num " + t_Stmt_Num + " " + // Substr ( t_Error_Message,  1,  260);                        t_Error_Message.substring(1 - 1, 260 + (1 - 1));                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added till here on 1st Feb10                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Action_Code: " + t_Lot_Rec.Action_Code + " , Inv-Id: " + t_Inventory_Item_Id + ", Txn-Date: " + t_Lot_Rec.Transaction_Date);                    if (!("CHANGE ITEM".equals(t_Lot_Rec.Action_Code) || "MERGE".equals(t_Lot_Rec.Action_Code))) {                        // --12-May-2012 MERGE included, Since NEW LOT-Name cane be used which doest exists in Oracle                        // --Added above IF condition by MohanVamsi, to avoid CHANGE ITEM transactions,                        // --as this will fetch the new Item Provided in TLIA(Tri2: IS023628)                        try {                            t_Stmt_Num = (int) 210.03;                            Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + // Added or Commented by Mahendra 29 Aug09 for Complete Unscrap                            " And Quantity_Scrapped <> Start_Quantity  " + " And Lot_Number = ? " + // Added on 1st Feb10                            " And Primary_Item_Id = ?  " + // 3 Release , ? Hold                            " And Status_Type Not In   (  3, ? )    ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Inventory_Item_Id);                            preparedStatement.setObject(4, 6);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 3380.13;                            t_Error_Message = "Job is Already Completed, Unable to Process thru eDapter.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // return methodParams_OutputMap;                        } catch (No_Data_Found e) {                            logger.error(e);                            // --Added by Mahendra 29 Aug09 for Complete Unscrap                            try {                                t_Stmt_Num = (int) 210.04;                                Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + " And Quantity_Scrapped = Start_Quantity " + " And Lot_Number = ? " + // Added on 1st Feb10                                " And Primary_Item_Id = ?  " + " And Status_Type = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(3, t_Inventory_Item_Id);                                preparedStatement.setObject(4, 4);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                // --Added till here by Mahendra 29 Aug09 for Complete Unscrap                            } catch (No_Data_Found e2) {                                logger.error(e2);                                try {                                    t_Stmt_Num = (int) 210.05;                                    Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + // Added on 1st Feb10                                    " And Primary_Item_Id = ?  " + " And Lot_Number = ? " + " And Status_Type In   (  3, ? )  " + " And Date_Released <= ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(4, 6);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    try {                                        // --Check if Lot-Item-Org Combination exists                                        t_Stmt_Num = (int) 210.06;                                        Sql = "SELECT  Item_Number " + " From Mtl_Item_Flexfields " + " Where Inventory_Item_Id = ? " + " And Organization_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Organization_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Item_Num = resultSet.getString(1);                                        }                                        // --No Exception for this select, since this will fail intially when fetching                                        // --T_Inventory_Item_ID itself in case of any exception.                                        Sql = "SELECT  X " + " From Apps.Wip_Discrete_Jobs_v Wdjv " + " Where Organization_Id = ? " + " And Primary_Item_Id = ? " + " And Lot_Number = ? " + " And Status_Type In   (  3, ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Organization_Id);                                        preparedStatement.setObject(2, t_Inventory_Item_Id);                                        preparedStatement.setObject(3, t_Lot_Rec.Lot_Id);                                        preparedStatement.setObject(4, 6);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Dummy = resultSet.getString(1);                                        }                                        t_Status_Code = Reject_Code;                                        t_Error_Code = (int) 3380.15;                                        DateFormat format = new SimpleDateFormat("DD-MON-YY HH24:MI:SS");                                        t_Error_Message = format.format(t_Lot_Rec.Transaction_Date) + ", Org: " + t_Organization_Code + ", Item Num: " + t_Item_Num + ", Lot: " + t_Lot_Rec.Lot_Id + "." + " Transaction Date earlier than Release Date of the Job in OSFM";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                        // return methodParams_OutputMap;                                    } catch (No_Data_Found e4) {                                        logger.error(e4);                                        t_Status_Code = Reject_Code;                                        t_Error_Code = (int) 3380.16;                                        t_Error_Message = "Job does not exists for this combination:" + " Org : " + t_Organization_Code + ", Item Num: " + t_Item_Num + ", Lot: " + t_Lot_Rec.Lot_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                        // return methodParams_OutputMap;                                    }                                }                            }                        }                    }                    // Close Change ITEM IF                    // --Added Above End If avoid CHANGE ITEM transactions, as this will fetch the new Item                    // --provided in TLIA(Tri2: IS023628)                }                // --Added by MohanVamsi 4th Dec08  Till Here                // ---------------------CALL REVERSE PROCEDURE HERE----------------------------------------------                procedureParams_OutputMap = Log_Message("Before calling REVERSE TXNS Proc");                t_Stmt_Num = (int) 210.10;                if (t_Lot_Rec.Action_Code.equals("REVERSE")) {                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, t_Lot_Rec.Transaction_Id:" + t_Lot_Rec.Transaction_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, t_Lot_Rec.Lot_Id:" + t_Lot_Rec.Lot_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, T_Organization_Id:" + t_Organization_Id);                    logger.debug("T_TRANSACT_LOTS: Before Calling T_Reverse_Txn_Api, T_Organization_Code:" + t_Organization_Code);                    procedureParams_OutputMap = tltAdatptSubObject.t_Reverse_Txn_Api(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Organization_Id.toString(), t_Organization_Code, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ---------------------CALL INV PROCEDURE HERE----------------------------------------------                // --------------------********Start Check for Inventory Transactions*********----------------                procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Calling INV Txn Proc");                if (("INVSPLIT".equals(t_Lot_Rec.Action_Code) || "INVMERGE".equals(t_Lot_Rec.Action_Code) || "TRANSLATELOTID".equals(t_Lot_Rec.Action_Code) || "MISCRECEIPT".equals(t_Lot_Rec.Action_Code) || "MISCISSUE".equals(t_Lot_Rec.Action_Code) || "ACCTALIASRECEIPT".equals(t_Lot_Rec.Action_Code) || "ACCTALIASISSUE".equals(t_Lot_Rec.Action_Code) || "SUBINVTRANSFER".equals(t_Lot_Rec.Action_Code) || "DIRINTERORGTRANSFER".equals(t_Lot_Rec.Action_Code) || "TRANSLATEITEM".equals(t_Lot_Rec.Action_Code) || "INTRANSITSHIPMENT".equals(t_Lot_Rec.Action_Code) || "INTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "INTREQINTRANSITRECEIPT".equals(t_Lot_Rec.Action_Code) || "RECEIVING".equals(t_Lot_Rec.Action_Code) || "PORECEIVE".equals(t_Lot_Rec.Action_Code) || "PORETURN".equals(t_Lot_Rec.Action_Code) || "OSPRETURN".equals(t_Lot_Rec.Action_Code))) {                    // --Added by MohanVamsi 7th Aug09                    // --Check if Accounting periods for scheduled factory and Transfer factory are Open or not                    try {                        t_Stmt_Num = (int) 210.20;                        Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods Oap, Mtl_Parameters Mp, t_Factories Tf " + // t_lot_rec.transfer_factory_name                        " Where Tf.Factory_Name = ?  " + " And Tf.Organization_Code = Mp.Organization_Code " + " And Oap.Organization_Id = Mp.Organization_Id " + " And Period_Close_Date == null " + " And Period_Start_Date <= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )  " + " And Schedule_Close_Date >= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.New_Factory_Name);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Period_Open_Flag = resultSet.getString(1);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = (int) 251.02;                        t_Error_Message = "Accounting Period not Open for the transaction date, for Source Factory :" + t_Lot_Rec.New_Factory_Name;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        connection.commit();                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // not returning as period is open and other txns can be considerd except this one.                    if (t_Period_Open_Flag.equals("N")) {                        t_Status_Code = Reject_Code;                        t_Error_Code = (int) 251.03;                        t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date. Cannot proceed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        connection.commit();                        return methodParams_OutputMap;                    }                    if (t_Lot_Rec.Action_Code.equals("DIRINTERORGTRANSFER")) {                        try {                            t_Stmt_Num = (int) 210.30;                            Sql = "SELECT  Open_Flag " + " From Org_Acct_Periods Oap, " + " Mtl_Parameters   Mp, " + " t_Factories      Tf " + " Where Tf.Factory_Name = ? " + " And Tf.Organization_Code = Mp.Organization_Code " + " And Oap.Organization_Id = Mp.Organization_Id " + " And Period_Close_Date == null " + " And Period_Start_Date <= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )  " + " And Schedule_Close_Date >= " + " Trunc  (  Nvl  (  t_Lot_Rec.Transaction_Date, Sysdate )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transfer_Factory_Name);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Period_Open_Flag = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 251.04;                            t_Error_Message = "Accounting Period not Open for the transaction date, for Transfer Factory :" + t_Lot_Rec.Transfer_Factory_Name;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            connection.commit();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // not returning as period is open and other txns can be considerd except this one.                        // -- chk later auto recovery                        if (t_Period_Open_Flag.equals("N")) {                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 251.05;                            t_Error_Message = "Accounting Period not open or No open period found for current date or transaction_date . Cannot proceed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            connection.commit();                            return methodParams_OutputMap;                        }                    }                    // --Added by MohanVamsi 7th Aug09 for Accounting Period Check Ends here.                    // --Added by MohanVamsi 7th Aug09 to Check Interface Tables for Inventory Transactions                    if (("INVMERGE".equals(t_Lot_Rec.Action_Code))) {                        Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = " + " ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet7 = preparedStatement.executeQuery();                        while (resultSet7.next()) {                            Integer t_Inv_Rec_Lot_Id = resultSet7.getInt("Lot_Id");                            t_Stmt_Num = (int) 210.31;                            procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Inv_Rec_Lot_Id.toString(), // x_wip_entity_id                            null, // t_organization_id                            null, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                    }                    t_Stmt_Num = (int) 210.32;                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, // x_wip_entity_id                    null, // t_organization_id,                    null, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    logger.debug("T_TRANSACT_LOTS: Status code after T_Check_Lot_Interface, at stmt no:" + t_Stmt_Num + " :" + t_Status_Code);                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        // -- t_error_message := t_error_message || lot ||t_lot_rec.lot_id|| still in interface tables at stmt no:||t_stmt_num;                        logger.debug("T_TRANSACT_LOTS: " + t_Error_Message);                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- Added by MohanVamsi 7th Aug09 Till Here to Check Interface Tables for Inventory Transactions.                    // --Hari Krishnan Nov 06 Added(I_Resp_Id, I_Resp_Appl_Id) for Tinvadapt receive transactions                    procedureParams_OutputMap = tinvAdaptObject.t_Inv_Txn(t_Organization_Id, i_User_Id, t_Lot_Rec.Transaction_Id, t_Status_Code, t_Error_Code, t_Error_Message, i_Resp_Id, i_Resp_Appl_Id);                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // --Added by MohanVamsi 4th May09 to WakeUp Errored Transactions failing because of INV Transactions                    // --If Inventory Transactions are successfully processed then WakeUp transactions, failing because of                    // --these Inventory Transactions. T_WAKEUP_REC this cursor will get the minimum transaction from tpla,tcla                    // --existing after Inventory Transaction in TPLA and wakes it up.(status_code = 1)                    if (t_Status_Code == Success_Code) {                        Sql = "SELECT  Min (  Tpla.Transaction_Id ) Transaction_Id, " + " Tcla.Line_Number " + " From t_Parent_Lots_Api Tpla, " + " t_Child_Lots_Api Tcla " + " Where Tpla.Transaction_Id > " + " ? " + " And Tpla.Transaction_Id = " + " Tcla.Transaction_Id " + " And Tpla.Lot_Id = ? " + " And Tpla.Status_Code <> ? " + " Group By Tcla.Line_Number ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(3, Success_Code);                        resultSet8 = preparedStatement.executeQuery();                        while (resultSet8.next()) {                            Integer t_Wakeup_Rec_Transaction_Id = resultSet8.getInt("Transaction_Id");                            Integer t_Wakeup_Rec_Line_Number = resultSet8.getInt("Line_Number");                            t_Status_Code = Reset_Code;                            t_Error_Code = null;                            t_Error_Message = "Transaction WakeUp by eDapter as Child Lot got processed.";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Wakeup_Rec_Transaction_Id, t_Wakeup_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                        // WakeUp{Ends                    }                    // Status Code If Ends                    // --Added Till here 4th May09                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ----------------*************End Check for Inventory Transactions******--------------                procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: After INV Txn Proc");                if (t_Auto_Recover == false) {                    // -- get wip_entity_id/job name for the lot                    procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, Integer.toString(t_Status_Type), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                        t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                    }                    if (procedureParams_OutputMap.get("o_Status_Type") != null) {                        t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                    }                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, T_Job_Name: " + t_Job_Name);                    // --start wip lot transactions                    t_Stmt_Num = 220;                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, X_Track_In_Oracle: " + x_Track_In_Oracle);                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, X_Job_Name:" + t_Job_Name);                    procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check, T_Lot_Position: " + t_Lot_Position);                    if (x_Track_In_Oracle == 1 && t_Job_Name == null || t_Lot_Position.equals("I") && !("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MERGE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "C");                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                            t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                        }                        if (procedureParams_OutputMap.get("o_Status_Type") != null) {                            t_Status_Type = Integer.parseInt(procedureParams_OutputMap.get("o_Status_Type").toString());                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Job_Name == null || t_Lot_Position.equals("I")) {                            procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, x_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "N");                            if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                                t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                            }                            if (procedureParams_OutputMap.get("o_Job_Name") != null) {                                t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                            }                            if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                                x_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                            }                            if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                                x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                            }                            if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                                t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                            }                            if (procedureParams_OutputMap.get("o_Status_Type") != null) {                                t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                            }                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                        procedureParams_OutputMap = Log_Message("T_TRANSACT_LOTS: Before Interface check ( 2) T_Job_Name: " + t_Job_Name);                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("MERGE")) {                            t_Startup = false;                            // --Added by K.L.Venkatraman, 27 July 2009                            t_Stmt_Num = (int) 220.01;                            try {                                Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Factory_Name = ? ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                preparedStatement.setObject(2, i_Factory_Name);                                resultSet9 = preparedStatement.executeQuery();                                while (resultSet9.next()) {                                    Integer k_Lot_Id = resultSet9.getInt("Lot_Id");                                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(k_Lot_Id.toString(), // x_wip_entity_id                                    null, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } else {                                        // null;                                    }                                }                            } catch (SQLException e) {                                logger.error(e, e);                                t_Status_Code = 9;                                t_Error_Code = (int) 220;                                t_Error_Message = "Error at stmt no:" + t_Stmt_Num;                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --Added by K.L.Venkatraman, 27 July 2009 Till Here                        }                        // -- Hari Krishnan, Nov 06, Since t_startup flag will be ultimately removed from code and                        // -- made configurable, have included Or clause to do bonus transactions using                        // -- BONUS action code (this was not possible under the current setup                        // -- and this seemed to be least intrusive to do it                        if (t_Startup == true && t_Lot_Rec.Action_Code.equals("MOVE") && t_Job_Name == null || t_Lot_Rec.Action_Code.equals("BONUS") && t_Job_Name == null) {                            procedureParams_OutputMap = t_Initial_Start_Up(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec, t_Lot_Rec.Action_Code, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                            // -- Hari Krishnan, Nov 06, this prevents a BONUS action code from proceeding.                            // -- hence including BONUS in the not in clause                        } else if (t_Startup == true && !("MOVE".equals(t_Lot_Rec.Action_Code) || "BONUS".equals(t_Lot_Rec.Action_Code)) && t_Job_Name == null) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 1000;                            t_Error_Message = "Cannot Proceed - Inital Bonus only on move action";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            t_Check_Interface = false;                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    t_Stmt_Num = 230;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_JOB_NAME at stmt no: " + t_Stmt_Num + ":, ORG :" + t_Organization_Id + ", JOB : " + t_Lot_Rec.Lot_Id);                    // --Added by MohanVamsi 13th May09 to check Interfaces for START Action Code                    if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Check_Interface == true) {                        t_Wip_Entity_Id = x_Wip_Entity_Id;                        x_Wip_Entity_Id = null;                        // --Added by K.L.Venkatraman,24 July 2009                        t_Stmt_Num = (int) 230.01;                        /* select lot_id                                                         into x_tcla_lot_id                                                         from t_child_lots_api                                                         where transaction_id = t_lot_rec.transaction_id                                                         and rownum =1;*/                        // --why is this required                        // --1st Jun2010 MohanVamsi commented the below if Clause, since X_TCLA_LOT_ID is no where selected                        // --hence it will be always null                        // -- IF X_TCLA_LOT_ID IS NOT NULL                        // -- THEN                        Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet10 = preparedStatement.executeQuery();                        while (resultSet10.next()) {                            Integer k_Lot_Id = resultSet10.getInt("Lot_Id");                            procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(k_Lot_Id.toString(), // x_wip_entity_id                            null, // t_organization_id                            null, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no: " + t_Stmt_Num + " :" + t_Status_Code);                            if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                                tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // --Added By K.L.Venkatraman, 24 July 2009 Till Here                        // -- ELSE-------                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, x_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, t_Wip_Entity_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        t_Stmt_Num = (int) 230.02;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no: " + t_Stmt_Num + " :" + t_Status_Code);                        if (!(t_Status_Code == Success_Code || t_Status_Code == Api_Success_Code)) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- END IF;----                    }                    // --Added by MohanVamsi 13th May09 Till here                    t_Stmt_Num = (int) 230.03;                    if (!("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Check_Interface == true && t_Job_Name != null) {                        // Deepak 24 Oct,02                        t_Wip_Entity_Id = x_Wip_Entity_Id;                        // for current only, later correct/make changes to the chk interface program and then enable                        x_Wip_Entity_Id = null;                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Job_Name, x_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, t_Wip_Entity_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        t_Stmt_Num = 240;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status Code after T_Check_Lot_Interface at stmt no:" + t_Stmt_Num + ":" + t_Status_Code);                        if (t_Status_Code != Api_Success_Code) {                            // -- update those parents where this lot is a child                            // -- chk later                            // --Suds SiRF May26, 2009, for debugging date format issue. Check Later                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2The NLS Date format after C_LOT_REC: " + t_Nls_Date_Format);                            t = "alter session set nls_date_format =DD-MON-YYYY HH24:MI:SS";                            // Execute Immediate t ;                            preparedStatement = connection.prepareStatement(t, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                            }                            // --Suds SiRF May26, 2009                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                // interface check based on auto recovery-false                t_Stmt_Num = 249;                // ---MohanVamsi - 8/Nov/2011 Serial Check Starts                // --call tlsutils, version 1, only specific action codes are supported                // --Ex a MOVE resulting in a SCRAP is not supported                // --Added by MohanVamsi 6-Dec-2011, when running for Multiple Bom-Levels                // --Wip entity id is being carried from Previous record :(                if (x_Track_In_Oracle == 1 && t_Job_Name == null && t_Lot_Position == null) {                    t_Wip_Entity_Id = null;                }                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before Calling Tlsutils.T_Validate_SN_Api //>> X Inv Item Id:" + x_Inventory_Item_Id + ",   T_Inv_Item_id: " + t_Inventory_Item_Id + ",   Wip Id:" + t_Wip_Entity_Id);                /*                                             If T_Wip_Entity_Id Is Not Null Then                                             Tlthread.T_Item_Serial_Enabled := N;                                             Select Decode(t_Lot_Rec.Action_Code, CHANGE ITEM,X_Inventory_Item_Id, T_Inventory_Item_Id) ,                                             Decode(t_Lot_Rec.Action_Code, CHANGE ITEM,T_Inventory_Item_Id, X_Inventory_Item_Id)                                             Into T_Inv_Item ,                                             T_Chg_Item                                             From Dual ;                                             \*  Tlsutils.T_Validate_SN_Api (                                             t_Lot_Rec.Transaction_Id ,                                             T_Organization_Id        ,                                             t_Lot_Rec.Action_Code    ,                                             t_Lot_Rec.Lot_id         ,                                             T_Inv_Item               ,                                             T_Wip_Entity_Id          ,                                             T_Chg_Item               , --New Item for CHANGE ITEM Action Code                                             T_Status_Code            ,                                             T_Error_Code             ,                                             T_Error_Message                                             );*\                                             If T_Status_Code = Failure_Code Then                                             tLotUtilsObject.T_Update_Txn_Status( t_Lot_Rec.Transaction_Id,                                             Null,                                             T_Status_Code  ,                                             T_Error_Code   ,                                             T_Error_Message,                                             SET                                             );                                             Goto End_Transact_Loop;                                             End If;                                             End If;*/                // ---MohanVamsi - 8/Nov/2011 Serial Check Ends                t_Stmt_Num = (int) 250.1;                // ----------------interface check ends- rigid check                procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Status_Type: " + t_Status_Type);                // --,MERGE      --Harikrishna June 03 2003 for validating in case of merge as well for non-production lots                if (("CONSUME".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOMOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "LOTLINK".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "COMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSTART".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNCONSUME".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNCOMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEROUTING".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNLINK".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUSQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Passed Modifications ( 1)");                    // --For SiRF ,Hari D 19 Sep 2008                    // --There are few cases for WIP transactions being sucessfull even if the wrong item is passed                    // --Included this IF block to validate if item in edapter.T_LOT_ITEMS_API                    // --MTL_SYSTEM_ITEMS and segment1 is hard coded as i need this fix very quickly                    // --Derive the the harded coded values from t_factories.                    logger.debug("T_Transact_Lots: T_STATUS_TYPE :" + t_Status_Type);                    if (t_Status_Type == 3 && !("CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        try {                            // --Suds SiRF May14, 09. The below query changed to use wip_entities instead of wip_discrete_jobs to avoid multiple fetch                            // --Also included MIF instead of MSI. Also used t_factories for organization instead of tpla                            /*                                                                 SELECT 1                                                                 INTO T_DUMMY                                                                 FROM EDAPTER.T_PARENT_LOTS_API TPLA,                                                                 EDAPTER.T_LOT_ITEMS_API   TLIA,                                                                 APPS.WIP_DISCRETE_JOBS    WDJ,                                                                 MTL_PARAMETERS            MP,                                                                 APPS.MTL_SYSTEM_ITEMS     MSI                                                                 WHERE TPLA.TRANSACTION_ID = TLIA.TRANSACTION_ID AND                                                                 TPLA.LOT_ID = T_LOT_REC.LOT_ID AND                                                                 TPLA.TRANSACTION_ID = T_LOT_REC.TRANSACTION_ID AND                                                                 WDJ.LOT_NUMBER = TPLA.LOT_ID AND                                                                 MP.ORGANIZATION_CODE = TPLA.NEW_FACTORY_NAME AND                                                                 MSI.ORGANIZATION_ID = MP.ORGANIZATION_ID AND                                                                 MSI.INVENTORY_ITEM_ID = WDJ.PRIMARY_ITEM_ID AND                                                                 MSI.SEGMENT1 = TLIA.NEW_ITEM;                                                                 */                            Sql = "SELECT  1 " + " From t_Parent_Lots_Api   Tpla, " + " t_Lot_Items_Api     Tlia, " + " Wip_Entities        We, " + " Mtl_Parameters      Mp, " + " t_Factories         Tf, " + " Mtl_Item_Flexfields Mif " + " Where Tpla.Transaction_Id = Tlia.Transaction_Id " + " And Tpla.Lot_Id = ? " + " And Tpla.Transaction_Id = ? " + " And We.Wip_Entity_Name = Tpla.Lot_Id " + " And We.Organization_Id = Mp.Organization_Id " + " And Tpla.New_Factory_Name = Tf.Factory_Name " + " And Tf.Organization_Code = Mp.Organization_Code " + " And We.Primary_Item_Id = Mif.Inventory_Item_Id " + " And We.Organization_Id = Mif.Organization_Id " + " And Tlia.New_Item = Mif.Item_Number  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            // --Suds SiRF May14, 09.                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 9192008;                            t_Error_Message = "Specified item for the lot is invalid.  " + "Action: Populate correct Item_Number in new_item column T_Lot_Items_Api table or" + "Operation Desc in T_Parent_Lots_Api to fetch Item_Number by Lot eDapter";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // --Added 30Apr09 by MohanVamsi for Bonus Qty to Reuse Change Qty                    // --To be able to reuse the existing code, the action_code Bonus Qty is being                    // --converted into Change Qty                    // --Use Bonus Qty action code when you get the incremental qty in TPLA.                    if (("BONUSQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Stmt_Num = (int) 250.01;                        try {                            logger.debug("T_Transact_Lots: X_WIP_ENTITY_ID:" + x_Wip_Entity_Id);                            logger.debug("T_Transact_Lots: T_WIP_ENTITY_ID:" + t_Wip_Entity_Id);                            // --Getting the Current Quantity from Wip_Operations. This is the Net Quantity                            // --of the job before carrying out Bonus Quantity.                            Sql = "SELECT  Nvl ( Quantity_Waiting_To_Move, 0) + " + " Nvl ( Quantity_Running, 0) + Nvl ( Quantity_In_Queue, 0) " + " From Wip_Operations Wo " + // X_WIP_ENTITY_ID                            " Where Wip_Entity_Id = ?  " + " And   (  Quantity_Waiting_To_Move > ? Or Quantity_Running > ? Or " + " Quantity_In_Queue > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Net_Quantity = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = (int) 1000.01;                            t_Error_Message = "Job does not exists in WIP, Please check if Job is Completed or Closed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Lot_Rec.Action_Code = "CHANGE QTY";                        t_Lot_Rec.New_Txn_Qty = t_Lot_Rec.New_Txn_Qty + t_Net_Quantity;                        // --Adding incremental quantity to the original quantity. Updating TCLA with                        // --OracleQty + incremental quantity i.e. populated in TPLA Qty to load into Resulting Jobs                        Sql = "UPDATE t_Child_Lots_Api Tcla " + " Set Txn_Qty = t_Lot_Rec.New_Txn_Qty " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.executeUpdate();                        connection.commit();                    }                    // --From here BONUS QTY action is Changed to CHNAGE QTY and Proceeds with QTY as                    // --TPLA_QTY + Current Lot QTY                    // --Added by MohanVamsi For Bonus Qty Till Here                    // --Modified by Harikrishna on Jul-27-2003 for unclosing jobs                    if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15) && ("RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Status_Code = Success_Code;                        t_Error_Code = null;                        t_Error_Message = null;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Wip Entity ID of Closed Job: " + x_Wip_Entity_Id);                    if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15) && ("TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        if (x_Wip_Entity_Id != null) {                            Sql = "SELECT  Sum ( Start_Quantity - Quantity_Scrapped) " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, x_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Cur_Qty = resultSet.getInt(1);                            }                        } else {                            t_Wip_Cur_Qty = 0;                        }                        if (t_Wip_Cur_Qty == 0) {                            t_Status_Code = Success_Code;                            t_Error_Code = null;                            t_Error_Message = null;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    if ((t_Status_Type == 12 || t_Status_Type == 15) && t_Auto_Recover == false) {                        if (("UNDOS".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                            if (((x_Wip_Entity_Id != null ? x_Wip_Entity_Id : 0) == 0)) {                                try {                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = C " + " And Tl.Status = C " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )  " + " And  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, 12);                                    preparedStatement.setObject(4, 2);                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(6, t_Factory_Id);                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(8, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        x_Wip_Entity_Id = resultSet.getInt(1);                                    }                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 1078.2;                                    t_Error_Message = " Cannot find lot to be Unclosed in Oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Attempting Job Unclose");                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(x_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job Unclose attmepted");                            if (t_Status_Code == Success_Code) {                                logger.debug("T_Transact_Lots: Success in Unclosing the Job");                                t_Status_Type = 4;                                t_Wip_Entity_Id = x_Wip_Entity_Id;                            } else {                                t_Status_Code = Failure_Code;                                t_Error_Code = (int) 1078.1;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        } else {                            t_Status_Code = Failure_Code;                            t_Error_Code = 1078;                            t_Error_Message = "Oracle Job is Closed ( 12) or Failed Close ( 15)in wip_discrete_jobs, Cannot transact further on this Lot. Unclose job in Oracle";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // vyshnavi last                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Passed Modifications ( 2)");                    t_Stmt_Num = 260;                    if (!("RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && t_Status_Type == 6) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_ID: " + t_Wip_Entity_Id);                        // -- release the job                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.setObject(3, t_Organization_Id);                        preparedStatement.executeUpdate();                        // --update t_lots also                        Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 24 Oct,02                        " And Status In   (  H, A )    ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Unique_Id = resultSet.getInt(1);                        }                        Sql = "UPDATE t_Lots Set Status = A Where Unique_Id = ? ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Unique_Id);                        preparedStatement.executeUpdate();                        Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = A " + " Where Lot_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Unique_Id);                        preparedStatement.executeUpdate();                    }                    /*  --normal completion with operation null.                                                     if (t_lot_rec.action_code = MOVE and t_lot_rec.new_operation is null)                                                     then                                                     t_stmt_num:=812;                                                     begin                                                     select wip_entity_id                                                     into   t_wip_entity_id                                                     from   t_oracle_jobs                                                     where  lot_id = (select max(unique_id)                                                     from   t_lots where lot_id = t_lot_rec.lot_id                                                     and    factory_id = t_factory_id);                                                     t_stmt_num:=820;                                                     select primary_item_id                                                     into   o_inventory_item_id                                                     from   wip_discrete_jobs                                                     where  wip_entity_id = t_wip_entity_id;                                                     t_stmt_num:=825;                                                     t_sql_string:=select bos.||t_routing_field;                                                     if t_operation_field is not null                                                     then                                                     t_sql_string:=t_sql_string||, bos.||t_operation_field;                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     t_sql_string:=t_sql_string||,bos.||t_step_seq_field;                                                     end if;                                                     t_sql_string:=t_sql_string|| from bom_operation_sequences bos,wip_discrete_jobs wdj ||                                                      where  wdj.wip_entity_id = :x_wip_entity_id ||                                                      and    bos.routing_sequence_id    = wdj.common_routing_sequence_id ||                                                      and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1)) ||                                                      and    bos.operation_sequence_id not in(select from_op_seq_id ||                                                      from bom_operation_networks ||                                                      where from_op_seq_id = bos.operation_sequence_id) ;                                                     begin                                                     t_cursor:=dbms_sql.open_cursor;                                                     dbms_sql.parse(t_cursor, t_sql_string, dbms_sql.native);                                                     dbms_sql.define_column(t_cursor,1,t_new_routing,255);                                                     if t_operation_field is not null                                                     then                                                     dbms_sql.define_column(t_cursor,2,t_to_operation_code,255);                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     dbms_sql.define_column(t_cursor,3,t_operation_seq,50);                                                     end if;                                                     dbms_sql.bind_variable(t_cursor,x_wip_entity_id,t_wip_entity_id);                                                     x_status_code:=dbms_sql.execute_and_fetch(t_cursor);                                                     if x_status_code=1                                                     then                                                     dbms_sql.column_value(t_cursor,1,t_new_routing);                                                     if t_operation_field is not null                                                     then                                                     dbms_sql.column_value(t_cursor,2,t_to_operation_code);                                                     end if;                                                     if t_step_seq_field is not null                                                     then                                                     dbms_sql.column_value(t_cursor,3,t_operation_seq);                                                     end if;                                                     elsif x_status_code>1                                                     then                                                     t_status_code := failure_code;                                                     t_error_code  := 1078;                                                     t_error_message := Multiple last operations ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     else                                                     t_status_code := failure_code;                                                     t_error_code  := 1078;                                                     t_error_message := No last operation found ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     dbms_sql.close_cursor(t_cursor);                                                     exception                                                     when others then                                                     if dbms_sql.is_open(t_cursor)                                                     then                                                     dbms_sql.close_cursor(t_cursor);                                                     end if;                                                     t_status_code := failure_code;                                                     t_error_code  := sqlcode;                                                     t_error_message := Error - ||sqlerrm|| -in selecting last operation ;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     t_stmt_num:=839;                                                     begin                                                     select state_name                                                     into   t_new_state                                                     from   t_state_step_mappings                                                     where  intraoperation_step  =3                                                     and    factory_id   =t_factory_id                                                     and    rownum<2;                                                     exception                                                     when no_data_found                                                     then                                                     t_status_code := failure_code;                                                     t_error_code:=834;                                                     t_error_message:=state name for intraoperation step 3 not defined;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     tLotUtilsObject.t_update_lot_bom_level (t_lot_rec.transaction_id,                                                     t_lot_rec.new_factory_name,                                                     t_new_routing,                                                     t_to_operation_code,                                                     t_operation_seq,                                                     o_bom_level,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message);                                                     dbms_output.put_line(bom level change-o_bom_level-||o_bom_level);                                                     dbms_output.put_line(bom level change-t_status_code-||t_status_code);                                                     if t_status_code=success_code                                                     then                                                     update  t_parent_lots_api                                                     set new_routing=t_new_routing,new_operation=t_to_operation_code,                                                     operation_sequence=t_operation_seq, new_state_id=t_new_state                                                     where transaction_id=t_lot_rec.transaction_id;                                                     else                                                     tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     tltadapt.t_validate_lot_api                                                     (                                                     t_lot_rec.transaction_id,                                                     null,                                                     t_factory_id,                                                     t_lot_rec.new_txn_qty,                                                     t_wip_entity_id,                                                     t_operation_seq_num,                                                     t_intra_op_step,                                                     o_inventory_item_id,                                                     t_lot_position,                                                     t_lot_number,                                                     t_job_name,                                                     t_lot_status,                                                     t_oracle_uom,                                                     i_user_id,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message                                                     );                                                     if t_status_code !=success_code                                                     then                                                     tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end if;                                                     tltadapt.t_move_lot_api                                                     (                                                     t_lot_rec.transaction_id,                                                     null,                                                     t_factory_id,                                                     t_lot_rec.new_txn_qty,                                                     t_wip_entity_id,                                                     o_inventory_item_id,                                                     t_job_name,                                                     i_user_id,                                                     t_lot_rec.transaction_date,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message                                                     );                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     null,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     GET                                                     );                                                     if t_status_code in (success_code,reprocess_code)                                                     then                                                     if t_status_code=success_code                                                     then                                                     tLotUtilsObject.t_update_oracle_job(   t_lot_rec.transaction_id,                                                     t_factory_id,                                                     t_lot_rec.lot_id,                                                     t_error_code,                                                     t_error_message);                                                     end if;                                                     goto end_transact_loop;                                                     else                                                     t_status_code := failure_code;                                                     t_error_message :=Error returned while completing-||t_error_message;                                                     end if;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     exception                                                     when no_data_found                                                     then                                                     t_status_code := failure_code;                                                     t_error_message :=no data found at||t_stmt_num;                                                     tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                     NULL,                                                     t_status_code,                                                     t_error_code,                                                     t_error_message,                                                     SET                                                     );                                                     goto end_transact_loop;                                                     end;                                                     end if;                                                     */                    // --*****JUMP BOM LEVEL STARTS******************************                    /*26/12/2001                                                     case1:trackout from last operation of old sector                                                     case2:trackout from last operation of old sector with scrap                                                     case3:Jump to first operation of new sector.Jump is mapped realtime.Qty might be in Die or Slice.                                                     case4:Jump to second or subsequent operation of new sector.Jump is mapped realtime.Qty might be in Die or Slice.                                                     case5:Jump to first operation of new sector and trackout.Jump is mapped to trackout.                                                     case6:Jump to second or subsequent operation of new sector and trackout.Jump is mapped to trackout.                                                     case7:Jump to new sector which is not immediate one.(AS-->FG)                                                     case8:jump back to previous sector                                                     case9:move/jump into next sector after jump backwards                                                     Jan 07: Hari Krishnan, Added case when MES has modular routings and a move from one sector to other does not come as a Start                                                     Also, though the routings are modular, the incoming device is the same for many levels                                                     */                    t_Stmt_Num = 270;                    // -- AND UPPER(T_LOT_REC.ACTION_CODE) = MOVE                    /*Commented the above Action Code Condition by MohanVamsi on 1st Dec08 for allowing                                                     any action as 1st txn in edapter to have entries in T_Lots and T_Oracle_Jobs                                                     for SI and can be Done anywhere if commented */                    if (x_Track_In_Oracle == 1) {                        // -- Hari K Feb 07, brought it up as this can be done irrespective of lot is in tlots or not                        // -- part of Lot Reverse Insert fix                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // new inventory item corr to tlia                        t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Get Lot Item, Err Msg: " + t_Error_Message);                        if (t_Status_Code != Success_Code) {                            t_Error_Code = 1321;                            t_Error_Message = "Error: T_Transact_Lots- in fetching lot item-" + // Substr ( t_Error_Message,  1,  260);                            t_Error_Message.substring(1 - 1, 260 + (1 - 1));                            procedureParams_OutputMap = Log_Message(t_Error_Message);                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        try {                            Sql = "SELECT  Bom_Level " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C, H )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Bom_Level = resultSet.getString(1);                            }                            // --Added H to check the HOLD Lots, or else selecting previous sector Completed Lots.                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Bom_Level: " + t_Bom_Level);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec.New_Bom_Level: " + t_Lot_Rec.New_Bom_Level);                            if (((t_Lot_Rec.New_Bom_Level != null ? t_Lot_Rec.New_Bom_Level : t_Bom_Level) != t_Bom_Level)) {                                // --jump across bom level                                t_Stmt_Num = 280;                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change");                                Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C )  )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Wip_Entity_Id = resultSet.getInt(1);                                }                                Sql = "SELECT  Primary_Item_Id, Status_Type " + // Hari K, Jan 07 brought forward from below for performance                                " t_Status_Type  " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    o_Inventory_Item_Id = resultSet.getInt(1);                                }                                t_Stmt_Num = 290;                                /* Hari Krishnan Feb 07 .taken up a few lines                                                                 tltadapt.t_get_lot_item(t_lot_rec.transaction_id,                                                                 t_factory_id,                                                                 t_organization_id,                                                                 t_inventory_item_id,  --new inventory item corr to tlia                                                                 t_lot_rec,                                                                 t_status_code,                                                                 t_error_code,                                                                 t_error_message                                                                 );                                                                 if t_status_code !=success_code                                                                 then                                                                 t_error_code :=1321;                                                                 t_error_message :=Error- t_transact_lots- in fetching lot item;                                                                 tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                                 null,                                                                 t_status_code,                                                                 t_error_code,                                                                 t_error_message,                                                                 SET                                                                 );                                                                 goto end_transact_loop;                                                                 end if;                                                                 -- Hari Krishnan commenting ends                                                                 */                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change, O_Inventory_Item_ID:" + // old item                                o_Inventory_Item_Id);                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level change, T_Inventory_Item_ID:" + // new item                                t_Inventory_Item_Id);                                if (o_Inventory_Item_Id != t_Inventory_Item_Id) {                                    t_Stmt_Num = 300;                                    try {                                        Sql = "SELECT  Item_Sequence " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        preparedStatement.setObject(3, t_Inventory_Item_Id);                                        preparedStatement.setObject(4, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Level = resultSet.getInt(1);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1233;                                        t_Error_Message = "Bom level not defined for inventory_item_id: " + t_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1366;                                        t_Error_Message = "Multiple rows defined for max session id for inventory_item_id: " + t_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    try {                                        Sql = "SELECT  Item_Sequence " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = ? " + " And Alternate_Designator = Primary " + " And Factory_Id = ? )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, o_Inventory_Item_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        preparedStatement.setObject(3, o_Inventory_Item_Id);                                        preparedStatement.setObject(4, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Current_Level = resultSet.getInt(1);                                        }                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1265;                                        t_Error_Message = "BOM level not defined for inventory_item_id. Create Primary routing through routing edapter for Inventory item id:" + o_Inventory_Item_Id;                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 1404;                                        t_Error_Message = "Multiple rows defined for max session id for inventory_item_id:" + o_Inventory_Item_Id + "- Check t_item_crossreferences_api";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    // -- Hari K Jan 07. Move across BOM level fix when Routings in MES are modular, but no Start event comes for next bom level                                    t_Stmt_Num = 305;                                    if (t_Level == t_Current_Level) {                                        // --Perform the following checks                                        // --1.is the move to a next level or to a lower one                                        // --2.If it is not immediate, leave the t_level and t_current_level variables as is so that it will error out                                        // --3.This feature is only for immediate moves. Not skipping levels. Once data flow becomes clear, we can handle that.                                        // --4.The xref table will have item_sequence as 1 always as routings are modular                                        try {                                            // -- move is to immediate next higher level,say from AS to TS                                            Sql = "SELECT  x " + " From T_Component_v Bic, Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = ? " + " And Bom.Organization_Id = ? " + " And Bic.Component_Item_Id = ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, Primary )  = " + " Nvl  (  t_Alternate_Designator, Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + "  (  ? + ? )  )   ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Inventory_Item_Id);                                            preparedStatement.setObject(2, t_Organization_Id);                                            preparedStatement.setObject(3, o_Inventory_Item_Id);                                            preparedStatement.setObject(4, 1);                                            preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                            preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                            preparedStatement.setObject(7, 1);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Dummy = resultSet.getString(1);                                            }                                            // not designed to handle case when next level involves a skip                                            t_Current_Level = t_Current_Level + 1;                                            // -- should not arise in this kind of setup                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            // -- move is to immediate next lower level,say from TS back to AS                                            try {                                                Sql = "SELECT  x " + " From T_Component_v         Bic, " + " Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = ? " + " And Bom.Organization_Id = ? " + " And Bic.Component_Item_Id = " + " ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, " + " Primary )  = " + " Nvl  (  t_Alternate_Designator, Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + "  (  ? + ? )  )   ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, o_Inventory_Item_Id);                                                preparedStatement.setObject(2, t_Organization_Id);                                                preparedStatement.setObject(3, t_Inventory_Item_Id);                                                preparedStatement.setObject(4, 1);                                                preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                                preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                                preparedStatement.setObject(7, 1);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Dummy = resultSet.getString(1);                                                }                                                t_Level = t_Level + 1;                                            } catch (No_Data_Found e1) {                                                logger.error(e1);                                            }                                            // it needs to error                                        }                                        Log_Msg = "Jump Bom level with same level info. Modified values of t_level and t_current_level are: " + t_Level + "," + t_Current_Level;                                        procedureParams_OutputMap = Log_Message(Log_Msg);                                        logger.debug(Log_Msg);                                    }                                    // --Hari K Jan 07. Move across BOM level fix when Routings in MES are modular, but no Start event comes for next bom level                                    t_Stmt_Num = 310;                                    if (t_Level < t_Current_Level) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: TPLA bom level ( " + t_Lot_Rec.New_Bom_Level + ") is higher than existing");                                        try {                                            Sql = // check if lot already exists in sector.if yes,just jump                                            "SELECT  Unique_Id  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Bom_Level = ? " + " And Status = A  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            preparedStatement.setObject(3, t_Lot_Rec.New_Bom_Level);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Unique_Id = resultSet.getInt(1);                                            }                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Unique_id: " + t_Unique_Id);                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            // --complete the lot and start in next sector                                            t_Level = t_Current_Level - 1;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: New Level Sequence: " + t_Level);                                            while (1 == 1) {                                                try {                                                    // -- Hari Krishnan Jan 07, removed unecessary code duplication                                                    // --if t_system_item_flag=2                                                    // --then                                                    Sql = "SELECT  Case t_System_Item_Flag " + " When 2 Then " + " New_Enterprise_Item " + " When 1 Then " + " New_Item End " + " From t_Lot_Items_Api " + " Where Transaction_Id = " + " ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Lot_Item1 = resultSet.getString(1);                                                    }                                                    t_Stmt_Num = 320;                                                    try {                                                        // --Hari K Jan 07                                                        // -- Hari K  Jan 07. First chck for the exact item in the txn.                                                        Sql = "SELECT  Bom_Level, Inventory_Item_Id " + " From t_Item_Crossreferences_Api " + " Where Item_Sequence = ? " + " And Factory_Id = ? " + " And Inventory_Item_Id = " + " ? " + " And Alternate_Designator = Primary " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Inventory_Item_Id = " + " ? " + " And Item_Sequence = ? " + " And Alternate_Designator = " + " Primary " + " And Factory_Id = ? )   ";                                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                        preparedStatement.setObject(1, t_Level);                                                        preparedStatement.setObject(2, t_Factory_Id);                                                        preparedStatement.setObject(3, t_Inventory_Item_Id);                                                        preparedStatement.setObject(4, t_Inventory_Item_Id);                                                        preparedStatement.setObject(5, t_Level);                                                        preparedStatement.setObject(6, t_Factory_Id);                                                        resultSet = preparedStatement.executeQuery();                                                        resultSet.last();                                                        totalRows = resultSet.getRow();                                                        resultSet.beforeFirst();                                                        if (totalRows > 1) {                                                            throw new SQLException("Too Many Rows");                                                        }                                                        if (resultSet.next() == false) {                                                            throw new No_Data_Found("No Data Found");                                                        } else {                                                            o_Bom_Level = resultSet.getString(1);                                                            t_Inventory_Item_Id = resultSet.getInt(2);                                                        }                                                        // --Hari K Jan 07                                                    } catch (No_Data_Found e1) {                                                        logger.error(e1);                                                        t_Stmt_Num = 330;                                                        try {                                                            // -- old original code,                                                            Sql = "SELECT  Bom_Level, Inventory_Item_Id " + " From t_Item_Crossreferences_Api " + " Where Item_Sequence = ? " + " And Factory_Id = ? " + " And Item = ? " + " And Alternate_Designator = Primary " + " And Session_Id = " + "  (  Select Max  (  Session_Id )  " + " From t_Item_Crossreferences_Api " + " Where Item = ? " + " And Item_Sequence = ? " + " And Alternate_Designator = " + " Primary " + " And Factory_Id = ? )   ";                                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                            preparedStatement.setObject(1, t_Level);                                                            preparedStatement.setObject(2, t_Factory_Id);                                                            preparedStatement.setObject(3, t_Lot_Item1);                                                            preparedStatement.setObject(4, t_Lot_Item1);                                                            preparedStatement.setObject(5, t_Level);                                                            preparedStatement.setObject(6, t_Factory_Id);                                                            resultSet = preparedStatement.executeQuery();                                                            resultSet.last();                                                            totalRows = resultSet.getRow();                                                            resultSet.beforeFirst();                                                            if (totalRows > 1) {                                                                throw new SQLException("Too Many Rows");                                                            }                                                            if (resultSet.next() == false) {                                                                throw new No_Data_Found("No Data Found");                                                            } else {                                                                o_Bom_Level = resultSet.getString(1);                                                                t_Inventory_Item_Id = resultSet.getInt(2);                                                            }                                                        } catch (SQLException e2) {                                                            logger.error(e2, e2);                                                            t_Status_Code = Failure_Code;                                                            t_Error_Code = 1456;                                                            t_Error_Message = "Error while fetching new bom level from t_item_crossreferences_api. Msg: " + e2.getSQLState();                                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                            }                                                            // Goto End_Transact_Loop;                                                            break end_Transact_Loop;                                                        }                                                    }                                                    // Hari K Jan 07                                                    // --else --sys item flag                                                    /* select  new_item                                                                                     into  t_lot_item1                                                                                     from  t_lot_items_api                                                                                     where transaction_id=t_lot_rec.transaction_id;                                                                                     t_stmt_num :=330;                                                                                     begin                                                                                     select  bom_level,inventory_item_id                                                                                     into  o_bom_level,t_inventory_item_id                                                                                     from  t_item_crossreferences_api                                                                                     where item_sequence=t_level                                                                                     and factory_id=t_factory_id                                                                                     and oracle_item=t_lot_item1                                                                                     and alternate_designator=Primary                                                                                     and     session_id= (select max(session_id)                                                                                     from t_item_crossreferences_api                                                                                     where oracle_item=t_lot_item1                                                                                     and  item_sequence=t_level                                                                                     and  alternate_designator=Primary                                                                                     and  factory_id=t_factory_id);                                                                                     exception                                                                                     when others then                                                                                     t_status_code    :=failure_code;                                                                                     t_error_code   :=1490;                                                                                     t_error_message    :=Error while fetching new bom level from t_item_crossreferences_api-||sqlerrm;                                                                                     tLotUtilsObject.T_Update_Txn_Status ( t_lot_rec.transaction_id,                                                                                     null,                                                                                     t_status_code,                                                                                     t_error_code,                                                                                     t_error_message,                                                                                     SET                                                                                     );                                                                                     goto end_transact_loop;                                                                                     end;                                                                                     end if; --sys item flag                                                                                     */                                                    // -- Hari Krishnan Jan 07, the decode will handle these two segments                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1327;                                                    t_Error_Message = "T_Transact_Lots: Next Bom Level not defined";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                // for entire sys item check                                                try {                                                    Sql = "SELECT  z " + // included for dummy bom levels  ( viral)                                                    " From Bom_Operational_Routings  " + " Where Organization_Id = ? " + " And Assembly_Item_Id = ? " + // check for primary only                                                    " And Alternate_Routing_Designator == null   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Dummy = resultSet.getString(1);                                                    }                                                    break;                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Level = t_Level - 1;                                                    t_Skip_Bom_Level = true;                                                }                                            }                                            // While{for Skip bom level                                            t_Stmt_Num = 340;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: New Bom Level: " + o_Bom_Level);                                            Sql = "UPDATE t_Lot_Items_Api " + " Set New_Bom_Level = ? " + " Where Transaction_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, o_Bom_Level);                                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                            preparedStatement.executeUpdate();                                            t_Lot_Rec.New_Bom_Level = o_Bom_Level;                                            /*                                                                             update t_parent_lots_api                                                                             set    new_bom_level=o_bom_level                                                                             where  transaction_id=t_lot_rec.transaction_id;                                                                             */                                            /* took it up,Hari K Jan 07 as a select on wdj was already there                                                                             select  status_type   --4 complete                                                                             into  t_status_type --chk later, stat type from get lot status already there                                                                             from  wip_discrete_jobs                                                                             where   wip_entity_id = t_wip_entity_id;                                                                             */                                            t_Stmt_Num = 350;                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Status_Type:" + t_Status_Type);                                            if ((t_Status_Type == 4 || t_Status_Type == 12 || t_Status_Type == 15)) {                                                // --start                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Start the Lot in next sector");                                                t_Component_Lot = t_Lot_Rec.Lot_Id;                                                try {                                                    Sql = "SELECT  Inventory_Item_Id, Transaction_Quantity " + " From Mtl_Onhand_Quantities " + " Where Organization_Id = ? " + " And Lot_Number = ? " + // Deepak 11 Dec,02                                                    " And Inventory_Item_Id = ?   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Component_Lot);                                                    preparedStatement.setObject(3, o_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Component_Item_Id = resultSet.getInt(1);                                                        t_Component_Qty = resultSet.getInt(2);                                                    }                                                    Sql = "SELECT  Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Component_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Component_Item = resultSet.getString(1);                                                    }                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 994;                                                    t_Error_Message = "No onhand exists for -" + t_Component_Lot;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (Too_Many_Rows e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1005;                                                    t_Error_Message = "Multiple lots exists in Inventory: " + t_Component_Lot;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 360;                                                Sql = "SELECT  Primary_Uom_Code " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                preparedStatement.setObject(2, t_Component_Item_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Uom_Code = resultSet.getString(1);                                                }                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside BOM Level Change, T_Uom_Code: " + t_Uom_Code);                                                Sql = "SELECT  t_Child_Lots_Api_s.Nextval " + " From Dual ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Line_Number_s = resultSet.getInt(1);                                                }                                                // --        delete  from t_child_lots_api                                                // --        where transaction_id=t_lot_rec.transaction_id;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Item , " + " Txn_Qty , " + " Uom_Code , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, t_Component_Lot);                                                preparedStatement.setObject(5, t_Component_Item);                                                preparedStatement.setObject(6, t_Component_Qty);                                                preparedStatement.setObject(7, t_Uom_Code);                                                preparedStatement.setObject(8, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Stmt_Num = 370;                                                t_Check_Bom = false;                                                procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, "START", i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, null);                                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                                }                                                // --            tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                // --                    null,                                                // --                    t_status_code,                                                // --                    t_error_code,                                                // --                    t_error_message,                                                // --                    GET                                                // --                 );                                                if (t_Status_Code == Success_Code) {                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    Sql = // check later...may return multiple rows                                                    "UPDATE t_Lots  " + " Set Status = N " + " Where Unique_Id = " + "  ( Select Max ( Unique_Id) " + " From t_Lots " + " Where Factory_Id = ? " + " And Lot_Id = ? " + // Deepak 04 Dec,02                                                    " And Bom_Level = ?  " + // Deepak 26 Dec,02;                                                    " And Status != T )";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Factory_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, t_Bom_Level);                                                    preparedStatement.executeUpdate();                                                    // --      factory_id=t_factory_id                                                    // --      and lot_id=t_lot_rec.lot_id                                                    // --      and bom_level=t_bom_level;  --Deepak 04/12/02                                                    // --  and bom_level!=o_bom_level;                                                    Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = N " + " Where Lot_Id In " + // unique_id                                                    "  ( Select Max ( Unique_Id)  " + " From t_Lots " + " Where Factory_Id = ? " + " And Lot_Id = ? " + // Deepak 04 Dec,02                                                    " And Bom_Level = ?  " + // Deepak 26 Dec,02;                                                    " And Status != T )";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Factory_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, t_Bom_Level);                                                    preparedStatement.executeUpdate();                                                    // --    and bom_level!=o_bom_level);                                                    t_Status_Code = Reset_Code;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                }                                                Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.executeUpdate();                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            } else {                                                // --complete the lot.                                                t_Stmt_Num = 380;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Complete the Lot in previous sector");                                                Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Last_Op_Seq_Num = resultSet.getInt(1);                                                }                                                try {                                                    // --lot is completed but status type not updated                                                    Sql = // Deepak 25 Dec,02                                                    "SELECT  x  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                                    preparedStatement.setObject(2, t_Last_Op_Seq_Num);                                                    preparedStatement.setObject(3, 0);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Dummy = resultSet.getString(1);                                                    }                                                    t_Status_Code = Reset_Code;                                                    t_Error_Message = "Waiting for lot to be completed";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                }                                                t_Stmt_Num = 390;                                                // --t_new_operation1:=t_lot_rec.new_operation;                                                // --t_oper_seq1 :=t_lot_rec.operation_sequence;                                                // --t_new_routing1:=t_lot_rec.new_routing;                                                // --t_new_department1:=t_lot_rec.new_department;                                                // --t_new_state1:=t_lot_rec.new_state_id;                                                // --t_new_txn_qty1:=t_lot_rec.new_txn_qty;                                                // --t_new_uom_code1:=t_lot_rec.new_uom_code;                                                t_Sql_String = "select bos." + t_Operation_Field;                                                if (t_Routing_Field != null) {                                                    t_Sql_String = t_Sql_String + ", bos." + t_Routing_Field;                                                }                                                if (t_Step_Seq_Field != null) {                                                    t_Sql_String = t_Sql_String + ",bos." + t_Step_Seq_Field;                                                }                                                t_Sql_String = t_Sql_String + " from bom_operation_sequences bos,wip_discrete_jobs wdj " + // Dbms_Sql.Parse  (  t_Cursor ,                                                " where  wdj.wip_entity_id  =   " + t_Wip_Entity_Id + "  " + " and    bos.routing_sequence_id    =  wdj.common_routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + " + 1 )  )   " + " and    bos.operation_sequence_id not in  (  select from_op_seq_id  " + " from bom_operation_networks  " + " where from_op_seq_id  =  bos.operation_sequence_id )   ";                                                try {                                                    // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                                    // Dbms_Sql.Parse  (  t_Cursor ,                                                    // t_Sql_String ,                                                    // Dbms_Sql.Native )  ;                                                    // Dbms_Sql.Define_Column  (  t_Cursor ,                                                    // 1 ,                                                    // t_To_Operation_Code ,                                                    // 255 )  ;                                                    if (t_Routing_Field != null) {                                                        // Dbms_Sql.Define_Column  (  t_Cursor ,                                                        // 2 ,                                                        // t_New_Routing ,                                                        // 255 )  ;                                                    }                                                    if (t_Step_Seq_Field != null) {                                                        // Dbms_Sql.Define_Column  (  t_Cursor ,                                                        // 3 ,                                                        // t_Operation_Seq ,                                                        // 50 )  ;                                                    }                                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                                    // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                                    preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    x_Status_Code = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    resultSet.next();                                                    if (x_Status_Code == 1) {                                                        // Dbms_Sql.Column_Value ( t_Cursor, 1,t_To_Operation_Code);                                                        t_To_Operation_Code = resultSet.getString(1);                                                        if (t_Routing_Field != null) {                                                            // Dbms_Sql.Column_Value ( t_Cursor, 2,t_New_Routing);                                                            t_New_Routing = resultSet.getString(2);                                                        }                                                        if (t_Step_Seq_Field != null) {                                                            // Dbms_Sql.Column_Value ( t_Cursor, 3,t_Operation_Seq);                                                            t_Operation_Seq = resultSet.getString(3);                                                        }                                                    } else if (x_Status_Code > 1) {                                                        // if  (  Dbms_Sql.Is_Opent_Cursor )                                                        {                                                            // Dbms_Sql.Close_Cursor ( t_Cursor);                                                        }                                                        t_Status_Code = Failure_Code;                                                        t_Error_Code = 1078;                                                        t_Error_Message = "Multiple last operations ";                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    } else {                                                        // if  (  Dbms_Sql.Is_Opent_Cursor )                                                        {                                                            // Dbms_Sql.Close_Cursor ( t_Cursor);                                                        }                                                        t_Status_Code = Failure_Code;                                                        t_Error_Code = 1078;                                                        t_Error_Message = "No last operation found ";                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    }                                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                                } catch (SQLException e1) {                                                    logger.error(e1, e1);                                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                                    {                                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                                    }                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1080;                                                    t_Error_Message = "Error: " + e1.getSQLState() + ", in selecting last operation";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 400;                                                try {                                                    Sql = "SELECT  State_Name " + " From t_State_Step_Mappings " + " Where Intraoperation_Step = ? " + " And Factory_Id = ? " + " And  Rownum = 1";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, 3);                                                    preparedStatement.setObject(2, t_Factory_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_New_State = resultSet.getString(1);                                                    }                                                } catch (No_Data_Found e2) {                                                    logger.error(e2);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = 1152;                                                    t_Error_Message = "state name for intraoperation step 3 not defined";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Organization_Id);                                                preparedStatement.setObject(2, o_Inventory_Item_Id);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_Uom = resultSet.getString(1);                                                }                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside Bom Level Change, T_UOM:" + t_Uom);                                                try {                                                    Sql = "SELECT  Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or " + " Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                                    preparedStatement.setObject(2, 0);                                                    preparedStatement.setObject(3, 0);                                                    preparedStatement.setObject(4, 0);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_New_Txn_Qty = resultSet.getInt(1);                                                    }                                                } catch (No_Data_Found e1) {                                                    logger.error(e1);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1445;                                                    t_Error_Message = "Cannot find operation with +ve Qty in wip_operations for wip_entity_id: " + t_Wip_Entity_Id;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                } catch (Too_Many_Rows e2) {                                                    logger.error(e2);                                                    t_Status_Code = Reject_Code;                                                    t_Error_Code = 1457;                                                    t_Error_Message = "Qty split between operations or intra-operation steps for wip_entity_id: " + t_Wip_Entity_Id;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                // vyshnavi - last                                                t_Stmt_Num = 410;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Lot_Bom_Level(t_Lot_Rec.Transaction_Id, t_Lot_Rec.New_Factory_Name, t_New_Routing, t_To_Operation_Code, t_Operation_Seq, t_Lot_Rec.Transaction_Date, o_Bom_Level, t_Status_Code, t_Error_Code, t_Error_Message);                                                if (procedureParams_OutputMap.get("i_New_Routing") != null) {                                                    t_New_Routing = (java.lang.String) procedureParams_OutputMap.get("i_New_Routing");                                                }                                                if (procedureParams_OutputMap.get("o_Bom_Level") != null) {                                                    o_Bom_Level = (java.lang.String) procedureParams_OutputMap.get("o_Bom_Level");                                                }                                                if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                }                                                t_Lot_Rec.New_Bom_Level = o_Bom_Level;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, O_Bom_Level: " + o_Bom_Level);                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code:" + t_Status_Code);                                                if (t_Status_Code != Success_Code) {                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                Sql = "SELECT  Case ? " + " When ? Then " + " ? " + " Else ? End " + " From Dual ";                                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                preparedStatement.setObject(1, t_Lot_Rec.New_Uom_Code);                                                preparedStatement.setObject(2, t_Uom);                                                preparedStatement.setObject(3, t_Lot_Rec.New_Txn_Qty);                                                preparedStatement.setObject(4, t_New_Txn_Qty);                                                resultSet = preparedStatement.executeQuery();                                                resultSet.last();                                                totalRows = resultSet.getRow();                                                resultSet.beforeFirst();                                                if (totalRows > 1) {                                                    throw new SQLException("Too Many Rows");                                                }                                                if (resultSet.next() == false) {                                                    throw new No_Data_Found("No Data Found");                                                } else {                                                    t_New_Txn_Qty = resultSet.getInt(1);                                                }                                                t_Lot_Rec.New_Routing = t_New_Routing;                                                t_Lot_Rec.New_Operation = t_To_Operation_Code;                                                t_Lot_Rec.Operation_Sequence = t_Operation_Seq;                                                t_Lot_Rec.New_State_Id = t_New_State;                                                t_Lot_Rec.New_Department = null;                                                t_Lot_Rec.New_Uom_Code = t_Uom;                                                t_Lot_Rec.New_Txn_Qty = t_New_Txn_Qty;                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec.New_Operation: " + t_Lot_Rec.New_Operation);                                                t_Stmt_Num = 420;                                                // t_oracle_uom is used in move_lot_api also.                                                tltAdatpObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, o_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api: " + t_Status_Code);                                                if (t_Status_Code != Success_Code) {                                                    /*                                                                                     update t_parent_lots_api                                                                                     set    new_operation=t_new_operation1,                                                                                     operation_sequence=t_oper_seq1,                                                                                     new_state_id=t_new_state1,                                                                                     new_routing=t_new_routing1,                                                                                     new_department=t_new_department1,                                                                                     new_bom_level=null,                                                                                     new_txn_qty=t_new_txn_qty1,                                                                                     new_uom_code=t_new_uom_code1                                                                                     where  transaction_id=t_lot_rec.transaction_id;                                                                                     */                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                                t_Stmt_Num = 430;                                                procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                                }                                                /*                                                                                 update t_parent_lots_api                                                                                 set    new_operation=t_new_operation1,operation_sequence=t_oper_seq1,                                                                                 new_state_id=t_new_state1,new_routing=t_new_routing1,new_department=t_new_department1,                                                                                 new_bom_level=null,new_txn_qty=t_new_txn_qty1,new_uom_code=t_new_uom_code1                                                                                 where  transaction_id=t_lot_rec.transaction_id;                                                                                 */                                                // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                                // --                null,                                                // --                t_status_code,                                                // --                t_error_code,                                                // --                t_error_message,                                                // --                GET                                                // --                    );                                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Bom Level change status after T_Move_Lot_Api: " + t_Status_Code);                                                if (t_Status_Code == Success_Code) {                                                    Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Inventory_Item_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Uom = resultSet.getString(1);                                                    }                                                    // --**** Added input parameter - transaction_id Kunal -15/11                                                    t_Stmt_Num = 440;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Alternate_Designator(t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Routing, t_Alternate_Designator, t_Status_Code, t_Error_Code, t_Error_Message, t_Lot_Rec);                                                    if (procedureParams_OutputMap.get("o_Alternate_Designator") != null) {                                                        t_Alternate_Designator = (java.lang.String) procedureParams_OutputMap.get("o_Alternate_Designator");                                                    }                                                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    if (t_Status_Code != Success_Code) {                                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                        }                                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                        }                                                        // Goto End_Transact_Loop;                                                        break end_Transact_Loop;                                                    }                                                    t_Stmt_Num = 450;                                                    if (t_Skip_Bom_Level) {                                                        Component_Qty_t = 1;                                                    } else {                                                        try {                                                            Sql = "SELECT  Bic.Component_Quantity " + // --  from  bom_inventory_components bic, --Deepak 22 Mar, 03                                                            " From T_Component_v         Bic, " + " Bom_Bill_Of_Materials Bom " + " Where Bic.Bill_Sequence_Id = " + " Bom.Common_Bill_Sequence_Id " + " And Bom.Assembly_Item_Id = " + " ? " + " And Bom.Organization_Id = " + " ? " + " And Bic.Component_Item_Id = " + " ? " + " And Bic.Wip_Supply_Type = ? " + " And Nvl  (  Bom.Alternate_Bom_Designator, " + " Primary )  = " + " Nvl  (  ?, " + " Primary )  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bic.Effectivity_Date )  And " + " Nvl  (  Bic.Disable_Date, " + // Deepak 22 Mar, 03                                                            "  (  ? + ? )  )    ";                                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                            preparedStatement.setObject(1, t_Inventory_Item_Id);                                                            preparedStatement.setObject(2, t_Organization_Id);                                                            preparedStatement.setObject(3, o_Inventory_Item_Id);                                                            preparedStatement.setObject(4, 1);                                                            preparedStatement.setObject(5, t_Alternate_Designator);                                                            preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                                            preparedStatement.setObject(7, t_Lot_Rec.Transaction_Date);                                                            preparedStatement.setObject(8, 1);                                                            resultSet = preparedStatement.executeQuery();                                                            resultSet.last();                                                            totalRows = resultSet.getRow();                                                            resultSet.beforeFirst();                                                            if (totalRows > 1) {                                                                throw new SQLException("Too Many Rows");                                                            }                                                            if (resultSet.next() == false) {                                                                throw new No_Data_Found("No Data Found");                                                            } else {                                                                Component_Qty_t = resultSet.getInt(1);                                                            }                                                            // --              and     trunc(sysdate) between trunc(bic.effectivity_date) and                                                            // --                nvl(bic.disable_date, (sysdate + 1));                                                        } catch (No_Data_Found e1) {                                                            logger.error(e1);                                                            t_Status_Code = Failure_Code;                                                            t_Error_Code = 1981;                                                            t_Error_Message = "Could not find effective BOM with the alternate designator: " + t_Alternate_Designator;                                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                            }                                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                            }                                                            // Goto End_Transact_Loop;                                                            break end_Transact_Loop;                                                        }                                                    }                                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Component_Qty_T: " + Component_Qty_t);                                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Updating Txn Qty: " + t_Lot_Rec.New_Txn_Qty);                                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set New_Uom_Code = ? , " + " New_Txn_Qty  = Case ? " + " When ? Then " + " ? " + " Else Round  (  ? / " + " ? , " + " ? )  End " + " Where Transaction_Id = " + " ?  ";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Uom);                                                    preparedStatement.setObject(2, t_Lot_Rec.New_Uom_Code);                                                    preparedStatement.setObject(3, t_Uom);                                                    preparedStatement.setObject(4, t_Lot_Rec.New_Txn_Qty);                                                    preparedStatement.setObject(5, t_Lot_Rec.New_Txn_Qty);                                                    preparedStatement.setObject(6, Component_Qty_t);                                                    preparedStatement.setObject(7, 0);                                                    preparedStatement.setObject(8, t_Lot_Rec.Transaction_Id);                                                    preparedStatement.executeUpdate();                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                                    }                                                    t_Status_Code = Reset_Code;                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                }                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            }                                        }                                        // end start or complete the lot                                        // end check if lot already exists in sector                                        t_Stmt_Num = 460;                                    } else if (t_Level > t_Current_Level) {                                        // --Deepak 25 Oct,02                                        Sql = // 4 complete                                        "SELECT  Wdj.Status_Type, We.Wip_Entity_Name  " + " From Wip_Discrete_Jobs Wdj, Wip_Entities We " + " Where Wdj.Wip_Entity_Id = We.Wip_Entity_Id " + " And We.Wip_Entity_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Wip_Entity_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Status_Type = resultSet.getInt(1);                                            t_Job_Name = resultSet.getString(2);                                        }                                        if (t_Status_Type == 4) {                                            // --lot need to be returned to wip first                                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Return to wip before jump  of ring for jump backwards");                                            Sql = "SELECT  Primary_Uom_Code " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Organization_Id);                                            preparedStatement.setObject(2, o_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom_Code = resultSet.getString(1);                                            }                                            t_Stmt_Num = 470;                                            procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                            null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                            }                                            if (t_Status_Code == Success_Code) {                                                t_Status_Code = Reset_Code;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                }                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 480;                                        try {                                            Sql = // uom code of active lot                                            "SELECT  Uom_Code  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom = resultSet.getString(1);                                            }                                        } catch (No_Data_Found e) {                                            logger.error(e);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 2410;                                            t_Error_Message = "No active lot available";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        if (t_Lot_Rec.New_Uom_Code != t_Uom) {                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 1987;                                            t_Error_Message = "Jump back across bom level with different UOM is not allowed";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Jump  of ring for jump backwards");                                        Sql = "UPDATE t_Lot_Items_Api " + " Set New_Bom_Level = ? " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Bom_Level);                                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Stmt_Num = 490;                                        // t_oracle_uom is used in move_lot_api also.                                        tltAdatpObject.t_Validate_Lot_Api(// 1                                        t_Lot_Rec.Transaction_Id, // 2                                        null, // 3                                        t_Factory_Id, // 4                                        t_Lot_Rec.New_Txn_Qty, null, // 5                                        t_Operation_Seq_Num, // 6                                        t_Intra_Op_Step, // 7                                        o_Inventory_Item_Id, // 8                                        t_Lot_Position, // 9                                        t_Lot_Rec.Lot_Id, // 10                                        t_Job_Name, // 11 chr                                        Character.toString(t_Lot_Status), // 12                                        t_Oracle_Uom, // 13                                        i_User_Id, // 14                                        t_Lot_Rec, // 15                                        t_Status_Code, // 16                                        t_Error_Code, // 17                                        t_Error_Message);                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api:" + t_Status_Code);                                        if (t_Status_Code != Success_Code) {                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 500;                                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                        // --                null,                                        // --                t_status_code,                                        // --                t_error_code,                                        // --                t_error_message,                                        // --                GET                                        // --                    );                                        if (t_Status_Code == Success_Code) {                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } else {                                        t_Status_Code = Reject_Code;                                        t_Error_Code = 1961;                                        t_Error_Message = "Lots not in sequence of the bom levels in t_lots table.Actions : If Cutover - Change unique_id in t_lots/t_oracle_jobs";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } else {                                    // --no change of item so just perform jump. lot would come here when jump forward to next sector comes                                    // --after jump jump back was done sometime back. So no need to complete and start lot.                                    // --lot is still in same sector although it jumped to operations in other sector                                    t_Stmt_Num = 510;                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Jump into Routing for jump forwards");                                    // t_oracle_uom is used in move_lot_api also.                                    tltAdatpObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, o_Inventory_Item_Id, t_Lot_Position, t_Lot_Rec.Lot_Id, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: BOM Level change, T_Status_Code after T_Validate_Lot_Api:" + t_Status_Code);                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 520;                                    procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, o_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                    // --                null,                                    // --                t_status_code,                                    // --                t_error_code,                                    // --                t_error_message,                                    // --                GET                                    // --                    );                                    if (t_Status_Code == Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                        }                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            // no change in bom level                        } catch (No_Data_Found e) {                            logger.error(e);                            // -- check if Lot in WIP for the very item , if so, then insert into t_lots,but still error out.                            // -- Hari K Feb 07 , reverse insert into t lots table if the lot has been created in Oracle.                            // -- if this flag is set to true in Client Site. This may not be applicable for all situations                            // --This has to be done carefully.Side effects include  headache,indigestion, mails from the big boss                            // -- and nasty looks/mails from the client.                            if (t_Reverse_Insert_From_Oracle && t_Lot_Rec.New_Bom_Level != null) {                                try {                                    // -- check if lot is created in Oracle from frontend or other sources                                    Log_Msg = "T_Transact_Lots: Item/org before Reverse-Insert: " + t_Inventory_Item_Id + "," + t_Organization_Id;                                    logger.debug(Log_Msg);                                    procedureParams_OutputMap = Log_Message(Log_Msg);                                    Sql = "SELECT  Primary_Item_Id, Status_Type, Wip_Entity_Id " + " From Wip_Discrete_Jobs " + " Where Lot_Number = ? " + " And Organization_Id = ? " + " And Primary_Item_Id = ? " + // strict check to keep this at a minimum.So moves causing start to next bom level etc will fail                                    " And Status_Type In   (  3, ? )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Organization_Id);                                    preparedStatement.setObject(3, t_Inventory_Item_Id);                                    preparedStatement.setObject(4, 6);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        o_Inventory_Item_Id = resultSet.getInt(1);                                        t_Status_Type = resultSet.getInt(2);                                        t_Wip_Entity_Id = resultSet.getInt(3);                                    }                                } catch (No_Data_Found e2) {                                    logger.error(e2);                                    t_Error_Code = 1264;                                    t_Error_Message = "No Released Lot found in Oracle. Cannot Reverse Insert.If this is a valid lot to be transacted, then create Lot in Oracle and Resubmit";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Failure_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        Failure_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // check if lot is created in Oracle from frontend or other sources                                // -- want to keep code length small, hence cramped.                                try {                                    // -- check once more, remember there can be side effects !                                    Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C, H )  )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                    // --Added H Status by Mahendra on 29 Aug 09 for HOLD check                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    Sql = "SELECT  t_Lots_s.Nextval " + " From Dual ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Reverse_Insert_Unique_Id = resultSet.getInt(1);                                    }                                    Sql = "INSERT Into t_Lots " + "   (  Unique_Id , " + " Lot_Id , " + " Txn_Qty , " + " Factory_Id , " + " Creation_Date , " + " Status , " + " Remarks , " + " Bom_Level , " + " Lot_Type " + // --Added By MohanVamsi 10-Nov-2011, without this If Scrap is first Txn then                                    // --Failing                                    "  )  " + " Values " + "   (  ? , " + " ?, " + " ? , " + " ? , " + " Sysdate , " + // as only released or on hold jobs considered, hence fixed                                    " A ,  " + " TLTHREAD:Reverseinsert from Oracle , " + " ? , " + " ? )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Reverse_Insert_Unique_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, t_Lot_Rec.New_Txn_Qty);                                    preparedStatement.setObject(4, t_Factory_Id);                                    preparedStatement.setObject(5, t_Lot_Rec.New_Bom_Level);                                    preparedStatement.setObject(6, t_Lot_Rec.New_Lot_Type);                                    preparedStatement.executeUpdate();                                    Sql = "INSERT Into t_Oracle_Jobs " + "   (  Lot_Id , " + " Factory_Id , " + " Wip_Entity_Id , " + " Parent_Wip_Entity_Id , " + " Status , " + " Active_Flag )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " A )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Reverse_Insert_Unique_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    preparedStatement.setObject(3, t_Wip_Entity_Id);                                    preparedStatement.setObject(4, t_Wip_Entity_Id);                                    preparedStatement.setObject(5, 1);                                    preparedStatement.executeUpdate();                                    t_Error_Code = (int) 1264.1;                                    t_Error_Message = "TLTHREAD.Reverse Insert  ( into t_lots) Flag is ON. Record Inserted into t_lots.";                                    procedureParams_OutputMap = Log_Message(t_Error_Message);                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Reset_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        Reset_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                                // --Need to Uncomment from Line(GOTO END_TRANSACT_LOOP) to line (GOTO END_TRANSACT_LOOP;---23456)                                // --and comment below for not Allowing to process any action code from Lot eDapter                                // --when Lot Starts outside Lot eDapter till 33333333                                // --Added by MohanVamsi for SI can be uncomment if required                                try {                                    Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  H )  )   ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e1) {                                    logger.error(e1);                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            try {                                Sql = "SELECT  x " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  H )  )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Failure_Code;                                t_Error_Code = 1265;                                t_Error_Message = "Lot does not exist in t_lots." + "Reasons: 1)Lot was Started from front end 2)Prior Transaction closed/completed the lot" + " Corresponding Actions  :1.Reverse insert into t_lots/t_oracle_jobs 2.Check why lot got completed and act accordingly";                                procedureParams_OutputMap = Log_Message(t_Error_Message);                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // Added or Commented by MohanVamsi                        /*  GOTO END_TRANSACT_LOOP;                                                                 END IF; -- Hari K, end of reverse insert..I hope it works without causing any side-effects.                                                                 T_STATUS_CODE   := FAILURE_CODE;                                                                 T_ERROR_CODE    := 1265;                                                                 T_ERROR_MESSAGE := Lot does not exist in t_lots. ||                                                                 Reasons: 1)Lot was Started from front end 2)Prior Transaction closed/completed the lot ||                                                                  Corresponding Actions :1.Reverse insert into t_lots/t_oracle_jobs 2.Check why lot got completed and act accordingly;                                                                 LOG_MESSAGE(T_ERROR_MESSAGE);                                                                 tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID,                                                                 NULL,                                                                 T_STATUS_CODE,                                                                 T_ERROR_CODE,                                                                 T_ERROR_MESSAGE,                                                                 SET);                                                                 GOTO END_TRANSACT_LOOP;---23456                                                                 */                        // bom level change first select                    }                    // track in oracle                    // --***************JUMP ACROSS BOM LEVEL END***************                    t_Stmt_Num = 530;                    // --Deepak 29 Nov,02                    if (x_Track_In_Oracle == 1 && t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS")) {                        /*                                                     begin                                                     select toj.wip_entity_id , status_type, primary_item_id                                                     into   t_wip_entity_id, t_status_type, t_inventory_item_id                                                     from   t_oracle_jobs toj,wip_discrete_jobs wdj                                                     where  toj.lot_id = (select max(unique_id)                                                     from   t_lots                                                     where  lot_id     = t_lot_rec.lot_id                                                     and    factory_id = t_factory_id                                                     and    status =C)                                                     and    toj.wip_entity_id =wdj.wip_entity_id;                                                     dbms_output.put_line( before return to wip t_status_type- ||t_status_type);                                                     exception                                                     when no_data_found then                                                     null;                                                     end;                                                     */                        // --Added by Harikrishna for unclose lots on 27-Aug-2003                        if (t_Status_Type == 12) {                            if (((x_Wip_Entity_Id != null ? x_Wip_Entity_Id : 0) == 0)) {                                try {                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = C " + " And Tl.Status = C " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )  " + " And  Rownum = 1";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(3, 12);                                    preparedStatement.setObject(4, 2);                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(6, t_Factory_Id);                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(8, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        x_Wip_Entity_Id = resultSet.getInt(1);                                    }                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 1078.2;                                    t_Error_Message = " Cannot find lot to be Unclosed in oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(t_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            if (t_Status_Code == Success_Code) {                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Success in unclosing the Job");                                logger.debug("T_Transact_Lots: Success in unclosing the Job");                                t_Status_Type = 4;                                t_Wip_Entity_Id = x_Wip_Entity_Id;                            } else {                                t_Status_Code = Failure_Code;                                t_Error_Code = (int) 2751.1;                                t_Error_Message = " Cannot unclose" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        if (t_Status_Type == 4) {                            // --lot need to be returned to wip first                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Return to WIP first ");                            // check if job is in inactive state.handled below                            tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "C");                            if (t_Status_Code != Success_Code) {                                t_Status_Code = Failure_Code;                                t_Error_Message = "Error-" + t_Error_Message + " in t_get_lot_status for uncomplete in undos";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --Chcking for full scrap                            // -- Added by Harikrishna on July 04                            if (t_Job_Name != null) {                                Sql = "SELECT  Primary_Uom_Code, Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, x_Inventory_Item_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Uom_Code = resultSet.getString(1);                                    t_Lot_Rec.New_Uom_Code = resultSet.getString(2);                                }                                Sql = "SELECT  Quantity_Completed " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                                }                                if (t_Lot_Rec.New_Txn_Qty == 0) {                                    // --Quantity is fully scrapped                                    try {                                        Sql = "SELECT  Quantity_Scrapped, Operation_Seq_Num " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Quantity_Completed = Quantity_Scrapped " + " And Quantity_Completed > ? " + " And Count_Point_Type = ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Wip_Entity_Id);                                        preparedStatement.setObject(2, 0);                                        preparedStatement.setObject(3, 1);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Wip_Qty = resultSet.getInt(1);                                            t_Operation_Seq_Num = resultSet.getInt(2);                                        }                                    } catch (SQLException e) {                                        logger.error(e, e);                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 2751;                                        t_Error_Message = "Quantity Fully Scrapped Cannot det oprn" + e.getSQLState();                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    if (t_Wip_Qty > 0) {                                        t_Lot_Rec.Action_Code = "UNTERMINATE";                                        t_Undo = true;                                    } else {                                        t_Status_Code = Failure_Code;                                        t_Error_Code = 2751;                                        t_Error_Message = "Quantity Fully Scrapped Cannot det oprn";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    // Goto t_Unterminate;                                    break t_Unterminate;                                } else {                                    // --quantity is completed                                    try {                                        Sql = // Deepak 26 Dec,02. bom level should not change in t_lots                                        "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = C )   ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                        preparedStatement.setObject(2, t_Factory_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Bom_Level = resultSet.getString(1);                                        }                                        t_Lot_Rec.New_Bom_Level = t_Bom_Level;                                        procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, // t_inventory_item_id,                                        x_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    } catch (No_Data_Found e) {                                        logger.error(e);                                        try {                                            Sql = "SELECT  Bom_Level " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = N )   ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                            preparedStatement.setObject(2, t_Factory_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Bom_Level = resultSet.getString(1);                                            }                                        } catch (No_Data_Found e2) {                                            logger.error(e2);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 2752;                                            t_Error_Message = "1.Undos.No completed lot available";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                }                                // Checking for Fully Scrap                            }                            // Job Name is not null                        } else {                            Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Organization_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Last_Op_Seq_Num = resultSet.getInt(1);                            }                            try {                                // --lot is completed but status type not updated                                Sql = // Deepak 26 Dec,02                                "SELECT  x  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Last_Op_Seq_Num);                                preparedStatement.setObject(3, 0);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                t_Status_Code = Reset_Code;                                t_Error_Message = "Undos.Waiting for lot to be completed";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } catch (No_Data_Found e) {                                logger.error(e);                            }                            // no uncomplete required                        }                        // --  end if;                        t_Stmt_Num = 540;                        // --******UNDO MOVE ACROSS BOM LEVEL STARTS*************                        // --  if x_track_in_oracle = 1 and upper(t_lot_rec.action_code) =UNDOS--UNDO MOVE --Deepak 16 Dec,02                        // --  then                        try {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Inside UNDO move across BOM Level");                            Sql = "SELECT  Max ( Unique_Id) " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Unique_Id = resultSet.getInt(1);                            }                            if (t_Unique_Id == null) {                                Sql = "SELECT  Max ( Unique_Id) " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = T  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            }                            Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Unique_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_ID: " + t_Wip_Entity_Id + ", at stmt no: " + t_Stmt_Num);                            try {                                Sql = // operation_sequence_id                                "SELECT  Standard_Operation_Id  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Quantity_In_Queue > ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, 0);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Wo_Std_Op_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                // --t_operation_seq_id:=null;                                t_Wo_Std_Op_Id = null;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wo_Std_Op_ID: " + t_Wo_Std_Op_Id);                            t_Stmt_Num = 542;                            try {                                Sql = "SELECT  x " + " From Bom_Operation_Sequences Bos, Wip_Discrete_Jobs Wdj " + // --   where   bos.operation_sequence_id=t_operation_seq_id  --ok since used for first operation                                " Where Bos.Standard_Operation_Id = ?  " + // Deepak 18 Jan,03                                " And Wdj.Wip_Entity_Id = ?  " + // Kunal 24 Jan,03                                " And Wdj.Common_Routing_Sequence_Id = " + // Kunal 24 Jan,03                                " Bos.Routing_Sequence_Id  " + " And Trunc  (  ? )  Between " + " Trunc  (  Bos.Effectivity_Date )  And " + " Nvl  (  Bos.Disable_Date, " + // Deepak 22 Mar,03                                "  (  ? + ? )  )   " + // --  and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1))                                " And Bos.Operation_Sequence_Id Not In " + "  (  Select To_Op_Seq_Id " + " From Bom_Operation_Networks " + " Where To_Op_Seq_Id = Bos.Operation_Sequence_Id )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wo_Std_Op_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                                preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                preparedStatement.setObject(5, 1);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                try {                                    Sql = // Deepak 25 Dec,02. this is to check if its across bom level                                    "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Unique_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Bom_Level = resultSet.getString(1);                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 2850;                                    t_Error_Message = "2.Undos.No active/cancelled lot available";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                if (t_Bom_Level == t_Lot_Rec.New_Bom_Level) {                                    // --this is within same bom level                                    t_Dummy = null;                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                t_Dummy = null;                            }                            t_Stmt_Num = 550;                            try {                                // --check if this is undo intraoperation step and not undo operation                                Sql = "SELECT  y " + " From Wip_Move_Transactions " + " Where Transaction_Id = " + "  (  Select Max  (  Transaction_Id )  " + " From Wip_Move_Transactions " + " Where Organization_Id = ? " + " And Wip_Entity_Id = ? " + " And To_Operation_Seq_Num = ? " + " And   (  Fm_Operation_Seq_Num = To_Operation_Seq_Num And " + " Fm_Intraoperation_Step_Type < " + " To_Intraoperation_Step_Type )  " + " And Wsm_Undo_Txn_Id == null )   ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Organization_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                preparedStatement.setObject(3, t_Operation_Seq_Num);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                // null;                            }                            // this is undo operation. t_dummy should not be updated.                            if (t_Dummy.equals("y")) {                                t_Dummy = null;                            }                            if (t_Dummy.equals("x")) {                                // --if undo move is from first operation only                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: Undo move is from first operation");                                t_Stmt_Num = 552;                                try {                                    // --added for undos with multiple components. return only primary component.                                    Sql = // Deepak 7 Mar, 03                                    "SELECT  Common_Bom_Sequence_Id  " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Bom_Seq_Id = resultSet.getInt(1);                                    }                                    t_Stmt_Num = 553;                                    Sql = "SELECT  Min ( Operation_Seq_Num) " + // --        from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, 1);                                    preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(5, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Op_Seq_Num = resultSet.getInt(1);                                    }                                    // --        and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                    t_Stmt_Num = 554;                                    Sql = "SELECT  Min ( Item_Num) " + // --    from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Operation_Seq_Num = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, t_Op_Seq_Num);                                    preparedStatement.setObject(3, 1);                                    preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(6, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Item_Seq_Num = resultSet.getInt(1);                                    }                                    // --    and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                    t_Stmt_Num = 555;                                    Sql = "SELECT  Component_Item_Id " + // -- from    bom_inventory_components  --Deepak 22 Mar, 03                                    " From T_Component_v " + " Where Bill_Sequence_Id = ? " + " And Operation_Seq_Num = ? " + " And Item_Num = ? " + " And Wip_Supply_Type = ? " + " And Trunc  (  ? )  Between " + " Trunc  (  Effectivity_Date )  And " + // Deepak 22 Mar, 03                                    " Nvl  (  Disable_Date,   (  ? + ? )  )    ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Bom_Seq_Id);                                    preparedStatement.setObject(2, t_Op_Seq_Num);                                    preparedStatement.setObject(3, t_Item_Seq_Num);                                    preparedStatement.setObject(4, 1);                                    preparedStatement.setObject(5, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(6, t_Lot_Rec.Transaction_Date);                                    preparedStatement.setObject(7, 1);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Comp_Item_Id = resultSet.getInt(1);                                    }                                    // -- and   trunc(sysdate) between trunc(effectivity_date) and nvl(disable_date, (sysdate + 1));                                } catch (SQLException e) {                                    logger.error(e, e);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 3048;                                    t_Error_Message = "Error in fetching primary component for UNDOS, Msg:" + e.getSQLState() + ", at stmt: " + t_Stmt_Num;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                t_Stmt_Num = 556;                                try {                                    Sql = "SELECT  x " + " From Mtl_Material_Transactions Mmt " + " Where Mmt.Organization_Id = ? " + // Deepak 7 Mar, 03                                    " And Mmt.Inventory_Item_Id = ?  " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Organization_Id);                                    preparedStatement.setObject(2, t_Comp_Item_Id);                                    preparedStatement.setObject(3, 5);                                    preparedStatement.setObject(4, 43);                                    preparedStatement.setObject(5, t_Wip_Entity_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                    t_Stmt_Num = 557;                                    if (t_Status_Type == 3) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Need to cancel the latest Job");                                        t_Job_Name = null;                                    } else {                                        // check if job is cancelled                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "T");                                        if (t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for cancelled lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Job_Name: " + t_Job_Name);                                    t_Stmt_Num = 560;                                    if (t_Job_Name == null) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Cancel the Lot");                                        // check if job is in wip                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                                        if (t_Job_Name == null || t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for wip lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        t_Stmt_Num = 570;                                        procedureParams_OutputMap = // cancel the lot                                        tltAdatptSubObject.t_Cancel_Wiplot_Api(// cancel the lot                                        t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Organization_Id, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                        }                                        // --          tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                        // --                  null,                                        // --                  t_status_code,                                        // --                  t_error_code,                                        // --                  t_error_message,                                        // --                  GET                                        // --                      );                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After cancel T_Status_Code: " + t_Status_Code);                                        if (t_Status_Code == Success_Code) {                                            // can go ahead with uncomplete                                            t_Undo = true;                                        } else {                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    } else {                                        // can go ahead with uncomplete                                        t_Undo = true;                                    }                                    t_Stmt_Num = 580;                                    if (t_Undo == true) {                                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Uncomplete the Lot");                                        // --if job is cancelled then uncomplete the lot in previous sector                                        // check if job is in inactive state                                        tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, "N");                                        if (t_Job_Name == null) {                                            // --this was undo lot start                                            t_Status_Code = Success_Code;                                            t_Error_Code = null;                                            t_Error_Message = null;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        } else if (t_Status_Code != Success_Code) {                                            t_Status_Code = Failure_Code;                                            t_Error_Message = "Error:" + t_Error_Message + ", in t_get_lot_status for inactive lot";                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        try {                                            Sql = "SELECT  Primary_Uom_Code, Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Organization_Id = ? " + " And Inventory_Item_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Organization_Id);                                            preparedStatement.setObject(2, t_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Uom_Code = resultSet.getString(1);                                                t_Lot_Rec.New_Uom_Code = resultSet.getString(2);                                            }                                            Sql = "SELECT  Quantity_Completed " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, t_Wip_Entity_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                                            }                                        } catch (SQLException e) {                                            logger.error(e, e);                                            t_Status_Code = Failure_Code;                                            t_Error_Code = 3225;                                            t_Error_Message = "Undos: Error selecting job details-" + e.getSQLState();                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                        // --Added by Harikrishna for unclose lots on 27-Aug-2003                                        if (t_Status_Type == 12) {                                            if (((t_Wip_Entity_Id != null ? t_Wip_Entity_Id : 0) == 0)) {                                                try {                                                    Sql = "SELECT  Wdj.Wip_Entity_Id " + " From Wip_Discrete_Jobs Wdj, " + " t_Lots            Tl, " + " t_Oracle_Jobs     Toj " + " Where Wdj.Organization_Id = ? " + " And Wdj.Lot_Number = ? " + " And Wdj.Status_Type = ? " + " And Wdj.Wip_Entity_Id = Toj.Wip_Entity_Id " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Status = ? " + " And Toj.Active_Flag = N " + " And Tl.Status = N " + " And Tl.Lot_Id = ? " + " And Tl.Factory_Id = ? " + " And Tl.Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = N )  " + " And  Rownum = 1";                                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                                    preparedStatement.setObject(1, t_Organization_Id);                                                    preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(3, 12);                                                    preparedStatement.setObject(4, 2);                                                    preparedStatement.setObject(5, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(6, t_Factory_Id);                                                    preparedStatement.setObject(7, t_Lot_Rec.Lot_Id);                                                    preparedStatement.setObject(8, t_Factory_Id);                                                    resultSet = preparedStatement.executeQuery();                                                    resultSet.last();                                                    totalRows = resultSet.getRow();                                                    resultSet.beforeFirst();                                                    if (totalRows > 1) {                                                        throw new SQLException("Too Many Rows");                                                    }                                                    if (resultSet.next() == false) {                                                        throw new No_Data_Found("No Data Found");                                                    } else {                                                        t_Wip_Entity_Id = resultSet.getInt(1);                                                    }                                                } catch (SQLException e) {                                                    logger.error(e, e);                                                    t_Status_Code = Failure_Code;                                                    t_Error_Code = (int) 1078.3;                                                    t_Error_Message = " Cannot find lot to be Unclosed in oracle";                                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                    }                                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                    }                                                    // Goto End_Transact_Loop;                                                    break end_Transact_Loop;                                                }                                            }                                            DateFormat dateFormat = new SimpleDateFormat("ddmmyyyy");                                            String strDate = dateFormat.format(t_Lot_Rec.Transaction_Date);                                            procedureParams_OutputMap = tLotUtilsObject.T_Unclose_Wip_Jobs(t_Wip_Entity_Id, t_Organization_Id, Integer.parseInt(strDate), t_User_Id, t_Status_Code, t_Error_Message);                                            if (procedureParams_OutputMap.get("o_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                            }                                            if (t_Status_Code == Success_Code) {                                                t_Status_Type = 4;                                                procedureParams_OutputMap = Log_Message("Success in unclosing the job-");                                            } else {                                                t_Status_Code = Failure_Code;                                                t_Error_Code = (int) 3225.1;                                                t_Error_Message = " Cannot unclose" + t_Error_Message;                                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                                }                                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                                }                                                // Goto End_Transact_Loop;                                                break end_Transact_Loop;                                            }                                        }                                        // this is undo across bom level                                        tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    // --perform unconsume first                                    // check if job is in wip                                    tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                                    if (t_Job_Name == null || t_Status_Code != Success_Code) {                                        t_Status_Code = Failure_Code;                                        t_Error_Message = "Error: " + t_Error_Message + ", in t_get_lot_status for wip lot";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 590;                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Perform UnConsume first");                                    Sql = "SELECT  t_Child_Lots_Api_s.Nextval " + " From Dual ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Line_Number_s = resultSet.getInt(1);                                    }                                    // -- delete  from t_child_lots_api                                    // -- where transaction_id=t_lot_rec.transaction_id;                                    Sql = // assuming that there is only one component in BOM                                    "INSERT Into t_Child_Lots_Api  " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.setObject(2, i_Factory_Name);                                    preparedStatement.setObject(3, t_Line_Number_s);                                    preparedStatement.setObject(4, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(5, Reset_Code);                                    preparedStatement.executeUpdate();                                    // unconsume the component lot                                    tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                                    null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, t_Uom_Code, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    // --        tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                    // --                null,                                    // --                t_status_code,                                    // --                t_error_code,                                    // --                t_error_message,                                    // --                GET                                    // --                    );                                    if (t_Status_Code == Success_Code) {                                        t_Status_Code = Reset_Code;                                    }                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 3093;                            t_Error_Message = "Undos:lot does not exists in t_lots";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // <<t_Unterminate>>                    // --******UNDO MOVE ACROSS BOM LEVEL ENDS*************                    t_Stmt_Num = 600;                    if (x_Track_In_Oracle == 1 && (!t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS"))) {                        // --Deepak 26 Dec,02                        try {                            Sql = "SELECT  Wip_Entity_Id " + " From t_Oracle_Jobs " + " Where Lot_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + // Deepak 07 Mar,03                            " And Status In   (  A, H, T, C )  )    ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            // --   and bom_level=t_lot_rec.new_bom_level); --Deepak 04 Dec,02                            Sql = "SELECT  Status_Type, Start_Quantity, Quantity_Scrapped " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Status_Type = resultSet.getInt(1);                                t_Original_Qty = resultSet.getInt(2);                                t_Qty_Scrapped = resultSet.getInt(3);                            }                            if (t_Status_Type == 4 && t_Original_Qty == t_Qty_Scrapped && t_Lot_Rec.Action_Code.equals("TERMINATE")) {                                t_Status_Code = Success_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if (t_Status_Type == 1) {                                if (t_Lot_Rec.Action_Code.equals("TERMINATE")) {                                    procedureParams_OutputMap = tltAdatptSubObject.t_Release_Wip_Lot(t_Wip_Entity_Id, t_Organization_Id.toString(), t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Message, t_Error_Code, "Y");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Status_Code = Success_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                    // ---added Code by Vamsi  Feb309                                } else if (t_Lot_Rec.Action_Code.equals("RELEASE")) {                                    Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, 3);                                    preparedStatement.setObject(2, t_Wip_Entity_Id);                                    preparedStatement.setObject(3, t_Organization_Id);                                    preparedStatement.executeUpdate();                                    /*                                                     --update t_lots also                                                     select unique_id                                                     into t_unique_id                                                     from t_lots                                                     where lot_id = t_lot_rec.lot_id                                                     and factory_id = t_factory_id                                                     and status  in (H,A); --Deepak 24 Oct,02                                                     update t_lots                                                     set    status=A                                                     where unique_id=t_unique_id;                                                     update t_oracle_jobs                                                     set active_flag=A                                                     where lot_id=t_unique_id;*/                                    // --Added till here                                } else {                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = TRANSACTION on UNRELEASED JOB " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Reject_Code);                                    preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            // --Code to handle transactions for Lots started from front end -HariD Sep 3 08 for SiRF                            try {                                Sql = "SELECT  Wip_Entity_Id " + " From Apps.Wip_Discrete_Jobs " + " Where Lot_Number = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Tlot_Check_Lot_Number = resultSet.getString(1);                                }                                // --Commented by MohanVamsi, Lots will be inserted by Reverse Insert Concept,                                // --instead of separate procedure.                                /*IF T_TLOT_CHECK_LOT_NUMBER > 0                                                     THEN                                                     T_T_LOTS_ENTRY(T_LOT_REC.LOT_ID,                                                     T_LOT_REC.TRANSACTION_ID,                                                     T_FACTORY_ID);                                                     END IF;*/                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Reject_Code;                                t_Error_Code = 782;                                t_Error_Message = "Transaction on uncreated LOT ID" + t_Lot_Rec.Lot_Id;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    t_Stmt_Num = 610;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before Validate Lot");                    procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, t_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                        t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                    }                    if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                        t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                        t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                        t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                    }                    if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                        t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    if (t_Job_Name == null) {                        // Goto End_Transact_Loop; //not tracked in oracle                        break end_Transact_Loop;                    }                    // ------UNDOS .                    t_Stmt_Num = (int) 610.01;                    if (x_Track_In_Oracle == 1 && t_Lot_Rec.Action_Code.toUpperCase().equals("UNDOS")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Start UNDOS");                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_Id: " + t_Wip_Entity_Id + ", at stmt no:" + t_Stmt_Num);                        try {                            t_Stmt_Num = 611;                            Sql = // Deepak 26 Dec,02. bom level should not change in t_lots                            "SELECT  Bom_Level  " + " From t_Lots " + " Where Unique_Id =   (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Bom_Level = resultSet.getString(1);                            }                            if (t_Lot_Rec.New_Bom_Level == t_Bom_Level) {                                t_Same_Bom_Level = true;                            } else {                                // for updating t_lots                                t_Lot_Rec.New_Bom_Level = t_Bom_Level;                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 4285;                            t_Error_Message = "3.Undos.No active lot available";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = (int) 611.01;                        Sql = "SELECT  Primary_Unit_Of_Measure " + " From Mtl_System_Items " + " Where Inventory_Item_Id = ? " + " And Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Inventory_Item_Id);                        preparedStatement.setObject(2, t_Organization_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.New_Uom_Code = resultSet.getString(1);                        }                        t_Stmt_Num = (int) 611.02;                        Sql = "SELECT   ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move), " + " Operation_Seq_Num " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )  " + " And  Rownum = 1";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, 0);                        preparedStatement.setObject(3, 0);                        preparedStatement.setObject(4, 0);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                            t_Operation_Seq_Num = resultSet.getInt(2);                        }                        if (t_Same_Bom_Level) {                            t_Stmt_Num = (int) 611.03;                            Sql = // operation_sequence_id,                            "SELECT  Standard_Operation_Id,  " + " Quantity_In_Queue, " + " Quantity_Running, " + " Quantity_Waiting_To_Move, " + " Quantity_Scrapped " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wo_Std_Op_Id = resultSet.getInt(1);                                t_Quantity_In_Queue = resultSet.getInt(2);                                t_Quantity_Running = resultSet.getInt(3);                                t_Quantity_Waiting_To_Move = resultSet.getInt(4);                                t_Quantity_Scrapped = resultSet.getInt(5);                            }                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = // bos.operation_sequence_id  "+                            " select bos.standard_operation_id  " + " from   bom_operation_sequences bos ,    " + "     wip_discrete_jobs     wdj     " + " where  wdj.wip_entity_id     =   " + t_Wip_Entity_Id + "  " + " and     bos.routing_sequence_id   =  wdj.common_routing_sequence_id  " + " and    trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                            " + 1 )  )   " + // " and    trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                            " and    " + "bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Step_Seq_Field + "  =  " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            try {                                t_Stmt_Num = 612;                                // t_Cursor    =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Bos_Std_Op_Id )  ; //x_operation_seq_id )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_step_seq",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: X_Status_Code: " + x_Status_Code + ", at stmt no: " + t_Stmt_Num);                                if (x_Status_Code == 1) {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Bos_Std_Op_Id); //x_operation_seq_id);                                    // x_operation_seq_id = resultSet.getnull ( 1);                                    t_Bos_Std_Op_Id = resultSet.getInt(1);                                } else {                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 4109;                                    t_Error_Message = "Operation doesnot exists in Routing. Cannot undo";                                    t_Stmt_Num = 613;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 4110;                                t_Error_Message = "Error executing dynamic sql: " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_wo_std_op_id: " + t_Wo_Std_Op_Id + ", at stmt no: " + t_Stmt_Num);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Bos_std_op_id:" + t_Bos_Std_Op_Id + ", at stmt no: " + t_Stmt_Num);                            if (t_Quantity_In_Queue > 0) {                                t_Oracle_Intraope_Step_Type = 1;                            } else if (t_Quantity_Running > 0) {                                t_Oracle_Intraope_Step_Type = 2;                            } else if (t_Quantity_Waiting_To_Move > 0) {                                t_Oracle_Intraope_Step_Type = 3;                            }                            t_Stmt_Num = 614;                            procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_State(t_Factory_Id, t_Lot_Rec.New_State_Id, t_Tpla_Intraope_Step_Type, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Intraop_Step") != null) {                                t_Tpla_Intraope_Step_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Intraop_Step");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Tpla_Intraope_Step_Type: " + t_Tpla_Intraope_Step_Type);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Oracle_Intraope_Step_Type: " + t_Oracle_Intraope_Step_Type);                        }                        // --    select decode(t_uom1,t_lot_rec.new_uom_code,t_txn_qty1,t_lot_rec.new_txn_qty) --Deepak 03 Jan,03                        // --    into   t_txn_qty1                        // --    from   dual;                        // -- or (t_txn_qty1!=t_lot_rec.new_txn_qty)                        if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id || t_Oracle_Intraope_Step_Type != t_Tpla_Intraope_Step_Type || t_Quantity_Scrapped > 0 || !t_Same_Bom_Level) {                            // --perform undo move                            t_Stmt_Num = 615;                            if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id) {                                Sql = "SELECT  * " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = " + " ? " + " And Organization_Id = " + " ? " + " And Operation_Seq_Num = " + " ? " + " And Wip_Supply_Type = ? " + " And Quantity_Issued > ? ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Organization_Id);                                preparedStatement.setObject(3, t_Operation_Seq_Num);                                preparedStatement.setObject(4, 1);                                preparedStatement.setObject(5, 0);                                resultSet11 = preparedStatement.executeQuery();                                while (resultSet11.next()) {                                    Integer Comp_Return_Loop_Quantity_Issued = resultSet11.getInt("Quantity_Issued");                                    Integer Comp_Return_Loop_Wip_Entity_Id = resultSet11.getInt("Wip_Entity_Id");                                    Integer Comp_Return_Loop_Organization_Id = resultSet11.getInt("Organization_Id");                                    Integer Comp_Return_Loop_Inventory_Item_Id = resultSet11.getInt("Inventory_Item_Id");                                    t_Stmt_Num = 616;                                    Sql = "SELECT  Sum ( Quantity_Issued) " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ? " + " And Wip_Supply_Type = ? " + " And Inventory_Item_Id = " + " ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Wip_Entity_Id);                                    preparedStatement.setObject(2, t_Organization_Id);                                    preparedStatement.setObject(3, 1);                                    preparedStatement.setObject(4, Comp_Return_Loop_Inventory_Item_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Return_Quantity = resultSet.getInt(1);                                    }                                    t_Stmt_Num = 617;                                    if (t_Return_Quantity > 0) {                                        // vyshnavi Least plsql to java pending - Least                                        t_Return_Quantity = Math.min(Comp_Return_Loop_Quantity_Issued, t_Return_Quantity);                                        t_Returned_Quantity = 0;                                        t_Stmt_Num = 618;                                        Sql = "SELECT  Lot_Control_Code, Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = " + " ? " + " And Inventory_Item_Id = " + " ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Lot_Control_Code = resultSet.getInt(1);                                            t_Component_Item_Number = resultSet.getString(2);                                        }                                        t_Stmt_Num = 619;                                        Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Line_Number_s = 0;                                        t_Child_Exist = 0;                                        if (t_Lot_Control_Code == 2) {                                            t_Stmt_Num = 620;                                            Sql = "SELECT  Mtl.Lot_Number, " + " Abs (  Mtl.Transaction_Quantity ) Txn_Qty " + " From Mtl_Material_Transactions Mmt, " + " Mtl_Transaction_Lot_Numbers Mtl " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mtl.Transaction_Id = " + " Mmt.Transaction_Id " + " And Mtl.Inventory_Item_Id = " + " Mmt.Inventory_Item_Id " + " And Mtl.Organization_Id = " + " Mmt.Organization_Id " + " And Mtl.Transaction_Source_Type_Id = ? " + " Order By Mtl.Transaction_Id Desc ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                            preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                            preparedStatement.setObject(3, Comp_Return_Loop_Wip_Entity_Id);                                            preparedStatement.setObject(4, 35);                                            preparedStatement.setObject(5, 5);                                            resultSet12 = preparedStatement.executeQuery();                                            while (resultSet12.next()) {                                                String Return_Lot_Rec_Lot_Number = resultSet12.getString("Lot_Number");                                                Integer Return_Lot_Rec_Txn_Qty = resultSet12.getInt("Txn_Qty");                                                t_Stmt_Num = 621;                                                if (Return_Lot_Rec_Lot_Number != t_Lot_Rec.Lot_Id) {                                                    t_Line_Number_s = t_Line_Number_s + 1;                                                    t_Stmt_Num = 622;                                                    if (t_Returned_Quantity >= t_Return_Quantity) {                                                        break;                                                    } else {                                                        Return_Lot_Rec_Txn_Qty = Math.min(Return_Lot_Rec_Txn_Qty, t_Return_Quantity - t_Returned_Quantity);                                                        t_Returned_Quantity = t_Returned_Quantity + Return_Lot_Rec_Txn_Qty;                                                    }                                                    t_Stmt_Num = 623;                                                    Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                    preparedStatement = connection.prepareStatement(Sql);                                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                    preparedStatement.setObject(2, i_Factory_Name);                                                    preparedStatement.setObject(3, t_Line_Number_s);                                                    preparedStatement.setObject(4, Return_Lot_Rec_Lot_Number);                                                    preparedStatement.setObject(5, Return_Lot_Rec_Txn_Qty);                                                    preparedStatement.setObject(6, Reset_Code);                                                    preparedStatement.executeUpdate();                                                    t_Child_Exist = 1;                                                }                                            }                                            t_Stmt_Num = 623;                                        } else {                                            Sql = // Harikrishna Apr 23                                            "SELECT  Sum ( Abs ( Mmt.Transaction_Quantity))  " + " From Mtl_Material_Transactions Mmt " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ?  ";                                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                            preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                            preparedStatement.setObject(2, 5);                                            preparedStatement.setObject(3, 35);                                            preparedStatement.setObject(4, Comp_Return_Loop_Wip_Entity_Id);                                            preparedStatement.setObject(5, Comp_Return_Loop_Inventory_Item_Id);                                            resultSet = preparedStatement.executeQuery();                                            resultSet.last();                                            totalRows = resultSet.getRow();                                            resultSet.beforeFirst();                                            if (totalRows > 1) {                                                throw new SQLException("Too Many Rows");                                            }                                            if (resultSet.next() == false) {                                                throw new No_Data_Found("No Data Found");                                            } else {                                                t_Returned_Quantity = resultSet.getInt(1);                                            }                                            t_Line_Number_s = t_Line_Number_s + 1;                                            t_Stmt_Num = 624;                                            if (((t_Returned_Quantity != null ? t_Returned_Quantity : 0) > 0)) {                                                t_Stmt_Num = 625;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Item , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, t_Component_Item_Number);                                                preparedStatement.setObject(5, t_Returned_Quantity);                                                preparedStatement.setObject(6, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Child_Exist = 1;                                            }                                        }                                        t_Stmt_Num = 626;                                        if (t_Child_Exist == 1) {                                            // unconsume the component lot                                            tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                        }                                        t_Stmt_Num = 627;                                        Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                        preparedStatement.executeUpdate();                                        t_Stmt_Num = 628;                                        if (t_Status_Code == Success_Code) {                                            t_Status_Code = Reset_Code;                                        } else {                                            t_Error_Code = 2022;                                            t_Error_Message = "Error in Unconsume on undo";                                            t_Stmt_Num = 629;                                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                            }                                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                            }                                            // Goto End_Transact_Loop;                                            break end_Transact_Loop;                                        }                                    }                                }                            }                            // for unconsume                            t_Lot_Rec.Action_Code = "UNDO MOVE";                            t_Stmt_Num = 630;                            // --  x_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            t_Stmt_Num = 631;                            if ((t_Status_Code == Success_Code || t_Status_Code == Reset_Code)) {                                t_Status_Code = Reset_Code;                            }                            t_Stmt_Num = 632;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else {                            t_Stmt_Num = 633;                            Sql = "SELECT  * " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = " + " ? " + " And Organization_Id = " + " ? " + " And Operation_Seq_Num = " + " ? " + " And Wip_Supply_Type = ? " + " And Quantity_Issued > ? ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Organization_Id);                            preparedStatement.setObject(3, t_Operation_Seq_Num);                            preparedStatement.setObject(4, 1);                            preparedStatement.setObject(5, 0);                            resultSet13 = preparedStatement.executeQuery();                            while (resultSet13.next()) {                                Integer Comp_Return_Loop_Quantity_Issued = resultSet13.getInt("Quantity_Issued");                                Integer Comp_Return_Loop_Wip_Entity_Id = resultSet13.getInt("Wip_Entity_Id");                                Integer Comp_Return_Loop_Organization_Id = resultSet13.getInt("Organization_Id");                                Integer Comp_Return_Loop_Inventory_Item_Id = resultSet13.getInt("Inventory_Item_Id");                                t_Stmt_Num = 634;                                Sql = "SELECT  Sum ( Quantity_Issued) " + " From Wip_Requirement_Operations " + " Where Wip_Entity_Id = ? " + " And Organization_Id = ? " + " And Wip_Supply_Type = ? " + " And Inventory_Item_Id = " + " ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Wip_Entity_Id);                                preparedStatement.setObject(2, t_Organization_Id);                                preparedStatement.setObject(3, 1);                                preparedStatement.setObject(4, Comp_Return_Loop_Inventory_Item_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Return_Quantity = resultSet.getInt(1);                                }                                t_Stmt_Num = 635;                                if (t_Return_Quantity > 0) {                                    t_Return_Quantity = Math.min(Comp_Return_Loop_Quantity_Issued, t_Return_Quantity);                                    t_Returned_Quantity = 0;                                    t_Stmt_Num = 636;                                    Sql = "SELECT  Lot_Control_Code, Item_Number " + " From Mtl_Item_Flexfields " + " Where Organization_Id = ? " + " And Inventory_Item_Id = " + " ?  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                    preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Lot_Control_Code = resultSet.getInt(1);                                        t_Component_Item_Number = resultSet.getString(2);                                    }                                    t_Stmt_Num = 637;                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    preparedStatement.executeUpdate();                                    t_Line_Number_s = 0;                                    t_Child_Exist = 1;                                    if (t_Lot_Control_Code == 2) {                                        t_Stmt_Num = 638;                                        Sql = "SELECT  Mtl.Lot_Number, " + " Abs (  Mtl.Transaction_Quantity ) Txn_Qty " + " From Mtl_Material_Transactions Mmt, " + " Mtl_Transaction_Lot_Numbers Mtl, " + " Wip_Discrete_Jobs Wdj " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mtl.Transaction_Id = " + " Mmt.Transaction_Id " + " And Mtl.Inventory_Item_Id = " + " Mmt.Inventory_Item_Id " + " And Mtl.Organization_Id = " + " Mmt.Organization_Id " + " And Wdj.Wip_Entity_Id = " + " ? " + " And Wdj.Organization_Id = " + " ? " + // -- and     to_char(wdj.scheduled_start_date, DD-MON-YYYY HH24:MI)<> to_char(mmt.transaction_date, DD-MON-YYYY HH24:MI)                                        " And Abs  (   Wdj.Scheduled_Start_Date - " + " Mmt.Transaction_Date  )  * ? * ? > ? " + " Order By Mtl.Transaction_Id Desc ";                                        preparedStatement = connection.prepareStatement(Sql);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, Comp_Return_Loop_Inventory_Item_Id);                                        preparedStatement.setObject(3, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(4, 35);                                        preparedStatement.setObject(5, 5);                                        preparedStatement.setObject(6, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(7, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(8, 24);                                        preparedStatement.setObject(9, 60);                                        preparedStatement.setObject(10, 1);                                        resultSet14 = preparedStatement.executeQuery();                                        while (resultSet14.next()) {                                            String Return_Lot_Rec_Lot_Number = resultSet14.getString("Lot_Number");                                            Integer Return_Lot_Rec_Txn_Qty = resultSet14.getInt("Txn_Qty");                                            t_Stmt_Num = 639;                                            if (Return_Lot_Rec_Lot_Number != t_Lot_Rec.Lot_Id) {                                                t_Line_Number_s = t_Line_Number_s + 1;                                                if (t_Returned_Quantity >= t_Return_Quantity) {                                                    break;                                                } else {                                                    Return_Lot_Rec_Txn_Qty = Math.min(Return_Lot_Rec_Txn_Qty, t_Return_Quantity - t_Returned_Quantity);                                                    t_Returned_Quantity = t_Returned_Quantity + Return_Lot_Rec_Txn_Qty;                                                }                                                t_Stmt_Num = 640;                                                Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Lot_Id , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                                preparedStatement = connection.prepareStatement(Sql);                                                preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                                preparedStatement.setObject(2, i_Factory_Name);                                                preparedStatement.setObject(3, t_Line_Number_s);                                                preparedStatement.setObject(4, Return_Lot_Rec_Lot_Number);                                                preparedStatement.setObject(5, Return_Lot_Rec_Txn_Qty);                                                preparedStatement.setObject(6, Reset_Code);                                                preparedStatement.executeUpdate();                                                t_Child_Exist = 1;                                            }                                        }                                        t_Stmt_Num = 641;                                    } else {                                        Sql = // Harikrishna Apr 23                                        "SELECT  Sum ( Abs ( Mmt.Transaction_Quantity))  " + " From Mtl_Material_Transactions Mmt, " + " Wip_Discrete_Jobs         Wdj " + " Where Mmt.Organization_Id = " + " ? " + " And Mmt.Transaction_Source_Type_Id = ? " + " And Mmt.Transaction_Type_Id = ? " + " And Mmt.Transaction_Source_Id = " + " ? " + " And Mmt.Inventory_Item_Id = " + " ? " + " And Mmt.Organization_Id = " + " ? " + " And Wdj.Organization_Id = " + " ? " + " And Wdj.Wip_Entity_Id = " + " ? " + // -- and    to_char(wdj.scheduled_start_date, DD-MON-YYYY HH24:MI)<> to_char(mmt.transaction_date, DD-MON-YYYY HH24:MI)                                        " And Abs  (  Wdj.Scheduled_Start_Date - " + " Mmt.Transaction_Date )  * ? * ? > ?  ";                                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                        preparedStatement.setObject(1, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(2, 5);                                        preparedStatement.setObject(3, 35);                                        preparedStatement.setObject(4, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(5, Comp_Return_Loop_Inventory_Item_Id);                                        preparedStatement.setObject(6, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(7, Comp_Return_Loop_Organization_Id);                                        preparedStatement.setObject(8, Comp_Return_Loop_Wip_Entity_Id);                                        preparedStatement.setObject(9, 24);                                        preparedStatement.setObject(10, 60);                                        preparedStatement.setObject(11, 1);                                        resultSet = preparedStatement.executeQuery();                                        resultSet.last();                                        totalRows = resultSet.getRow();                                        resultSet.beforeFirst();                                        if (totalRows > 1) {                                            throw new SQLException("Too Many Rows");                                        }                                        if (resultSet.next() == false) {                                            throw new No_Data_Found("No Data Found");                                        } else {                                            t_Returned_Quantity = resultSet.getInt(1);                                        }                                        t_Stmt_Num = 642;                                        t_Line_Number_s = t_Line_Number_s + 1;                                        if (((t_Returned_Quantity != null ? t_Returned_Quantity : 0) > 0)) {                                            Sql = "INSERT Into t_Child_Lots_Api " + "   (  Transaction_Id , " + " Factory_Name , " + " Line_Number , " + " Item , " + " Txn_Qty , " + " Status_Code )  " + " Values " + "   (  ? , " + " ? , " + " ? , " + " ? , " + " ? , " + " ? )   ";                                            preparedStatement = connection.prepareStatement(Sql);                                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                            preparedStatement.setObject(2, i_Factory_Name);                                            preparedStatement.setObject(3, t_Line_Number_s);                                            preparedStatement.setObject(4, t_Component_Item_Number);                                            preparedStatement.setObject(5, t_Returned_Quantity);                                            preparedStatement.setObject(6, Reset_Code);                                            preparedStatement.executeUpdate();                                            t_Child_Exist = 1;                                        }                                    }                                    t_Stmt_Num = 643;                                    if (t_Child_Exist == 1) {                                        // unconsume the component lot                                        tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    }                                    if (t_Status_Code == Success_Code) {                                        t_Status_Code = Reset_Code;                                    } else {                                        t_Error_Code = 2022;                                        t_Error_Message = "Error in Unconsume on undo";                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    Sql = "DELETE From t_Child_Lots_Api " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.executeUpdate();                                }                            }                            t_Stmt_Num = 644;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                            }                            if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                            }                            // Deepak 25 Dec,02                            t_Status_Code = Success_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // -----UNDOS                    t_Stmt_Num = 620;                    Sql = "SELECT  Status_Type, Start_Quantity, Quantity_Scrapped " + " From Wip_Discrete_Jobs " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Status_Type = resultSet.getInt(1);                        t_Original_Qty = resultSet.getInt(2);                        t_Qty_Scrapped = resultSet.getInt(3);                    }                    // -- chk later not ok                    if (t_Original_Qty == 0 && t_Qty_Scrapped > 0 && !("UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                        t_Status_Code = Failure_Code;                        t_Error_Code = 520;                        t_Error_Message = "Lot is completely scrapped. Only UNSCRAP, UNTERMINATE or CHANGE QTY action allowed";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    /* --moved above                                     if upper(t_lot_rec.action_code) not in (RELEASE,CANCEL) and t_status_type =6                                     then                                     -- release the job                                     update wip_discrete_jobs                                     set status_type =3                                     where wip_entity_id =t_wip_entity_id                                     and   organization_id = t_organization_id;                                     --update t_lots also                                     select unique_id                                     into t_unique_id                                     from t_lots                                     where lot_id = t_lot_rec.lot_id                                     and factory_id = t_factory_id                                     and status =H;                                     update t_lots                                     set    status=A                                     where unique_id=t_unique_id;                                     update t_oracle_jobs                                     set active_flag=A                                     where lot_id=t_unique_id;                                     insert into t_lot_properties_api                                     values( t_lot_rec.transaction_id,                                     TRINITIeDapterAutoReleaseForRecovery,                                     Job-||t_job_name||- AutoReleased by TRINITIeDapter from Hold Status due to transaction-||t_lot_rec.transaction_id);                                     end if;                                     */                    if (t_Lot_Rec.Action_Code.toUpperCase().equals("RELEASE") && t_Status_Type == 3) {                        procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -- check the interface                    if (x_Track_In_Oracle == 1) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name before check Lot Interface: " + t_Job_Name);                        // --(Tri2: IS023931)1st Jun2010 MohanVamsi modified the variable as X_Wip_Entity_Id is always null                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Job_Name, // X_WIP_ENTITY_ID,                        t_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status after check Lot Interface: " + t_Status_Code);                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // check interaface for track in oracle                }                // validating the parent lots api                // ------------------end of tpla validation-------------------                t_Stmt_Num = 630;                // -- action codes                if (("START".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "BONUS".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CREATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    t_Proceed = false;                    try {                        Sql = "SELECT  Lot_Id, Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, H )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Rec.Lot_Id = resultSet.getString(1);                            t_Unique_Id = resultSet.getInt(2);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Proceed = true;                    }                    Sql = "SELECT  Upper ( t_Lot_Rec.Action_Code) From Dual";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Action = resultSet.getString(1);                    }                    if (x_Track_In_Oracle == 1) {                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        logger.debug("T_Transact_Lots: Status Code after Get Lot Item: " + t_Status_Code);                        if (t_Status_Code != Success_Code) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Code    = ? , " + " Error_Message = ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Status_Code);                            preparedStatement.setObject(2, t_Error_Code);                            preparedStatement.setObject(3, t_Error_Message);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (!t_Proceed) {                            // -- check if lot already exists                            procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                                t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                            }                            if (procedureParams_OutputMap.get("o_Job_Name") != null) {                                t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                            }                            if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                                t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                            }                            if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                                x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                            }                            if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                                t_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                            }                            if (procedureParams_OutputMap.get("o_Status_Type") != null) {                                t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                            }                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                t_Proceed = true;                                // --**** 2                            } else {                                if (t_Status_Type == 1) {                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before calling T_Release_Wip_Lot");                                    procedureParams_OutputMap = tltAdatptSubObject.t_Release_Wip_Lot(t_Wip_Entity_Id, t_Organization_Id.toString(), t_Lot_Rec.Transaction_Date, i_User_Id, t_Status_Code, t_Error_Message, t_Error_Code, null);                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (t_Status_Code != Success_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Stmt_Num = 640;                                    Log_Msg = "Calling Xtended_validations at stmt no:" + t_Stmt_Num;                                    procedureParams_OutputMap = Log_Message(Log_Msg);                                    logger.debug(Log_Msg);                                    // --material consumption                                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, x_Inventory_Item_Id, // ****9 uom_code is changed to new_uom_code                                    t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, "RELEASE", t_Status_Code, t_Error_Code, t_Error_Message, // **** 12 to execute t_get_current_operation properly                                    10, // **** 12 to execute t_get_current_operation properly                                    t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, // **** 11to capture change routing in start                                    i_User_Id);                                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                                    }                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    if (t_Status_Code == Failure_Code) {                                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                        }                                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                        }                                        // Goto End_Transact_Loop;                                        break end_Transact_Loop;                                    }                                    t_Status_Code = Success_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // -- to track error messages , like routing not there                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Error_Code    = ? , " + " Error_Message = ? " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, t_Error_Code);                                    preparedStatement.setObject(2, t_Error_Message);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                // status type 1                                t_Proceed = true;                            }                            if (t_Inventory_Item_Id == x_Inventory_Item_Id) {                                if (t_Auto_Recover == true) {                                    /*                                             insert into t_lot_properties_api                                             values                                             (t_lot_rec.transaction_id,                                             TRINITIeDapterDuplicateLotFromMES-||t_lot_rec.transaction_id,                                             Duplicate for existing MES lot/Oracle Job-||t_job_name||-transaction_id-||t_lot_rec.transaction_id                                             );                                             */                                    procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                    }                                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Duplicate Lot from MES, Ignored by Lot eDapter");                                    Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code   = ? , " + " Error_Message = Duplicate Lot from MES- Start ignored by TRINITI eDapter " + " Where Transaction_Id = t_Lot_Rec.Transaction_Id  ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.setObject(1, Success_Code);                                    preparedStatement.executeUpdate();                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                } else {                                    t_Status_Code = Success_Code;                                    t_Error_Code = 10000;                                    t_Error_Message = "T_Transact_Lots: Cannot start already existing lot: " + t_Lot_Rec.Lot_Id;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                        }                        // if t_proceed is false                    } else {                        // --*****Lot type not tracked in Oracle started after create                        if (!t_Proceed && t_Lot_Rec.Action_Code.toUpperCase().equals("START")) {                            t_Status_Code = Success_Code;                            // --t_error_code  := 5880;                            t_Error_Message = "Lot type not tracked in Oracle";                            t_Status_Code = Success_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            Sql = "UPDATE t_Lots Set Status = A Where Unique_Id = ? ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            preparedStatement.executeUpdate();                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // track in oracle is yes                    t_Stmt_Num = 650;                    if (t_Proceed) {                        // -- get the item code for the raw material to be issued/backflushed                        try {                            Sql = "SELECT  x " + " From t_Lot_Types " + " Where Factory_Id = ? " + " And Lot_Type = " + " Nvl  (  t_Lot_Rec.New_Lot_Type, ? )  " + // for differentiating between eng. and prod lots. no consumption                            " And Backflush_Flag = Y   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Factory_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Old_Lot_Type);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            // --for eng lots                            // -- Hari K, March 07,  Prevent starts if no child record data for backflush flag =Y                            if (t_Dummy.equals("x") && t_Lot_Rec.Action_Code.equals("START")) {                                try {                                    Sql = "SELECT  x " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And  Rownum = 1";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Dummy = resultSet.getString(1);                                    }                                } catch (No_Data_Found e) {                                    logger.error(e);                                    t_Error_Message = "Cannot Consume-No Record Found in TCLA for this txn";                                    t_Error_Code = 650;                                    t_Status_Code = Failure_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            t_Stmt_Num = 660;                            Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                            procedureParams_OutputMap = Log_Message(Log_Msg);                            logger.debug(Log_Msg);                            procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                            (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, null, null, null, null, null);                            if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            t_Stmt_Num = 670;                            if (t_Status_Code == Failure_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            } else if (t_Status_Code == Reject_Code) {                                // no consumption                                t_Consume = "NC";                            } else if (t_Status_Code == Success_Code) {                                t_Consume = null;                            }                            if (("CREATE".equals(t_Lot_Rec.Action_Code))) {                                t_Consume = "NC";                            }                            if (((t_Consume_Flag != null ? t_Consume_Flag : 0) == 0)) {                                t_Consume = "NC";                            }                            if (t_Consume.equals("NC") && t_Lot_Rec.Action_Code.equals("START") && t_Consume_Flag == 1) {                                t_Status_Code = Failure_Code;                                t_Error_Code = 2246;                                t_Error_Message = "Fail in consumption. Check T_Child_Lots_Api for this transaction";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Consume: " + t_Consume);                            procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, // **** 3                            "START", i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, t_Consume);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            procedureParams_OutputMap = tltAdatpObject.t_Start_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Action, i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message, null, "NC");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        }                    }                    /*handled before calling start lot api                             if t_consume =NC                             then                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             if t_status_code =success_code                             then                             t_error_message :=Consumption was not done for this Lot.Check t_child_lots_api for this transaction;                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             end if;                             end if;                             tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                             null,                             t_status_code,                             t_error_code,                             t_error_message,                             GET                             );                             */                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: After start Lot T_Status_Code: " + t_Status_Code);                    if (t_Status_Code == Success_Code) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Update_Oracle_Job try{s");                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                        }                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                        }                        logger.debug("T_Transact_Lots: T_Update_Oracle_Job ends");                    }                    procedureParams_OutputMap = // Deepak 13 Nov,02                    tLotUtilsObject.T_Update_Txn_Status(// Deepak 13 Nov,02                    t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // action is start                // --------XTENDED VALIDATIONS                t_Stmt_Num = 680;                if (("COMPLETE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    logger.debug(Log_Msg);                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code || t_Proceed == false) {                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    if (t_Merge_Flag == true) {                        t_Lot_Rec.Action_Code = "MERGE";                    }                }                t_Stmt_Num = 690;                if (("MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TRANSFER".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Operation_Seq_Num: " + t_Operation_Seq_Num);                    try {                        Sql = "SELECT  Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, t_Operation_Seq_Num);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            x_Wip_Qty = resultSet.getInt(1);                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: x_wip_qty: " + x_Wip_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.action_code: " + t_Lot_Rec.Action_Code);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                    } catch (No_Data_Found e) {                        logger.error(e);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: NO DATA found for UNTERMINATE/SCRAP");                        if (("UNSCRAP".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code) || "CHANGE QTY".equals(t_Lot_Rec.Action_Code))) {                            x_Wip_Qty = 0;                        } else {                            t_Status_Code = Reject_Code;                            t_Error_Code = 910;                            t_Error_Message = "Error fetching qty from wip_operations for wip_entity_id-" + t_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                t_Stmt_Num = 700;                if (t_Lot_Rec.Action_Code.equals("UNTERMINATE") && x_Wip_Qty > 0) {                    if (t_Lot_Rec.New_Txn_Qty == x_Wip_Qty) {                        t_Status_Code = Success_Code;                        // processing already done or termination did not happen in Oracle                        t_Error_Message = "IG-UP.";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // -- for unscrap- full qty after unscrap comes in tpla                // -- unterminate can have diff qty if extract stopped                // -- unterminate precedes an unscrap action                if (("UNSCRAP".equals(t_Lot_Rec.Action_Code) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code))) {                    Sql = "SELECT  Quantity_Scrapped " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    preparedStatement.setObject(2, t_Operation_Seq_Num);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Scrapped_Qty = resultSet.getInt(1);                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_operation_seq_num-" + t_Operation_Seq_Num);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_scrapped_qty-" + t_Scrapped_Qty);                }                if (t_Lot_Rec.Action_Code.equals("UNSCRAP")) {                    t_Unscrap_Qty = t_Lot_Rec.New_Txn_Qty - x_Wip_Qty;                    if (t_Unscrap_Qty > t_Scrapped_Qty) {                        t_Lot_Rec.Action_Code = "CHANGE QTY";                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: unscrap resulting in cq");                    } else if (t_Unscrap_Qty <= t_Scrapped_Qty) {                        t_Lot_Rec.Action_Code = "UNSCRAP";                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: unscrap resulting in us");                    } else if (t_Unscrap_Qty == 0) {                        t_Status_Code = Success_Code;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                t_Stmt_Num = 710;                // ---------MOVE/UNDO MOVE                if ((!t_Lot_Rec.Action_Code.toUpperCase().equals("UNTERMINATE"))) {                    t_Undo = false;                }                if (("MOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNDOMOVE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: start move");                    if (t_Lot_Rec.New_Operation == null && t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE")) {                        t_Status_Code = Failure_Code;                        t_Error_Code = 4170;                        t_Error_Message = "New Operation cannot be null for move transactions";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 712;                    // --start jump from last operation. Oracle bug: cannot jump from last operation. So undo first                    if (t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE")) {                        Sql = // operation_sequence_id                        "SELECT  Standard_Operation_Id  " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, 0);                        preparedStatement.setObject(3, 0);                        preparedStatement.setObject(4, 0);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wo_Std_Op_Id = resultSet.getInt(1);                        }                        try {                            // --check if this is last operation                            Sql = "SELECT  Bos.Operation_Seq_Num " + " From Bom_Operation_Sequences Bos, Wip_Discrete_Jobs Wdj " + // Deepak 18 Jan,03                            " Where Bos.Standard_Operation_Id = ?  " + // Kunal 24 Jan,03                            " And Wdj.Wip_Entity_Id = ?  " + " And Wdj.Common_Routing_Sequence_Id = " + // Kunal 24 Jan,03                            " Bos.Routing_Sequence_Id  " + // --   where   bos.operation_sequence_id=t_operation_seq_id  --ok since this is last operation                            " And Trunc  (  ? )  Between " + " Trunc  (  Bos.Effectivity_Date )  And " + // Deepak 22 Feb, 03                            " Nvl  (  Bos.Disable_Date,   (  ? + ? )  )   " + // --   and trunc(sysdate) between trunc(bos.effectivity_date) and nvl(bos.disable_date, (sysdate + 1))                            " And Bos.Operation_Sequence_Id Not In " + "  (  Select From_Op_Seq_Id " + " From Bom_Operation_Networks " + " Where From_Op_Seq_Id = Bos.Operation_Sequence_Id )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wo_Std_Op_Id);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.setObject(3, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(4, t_Lot_Rec.Transaction_Date);                            preparedStatement.setObject(5, 1);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Operation_Seq_Num = resultSet.getInt(1);                            }                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = // bos.operation_sequence_id  "+                            " select bos.standard_operation_id  " + " from   bom_operation_sequences bos ,    " + "     wip_discrete_jobs     wdj     " + " where  wdj.wip_entity_id     =   " + t_Wip_Entity_Id + "  " + " and     bos.routing_sequence_id   =  wdj.common_routing_sequence_id  " + " and    trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar , 03                            " + 1 )  )   " + " and    " + "bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + " and  " + "bos. " + t_Step_Seq_Field + "  =  " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Bos_Std_Op_Id )  ; //x_operation_seq_id )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_wip_entity_id",t_Wip_Entity_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_step_seq",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                procedureParams_OutputMap = Log_Message("x_status_code-" + x_Status_Code);                                if (x_Status_Code != 1) {                                    // null; //jump  of ring. but first need to undo last operation                                } else {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Bos_Std_Op_Id); //x_operation_seq_id);                                    // x_operation_seq_id = resultSet.getnull ( 1);                                    t_Bos_Std_Op_Id = resultSet.getInt(1);                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 5800;                                t_Error_Message = "TLTHREAD: Error executing dynamic sql " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            /*                                                 t_new_operation:=t_lot_rec.new_operation;                                                 t_operation_sequence:=t_lot_rec.operation_sequence;                                                 t_new_routing1:=t_lot_rec.new_routing;                                                 begin                                                 if t_routing_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_operation_sequence;                                                 elsif t_step_seq_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_new_routing1;                                                 elsif t_routing_field is null and t_step_seq_field is null                                                 then                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation;                                                 else                                                 execute immediate t_sql_string into x_operation_seq_id using t_wip_entity_id,                                                 t_new_operation,t_new_routing1,t_operation_sequence;                                                 end if;                                                 exception                                                 when no_data_found then                                                 x_operation_seq_id:=null; --jump out of routing. but first need to undo last operation                                                 when others then                                                 t_status_code   := failure_code;                                                 t_error_code  := sqlcode;                                                 t_error_message := Error executing dynamic sql ||t_sql_string;                                                 tLotUtilsObject.T_Update_Txn_Status( t_lot_rec.transaction_id,                                                 null,                                                 t_status_code,                                                 t_error_code,                                                 t_error_message,                                                 SET                                                 );                                                 goto end_transact_loop;                                                 end;                                                 */                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_wo_std_op_id-" + t_Wo_Std_Op_Id);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_bos_std_op_id-" + t_Bos_Std_Op_Id);                            // --  if t_operation_seq_id!=x_operation_seq_id or x_operation_seq_id is null                            if (t_Wo_Std_Op_Id != t_Bos_Std_Op_Id || t_Bos_Std_Op_Id == null) {                                // --check if this is jump                                procedureParams_OutputMap = Log_Message("T_Transact_Lots: This is Jump from last operation");                                t_Undo = true;                                t_Lot_Rec.Undo_Flag = "Y";                                // --        update t_parent_lots_api                                // --        set undo_flag =Y                                // --        where transaction_id =t_lot_rec.transaction_id;                            }                        } catch (No_Data_Found e) {                            logger.error(e);                        }                    }                    t_Stmt_Num = 720;                    // --  x_operation_seq_num,                    // --  t_intra_op_step,                    procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // --    tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                    // --            null,                    // --            t_status_code,                    // --            t_error_code,                    // --            t_error_message,                    // --            GET                    // --                );                    if (t_Status_Code == Success_Code) {                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("MOVE") && t_Undo) {                            // --check if this is jump                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: This is Jump from last operation, Reset code");                            t_Status_Code = Reset_Code;                            // --        update t_parent_lots_api                            // --        set undo_flag =null                            // --        where transaction_id =t_lot_rec.transaction_id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Oracle_Job(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Lot_Rec.Lot_Id, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                        }                        if (procedureParams_OutputMap.get("o_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                        }                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // --------- MOVE/UNDO MOVE                t_Stmt_Num = 730;                // ---ADJUST QTY                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CHANGEQTY")) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_original_qty-" + t_Original_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.x_wip_qty-" + x_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                        procedureParams_OutputMap = Log_Message("3.x_wip_qty-" + x_Wip_Qty);                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty - t_Lot_Rec.New_Txn_Qty;                        if (t_Lot_Position.equals("W")) {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: inside wrap-ti_wip_entity_name" + t_Wip_Entity_Name);                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: inside wrap-t_job_name" + t_Job_Name);                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, t_Wip_Entity_Id, // t_wip_entity_name,                            t_Job_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.New_Txn_Qty, // t_lot_rec.new_uom_code,                            t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else if (t_Lot_Position.equals("I")) {                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, t_Inventory_Item_Id, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                            t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // --update inside the procedure                            // -- handle unscrap there                            // -- dummy this one for the time being                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } else if (x_Wip_Qty == t_Lot_Rec.New_Txn_Qty) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (x_Wip_Qty == 0) {                        t_Lot_Rec.Action_Code = "UNSCRAP";                        t_Unscrap_Qty = t_Lot_Rec.New_Txn_Qty;                    }                }                // -- ADJUST QTY                t_Stmt_Num = 740;                // --------------------------SPLIT STARTS--------------------------------------                // -- handles only 2 resulting lots, chk later for multiple lots                if (("SPLIT".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGELOTID".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEQTY".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // ---Added by Dheeraj                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code || t_Proceed == false) {                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // ---Addition Complete                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: 1306 before call to split- t_original_qty-" + t_Original_Qty);                    Sql = "SELECT  Upper ( t_Lot_Rec.Action_Code) From Dual ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Action = resultSet.getString(1);                    }                    if (t_System_Item_Flag == 2) {                        Sql = "SELECT  Nvl ( New_Enterprise_Item, Old_Enterprise_Item) " + " From t_Lot_Items_Api " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Item1 = resultSet.getString(1);                        }                        Sql = "UPDATE t_Child_Lots_Api " + " Set Enterprise_Item = ? " + " Where Transaction_Id = ? " + " And Enterprise_Item == null  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Item1);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                    } else {                        Sql = "SELECT  Nvl ( New_Item, Old_Item) " + " From t_Lot_Items_Api " + " Where Transaction_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Item2 = resultSet.getString(1);                        }                        Sql = "UPDATE t_Child_Lots_Api " + " Set Item = ? " + " Where Transaction_Id = ? " + " And Item == null  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Item2);                        preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                        preparedStatement.executeUpdate();                    }                    t_Stmt_Num = 750;                    // -- if translation reqd, must be done                    // -- FW specific- fwlot has only updated qty                    if (t_Lot_Rec.Action_Code.equals("SPLIT")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: x_wip_qty in split section-" + x_Wip_Qty);                        // used when new txn qty comes as zero                        t_Lot_Rec.Old_Txn_Qty = t_Lot_Rec.New_Txn_Qty;                        // to trace back                        t_Parent_Qty = x_Wip_Qty;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 1.t_parent_qty in split section-" + t_Parent_Qty);                        procedureParams_OutputMap = tedutilsObject.T_Get_Item_Conversion(t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Routing, // Deepak 22 Mar, 03                        t_Lot_Rec.Transaction_Date, // Nvl ( t_Lot_Rec.New_Uom_Code,                        // t_Lot_Rec.Old_Uom_Code),                        t_Lot_Rec.New_Uom_Code != null ? t_Lot_Rec.New_Uom_Code : t_Lot_Rec.Old_Uom_Code, t_Parent_Qty, t_Oracle_Uom, t_Status_Code, t_Error_Code, t_Error_Message, // reverse                        "R");                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Parent_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code == Failure_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2.t_parent_qty in split section-" + t_Parent_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_parent_qty-" + t_Parent_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                        // -- call move proc                        // -- for change qty, recover the lot to the transactable status                        try {                            Sql = "SELECT  Sum ( Txn_Qty) " + " From t_Child_Lots_Api " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Total_Child_Qty = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        // error condition                        t_Stmt_Num = 760;                        if (t_Parent_Qty != t_Total_Child_Qty) {                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move");                            // --  t_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Total_Child_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // --      tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                            // --              NULL,                            // --              t_status_code,                            // --              t_error_code,                            // --              t_error_message,                            // --              GET                            // --                 );                            if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                t_Error_Code = 4577;                                t_Error_Message = "1.Error executing t_move_lot_api for split-" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                t_Status_Code = Reset_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            // --  goto end_transact_loop;                        }                        /*                                                     begin                                                     select sum(txn_qty)                                                     into t_child_qty                                                     from t_child_lots_api                                                     where transaction_id = t_lot_rec.transaction_id                                                     and   lot_id       != t_lot_rec.lot_id;                                                     dbms_output.put_line(wrapper-split-t_child_qty-||t_child_qty);                                                     dbms_output.put_line(wrapper-split-t_total_child_qty-||t_total_child_qty);                                                     if t_total_child_qty != t_lot_rec.new_txn_qty --make qty same for lot in tpla and tcla                                                     then                                                     dbms_output.put_line(wrapper-split-t_total_child_qty-update:2||t_total_child_qty);                                                     update t_child_lots_api tcl                                                     set txn_qty = t_parent_qty - t_child_qty                                                     where transaction_id = t_lot_rec.transaction_id                                                     and lot_id       = t_lot_rec.lot_id;                                                     end if;                                                     exception                                                     when no_data_found then                                                     null;                                                     end;                                                     */                        // update tpla with actual wip qty                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty;                        t_Stmt_Num = 770;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_lot_rec.old_txn_qty-" + t_Lot_Rec.Old_Txn_Qty);                        // -- site specific, parent comes with zero qty and complete                        // -- qty is in the child,in effect a change lotid would suffice                        // --    if t_lot_rec.old_txn_qty =0                        // --    then                        try {                            Sql = "SELECT  Lot_Id " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Lot_Id != ? " + " And Txn_Qty = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Parent_Qty);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Child_Lot = resultSet.getString(1);                            }                            /*    --Deepak 06 Dec,02                                                         delete from t_child_lots_api                                                         where  transaction_id = t_lot_rec.transaction_id                                                         and lot_id       = t_lot_rec.lot_id;                                                         */                            /*                                                         update t_parent_lots_api                                                         set new_txn_qty = t_parent_qty                                                         where transaction_id = t_lot_rec.transaction_id;                                                         */                            t_Lot_Rec.New_Txn_Qty = t_Parent_Qty;                            t_Lot_Rec.New_Lot_Id = t_Child_Lot;                            t_Lot_Rec.Action_Code = "CHANGE LOTID";                        } catch (No_Data_Found e) {                            logger.error(e);                        }                        // --    end if;                        // -- chk if actual good split has happend                        Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " Order By Line_Number " + // -- order by decode(lot_id,t_lot_rec.lot_id,1,2)                        " ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        resultSet15 = preparedStatement.executeQuery();                        while (resultSet15.next()) {                            Integer Ch_Rec_Transaction_Id = resultSet15.getInt("Transaction_Id");                            Integer Ch_Rec_Lot_Id = resultSet15.getInt("Lot_Id");                            Integer Ch_Rec_Line_Number = resultSet15.getInt("Line_Number");                            Sql = "UPDATE t_Child_Lots_Api " + " Set Status_Code = ? " + " Where Transaction_Id = ? " + " And Line_Number = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Reset_Code);                            preparedStatement.setObject(2, Ch_Rec_Transaction_Id);                            preparedStatement.setObject(3, Ch_Rec_Line_Number);                            preparedStatement.executeUpdate();                        }                    }                    // split                    t_Stmt_Num = 780;                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wip_Qty = resultSet.getInt(1);                    }                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_wip_qty-" + t_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move t_lot_rec.new_txn_qty-" + t_Lot_Rec.New_Txn_Qty);                    // -- call move proc                    // -- for change qty, recover the lot to the transactable status                    if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3) || t_Wip_Qty != t_Lot_Rec.New_Txn_Qty && ("SPLIT".equals(t_Action) || "CHANGE LOTID".equals(t_Action))) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to move");                        // --  t_operation_seq_num,                        // --  t_intra_op_step,                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // --    tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                        // --            null,                        // --            t_status_code,                        // --            t_error_code,                        // --            t_error_message,                        // --            GET                        // --               );                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            t_Error_Code = 4715;                            t_Error_Message = "2.Error executing t_move_lot_api for split-" + t_Error_Message;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                            t_Status_Code = Reset_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- goto end_transact_loop;                    }                    // intraop step not in 1,3                    // -- loop for the child and chk whether the child lot already exists                    // -- only one can exist- FW helps for now                    // -- check if the child lots require translation --take from ur original wrapper --later                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to split- t_original_qty-" + t_Original_Qty);                    t_Stmt_Num = 790;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: before call to split- qty-" + t_Lot_Rec.New_Txn_Qty);                    // -- call the split proc                    procedureParams_OutputMap = tltAdatptSubObject.t_Split_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Action_Code, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // --  tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                    // --           null,                    // --           t_status_code,                    // --           t_error_code,                    // --           t_error_message,                    // --           GET                    // --          );                    if (t_Status_Code == Failure_Code) {                        t_Error_Code = 4781;                        t_Error_Message = "Error executing t_split_wip_lot_api-" + t_Error_Message;                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Txn_Qty > ? " + " Order By Line_Number ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                        preparedStatement.setObject(2, 0);                        resultSet16 = preparedStatement.executeQuery();                        while (resultSet16.next()) {                            Integer Ch_Rec_Transaction_Id = resultSet16.getInt("Transaction_Id");                            Integer Ch_Rec_Lot_Id = resultSet16.getInt("Lot_Id");                            Integer Ch_Rec_Line_Number = resultSet16.getInt("Line_Number");                            try {                                t_Stmt_Num = 800;                                Sql = "SELECT  Toj.Wip_Entity_Id " + " From t_Lots Tl, t_Oracle_Jobs Toj " + " Where Tl.Lot_Id = ? " + " And Tl.Status = A " + " And Tl.Factory_Id = ? " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Factory_Id = Tl.Factory_Id  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, Ch_Rec_Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Child_Wip_Entity_Id = resultSet.getInt(1);                                }                                if (t_Wip_Entity_Id != t_Child_Wip_Entity_Id) {                                    procedureParams_OutputMap = tLotUtilsObject.T_Copy_Lot_Attributes(t_Wip_Entity_Id, t_Child_Wip_Entity_Id, t_Error_Code, t_Error_Message);                                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                    }                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            } catch (SQLException e) {                                logger.error(e, e);                                t_Error_Message = "Error: " + e.getSQLState() + ", before t_copy_lot_attributes";                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                    }                }                // action is split .toUpperCase()                // --------------------------SPLIT ENDS--------------------------------------                // -------------------------MERGE------------------------------------------------                t_Stmt_Num = 810;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("MERGE")) {                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Merge Starts ");                    try {                        Sql = "SELECT  Lot_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                        preparedStatement.setObject(2, t_Factory_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Lot_Number = resultSet.getString(1);                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_lot_number" + t_Lot_Number);                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Lot_Number = null;                    } catch (Too_Many_Rows e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = 1335;                        t_Error_Message = "Multiple active lots in T_Lots.";                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --Checking if lot ids in TCLA exsists in T_LOTS----                    Sql = "SELECT  Lot_Id, Transaction_Id, Txn_Qty " + " From t_Child_Lots_Api Tcl " + " Where Tcl.Transaction_Id = " + " ? ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet17 = preparedStatement.executeQuery();                    while (resultSet17.next()) {                        Integer Merge_Child_Rec_Txn_Qty = resultSet17.getInt("Txn_Qty");                        Integer Merge_Child_Rec_Lot_Id = resultSet17.getInt("Lot_Id");                        try {                            logger.debug("T_Transact_Lots: MERGE_CHILD_REC Txn Qty: " + Merge_Child_Rec_Txn_Qty);                            t_Stmt_Num = (int) 810.01;                            Sql = "SELECT  X " + " From t_Lots " + " Where Unique_Id = " + "  (  Select Max  (  Unique_Id )  " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status In   (  A, C )  )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, Merge_Child_Rec_Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            try {                                t_Stmt_Num = (int) 810.02;                                Sql = "SELECT  Y " + " From Apps.Wip_Discrete_Jobs " + " Where Lot_Number = ? " + " And Status_Type = ?  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, Merge_Child_Rec_Lot_Id);                                preparedStatement.setObject(2, 3);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Dummy = resultSet.getString(1);                                }                                /* IF T_DUMMY = Y                                                             THEN                                                             T_T_LOTS_ENTRY(MERGE_CHILD_REC.LOT_ID,                                                             MERGE_CHILD_REC.TRANSACTION_ID,                                                             T_FACTORY_ID);                                                             END IF;*/                            } catch (No_Data_Found e2) {                                logger.error(e2);                                t_Status_Code = Reject_Code;                                t_Error_Code = 782;                                t_Error_Message = "Transaction on UnCreated Lot ID" + t_Lot_Rec.Lot_Id;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                        }                    }                    // --Checking if lot ids in TCLA exsists in T_LOTS----                    // --validate the resulting job                    if (t_Lot_Number != null) {                        t_Stmt_Num = (int) 810.03;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Validate_Lot_Api st Stmt no: " + t_Stmt_Num);                        /*   DBMS_OUTPUT.PUT_LINE(At Stmt No 810.03:  T_PARENT_WIP_ENTITY_ID: || T_PARENT_WIP_ENTITY_ID||                                                     , T_LOT_REC.NEW_TXN_QTY: || T_LOT_REC.NEW_TXN_QTY); */                        procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Parent_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, t_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            t_Parent_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                            t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                        }                        if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                            t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                            t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                            t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (t_Job_Name == null) {                            // --Deepak 13 Dec,02                            // Goto End_Transact_Loop; //not tracked in oracle                            break end_Transact_Loop;                        }                        if (t_Job_Name != null) {                            // -- check the interface                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_Check_Lot_Interface");                            procedureParams_OutputMap = // i_lot_id                            tLotUtilsObject.T_Check_Lot_Interface(// i_lot_id                            t_Job_Name, t_Parent_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            if (t_Status_Code != Api_Success_Code) {                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Stmt_Num = 820;                            procedureParams_OutputMap = Log_Message("T_Transact_Lots:  T_Intra_Op_Step:" + t_Intra_Op_Step + ", at Stmt no: " + t_Stmt_Num);                            if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3)) {                                // --  x_operation_seq_num,                                // --  t_intra_op_step,                                procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Parent_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                                if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                                }                                if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                                }                                if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                                }                                // --      tLotUtilsObject.T_Update_Txn_Status(  t_lot_rec.transaction_id,                                // --              null,                                // --              t_status_code,                                // --              t_error_code,                                // --              t_error_message,                                // --              GET                                // --                  );                                if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                    t_Error_Code = 4970;                                    t_Error_Message = "1.Error executing t_move_lot_api for merge-" + t_Error_Message;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                                if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                    t_Status_Code = Reset_Code;                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            }                            // move if not in 1,3                        }                        // job name is null                    } else {                        t_Stmt_Num = 830;                        t_Wip_Entity_Id = null;                        procedureParams_OutputMap = Log_Message("T_Transact_Lots:  Before T_Get_Lot_Item, at Stmt No: " + t_Stmt_Num);                        procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            t_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            t_Error_Code = 1425;                            t_Error_Message = "Error- t_transact_lots- in fetching lot item";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // ---Added by Dheeraj                    // --Merge does not has value of t_operation_seq_num                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Wip entity id: " + t_Wip_Entity_Id);                    /*  select operation_seq_num                                                 into   t_operation_seq_num                                                 from wip_operations                                                 where wip_entity_id =t_wip_entity_id                                                 and  ( quantity_in_queue >0                                                 or quantity_running >0                                                 or quantity_waiting_to_move >0                                                 );                                                 */                    /*--commented temporarily 2 Oct 2007                                                 t_xtended_validations ( t_factory_id,                                                 t_lot_rec.transaction_id,                                                 t_lot_rec,                                                 null,                                                 t_lot_rec.lot_id,                                                 t_organization_id,                                                 t_inventory_item_id,                                                 t_lot_rec.new_uom_code,                                                 t_lot_rec.new_txn_qty,                                                 null,                                                 upper(t_lot_rec.action_code),                                                 t_status_code,                                                 t_error_code,                                                 t_error_message,                                                 t_operation_seq_num,                                                 t_operation_field,                                                 t_routing_field,                                                 t_step_seq_field                                                 );                                                 if t_status_code !=success_code or t_proceed =false                                                 then                                                 goto end_transact_loop;                                                 end if;                                                 */                    // ---Addition Complete                    // --loop on child lots api                    t_Need_Xlation = false;                    t_Total_Qty = 0;                    t_First_Time = false;                    Sql = "SELECT  * " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " Order By Line_Number ";                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                    resultSet18 = preparedStatement.executeQuery();                    while (resultSet18.next()) {                        String Child_Rec_Lot_Id = resultSet18.getString("Lot_Id");                        Integer Child_Rec_Line_Number = resultSet18.getInt("Line_Number");                        Integer Child_Rec_Transaction_Id = resultSet18.getInt("Transaction_Id");                        Integer Child_Rec_Txn_Qty = resultSet18.getInt("Txn_Qty");                        t_Stmt_Num = 840;                        // -- validate the child lot                        procedureParams_OutputMap = Log_Message("T_Transact_Lots:  Before T_Validate_Lot_Api, at Stmt no: " + t_Stmt_Num);                        /*   DBMS_OUTPUT.PUT_LINE(At Stmt No 840:  T_WIP_ENTITY_ID: || T_WIP_ENTITY_ID||                                                     , CHILD_REC.TXN_QTY: || CHILD_REC.TXN_QTY); */                        // --Added by MohanVamsi 2Feb10 to get the Qty from Oracle when Qty not provided                        logger.debug("T_Transact_Lots: t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        logger.debug("T_Transact_Lots: Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        if (Child_Rec_Txn_Qty == null) {                            logger.debug("Inside T_Transact_Lots:  Wip_entity_Id : " + t_Wip_Entity_Id);                            Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                Child_Rec_Txn_Qty = resultSet.getInt(1);                            }                        }                        // --Added till here by MohanVamsi 2Feb10                        procedureParams_OutputMap = tltAdatptSubObject.t_Validate_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, Child_Rec_Txn_Qty, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Intra_Op_Step, x_Inventory_Item_Id, t_Lot_Position, t_Lot_Number, t_Job_Name, Character.toString(t_Lot_Status), t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            Child_Rec_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                            t_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                        }                        if (procedureParams_OutputMap.get("o_Operation_Seq_Num") != null) {                            t_Operation_Seq_Num = (java.lang.Integer) procedureParams_OutputMap.get("o_Operation_Seq_Num");                        }                        if (procedureParams_OutputMap.get("o_Intra_Op_Step") != null) {                            t_Intra_Op_Step = (java.lang.Integer) procedureParams_OutputMap.get("o_Intra_Op_Step");                        }                        if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                            x_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                        }                        if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                            t_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                        }                        if (procedureParams_OutputMap.get("o_Lot_Number") != null) {                            t_Lot_Number = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Number");                        }                        if (procedureParams_OutputMap.get("o_Job_Name") != null) {                            t_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                        }                        if (procedureParams_OutputMap.get("o_Lot_Status") != null) {                            t_Lot_Status = (java.lang.Character) procedureParams_OutputMap.get("o_Lot_Status");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        logger.debug("T_Transact_Lots: After Change Wip_entity_Id : " + t_Wip_Entity_Id);                        logger.debug("T_Transact_Lots: After Change t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        logger.debug("T_Transact_Lots: After Change Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Change t_Lot_Rec ( New_Txn_Qty): " + t_Lot_Rec.New_Txn_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: After Change Child_Rec ( Txn_Qty): " + Child_Rec_Txn_Qty);                        if (t_Job_Name == null) {                            // --Deepak 13 Dec,02                            // Goto End_Transact_Loop; //not tracked in oracle                            break end_Transact_Loop;                        }                        /*--merge                                                     --if t_job_name is null and child_rec.lot_id != t_lot_rec.lot_id                                                     --then                                                     update t_lots                                                     set status =C                                                     remarks =Lot closed due to merge transaction-||t_lot_rec.transaction_id                                                     where lot_id = child_rec.lot_id                                                     and factory_id = t_factory_id                                                     and status =A;                                                     tltadapt.t_update_lot_properties(t_lot_rec.transaction_id,child_rec.lot_id,t_factory_id);                                                     --end if;                                                     */                        t_Stmt_Num = 850;                        // -- check the interface                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name before T_Check_Lot_Interface" + t_Job_Name + ", at Stmt No: " + t_Stmt_Num);                        procedureParams_OutputMap = // i_lot_id                        tLotUtilsObject.T_Check_Lot_Interface(// i_lot_id                        t_Job_Name, t_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Total_Qty = t_Total_Qty + Child_Rec_Txn_Qty;                        if (t_Inventory_Item_Id != x_Inventory_Item_Id) {                            t_Need_Xlation = true;                            t_Stmt_Num = 860;                            // --for change routing/item at different operation in new routing than existing one                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = " select bos.operation_seq_num   " + " from bom_operation_sequences bos , bom_operational_routings bor  " + " where bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  " + " and bos.routing_sequence_id = bor.routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                            " + 1 )  )   " + // -   " and trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                            " and bor.assembly_item_id =   " + t_Inventory_Item_Id + "  " + " and bor.organization_id =  " + t_Organization_Id + "  ";                            if (t_Routing_Field != null) {                                t_Sql_String = t_Sql_String + "and bos. " + t_Routing_Field + "  =  " + t_Lot_Rec.New_Routing + "  ";                            }                            if (t_Step_Seq_Field != null) {                                t_Sql_String = t_Sql_String + "and bos. " + t_Step_Seq_Field + "  =   " + t_Lot_Rec.Operation_Sequence + "  ";                            }                            /*                                                            t_new_operation:=t_lot_rec.new_operation;                                                            t_operation_sequence:=t_lot_rec.operation_sequence;                                                            t_new_routing1:=t_lot_rec.new_routing;                                                            try{                                                            if t_routing_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_operation_sequence;                                                            elsif t_step_seq_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_new_routing1;                                                            elsif t_routing_field is null and t_step_seq_field is null                                                            then                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id;                                                            else                                                            execute immediate t_sql_string into t_operation_seq_num using t_new_operation,                                                            t_inventory_item_id,t_organization_id,t_new_routing1,t_operation_sequence;                                                            end if;                                                            exception                                                            when no_data_found then                                                            null;   //use existing operation sequence of lot passed from t_validate_lot_api                                                            when others then                                                            t_status_code   := failure_code;                                                            t_error_code  := sqlcode;                                                            t_error_message := "Error executing dynamic sql "||t_sql_string;                                                            tLotUtilsObject.T_Update_Txn_Status (  t_lot_rec.transaction_id,                                                            null,                                                            t_status_code,                                                            t_error_code,                                                            t_error_message,                                                            "SET"                                                            );                                                            goto end_transact_loop;                                                                                                                        */                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Operation_Seq_Num )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_inventory_item_id",t_Inventory_Item_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_organization_id",t_Organization_Id);                                if (t_Routing_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                                }                                if (t_Step_Seq_Field != null) {                                    // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation_sequence",t_Lot_Rec.Operation_Sequence);                                }                                // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                x_Status_Code = resultSet.getRow();                                resultSet.beforeFirst();                                resultSet.next();                                if (x_Status_Code != 1) {                                    // --      null;   --use existing operation sequence of lot passed from t_validate_lot_api                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    // Added by Suchi                                    Sql = "INSERT Into t_Debug Values  ( 5321, Sysdate, t_Sql_String) ";                                    preparedStatement = connection.prepareStatement(Sql);                                    preparedStatement.executeUpdate();                                    connection.commit();                                    t_Status_Code = Failure_Code;                                    t_Error_Code = 5321;                                    t_Error_Message = "XLATE: Routing or Operation doesnot exists in oracle";                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                } else {                                    // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Operation_Seq_Num);                                    t_Operation_Seq_Num = resultSet.getInt(1);                                }                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 6790;                                t_Error_Message = "Error executing dynamic sql " + t_Sql_String;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            t_Stmt_Num = 870;                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_Xlate_Wip_Lot_Api at Stmt no: " + t_Stmt_Num);                            procedureParams_OutputMap = tltAdatptSubObject.t_Xlate_Wip_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, t_Wip_Entity_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec.New_Routing, t_Operation_Seq_Num, t_Intra_Op_Step, Child_Rec_Txn_Qty, t_Uom_Code, t_Inventory_Item_Id, i_User_Id, t_Lot_Rec.Transaction_Date, // Deepak 02 Dec,02                            "CHANGE ROUTING", t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code) {                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            /*                                                     insert into t_lot_properties_api                                                     values                                                     ( t_lot_rec.transaction_id,                                                     TRINITIeDapterLotXBME-||t_lot_rec.transaction_id,                                                     Wip entity id-||t_wip_entity_id||-was translated by TRINITI LOTS eDapter                                                      );                                                     */                        }                        // --removed if. should do operation check for each lot                        // --  if t_intra_op_step not in (1,3) or t_need_xlation =true                        // --  then                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Wip_Entity_id for Current Operation -" + t_Wip_Entity_Id);                        t_Stmt_Num = 880;                        procedureParams_OutputMap = tLotUtilsObject.T_Get_Current_Operation(t_Lot_Rec.Transaction_Id, null, t_Wip_Entity_Id, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, t_Create_Standard_Operations, t_Standard_Operations_Flag, t_Current_Operation, t_Outside_Resource, t_Current_Routing, t_Current_Operation_Seq, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("o_Operation") != null) {                            t_Current_Operation = (java.lang.String) procedureParams_OutputMap.get("o_Operation");                        }                        if (procedureParams_OutputMap.get("o_Outside_Resource") != null) {                            t_Outside_Resource = (java.lang.String) procedureParams_OutputMap.get("o_Outside_Resource");                        }                        if (procedureParams_OutputMap.get("o_Routing") != null) {                            t_Current_Routing = (java.lang.String) procedureParams_OutputMap.get("o_Routing");                        }                        if (procedureParams_OutputMap.get("o_Operation_Sequence") != null) {                            t_Current_Operation_Seq = (java.lang.String) procedureParams_OutputMap.get("o_Operation_Sequence");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: Status after Calling T_Get_Current_Operation: " + t_Status_Code);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: T_Current_Operation after T_Get_Current_Operation: " + t_Current_Operation);                        if (t_Status_Code != Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // ---Added by Dheeraj                        if (Child_Rec_Lot_Id != t_Lot_Rec.Lot_Id) {                            // --Merge does not has value of t_operation_seq_num                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Child Wip entity id: " + t_Wip_Entity_Id);                            /*  select operation_seq_num                                                         into   t_operation_seq_num                                                         from wip_operations                                                         where wip_entity_id =t_wip_entity_id                                                         and  ( quantity_in_queue >0                                                         or quantity_running >0                                                         or quantity_waiting_to_move >0                                                         );                                                         */                            procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, Child_Rec_Transaction_Id, t_Lot_Rec, Child_Rec_Line_Number, Child_Rec_Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, Child_Rec_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                            (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, t_Operation_Seq_Num, t_Operation_Field, t_Routing_Field, t_Step_Seq_Field, null);                            if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                                Child_Rec_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                            }                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if (t_Status_Code != Success_Code || t_Proceed == false) {                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // ---Addition Complete                        Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wip_Qty = resultSet.getInt(1);                        }                        // -- move child lot to where merged entity is to be                        if (((t_Lot_Rec.New_Operation != null ? t_Lot_Rec.New_Operation : t_Current_Operation) != t_Current_Operation) || t_Wip_Qty != Child_Rec_Txn_Qty) {                            t_Stmt_Num = 890;                            // -- call move proc                            // -- reqd if the current intraop step is not 1 or 3                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before T_move_Lot_Api, at Stmt no: " + t_Stmt_Num);                            // --  x_operation_seq_num,                            // --  t_intra_op_step,                            procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(Child_Rec_Transaction_Id, Child_Rec_Line_Number, t_Factory_Id, Child_Rec_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                                t_Error_Code = 5343;                                t_Error_Message = "2.Error executing t_move_lot_api for merge-" + t_Error_Message;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, Child_Rec_Line_Number, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                            if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                                t_Status_Code = Reset_Code;                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        }                        // operations dont match                        // -- update the child with the wip entity id and the operation seq num                        Sql = "UPDATE t_Child_Lots_Api " + " Set Wip_Entity_Id     = ? , " + " Operation_Seq_Num = ? " + " Where Transaction_Id = " + t_Lot_Rec.Transaction_Id + // use sequence to genarate line no initially;                        " And Line_Number = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, t_Wip_Entity_Id);                        preparedStatement.setObject(2, t_Operation_Seq_Num);                        preparedStatement.setObject(3, Child_Rec_Line_Number);                        preparedStatement.executeUpdate();                        if (t_Lot_Rec.Lot_Id == Child_Rec_Lot_Id && t_First_Time == false) {                            t_First_Time = true;                            t_Parent_Qty = Child_Rec_Txn_Qty;                            t_Rep_Operation_Seq_Num = t_Operation_Seq_Num;                        }                    }                    t_Stmt_Num = 900;                    if (t_First_Time == false) {                        t_Parent_Qty = t_Lot_Rec.New_Txn_Qty;                        try {                            Sql = // representative lot                            "SELECT  Wip_Entity_Id, Operation_Seq_Num  " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? " + " And Line_Number = " + "  (  Select Min  (  Line_Number )  " + " From t_Child_Lots_Api " + " Where Transaction_Id = ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Transaction_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Parent_Wip_Entity_Id = resultSet.getInt(1);                                t_Operation_Seq_Num = resultSet.getInt(2);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Failure_Code;                            t_Error_Code = 5422;                            t_Error_Message = "No row found txn id-" + t_Lot_Rec.Transaction_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Rep_Operation_Seq_Num = t_Operation_Seq_Num;                    }                    t_Stmt_Num = 910;                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Merge wip lot procedure starts");                    procedureParams_OutputMap = tltAdatptSubObject.t_Merge_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Parent_Wip_Entity_Id, t_Inventory_Item_Id, t_Rep_Operation_Seq_Num, t_Intra_Op_Step, // - must be present in child lot                    t_Lot_Rec.Lot_Id, t_Parent_Qty, // t_lot_rec.new_uom_code,                    t_Oracle_Uom, t_Total_Qty, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code == Success_Code) {                        t_Stmt_Num = 920;                        try {                            Sql = "SELECT  Toj.Wip_Entity_Id " + " From t_Lots Tl, t_Oracle_Jobs Toj " + " Where Tl.Lot_Id = ? " + " And Tl.Status = A " + " And Tl.Factory_Id = ? " + " And Toj.Lot_Id = Tl.Unique_Id " + " And Toj.Factory_Id = Tl.Factory_Id  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Wip_Entity_Id = resultSet.getInt(1);                            }                            if (t_Wip_Entity_Id != t_Parent_Wip_Entity_Id) {                                procedureParams_OutputMap = tLotUtilsObject.T_Copy_Lot_Attributes(t_Parent_Wip_Entity_Id, t_Wip_Entity_Id, t_Error_Code, t_Error_Message);                                if (procedureParams_OutputMap.get("o_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                                }                                if (procedureParams_OutputMap.get("o_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                                }                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                            }                        } catch (SQLException e) {                            logger.error(e, e);                            t_Error_Message = "Error: " + e.getSQLState() + " - before t_copy_lot_attributes";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // action is merge                // -------------------------MERGE END ------------------------------------------------                t_Stmt_Num = 930;                // -- translate lots                if (("CHANGEITEM".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CHANGEROUTING".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // -- taken out from validate                    // --  if upper(t_lot_rec.action_code) =CHANGE ITEM                    // --  then                    t_Min_Wip_Qty = 0;                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations a " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = " + "  (  Select Min  (  b.Operation_Seq_Num )  " + " From Wip_Operations b " + " Where b.Wip_Entity_Id = a.Wip_Entity_Id )   ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Min_Wip_Qty = resultSet.getInt(1);                    }                    Sql = "SELECT  Sum ( Quantity_In_Queue + Quantity_Running + " + " Quantity_Waiting_To_Move) " + " From Wip_Operations " + " Where Wip_Entity_Id = ?  ";                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                    preparedStatement.setObject(1, t_Wip_Entity_Id);                    resultSet = preparedStatement.executeQuery();                    resultSet.last();                    totalRows = resultSet.getRow();                    resultSet.beforeFirst();                    if (totalRows > 1) {                        throw new SQLException("Too Many Rows");                    }                    if (resultSet.next() == false) {                        throw new No_Data_Found("No Data Found");                    } else {                        t_Wip_Qty = resultSet.getInt(1);                    }                    if (!(t_Intra_Op_Step == 1 || t_Intra_Op_Step == 3) || t_Wip_Qty != t_Lot_Rec.New_Txn_Qty && t_Min_Wip_Qty == 0) {                        // --no need to scrap for first operation. let the next txn do that                        // -- move the lot or scrap/bonus the qty                        // -- chk later                        // --  x_operation_seq_num,                        // --  t_intra_op_step,                        procedureParams_OutputMap = tltAdatptSubObject.t_Move_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            t_Error_Code = 5561;                            t_Error_Message = "Error executing t_move_lot_api for translate-" + t_Error_Message;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if ((t_Status_Code == Success_Code || t_Status_Code == Reprocess_Code)) {                            t_Status_Code = Reset_Code;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                    // -- fetch the item to which it is changed                    /*                                             begin                                             select substr(new_item,1,1)                                             into t_dummy                                             from t_lot_items_api                                             where transaction_id =t_lot_rec.transaction_id;                                             update t_lot_items_api tl                                             set new_enterprise_item = nvl(tl.new_item, tl.new_enterprise_item)                                             where transaction_id = t_lot_rec.transaction_id;                                             update t_lot_items_api                                             set new_item =null                                             where transaction_id = t_lot_rec.transaction_id;                                             exception                                             when no_data_found then                                             null;                                             end;                                             */                    // --    end if;-- if change item                    procedureParams_OutputMap = tltAdatpObject.t_Get_Lot_Item(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, o_Inventory_Item_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        o_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if (t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 940;                    // --for change routing/item at different operation in new routing than existing one                    // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                    t_Sql_String = " select bos.operation_seq_num   " + " from bom_operation_sequences bos , bom_operational_routings bor  " + " where bos. " + t_Operation_Field + "  =   " + t_Lot_Rec.New_Operation + "  " + " and bos.routing_sequence_id = bor.routing_sequence_id  " + " and trunc  (   " + t_Lot_Rec.Transaction_Date + " )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (   " + t_Lot_Rec.Transaction_Date + // Deepak 22 Mar ,  03                    " + 1 )  )   " + // " and trunc  (  sysdate )  between trunc  (  bos.effectivity_date )  and nvl  (  bos.disable_date ,    (  sysdate + 1 )  )   "+                    " and bor.assembly_item_id =   " + o_Inventory_Item_Id + "  " + " and bor.organization_id =  " + t_Organization_Id + "  ";                    if (t_Routing_Field != null) {                        t_Sql_String = t_Sql_String + "and bos. " + t_Routing_Field + "  =   " + t_Lot_Rec.New_Routing + "  ";                    }                    if (t_Step_Seq_Field != null) {                        t_Sql_String = t_Sql_String + "and bos. " + t_Step_Seq_Field + "  =   " + t_Lot_Rec.Operation_Sequence + "  ";                    }                    /*    t_new_operation:=t_lot_rec.operation_sequence;    t_operation_sequence:=t_lot_rec.operation_sequence;    t_new_routing1:=t_lot_rec.new_routing;    try{    if t_routing_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_operation_sequence;    elsif t_step_seq_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_new_routing1;    elsif t_routing_field is null and t_step_seq_field is null    then    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id;    else    execute immediate t_sql_string into t_operation_seq_num using t_new_operation,    o_inventory_item_id,t_organization_id,t_new_routing1,t_operation_sequence;    end if;    exception    when no_data_found then    null;   //use existing operation sequence of lot passed from t_validate_lot_api    when others then    t_status_code   := failure_code;    t_error_code  := sqlcode;    t_error_message := "Error executing dynamic sql "||t_sql_string;    tLotUtilsObject.T_Update_Txn_Status (  t_lot_rec.transaction_id,    null,    t_status_code,    t_error_code,    t_error_message,    "SET"    );    goto end_transact_loop;        */                    try {                        // t_Cursor  =  Dbms_Sql.Open_Cursor ;                        // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                        // Dbms_Sql.Define_Column  (  t_Cursor ,  1 ,  t_Operation_Seq_Num )  ;                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation",t_Lot_Rec.New_Operation);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_txn_date",t_Lot_Rec.Transaction_Date);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_inventory_item_id",o_Inventory_Item_Id);                        // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_organization_id",t_Organization_Id);                        if (t_Routing_Field != null) {                            // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_routing",t_Lot_Rec.New_Routing);                        }                        if (t_Step_Seq_Field != null) {                            // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "x_operation_sequence",t_Lot_Rec.Operation_Sequence);                        }                        // x_Status_Code  =  Dbms_Sql.Execute_And_Fetch  (  t_Cursor )  ; ;                        preparedStatement = connection.prepareStatement(t_Sql_String, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        x_Status_Code = resultSet.getRow();                        resultSet.beforeFirst();                        resultSet.next();                        procedureParams_OutputMap = Log_Message("TLTHREAD: At Stmt 940, x_operation: " + t_Lot_Rec.New_Operation + ", x_inventory_item_id: " + o_Inventory_Item_Id + ", x_organization_id: " + t_Organization_Id + ", X_routing: " + t_Lot_Rec.New_Routing);                        if (x_Status_Code != 1) {                            // --     null;   --use existing operation sequence of lot passed from t_validate_lot_api                            // if  (  Dbms_Sql.Is_Opent_Cursor )                            {                                // Dbms_Sql.Close_Cursor ( t_Cursor);                            }                            // Added by Suchi                            Sql = "INSERT Into t_Debug Values  ( 5321.01, Sysdate, t_Sql_String) ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.executeUpdate();                            connection.commit();                            t_Status_Code = Failure_Code;                            t_Error_Code = (int) 5321.01;                            t_Error_Message = "XLATE: Routing or Operation doesnot exists in oracle";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } else {                            // Dbms_Sql.Column_Value ( t_Cursor, 1, t_Operation_Seq_Num);                            t_Operation_Seq_Num = resultSet.getInt(1);                        }                        // Dbms_Sql.Close_Cursor ( t_Cursor);                    } catch (SQLException e) {                        logger.error(e, e);                        // if  (  Dbms_Sql.Is_Opent_Cursor )                        {                            // Dbms_Sql.Close_Cursor ( t_Cursor);                        }                        t_Status_Code = Failure_Code;                        t_Error_Code = 7320;                        t_Error_Message = "Error executing dynamic sql " + t_Sql_String;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    t_Stmt_Num = 950;                    procedureParams_OutputMap = tltAdatptSubObject.t_Xlate_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Lot_Rec.Lot_Id, t_Lot_Rec.New_Routing, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, t_Uom_Code, t_Inventory_Item_Id, i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec.Action_Code, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                }                // end translate                // -- ----------------------scrap lot------------------------                t_Stmt_Num = 960;                if (("SCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNSCRAP".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "TERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "UNTERMINATE".equals(t_Lot_Rec.Action_Code.toUpperCase()))) {                    // -- the qty sent in is the qty to be scrapped                    try {                        Sql = "SELECT  Wip_Entity_Name " + " From Wip_Entities " + " Where Organization_Id = ? " + " And Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Organization_Id);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Wip_Entity_Name = resultSet.getString(1);                        }                    } catch (No_Data_Found e) {                        logger.error(e);                        t_Status_Code = Reject_Code;                        t_Error_Code = 1410;                        t_Error_Message = "Invalid Wip Entity Id -" + t_Wip_Entity_Id;                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    /* ---Added by Dheeraj T_XTENDED_VALIDATIONS(T_FACTORY_ID, T_LOT_REC.TRANSACTION_ID, T_LOT_REC, NULL, T_LOT_REC.LOT_ID, T_ORGANIZATION_ID, T_INVENTORY_ITEM_ID, T_LOT_REC.NEW_UOM_CODE, T_LOT_REC.NEW_TXN_QTY, NULL, UPPER(T_LOT_REC.ACTION_CODE), T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, T_OPERATION_SEQ_NUM, T_OPERATION_FIELD, T_ROUTING_FIELD, T_STEP_SEQ_FIELD); IF T_STATUS_CODE != SUCCESS_CODE OR T_PROCEED = FALSE THEN GOTO END_TRANSACT_LOOP; END IF; ---Addition Complete */                    // --Commented by MohanVamsi as this is not part of Standard Lot eDapter on 9th Jul09                    if (t_Lot_Rec.Action_Code.equals("UNSCRAP")) {                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2063 x_wip_qty: " + x_Wip_Qty);                        procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2063 t_lot_rec.new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                        if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                            // -- T_LOT_REC.NEW_TXN_QTY := X_WIP_QTY - T_LOT_REC.NEW_TXN_QTY;                            // -- T_LOT_REC.ACTION_CODE := SCRAP;                            // --Added by MohanVamsi 24 Jun09                            t_Lot_Rec.Action_Code = "UNSCRAP";                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: 2070 uns resulting in sc:3 , Lot Position :" + t_Lot_Position);                        } else {                            t_Lot_Rec.New_Txn_Qty = t_Unscrap_Qty;                            Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, 3);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.executeUpdate();                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: Unscrap qty is -" + t_Lot_Rec.New_Txn_Qty);                        }                    }                    if (t_Lot_Rec.Action_Code.equals("UNTERMINATE")) {                        // --undo the last scrap only                        t_Lot_Rec.Action_Code = "UNSCRAP";                        // --t_lot_rec.new_txn_qty := t_scrapped_qty; --before osfm fix                        t_Stmt_Num = 970;                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.executeUpdate();                        try {                            Sql = "SELECT  Nvl ( Transaction_Quantity, 0) " + " From Wip_Move_Transactions " + " Where Wip_Entity_Id = ? " + " And Transaction_Id = " + "  (  Select Max  (  Transaction_Id )  " + " From Wip_Move_Transactions " + " Where Wip_Entity_Id = ? " + " And To_Intraoperation_Step_Type = ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Wip_Entity_Id);                            preparedStatement.setObject(3, 5);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Lot_Rec.New_Txn_Qty = resultSet.getInt(1);                            }                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 1925;                            t_Error_Message = "Cannot find scrap details at the operation";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // -- wake up the job --to fix osfm defect                        Sql = "UPDATE Wip_Discrete_Jobs " + " Set Status_Type = ? " + " Where Wip_Entity_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql);                        preparedStatement.setObject(1, 3);                        preparedStatement.setObject(2, t_Wip_Entity_Id);                        preparedStatement.executeUpdate();                        // --dbms_output.put_line( before the unterminate t_oracle_uom is -||t_oracle_uom);                    }                    // unterminate                    if (t_Lot_Rec.Action_Code.equals("TERMINATE")) {                        t_Lot_Rec.Action_Code = "SCRAP";                        t_Lot_Rec.New_Txn_Qty = x_Wip_Qty;                    }                    // --dbms_output.put_line(returning before scrap call);                    // -- testing return;                    t_Stmt_Num = 980;                    if (t_Lot_Position.equals("W")) {                        procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, t_Wip_Entity_Id, t_Wip_Entity_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.New_Txn_Qty, // t_lot_rec.new_uom_code,                        t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, t_Lot_Rec.Action_Code);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // --update inside the procedure                        if (t_Undo && t_Status_Code == Success_Code) {                            Sql = "UPDATE t_Parent_Lots_Api " + " Set Status_Code = ? " + " Where Transaction_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, Reset_Code);                            preparedStatement.setObject(2, t_Lot_Rec.Transaction_Id);                            preparedStatement.executeUpdate();                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Lot_Position.equals("I")) {                        // -- to be tested                        procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // i_lot_number,                        t_Wip_Entity_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                        // t_Lot_Rec.Old_Lot_Type),                        t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, t_Inventory_Item_Id, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                        t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // --update inside the procedure                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // of scrap txn                // -- terminate lot                /* -- mapped to scrap if upper(t_lot_rec.action_code)=TERMINATE then --As Oracle API does not handle it currently t_status_code :=success_code; t_error_message :=Currently Oracle API does not support Lot Termination or cancellation. Please do from front end; tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id, null, t_status_code, t_error_code, t_error_message, SET ); goto end_transact_loop; tltadapt.t_cancel_wiplot_api ( t_lot_rec.transaction_id, null, t_factory_id, t_organization_id, t_wip_entity_id, t_inventory_item_id, t_lot_rec.transaction_date, i_user_id ); end if;-- terminate */                // -- terminate lot ends                t_Stmt_Num = 990;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("COMPLETE")) {                    procedureParams_OutputMap = tltAdatptSubObject.t_Complete_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Organization_Code, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Lot_Rec.Transaction_Date, i_User_Id, t_Oracle_Uom, // in   number,                    t_Status_Code, // in   varchar2,                    t_Error_Message, // in   number,                    t_Error_Code);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // ****                // -- transfer lot                if (t_Lot_Rec.Action_Code.toUpperCase().equals("TRANSFER")) {                    t_Transfer = true;                    // --------process lot from which transfer is happening                    // -- use of variables                    procedureParams_OutputMap = tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transfer_Lot_Id, t_Transfer_Lot_Position, t_Transfer_Job_Name, x_Transfer_Wip_Entity_Id, x_Transfer_Inventory_Item_Id, t_Dummy_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("o_Lot_Position") != null) {                        t_Transfer_Lot_Position = (java.lang.String) procedureParams_OutputMap.get("o_Lot_Position");                    }                    if (procedureParams_OutputMap.get("o_Job_Name") != null) {                        t_Transfer_Job_Name = (java.lang.String) procedureParams_OutputMap.get("o_Job_Name");                    }                    if (procedureParams_OutputMap.get("o_Wip_Entity_Id") != null) {                        x_Transfer_Wip_Entity_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Wip_Entity_Id");                    }                    if (procedureParams_OutputMap.get("o_Inventory_Item_Id") != null) {                        x_Transfer_Inventory_Item_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Inventory_Item_Id");                    }                    if (procedureParams_OutputMap.get("o_Start_Qty") != null) {                        t_Dummy_Wip_Qty = (java.lang.Integer) procedureParams_OutputMap.get("o_Start_Qty");                    }                    if (procedureParams_OutputMap.get("o_Status_Type") != null) {                        t_Status_Type = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Type");                    }                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    if (t_Transfer_Job_Name == null) {                        procedureParams_OutputMap = tltAdatpObject.t_Update_Lot_Properties(t_Lot_Rec.Transaction_Id, t_Lot_Rec.Transfer_Lot_Id, t_Factory_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        t_Transfer = false;                    }                    // --check the interface                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Job name for check interface for transfer: " + t_Job_Name);                    if (t_Transfer == true) {                        procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Transfer_Job_Name, x_Transfer_Wip_Entity_Id, t_Organization_Id, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code != Api_Success_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = 1000;                        try {                            Sql = "SELECT  Operation_Seq_Num, " + " Case Quantity_In_Queue " + " When 0 Then " + " Case Quantity_Running " + " When 0 Then " + " Quantity_Waiting_To_Move " + " Else Quantity_Running End " + " Else Quantity_In_Queue End " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And   (  Quantity_In_Queue > ? Or Quantity_Running > ? Or " + " Quantity_Waiting_To_Move > ? )   ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, x_Transfer_Wip_Entity_Id);                            preparedStatement.setObject(2, 0);                            preparedStatement.setObject(3, 0);                            preparedStatement.setObject(4, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Transfer_Operation_Seq_Num = resultSet.getInt(1);                                x_Transfer_Wip_Qty = resultSet.getInt(2);                            }                            procedureParams_OutputMap = Log_Message("T_Transact_Lots: X_transfer_wip_qty: " + x_Transfer_Wip_Qty);                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reject_Code;                            t_Error_Code = 510;                            t_Error_Message = "Cannot find operation with +ve Qty in wip_operations for wip_entity_id- " + x_Transfer_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        procedureParams_OutputMap = tedutilsObject.T_Get_Item_Conversion(t_Factory_Id, t_Organization_Id, x_Transfer_Inventory_Item_Id, t_Lot_Rec.New_Routing, // Deepak 22 Mar, 03                        t_Lot_Rec.Transaction_Date, // Nvl ( t_Lot_Rec.New_Uom_Code,                        // t_Lot_Rec.Old_Uom_Code),                        t_Lot_Rec.New_Uom_Code != null ? t_Lot_Rec.New_Uom_Code : t_Lot_Rec.Old_Uom_Code, t_Lot_Rec.Transferlot_Txn_Qty, t_Oracle_Uom, t_Status_Code, t_Error_Code, t_Error_Message, null);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.Transferlot_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("o_Oracle_Uom_Code") != null) {                            t_Oracle_Uom = (java.lang.String) procedureParams_OutputMap.get("o_Oracle_Uom_Code");                        }                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        if (t_Status_Code == Failure_Code) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        if (x_Transfer_Wip_Qty < t_Lot_Rec.Transferlot_Txn_Qty) {                            t_Status_Code = Reject_Code;                            t_Error_Code = 1900;                            t_Error_Message = "Oracle Job does not have sufficient quantity to transfer-" + t_Job_Name;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        t_Stmt_Num = 1010;                        if (t_Transfer_Lot_Position.equals("W")) {                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, x_Transfer_Wip_Entity_Id, t_Transfer_Job_Name, t_Transfer_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, t_Lot_Rec.Transferlot_Txn_Qty, // t_lot_rec.new_uom_code,                            t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                            // --update inside the procedure                        } else if (t_Transfer_Lot_Position.equals("I")) {                            // -- to take care of this later, chk                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, // i_lot_number,                            t_Transfer_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, x_Transfer_Inventory_Item_Id, t_Lot_Rec.Transferlot_Txn_Qty, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                            t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // --update inside the procedure                        }                    }                    // transfer is true                    // -- xfrer lot ends                    // -- change/scrap of lot id starts                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before transfer lot -x_wip_qty: " + x_Wip_Qty);                    procedureParams_OutputMap = Log_Message("T_Transact_Lots: Before transfer lot -t_lot_rec.new_txn_qty: " + t_Lot_Rec.New_Txn_Qty);                    if (x_Wip_Qty > t_Lot_Rec.New_Txn_Qty) {                        // -- for data consistencey/recovery                        t_Stmt_Num = 1020;                        if (t_Lot_Position.equals("W")) {                            procedureParams_OutputMap = tltAdatptSubObject.t_Scrap_Wip_Lot(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Transaction_Id, x_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Lot_Rec.New_Lot_Type, t_Lot_Rec.Transaction_Date, x_Wip_Qty - t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id, // t_lot_rec.action_code                            "SCRAP");                            if (procedureParams_OutputMap.get("t_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                            }                            if (procedureParams_OutputMap.get("t_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                            }                        } else if (t_Lot_Position.equals("I")) {                            // -- to take care of this later, chk                            procedureParams_OutputMap = tltAdatpObject.t_Scrap_Inv_Lot(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Job_Name, // Nvl ( t_Lot_Rec.New_Lot_Type,                            // t_Lot_Rec.Old_Lot_Type),                            t_Lot_Rec.New_Lot_Type != null ? t_Lot_Rec.New_Lot_Type : t_Lot_Rec.Old_Lot_Type, x_Inventory_Item_Id, x_Wip_Qty - t_Lot_Rec.New_Txn_Qty, t_Oracle_Uom, t_Lot_Rec.Transaction_Date, t_Status_Code, t_Error_Code, t_Error_Message, i_User_Id);                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                        }                    } else if (x_Wip_Qty < t_Lot_Rec.New_Txn_Qty) {                        t_Stmt_Num = 1030;                        procedureParams_OutputMap = tltAdatptSubObject.t_Split_Wip_Lot_Api(t_Lot_Rec.Transaction_Id, null, t_Factory_Id, t_Wip_Entity_Id, t_Job_Name, t_Operation_Seq_Num, t_Intra_Op_Step, t_Lot_Rec.New_Txn_Qty, // nvl ( t_lot_rec.new_uom_code,t_lot_rec.old_uom_code),                        t_Oracle_Uom, t_Lot_Rec.New_Lot_Type, // upper ( t_lot_rec.action_code),                        "CHANGE QTY", i_User_Id, t_Lot_Rec.Transaction_Date, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                            t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                        }                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                    } else {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, Success_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            Success_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --    tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                    // --             null,                    // --             t_status_code,                    // --             t_error_code,                    // --             t_error_message,                    // --             GET                    // --            );                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, 1, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // transfer components                // -- transfer lot                t_Stmt_Num = 1040;                // -- uncomplete lot                if (t_Lot_Rec.Action_Code.toUpperCase().equals("UNCOMPLETE")) {                    /* insert into t_lot_properties_api values (t_lot_rec.transaction_id, TRINITIeDapterLotUncompleteTxn, Oracle Job-||t_job_name||- was uncompleted by transaction_id-||t_lot_rec.transaction_id ); */                    // --Inv Interface Lot Check added by K.L.Venkatraman                    // --on 21 Jul 2009 for pi uncomplete txn                    // --checking lot status in Inventory just in case you have any inventory txns pending                    // --after job completion.                    procedureParams_OutputMap = tLotUtilsObject.T_Check_Lot_Interface(t_Lot_Rec.Lot_Id, // x_wip_entity_id                    null, // t_organization_id,                    null, t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    t_Stmt_Num = (int) 1040.01;                    logger.debug("T_Transact_Lots: Status code after t_check_lot_interface at stmt no: " + t_Stmt_Num + ":" + t_Status_Code);                    if ((t_Status_Code == Found_Code || t_Status_Code == Api_Error_Code)) {                        procedureParams_OutputMap = Log_Message(t_Error_Message);                        logger.debug("T_Transact_Lots: T_error_message :" + t_Error_Message);                        tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // -------- Added by K.L.Venkatraman on 21 Jul 2009 Till here                    if (t_Status_Type == 4) {                        procedureParams_OutputMap = tltAdatptSubObject.t_Uncomplete_Lot_Api(t_Lot_Rec.Transaction_Id, // i_line_number,                        null, t_Factory_Id, t_Organization_Id, t_Lot_Rec.New_Txn_Qty, t_Wip_Entity_Id, t_Inventory_Item_Id, t_Job_Name, t_Lot_Rec.Lot_Id, t_Lot_Rec.Transaction_Date, // nvl ( t_lot_rec.new_uom_code, t_lot_rec.old_uom_code),                        t_Oracle_Uom, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // -- tLotUtilsObject.T_Update_Txn_Status(t_lot_rec.transaction_id,                        // --          null,                        // --          t_status_code,                        // --          t_error_code,                        // --          t_error_message,                        // --          GET                        // --         );                        if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    } else {                        // --Deepak 24 Dec,02  --lot is completed but status type not updated.                        Sql = "SELECT  Last_Operation_Seq_Num " + " From Wsm_Parameters " + " Where Organization_Id = ?  ";                        preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                        preparedStatement.setObject(1, t_Organization_Id);                        resultSet = preparedStatement.executeQuery();                        resultSet.last();                        totalRows = resultSet.getRow();                        resultSet.beforeFirst();                        if (totalRows > 1) {                            throw new SQLException("Too Many Rows");                        }                        if (resultSet.next() == false) {                            throw new No_Data_Found("No Data Found");                        } else {                            t_Last_Op_Seq_Num = resultSet.getInt(1);                        }                        try {                            Sql = "SELECT  x " + " From Wip_Operations " + " Where Wip_Entity_Id = ? " + " And Operation_Seq_Num = ? " + " And Quantity_Waiting_To_Move > ?  ";                            preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                            preparedStatement.setObject(1, t_Wip_Entity_Id);                            preparedStatement.setObject(2, t_Last_Op_Seq_Num);                            preparedStatement.setObject(3, 0);                            resultSet = preparedStatement.executeQuery();                            resultSet.last();                            totalRows = resultSet.getRow();                            resultSet.beforeFirst();                            if (totalRows > 1) {                                throw new SQLException("Too Many Rows");                            }                            if (resultSet.next() == false) {                                throw new No_Data_Found("No Data Found");                            } else {                                t_Dummy = resultSet.getString(1);                            }                            t_Status_Code = Reset_Code;                            t_Error_Message = "Cannot Uncomplete.Waiting for lot to be completed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        } catch (No_Data_Found e) {                            logger.error(e);                            t_Status_Code = Reset_Code;                            t_Error_Code = 6186;                            t_Error_Message = "Cannot Uncomplete.Lot is not completed";                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                    }                }                t_Stmt_Num = 1050;                // --Hold or Release Lot                // --,CHANGESCHEDDATE --Add this later MohanVamsi                if (("HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && (t_Status_Type == 3 || t_Status_Type == 6)) {                    t_Rows_Updated = 0;                    x_Status_Code = 0;                    // --Added from here By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface,                    // --Get Lot Type Details, Even though its not required it is being invoked for now, after testing remove this.                    procedureParams_OutputMap = tLotUtilsObject.T_Get_Lot_Type_Details(t_Factory_Id, t_Lot_Rec.New_Lot_Type, x_Track_In_Oracle, t_Class_Code, t_Bonus_Account_Id, t_Suspense_Account_Id, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("o_Track_In_Oracle") != null) {                        x_Track_In_Oracle = (java.lang.Integer) procedureParams_OutputMap.get("o_Track_In_Oracle");                    }                    if (procedureParams_OutputMap.get("o_Class_Code") != null) {                        t_Class_Code = (java.lang.String) procedureParams_OutputMap.get("o_Class_Code");                    }                    if (procedureParams_OutputMap.get("o_Bonus_Account_Id") != null) {                        t_Bonus_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Bonus_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Suspense_Account_Id") != null) {                        t_Suspense_Account_Id = (java.lang.Integer) procedureParams_OutputMap.get("o_Suspense_Account_Id");                    }                    if (procedureParams_OutputMap.get("o_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Status_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("o_Error_Code");                    }                    if (procedureParams_OutputMap.get("o_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("o_Error_Message");                    }                    logger.debug("T_Transact_Lots: Action_Code is: " + t_Lot_Rec.Action_Code);                    logger.debug("T_Transact_Lots: Action_Code is: " + t_Lot_Rec.Action_Code);                    if (t_Lot_Rec.Action_Code.equals("HOLD")) {                        t_Wip_Status = "H";                    } else if (t_Lot_Rec.Action_Code.equals("RELEASE")) {                        t_Wip_Status = "R";                    } else if (t_Lot_Rec.Action_Code.equals("CANCEL")) {                        t_Wip_Status = "C";                    } else if (t_Lot_Rec.Action_Code.equals("CHANGESCHEDDATE")) {                        t_Wip_Status = "U";                    }                    logger.debug("T_Transact_Lots: Before Calling Tltadapt.T_Update_Wip_Status_Api, T_Wip_Status: " + t_Wip_Status);                    logger.debug("T_Transact_Lots: Before Calling Tltadapt.T_Update_Wip_Status_Api, T_Wip_Status: " + t_Wip_Status);                    try {                        t_Stmt_Num = (int) 1050.10;                        procedureParams_OutputMap = tltAdatptSubObject.t_Update_Wip_Status_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, t_Organization_Id, t_Wip_Entity_Id, t_Inventory_Item_Id, // T_FIRM_PLANNED_FLAG, Use this if required for Planning                        null, t_Lot_Rec.Transaction_Date, i_User_Id, t_Wip_Status, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                    } catch (Exception e2) {                        logger.error(e2, e2);                        logger.debug("T_Transact_Lots: Error in calling Proc:" + ((SQLException) e2).getSQLState() + ", At Stmt_num-" + t_Stmt_Num);                        logger.debug("T_Transact_Lots: Error in calling Proc:" + ((SQLException) e2).getSQLState() + ", At Stmt_num-" + t_Stmt_Num);                    }                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        logger.debug("T_Transact_Lots: After Calling Tltadapt.T_Update_Wip_Status_Api, Status: " + t_Status_Code);                        logger.debug("T_Transact_Lots: After Calling Tltadapt.T_Update_Wip_Status_Api, Status: " + t_Status_Code);                        logger.debug("T_Transact_Lots: Going to Update T_Lots and T_Oracle_Jobs");                        logger.debug("T_Transact_Lots: Going to Update T_Lots and T_Oracle_Jobs");                        if (t_Lot_Rec.Action_Code.toUpperCase().equals("HOLD")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for HOLD");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for HOLD");                            try {                                t_Stmt_Num = (int) 1050.25;                                Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                try {                                    t_Stmt_Num = (int) 1050.30;                                    Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                    }                                    t_Status_Code = 3;                                    t_Error_Code = (int) 8319.25;                                    t_Error_Message = "Lot is already in Hold, Transaction Ignored-" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                } catch (No_Data_Found e3) {                                    logger.error(e3);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 8319.30;                                    t_Error_Message = "Check if Lot is Completed -" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            }                            Sql = "UPDATE t_Lots " + " Set Remarks = ? , Status = H " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Lot_Rec.Message_Id);                            preparedStatement.setObject(2, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(3, t_Factory_Id);                            updateCount = preparedStatement.executeUpdate();                            Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = H " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            updateCount = preparedStatement.executeUpdate();                            t_Status_Code = Success_Code;                            // -- END IF;                        } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("RELEASE")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for RELEASE");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for RELEASE");                            try {                                t_Stmt_Num = (int) 1050.35;                                Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                                preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                preparedStatement.setObject(2, t_Factory_Id);                                resultSet = preparedStatement.executeQuery();                                resultSet.last();                                totalRows = resultSet.getRow();                                resultSet.beforeFirst();                                if (totalRows > 1) {                                    throw new SQLException("Too Many Rows");                                }                                if (resultSet.next() == false) {                                    throw new No_Data_Found("No Data Found");                                } else {                                    t_Unique_Id = resultSet.getInt(1);                                }                            } catch (No_Data_Found e) {                                logger.error(e);                                try {                                    t_Stmt_Num = (int) 1050.40;                                    Sql = "SELECT  Unique_Id " + " From t_Lots " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = A  ";                                    preparedStatement = connection.prepareStatement(Sql, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);                                    preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                                    preparedStatement.setObject(2, t_Factory_Id);                                    resultSet = preparedStatement.executeQuery();                                    resultSet.last();                                    totalRows = resultSet.getRow();                                    resultSet.beforeFirst();                                    if (totalRows > 1) {                                        throw new SQLException("Too Many Rows");                                    }                                    if (resultSet.next() == false) {                                        throw new No_Data_Found("No Data Found");                                    } else {                                        t_Unique_Id = resultSet.getInt(1);                                    }                                    t_Status_Code = 3;                                    t_Error_Code = (int) 8319.35;                                    t_Error_Message = "Lot is already Released, Transaction Ignored-" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                } catch (No_Data_Found e2) {                                    logger.error(e2);                                    t_Status_Code = Failure_Code;                                    t_Error_Code = (int) 8319.40;                                    t_Error_Message = "Check if Lot is Completed -" + t_Stmt_Num + "-" + e.getSQLState();                                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                    }                                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                    }                                }                            }                            // --Will Ignore the Txn if Lot is already Released                            Sql = "UPDATE t_Lots " + " Set Remarks = null , Status = A " + " Where Lot_Id = ? " + " And Factory_Id = ? " + " And Status = H  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Lot_Rec.Lot_Id);                            preparedStatement.setObject(2, t_Factory_Id);                            updateCount = preparedStatement.executeUpdate();                            Sql = "UPDATE t_Oracle_Jobs " + " Set Active_Flag = A " + " Where Lot_Id = ?  ";                            preparedStatement = connection.prepareStatement(Sql);                            preparedStatement.setObject(1, t_Unique_Id);                            updateCount = preparedStatement.executeUpdate();                            t_Hold_Value = null;                            t_Status_Code = Success_Code;                            // --END IF;                        } else if (t_Lot_Rec.Action_Code.toUpperCase().equals("CANCEL")) {                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for CANCEL");                            logger.debug("T_Transact_Lots: Updating T_Lots and T_Oracle_Jobs for CANCEL");                            try {                                t_Stmt_Num = (int) 1050.45;                                Sql = "UPDATE t_Oracle_Jobs " + // Inactive                                " Set Status      = ? ,  " + // Terminated                                " Active_Flag = T  " + " Where Wip_Entity_Id = ?  ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, 2);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                updateCount = preparedStatement.executeUpdate();                                Sql = "UPDATE t_Lots " + // Terminated                                " Set Status = T ,  " + // --Lot_Id= CANCEL~||decode(substr(lot_id,1,7),CANCEL~,substr(lot_id,8),lot_id), --Deepak 26 Dec,02                                " Remarks = Lot cancelled due to transaction- || " + " ? " + " Where Unique_Id In " + "  ( Select Lot_Id " + " From t_Oracle_Jobs " + " Where Wip_Entity_Id = ? )   ";                                preparedStatement = connection.prepareStatement(Sql);                                preparedStatement.setObject(1, i_Transaction_Id);                                preparedStatement.setObject(2, t_Wip_Entity_Id);                                updateCount = preparedStatement.executeUpdate();                                t_Status_Code = Success_Code;                            } catch (SQLException e) {                                logger.error(e, e);                                t_Status_Code = Reject_Code;                            }                            if (t_Status_Code == Success_Code) {                                procedureParams_OutputMap = Log_Message("Lot is Successfully Cancelled");                                t_Error_Code = null;                                t_Error_Message = null;                            } else {                                procedureParams_OutputMap = Log_Message("Errored in Cancelling the Lot: " + t_Error_Message);                            }                        }                        logger.debug("T_Transact_Lots: Successfully Updated T_Lots and T_Oracle_Jobs for Action: " + t_Lot_Rec.Action_Code);                        logger.debug("T_Transact_Lots: Successfully Updated T_Lots and T_Oracle_Jobs for Action: " + t_Lot_Rec.Action_Code);                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    // --Added By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface                    /* --Commented below By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface IF UPPER(T_LOT_REC.ACTION_CODE) = HOLD THEN UPDATE WIP_DISCRETE_JOBS SET STATUS_TYPE = 6 WHERE WIP_ENTITY_ID = T_WIP_ENTITY_ID; --Commented and Added with Exception by MohanVamsi 4th Dec09 --to ignore if Lot is already in Hold --SELECT UNIQUE_ID --  INTO T_UNIQUE_ID --  FROM T_LOTS -- WHERE LOT_ID = T_LOT_REC.LOT_ID --   AND FACTORY_ID = T_FACTORY_ID --   AND STATUS = A; BEGIN T_STMT_NUM := 1050.25; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; EXCEPTION WHEN NO_DATA_FOUND THEN BEGIN T_STMT_NUM := 1050.30; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; T_STATUS_CODE   := 3; T_ERROR_CODE    := 8319.25; T_ERROR_MESSAGE := Lot is already in Hold, Transaction Ignored- || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); EXCEPTION WHEN NO_DATA_FOUND THEN T_STATUS_CODE   := FAILURE_CODE; T_ERROR_CODE    := 8319.30; T_ERROR_MESSAGE := Check if Lot is Completed - || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); END; END; -- Added by MohanVamsi to ignore if Lot is already in Hold UPDATE T_LOTS SET REMARKS = T_LOT_REC.MESSAGE_ID, STATUS  = H WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; UPDATE T_ORACLE_JOBS SET ACTIVE_FLAG = H WHERE LOT_ID = T_UNIQUE_ID; T_STATUS_CODE := SUCCESS_CODE; END IF; IF UPPER(T_LOT_REC.ACTION_CODE) = RELEASE THEN UPDATE WIP_DISCRETE_JOBS SET STATUS_TYPE = 3 WHERE WIP_ENTITY_ID = T_WIP_ENTITY_ID AND STATUS_TYPE = 6; --Commented and Added with Exception by MohanVamsi 4th Dec09 -- to ignore if Lot is already Released --SELECT UNIQUE_ID --  INTO T_UNIQUE_ID --  FROM T_LOTS -- WHERE LOT_ID = T_LOT_REC.LOT_ID --   AND FACTORY_ID = T_FACTORY_ID --   AND STATUS = H; BEGIN T_STMT_NUM := 1050.35; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; EXCEPTION WHEN NO_DATA_FOUND THEN BEGIN T_STMT_NUM := 1050.40; SELECT UNIQUE_ID INTO T_UNIQUE_ID FROM T_LOTS WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = A; T_STATUS_CODE   := 3; T_ERROR_CODE    := 8319.35; T_ERROR_MESSAGE := Lot is already Released, Transaction Ignored- || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); EXCEPTION WHEN NO_DATA_FOUND THEN T_STATUS_CODE   := FAILURE_CODE; T_ERROR_CODE    := 8319.40; T_ERROR_MESSAGE := Check if Lot is Completed - || T_STMT_NUM || - || SQLERRM; tLotUtilsObject.T_Update_Txn_Status(T_LOT_REC.TRANSACTION_ID, NULL, T_STATUS_CODE, T_ERROR_CODE, T_ERROR_MESSAGE, SET); END; END; --Added by MohanVamsi to ignore if Lot is already Released UPDATE T_LOTS SET REMARKS = NULL, STATUS  = A WHERE LOT_ID = T_LOT_REC.LOT_ID AND FACTORY_ID = T_FACTORY_ID AND STATUS = H; UPDATE T_ORACLE_JOBS SET ACTIVE_FLAG = A WHERE LOT_ID = T_UNIQUE_ID; --update t_parent_lots_Api --set status_code =success_code --where transaction_id = t_lot_rec.transaction_id; T_HOLD_VALUE := NULL; T_STATUS_CODE := SUCCESS_CODE; END IF; IF UPPER(T_LOT_REC.ACTION_CODE) = CANCEL THEN BEGIN TLTADAPT.T_CANCEL_WIPLOT_API(T_LOT_REC.TRANSACTION_ID, --  i_transaction_id 0, --  i_line_number T_FACTORY_ID, --  i_factory_id T_ORGANIZATION_ID, --  i_organization_id T_WIP_ENTITY_ID, --  i_wip_entity_id T_INVENTORY_ITEM_ID, --  i_inventory_item_id T_LOT_REC.TRANSACTION_DATE, --  i_transaction_date I_USER_ID, --  i_user_id T_STATUS_CODE, --      out T_ERROR_CODE, --     out T_ERROR_MESSAGE --         out ); IF T_STATUS_CODE = 3 THEN LOG_MESSAGE(Successfully cancelled the lot); T_ERROR_CODE    := NULL; T_ERROR_MESSAGE := NULL; ELSE LOG_MESSAGE(Errored in Cancel proc  || T_ERROR_MESSAGE); END IF; EXCEPTION WHEN OTHERS THEN LOG_MESSAGE(Error in calling proc- || SQLERRM || - at stmt_num- || T_STMT_NUM); END; END IF;*/                    // --Commented By MohanVamsi 24th Sep09 as Wip Status Update is now through Interface                    // Sql%Rowcount;                    t_Rows_Updated = updateCount;                    // --t_status_code :=success_code;                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                    if (t_Lot_Rec.Action_Code.equals("RELEASE") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "3";                    } else if (t_Lot_Rec.Action_Code.equals("HOLD") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "6";                    } else if (t_Lot_Rec.Action_Code.equals("CANCEL") && t_Hold_Column.equals("STATUS_TYPE")) {                        t_Hold_Value = "7";                    } else if (t_Lot_Rec.Action_Code.equals("RELEASE") && (!t_Hold_Column.equals("STATUS_TYPE"))) {                        t_Hold_Value = "LotReleased";                    }                    t_Stmt_Num = 1060;                    // -- update the attribute columns, message_id stores the hold reason                    if (("HOLD".equals(t_Lot_Rec.Action_Code) || "RELEASE".equals(t_Lot_Rec.Action_Code))) {                        if (t_Rows_Updated == 1) {                            // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                            t_Sql_String = " update wip_discrete_jobs  " + " set  " + t_Hold_Column + "  =  " + t_Lot_Rec.Message_Id + "  " + " where wip_entity_id      =  " + t_Wip_Entity_Id + "  ";                            /*    t_message_id:=  t_lot_rec.message_id;    try{    execute immediate t_sql_string using t_message_id,t_wip_entity_id;    exception    when others then    t_status_code :=failure_code;    t_error_code  :=2460;    t_error_message :="Error in dyn sql while updating job details-"||sqlerrm;    tLotUtilsObject.T_Update_Txn_Status ( t_lot_rec.transaction_id,    null,    t_status_code,    t_error_code,    t_error_message,    "SET"    );    goto end_transact_loop;        */                            try {                                // t_Cursor  =  Dbms_Sql.Open_Cursor ;                                // Dbms_Sql.Parse  (  t_Cursor ,  t_Sql_String ,  Dbms_Sql.Native )  ;                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "t_hold_value",t_Lot_Rec.Message_Id);                                // Dbms_Sql.Bind_Variable  (  t_Cursor ,  "t_wip_entity_id",t_Wip_Entity_Id);                                // x_Status_Code  =  Dbms_Sql.Execute  (  t_Cursor )  ; ;                                preparedStatement = connection.prepareStatement(t_Sql_String);                                x_Status_Code = preparedStatement.executeUpdate();                                if (x_Status_Code == 1) {                                    // if  (  Dbms_Sql.Is_Opent_Cursor )                                    {                                        // Dbms_Sql.Close_Cursor ( t_Cursor);                                    }                                    // Added by Suchi                                    // Goto End_Transact_Loop;                                    break end_Transact_Loop;                                }                            } catch (SQLException e) {                                logger.error(e, e);                                // if  (  Dbms_Sql.Is_Opent_Cursor )                                {                                    // Dbms_Sql.Close_Cursor ( t_Cursor);                                }                                t_Status_Code = Failure_Code;                                t_Error_Code = 2460;                                t_Error_Message = "Error in dyn sql while updating job details-" + e.getSQLState();                                procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                                if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                    t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                    t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                                }                                if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                    t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                                }                                // Goto End_Transact_Loop;                                break end_Transact_Loop;                            }                        } else {                            t_Status_Code = Failure_Code;                            t_Error_Code = 2480;                            t_Error_Message = "Job must be in transactable status.Released ( 3),complete ( 4) or On Hold ( 6) . Check wip_discrete_jobs-" + t_Wip_Entity_Id;                            procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                            if (procedureParams_OutputMap.get("i_Status_Code") != null) {                                t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Code") != null) {                                t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                            }                            if (procedureParams_OutputMap.get("i_Error_Message") != null) {                                t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                            }                            // Goto End_Transact_Loop;                            break end_Transact_Loop;                        }                        // rowcount is 1                    }                    // hold/release                } else if (("HOLD".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "RELEASE".equals(t_Lot_Rec.Action_Code.toUpperCase()) || "CANCEL".equals(t_Lot_Rec.Action_Code.toUpperCase())) && !(t_Status_Type == 3 || t_Status_Type == 6)) {                    t_Status_Code = Success_Code;                    t_Error_Message = "Lot not in transactable status in Oracle. Cannot Hold/Release";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                // hold/release                t_Stmt_Num = 1070;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CONSUME")) {                    Log_Msg = "T_Transact_Lots: Calling Xtended_validations at stmt no: " + t_Stmt_Num;                    procedureParams_OutputMap = Log_Message(Log_Msg);                    procedureParams_OutputMap = Log_Message(Log_Msg);                    // -- how to differentiate between push and return :1                    procedureParams_OutputMap = t_Xtended_Validations(t_Factory_Id, t_Lot_Rec.Transaction_Id, t_Lot_Rec, null, t_Lot_Rec.Lot_Id, t_Organization_Id, t_Inventory_Item_Id, t_Lot_Rec.New_Uom_Code, t_Lot_Rec.New_Txn_Qty, null, // Upper ( t_Lot_Rec.Action_Code),                    (t_Lot_Rec.Action_Code).toUpperCase(), t_Status_Code, t_Error_Code, t_Error_Message, null, null, null, null, null);                    if (procedureParams_OutputMap.get("i_Txn_Qty") != null) {                        t_Lot_Rec.New_Txn_Qty = (java.lang.Integer) procedureParams_OutputMap.get("i_Txn_Qty");                    }                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    if ((t_Status_Code == Failure_Code || t_Status_Code == Reject_Code)) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    } else if (t_Status_Code == Success_Code) {                        // --t_check_bom:=false; --Deepak 03 Jan,03                        procedureParams_OutputMap = tltAdatpObject.t_Consume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Factory_Id, // i_transaction_interface_id,                        null, t_Wip_Entity_Id, Y, i_User_Id, t_Lot_Rec, t_Check_Bom, t_Status_Code, t_Error_Code, t_Error_Message);                        if (procedureParams_OutputMap.get("t_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                        }                        if (procedureParams_OutputMap.get("t_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                }                // --return components.                t_Stmt_Num = 1080;                if (t_Lot_Rec.Action_Code.toUpperCase().equals("UNCONSUME")) {                    // check if job is in wip                    tLotUtilsObject.t_Get_Lot_Status(t_Factory_Id, t_Organization_Id, t_Lot_Rec.Lot_Id, t_Lot_Position, t_Job_Name, t_Wip_Entity_Id, x_Inventory_Item_Id, t_Wip_Qty, t_Status_Type.toString(), t_Status_Code, t_Error_Code, t_Error_Message, null);                    if (t_Job_Name == null || t_Status_Code != Success_Code) {                        procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                        if (procedureParams_OutputMap.get("i_Status_Code") != null) {                            t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Code") != null) {                            t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                        }                        if (procedureParams_OutputMap.get("i_Error_Message") != null) {                            t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                        }                        // Goto End_Transact_Loop;                        break end_Transact_Loop;                    }                    procedureParams_OutputMap = tltAdatpObject.t_Unconsume_Lot_Api(t_Lot_Rec.Transaction_Id, t_Organization_Id, t_Factory_Id, t_Inventory_Item_Id, t_Wip_Entity_Id, i_User_Id, t_Lot_Rec, t_Status_Code, t_Error_Code, t_Error_Message);                    if (procedureParams_OutputMap.get("t_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Status_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("t_Error_Code");                    }                    if (procedureParams_OutputMap.get("t_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("t_Error_Message");                    }                    // Goto End_Transact_Loop;                    break end_Transact_Loop;                }                if (t_Lot_Rec.Action_Code.toUpperCase().equals("CHANGEATTRIBUTE")) {                    // --**** IG Transactions not usefull                    t_Status_Code = Success_Code;                    t_Error_Message = "IG Transaction";                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                }                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper is thru with the validations");                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper Wip Entity ID: " + t_Wip_Entity_Id);                procedureParams_OutputMap = Log_Message("T_Transact_Lots: The wrapper Job:" + t_Job_Name);                t_Stmt_Num = 1090;                connection.commit();                // --  t_rows_processed := t_rows_processed + 1;                // <<end_Transact_Loop>>                // null;                t_Stmt_Num = 1100;                // if  (  Dbms_Sql.Is_Opent_Cursor )                {                    // Dbms_Sql.Close_Cursor ( t_Cursor);                }                // --Deepak 18/12/02 for tracking unhandled exception            } catch (SQLException e) {                logger.error(e, e);                // if  (  Dbms_Sql.Is_Opent_Cursor )                {                    // Dbms_Sql.Close_Cursor ( t_Cursor);                }                t_Status_Code = Failure_Code;                t_Error_Code = 8320;                t_Error_Message = "T_Transact_Lots: Error in Lot_Rec{at stmt: " + t_Stmt_Num + ", Err Msg:" + e.getSQLState();                try {                    // --Added Begin/Exception by MohanVamsi 12th May 2010 to Error Out in TPLA and So that User                    // --can understand the error                    procedureParams_OutputMap = tLotUtilsObject.T_Update_Txn_Status(t_Lot_Rec.Transaction_Id, null, t_Status_Code, t_Error_Code, t_Error_Message, "SET");                    if (procedureParams_OutputMap.get("i_Status_Code") != null) {                        t_Status_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Status_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Code") != null) {                        t_Error_Code = (java.lang.Integer) procedureParams_OutputMap.get("i_Error_Code");                    }                    if (procedureParams_OutputMap.get("i_Error_Message") != null) {                        t_Error_Message = (java.lang.String) procedureParams_OutputMap.get("i_Error_Message");                    }                } catch (Exception e2) {                    logger.error(e2, e2);                    // --As we cant make use of tLotUtilsObject.T_Update_Txn_Status if tLotUtilsObject is in INVALID.                    Sql = "UPDATE t_Parent_Lots_Api Tpla " + " Set Status_Code      = ? , " + " Error_Code       = ? , " + " Error_Message    = ? , " + " Last_Update_Date = Sysdate " + " Where Transaction_Id = " + t_Lot_Rec.Transaction_Id;                    preparedStatement = connection.prepareStatement(Sql);                    preparedStatement.setObject(1, t_Status_Code);                    preparedStatement.setObject(2, t_Error_Code);                    preparedStatement.setObject(3, t_Error_Message);                    preparedStatement.executeUpdate();                    connection.commit();                    logger.debug(i_Error_Message);                    procedureParams_OutputMap = Log_Message(i_Error_Message);                }                // --Added by MohanVamsi 12th May 2010 to Error Out in TPLA and So that User                // --can understand the error            }        }        // Main{        if (i_Transaction_Id == null) {            Sql = "UPDATE t_Factories " + " Set Lot_Process_Status = ? " + " Where Factory_Id = ?  ";            preparedStatement = connection.prepareStatement(Sql);            preparedStatement.setObject(1, 1);            preparedStatement.setObject(2, t_Factory_Id);            preparedStatement.executeUpdate();        }        // if  (  Dbms_Sql.Is_Opent_Cursor )        {            // Dbms_Sql.Close_Cursor ( t_Cursor);        }        i_Error_Code = null;        i_Error_Message = null;        connection.commit();        return methodParams_OutputMap;    }}    ');
            var rect276 = rect.clone();
            rect276.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect276.attr('label/text', flowChartNode);
            rect276.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Line No-22000: return methodParams_OutputMap;    ');
            var rect277 = rect.clone();
            rect277.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect277.attr('label/text', flowChartNode);
            rect277.addTo(javaStatementsGraph);

            flowChartNode = getBrokenText('Stop    ');
            var rect278 = ellipse.clone();
            rect278.resize(maxNodeWidth, ((flowChartNode.match(/\n/g) || []).length + 2) * 15);
            rect278.attr('text/text', flowChartNode);
            rect278.addTo(javaStatementsGraph);


            var link139 = link.clone();
            link139.source(rect139);
            link139.target(rect140);
            link139.addTo(javaStatementsGraph);

            var link140 = link.clone();
            link140.source(rect140);
            link140.target(rect141);
            link140.addTo(javaStatementsGraph);

            var link141 = link.clone();
            link141.source(rect141);
            link141.target(rect142);
            link141.addTo(javaStatementsGraph);

            var link142 = link.clone();
            link142.source(rect142);
            link142.target(rect143);
            link142.addTo(javaStatementsGraph);

            var link143 = link.clone();
            link143.source(rect143);
            link143.target(rect144);
            link143.addTo(javaStatementsGraph);

            var link144 = link.clone();
            link144.source(rect144);
            link144.target(rect145);
            link144.addTo(javaStatementsGraph);

            var link145 = link.clone();
            link145.source(rect145);
            link145.target(rect146);
            link145.addTo(javaStatementsGraph);

            var link146 = link.clone();
            link146.source(rect146);
            link146.target(rect147);
            link146.addTo(javaStatementsGraph);

            var link147 = link.clone();
            link147.source(rect147);
            link147.target(rect148);
            link147.addTo(javaStatementsGraph);

            var link148 = link.clone();
            link148.source(rect148);
            link148.target(rect149);
            link148.addTo(javaStatementsGraph);

            var link149 = link.clone();
            link149.source(rect149);
            link149.target(rect150);
            link149.addTo(javaStatementsGraph);

            var link150 = link.clone();
            link150.source(rect150);
            link150.target(rect151);
            link150.addTo(javaStatementsGraph);

            var link151 = link.clone();
            link151.source(rect151);
            link151.target(rect152);
            link151.addTo(javaStatementsGraph);

            var link152 = link.clone();
            link152.source(rect152);
            link152.target(rect153);
            link152.addTo(javaStatementsGraph);

            var link153 = link.clone();
            link153.source(rect153);
            link153.target(rect154);
            link153.addTo(javaStatementsGraph);

            var link154 = link.clone();
            link154.source(rect154);
            link154.target(rect155);
            link154.addTo(javaStatementsGraph);

            var link155 = link.clone();
            link155.source(rect155);
            link155.target(rect156);
            link155.addTo(javaStatementsGraph);

            var link156 = link.clone();
            link156.source(rect156);
            link156.target(rect157);
            link156.addTo(javaStatementsGraph);

            var link157 = link.clone();
            link157.source(rect157);
            link157.target(rect158);
            link157.addTo(javaStatementsGraph);

            var link158 = link.clone();
            link158.source(rect158);
            link158.target(rect159);
            link158.addTo(javaStatementsGraph);

            var link159 = link.clone();
            link159.source(rect159);
            link159.target(rect160);
            link159.addTo(javaStatementsGraph);

            var link160 = link.clone();
            link160.source(rect160);
            link160.target(rect161);
            link160.addTo(javaStatementsGraph);

            var link161 = link.clone();
            link161.source(rect161);
            link161.target(rect162);
            link161.addTo(javaStatementsGraph);

            var link162 = link.clone();
            link162.source(rect162);
            link162.target(rect163);
            link162.addTo(javaStatementsGraph);

            var link163 = link.clone();
            link163.source(rect163);
            link163.target(rect164);
            link163.addTo(javaStatementsGraph);

            var link164 = link.clone();
            link164.source(rect164);
            link164.target(rect165);
            link164.addTo(javaStatementsGraph);

            var link165 = link.clone();
            link165.source(rect165);
            link165.target(rect166);
            link165.addTo(javaStatementsGraph);

            var link166 = link.clone();
            link166.source(rect166);
            link166.target(rect167);
            link166.addTo(javaStatementsGraph);

            var link167 = link.clone();
            link167.source(rect167);
            link167.target(rect168);
            link167.addTo(javaStatementsGraph);

            var link168 = link.clone();
            link168.source(rect168);
            link168.target(rect169);
            link168.addTo(javaStatementsGraph);

            var link169 = link.clone();
            link169.source(rect169);
            link169.target(rect170);
            link169.addTo(javaStatementsGraph);

            var link170 = link.clone();
            link170.source(rect170);
            link170.target(rect171);
            link170.addTo(javaStatementsGraph);

            var link171 = link.clone();
            link171.source(rect171);
            link171.target(rect172);
            link171.addTo(javaStatementsGraph);

            var link172 = link.clone();
            link172.source(rect172);
            link172.target(rect173);
            link172.addTo(javaStatementsGraph);

            var link173 = link.clone();
            link173.source(rect173);
            link173.target(rect174);
            link173.addTo(javaStatementsGraph);

            var link174 = link.clone();
            link174.source(rect174);
            link174.target(rect175);
            link174.addTo(javaStatementsGraph);

            var link175 = link.clone();
            link175.source(rect175);
            link175.target(rect176);
            link175.addTo(javaStatementsGraph);

            var link176 = link.clone();
            link176.source(rect176);
            link176.target(rect177);
            link176.addTo(javaStatementsGraph);

            var link177 = link.clone();
            link177.source(rect177);
            link177.target(rect178);
            link177.addTo(javaStatementsGraph);

            var link178 = link.clone();
            link178.source(rect178);
            link178.target(rect179);
            link178.addTo(javaStatementsGraph);

            var link179 = link.clone();
            link179.source(rect179);
            link179.target(rect180);
            link179.addTo(javaStatementsGraph);

            var link180 = link.clone();
            link180.source(rect180);
            link180.target(rect181);
            link180.addTo(javaStatementsGraph);

            var link181 = link.clone();
            link181.source(rect181);
            link181.target(rect182);
            link181.addTo(javaStatementsGraph);

            var link182 = link.clone();
            link182.source(rect182);
            link182.target(rect183);
            link182.addTo(javaStatementsGraph);

            var link183 = link.clone();
            link183.source(rect183);
            link183.target(rect184);
            link183.addTo(javaStatementsGraph);

            var link184 = link.clone();
            link184.source(rect184);
            link184.target(rect185);
            link184.addTo(javaStatementsGraph);

            var link185 = link.clone();
            link185.source(rect185);
            link185.target(rect186);
            link185.addTo(javaStatementsGraph);

            var link186 = link.clone();
            link186.source(rect186);
            link186.target(rect187);
            link186.addTo(javaStatementsGraph);

            var link187 = link.clone();
            link187.source(rect187);
            link187.target(rect188);
            link187.addTo(javaStatementsGraph);

            var link188 = link.clone();
            link188.source(rect188);
            link188.target(rect189);
            link188.addTo(javaStatementsGraph);

            var link189 = link.clone();
            link189.source(rect189);
            link189.target(rect190);
            link189.addTo(javaStatementsGraph);

            var link190 = link.clone();
            link190.source(rect190);
            link190.target(rect191);
            link190.addTo(javaStatementsGraph);

            var link191 = link.clone();
            link191.source(rect191);
            link191.target(rect192);
            link191.addTo(javaStatementsGraph);

            var link192 = link.clone();
            link192.source(rect192);
            link192.target(rect193);
            link192.addTo(javaStatementsGraph);

            var link193 = link.clone();
            link193.source(rect193);
            link193.target(rect194);
            link193.addTo(javaStatementsGraph);

            var link194 = link.clone();
            link194.source(rect194);
            link194.target(rect195);
            link194.addTo(javaStatementsGraph);

            var link195 = link.clone();
            link195.source(rect195);
            link195.target(rect196);
            link195.addTo(javaStatementsGraph);

            var link196 = link.clone();
            link196.source(rect196);
            link196.target(rect197);
            link196.addTo(javaStatementsGraph);

            var link197 = link.clone();
            link197.source(rect197);
            link197.target(rect198);
            link197.addTo(javaStatementsGraph);

            var link198 = link.clone();
            link198.source(rect198);
            link198.target(rect199);
            link198.addTo(javaStatementsGraph);

            var link199 = link.clone();
            link199.source(rect199);
            link199.target(rect200);
            link199.addTo(javaStatementsGraph);

            var link200 = link.clone();
            link200.source(rect200);
            link200.target(rect201);
            link200.addTo(javaStatementsGraph);

            var link201 = link.clone();
            link201.source(rect201);
            link201.target(rect202);
            link201.addTo(javaStatementsGraph);

            var link202 = link.clone();
            link202.source(rect202);
            link202.target(rect203);
            link202.addTo(javaStatementsGraph);

            var link203 = link.clone();
            link203.source(rect203);
            link203.target(rect204);
            link203.addTo(javaStatementsGraph);

            var link204 = link.clone();
            link204.source(rect204);
            link204.target(rect205);
            link204.addTo(javaStatementsGraph);

            var link205 = link.clone();
            link205.source(rect205);
            link205.target(rect206);
            link205.addTo(javaStatementsGraph);

            var link206 = link.clone();
            link206.source(rect206);
            link206.target(rect207);
            link206.addTo(javaStatementsGraph);

            var link207 = link.clone();
            link207.source(rect207);
            link207.target(rect208);
            link207.addTo(javaStatementsGraph);

            var link208 = link.clone();
            link208.source(rect208);
            link208.target(rect209);
            link208.addTo(javaStatementsGraph);

            var link209 = link.clone();
            link209.source(rect209);
            link209.target(rect210);
            link209.addTo(javaStatementsGraph);

            var link210 = link.clone();
            link210.source(rect210);
            link210.target(rect211);
            link210.addTo(javaStatementsGraph);

            var link211 = link.clone();
            link211.source(rect211);
            link211.target(rect212);
            link211.addTo(javaStatementsGraph);

            var link212 = link.clone();
            link212.source(rect212);
            link212.target(rect213);
            link212.addTo(javaStatementsGraph);

            var link213 = link.clone();
            link213.source(rect213);
            link213.target(rect214);
            link213.addTo(javaStatementsGraph);

            var link214 = link.clone();
            link214.source(rect214);
            link214.target(rect215);
            link214.addTo(javaStatementsGraph);

            var link215 = link.clone();
            link215.source(rect215);
            link215.target(rect216);
            link215.addTo(javaStatementsGraph);

            var link216 = link.clone();
            link216.source(rect216);
            link216.target(rect217);
            link216.addTo(javaStatementsGraph);

            var link217 = link.clone();
            link217.source(rect217);
            link217.target(rect218);
            link217.addTo(javaStatementsGraph);

            var link218 = link.clone();
            link218.source(rect218);
            link218.target(rect219);
            link218.addTo(javaStatementsGraph);

            var link219 = link.clone();
            link219.source(rect219);
            link219.target(rect220);
            link219.addTo(javaStatementsGraph);

            var link220 = link.clone();
            link220.source(rect220);
            link220.target(rect221);
            link220.addTo(javaStatementsGraph);

            var link221 = link.clone();
            link221.source(rect221);
            link221.target(rect222);
            link221.addTo(javaStatementsGraph);

            var link222 = link.clone();
            link222.source(rect222);
            link222.target(rect223);
            link222.addTo(javaStatementsGraph);

            var link223 = link.clone();
            link223.source(rect223);
            link223.target(rect224);
            link223.addTo(javaStatementsGraph);

            var link224 = link.clone();
            link224.source(rect224);
            link224.target(rect225);
            link224.addTo(javaStatementsGraph);

            var link225 = link.clone();
            link225.source(rect225);
            link225.target(rect226);
            link225.addTo(javaStatementsGraph);

            var link226 = link.clone();
            link226.source(rect226);
            link226.target(rect227);
            link226.addTo(javaStatementsGraph);

            var link227 = link.clone();
            link227.source(rect227);
            link227.target(rect228);
            link227.addTo(javaStatementsGraph);

            var link228 = link.clone();
            link228.source(rect228);
            link228.target(rect229);
            link228.addTo(javaStatementsGraph);

            var link229 = link.clone();
            link229.source(rect229);
            link229.target(rect230);
            link229.addTo(javaStatementsGraph);

            var link230 = link.clone();
            link230.source(rect230);
            link230.target(rect231);
            link230.addTo(javaStatementsGraph);

            var link231 = link.clone();
            link231.source(rect231);
            link231.target(rect232);
            link231.addTo(javaStatementsGraph);

            var link232 = link.clone();
            link232.source(rect232);
            link232.target(rect233);
            link232.addTo(javaStatementsGraph);

            var link233 = link.clone();
            link233.source(rect233);
            link233.target(rect234);
            link233.addTo(javaStatementsGraph);

            var link234 = link.clone();
            link234.source(rect234);
            link234.target(rect235);
            link234.addTo(javaStatementsGraph);

            var link235 = link.clone();
            link235.source(rect235);
            link235.target(rect236);
            link235.addTo(javaStatementsGraph);

            var link236 = link.clone();
            link236.source(rect236);
            link236.target(rect237);
            link236.addTo(javaStatementsGraph);

            var link237 = link.clone();
            link237.source(rect237);
            link237.target(rect238);
            link237.addTo(javaStatementsGraph);

            var link238 = link.clone();
            link238.source(rect238);
            link238.target(rect239);
            link238.addTo(javaStatementsGraph);

            var link239 = link.clone();
            link239.source(rect239);
            link239.target(rect240);
            link239.addTo(javaStatementsGraph);

            var link240 = link.clone();
            link240.source(rect240);
            link240.target(rect241);
            link240.addTo(javaStatementsGraph);

            var link241 = link.clone();
            link241.source(rect241);
            link241.target(rect242);
            link241.addTo(javaStatementsGraph);

            var link242 = link.clone();
            link242.source(rect242);
            link242.target(rect243);
            link242.addTo(javaStatementsGraph);

            var link243 = link.clone();
            link243.source(rect243);
            link243.target(rect244);
            link243.addTo(javaStatementsGraph);

            var link244 = link.clone();
            link244.source(rect244);
            link244.target(rect245);
            link244.addTo(javaStatementsGraph);

            var link245 = link.clone();
            link245.source(rect245);
            link245.target(rect246);
            link245.addTo(javaStatementsGraph);

            var link246 = link.clone();
            link246.source(rect246);
            link246.target(rect247);
            link246.addTo(javaStatementsGraph);

            var link247 = link.clone();
            link247.source(rect247);
            link247.target(rect248);
            link247.addTo(javaStatementsGraph);

            var link248 = link.clone();
            link248.source(rect248);
            link248.target(rect249);
            link248.addTo(javaStatementsGraph);

            var link249 = link.clone();
            link249.source(rect249);
            link249.target(rect250);
            link249.addTo(javaStatementsGraph);

            var link250 = link.clone();
            link250.source(rect250);
            link250.target(rect251);
            link250.addTo(javaStatementsGraph);

            var link251 = link.clone();
            link251.source(rect251);
            link251.target(rect252);
            link251.addTo(javaStatementsGraph);

            var link252 = link.clone();
            link252.source(rect252);
            link252.target(rect253);
            link252.addTo(javaStatementsGraph);

            var link253 = link.clone();
            link253.source(rect253);
            link253.target(rect254);
            link253.addTo(javaStatementsGraph);

            var link254 = link.clone();
            link254.source(rect254);
            link254.target(rect255);
            link254.addTo(javaStatementsGraph);

            var link255 = link.clone();
            link255.source(rect255);
            link255.target(rect256);
            link255.addTo(javaStatementsGraph);

            var link256 = link.clone();
            link256.source(rect256);
            link256.target(rect257);
            link256.addTo(javaStatementsGraph);

            var link257 = link.clone();
            link257.source(rect257);
            link257.target(rect258);
            link257.addTo(javaStatementsGraph);

            var link258 = link.clone();
            link258.source(rect258);
            link258.target(rect259);
            link258.addTo(javaStatementsGraph);

            var link259 = link.clone();
            link259.source(rect259);
            link259.target(rect260);
            link259.addTo(javaStatementsGraph);

            var link260 = link.clone();
            link260.source(rect260);
            link260.target(rect261);
            link260.addTo(javaStatementsGraph);

            var link261 = link.clone();
            link261.source(rect261);
            link261.target(rect262);
            link261.addTo(javaStatementsGraph);

            var link262 = link.clone();
            link262.source(rect262);
            link262.target(rect263);
            link262.addTo(javaStatementsGraph);

            var link263 = link.clone();
            link263.source(rect263);
            link263.target(rect264);
            link263.addTo(javaStatementsGraph);

            var link264 = link.clone();
            link264.source(rect264);
            link264.target(rect265);
            link264.addTo(javaStatementsGraph);

            var link265 = link.clone();
            link265.source(rect265);
            link265.target(rect266);
            link265.addTo(javaStatementsGraph);

            var link266 = link.clone();
            link266.source(rect266);
            link266.target(rect267);
            link266.addTo(javaStatementsGraph);

            var link267 = link.clone();
            link267.source(rect267);
            link267.target(rect268);
            link267.addTo(javaStatementsGraph);

            var link268 = link.clone();
            link268.source(rect268);
            link268.target(rect269);
            link268.addTo(javaStatementsGraph);

            var link269 = link.clone();
            link269.source(rect269);
            link269.target(rect270);
            link269.addTo(javaStatementsGraph);

            var link270 = link.clone();
            link270.source(rect270);
            link270.target(rect271);
            link270.addTo(javaStatementsGraph);

            var link271 = link.clone();
            link271.source(rect271);
            link271.target(rect272);
            link271.addTo(javaStatementsGraph);

            var link272 = link.clone();
            link272.source(rect272);
            link272.target(rect273);
            link272.addTo(javaStatementsGraph);

            var link273 = link.clone();
            link273.source(rect273);
            link273.target(rect274);
            link273.addTo(javaStatementsGraph);

            var link274 = link.clone();
            link274.source(rect274);
            link274.target(rect275);
            link274.addTo(javaStatementsGraph);

            var link275 = link.clone();
            link275.source(rect275);
            link275.target(rect276);
            link275.addTo(javaStatementsGraph);

            var link276 = link.clone();
            link276.source(rect276);
            link276.target(rect277);
            link276.addTo(javaStatementsGraph);

            var link277 = link.clone();
            link277.source(rect277);
            link277.target(rect278);
            link277.addTo(javaStatementsGraph);

            rect139.set('startNode', 'true');
            rect278.set('stopNode', 'true');
            rect278.attr('circle/fill', 'red');
            rect278.translate((maxNodeWidth - 100)/ 2, 0);

            setFlowDiagramFolder('../../../../');
            setIfElseMultiplier(1.1);

            setPaperId(javaStatementsPaper);
            setGraphId(javaStatementsGraph);
            moveNodesOnYAxis(gapBetweenNodes);
            moveIfElseBlocks();
            moveImproperIfElseBlocks();
            moveImproperWhileBlocks();
            moveInvisibleNodes();
            beautifyLoopConnectors();
            alignStopNode(rect139, rect278);
            resizePaper();
            initializePaperBehavior();
        </script>
    </body>
</html>